include structures.h
include enums.h
include macros.h

; TODO
;
; Look at adding scrolling speed commands
;	- getIOwithDelay. This looks to be fairly complicated since there isn't a text_delay a la BT1.
;
; Check the monster breath effects are correct. e.g. "Frozen for xx" instead of "Burned for xx"
;


; Still Testing
;

; DONE
;
; Make monster breathe
; Fix monster special attack
; Divine intervention doesn't convert illusion to real monster
; Make the Up Arrow act like it should.
; Fix a bug where if a monster's attack priority is lower than all of the party's attack priorities the monster can't attack.
; Fix Horn of Gods and Wand of Fury.
; Set a maximum negative AC of -50 to match Apple II. Otherwise it can wrap.
; Fix the incorrect saving throw values for monsters in _savingThrowCheck
; Fix the groupSize when a new monster group is created by summoning
; Clear the monHostile flag after the check.
; Fix the dun_monHostile function to affect the party only when there is a monster in the party.
; Call doSummon() with 15h (Black Slayer) 10 times as Tarjan's only attack.
; COSMETIC: Print a blank line between attacks from a breath attack 
; COSMETIC: Print an '!' after the kill string
; COSMETIC: Fix the output of get_Reward if you leave the chest. It skipped over "you recieved 0 pieces of gold"
; Add text casting of spells
; Lights now stay on when hitting an anti-magic square. 
; Fixed Sorcerer Sight spell to detect more than just trap squares.
; Fixed monster rosters for levels. 
; Fizzle spells when cast on an anti-magic square like BT1 and BT2.
; Print full spell name under "Known Spells" screen of a magic user
; Removed wait4IO from dunsq_doTrap
; Made the outdoor levels outdoor. Basically just call a different setBG routine and make lightDistance 4 in dun_buildView
; COSMETIC: Clear the screen after certain actions in dunMainLoop and wildMainLoop. Messages would linger and be confusing.

.686p
.mmx
.model large

; Segment type:	Pure code
seg000 segment byte public 'CODE' use16
	assume cs:seg000
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
	; Attributes: bp-based frame

_main proc far
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah
	arg_27=	word ptr  2Dh

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	mov	ax, 55h
	push	ax
	call	bigpic_initBuffers
	add	sp, 2
	sub	ax, ax
	push	ax
	mov	ax, offset aThief_cfg
	push	ds
	push	ax
	call	openFile
	add	sp, 6
	mov	[bp+var_4], ax
	inc	ax
	jnz	short loc_10039
	mov	ax, 4
	push	ax
	call	far ptr	sub_28424
	add	sp, 2
loc_10039:
	mov	ax, 6
	push	ax
	mov	ax, offset word_4243A
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	[bp+var_4]
	call	_read
	add	sp, 8
	push	[bp+var_4]
	call	_close
	add	sp, 2
	mov	gs, seg027_x
	push	gs:word_4243E
	call	sub_14D90
	add	sp, 2
	cmp	[bp+arg_0], 1
	jg	short loc_1007E
	cmp	gs:word_4243A, 0
	jnz	short loc_100E7
loc_1007E:
	mov	gs:word_4243A, 1
	push	[bp+arg_4]
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	sub_2625E
	add	sp, 6
	mov	gs:word_4243C, ax
	mov	ax, 2
	push	ax
	mov	ax, offset aThief_cfg
	push	ds
	push	ax
	call	openFile
	add	sp, 6
	mov	[bp+var_4], ax
	inc	ax
	jnz	short loc_100C5
	mov	ax, 4
	push	ax
	call	far ptr	sub_28424
	add	sp, 2
loc_100C5:
	mov	ax, 4
	push	ax
	mov	ax, offset word_4243A
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	[bp+var_4]
	call	_write
	add	sp, 8
	push	[bp+var_4]
	call	_close
	add	sp, 2
loc_100E7:
	sub	ax, ax
	push	ax
	mov	bx, gs:word_4243C
	and	bx, 0Fh
	shl	bx, 1
	shl	bx, 1
	push	word ptr (graphicsDrivers+2)[bx]
	push	word ptr graphicsDrivers[bx]
	call	openFile
	add	sp, 6
	mov	[bp+var_4], ax
	inc	ax
	jnz	short loc_1011C
	mov	ax, 4
	push	ax
	call	far ptr	sub_28424
	add	sp, 2
loc_1011C:
	mov	ax, 18h
	push	ax
	mov	ax, offset monsterBuf
	mov	dx, seg	seg023
	push	dx
	push	ax
	push	[bp+var_4]
	call	_read
	add	sp, 8
	mov	ax, 1068h
	push	ax
	mov	ax, offset vid_setMode
	mov	dx, seg	seg024
	push	dx
	push	ax
	push	[bp+var_4]
	call	_read
	add	sp, 8
	push	[bp+var_4]
	call	_close
	add	sp, 2
	mov	ax, 1
	push	ax
	call	far ptr	vid_setMode
	add	sp, 2
	sub	ax, ax
	push	ax
	call	far ptr j_nullsub_2
	add	sp, 2
	sub	ax, ax
	push	ax
	mov	ax, offset aTit0
	push	ds
	push	ax
	call	openFile
	add	sp, 6
	mov	[bp+var_4], ax
	inc	ax
	jnz	short loc_1018E
	mov	ax, 4
	push	ax
	call	far ptr	sub_28424
	add	sp, 2
loc_1018E:
	mov	ax, 33000
	sub	dx, dx
	push	dx
	push	ax
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	[bp+var_4]
	call	_read
	add	sp, 0Ah
	push	[bp+var_4]
	call	_close
	add	sp, 2
	mov	[bp+var_6], 0
	jmp	short loc_101BD
loc_101BA:
	inc	[bp+var_6]
loc_101BD:
	cmp	[bp+var_6], 8
	jge	short loc_101E6
	mov	ax, 3200
	push	ax
	call	_mallocMaybe
	add	sp, 2
	mov	bx, [bp+var_6]
	shl	bx, 1
	shl	bx, 1
	mov	word ptr gs:musicBufs._offset[bx], ax
	mov	gs:musicBufs._segment[bx], dx
	jmp	short loc_101BA
loc_101E6:
	mov	ax, 33000
	sub	dx, dx
	push	dx
	push	ax
	call	_mallocMaybe
	add	sp, 4
	mov	gs:word_42562, ax
	mov	gs:word_42564, dx
	push	dx
	push	ax
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	call	d3comp
	add	sp, 8
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	mov	ax, gs:word_42562
	mov	dx, gs:word_42564
	add	ax, 0Dh
	push	dx
	push	ax
	call	far ptr	sub_3E97D
	add	sp, 8
	sub	ax, ax
	push	ax
	mov	ax, offset aTitle
	push	ds
	push	ax
	call	openFile
	add	sp, 6
	mov	[bp+var_4], ax
	inc	ax
	jnz	short loc_10266
	push	gs:word_42564
	push	gs:word_42562
	call	_freeMaybe
	add	sp, 4
	push	cs
	call	near ptr sub_104F3
loc_10266:
	mov	ax, 33000
	sub	dx, dx
	push	dx
	push	ax
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	[bp+var_4]
	call	_read
	add	sp, 0Ah
	push	[bp+var_4]
	call	_close
	add	sp, 2
	push	gs:word_42564
	push	gs:word_42562
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	call	d3comp
	add	sp, 8
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	mov	ax, gs:word_42562
	mov	dx, gs:word_42564
	add	ax, 0Dh
	push	dx
	push	ax
	call	far ptr	sub_3E97D
	add	sp, 8
	sub	ax, ax
	push	ax
	mov	ax, offset aMusic_all
	push	ds
	push	ax
	call	openFile
	add	sp, 6
	mov	[bp+var_4], ax
	inc	ax
	jnz	short loc_102FB
	push	gs:word_42564
	push	gs:word_42562
	call	_freeMaybe
	add	sp, 4
	push	cs
	call	near ptr sub_104F3
loc_102FB:
	mov	ax, 0FFFFh
	push	ax
	mov	ax, gs:word_4243C
	mov	cl, 7
	sar	ax, cl
	add	ax, 10h
	cwd
	push	dx
	push	ax
	push	[bp+var_4]
	call	_lseek
	add	sp, 8
	mov	ax, 2
	push	ax
	lea	ax, [bp+var_2]
	push	ss
	push	ax
	push	[bp+var_4]
	call	_read
	add	sp, 8
	mov	ax, 0FFFFh
	push	ax
	mov	ax, [bp+var_2]
	cwd
	push	dx
	push	ax
	push	[bp+var_4]
	call	_lseek
	add	sp, 8
	mov	ax, 9C4h
	push	ax
	mov	ax, 0
	mov	dx, seg	seg025
	push	dx
	push	ax
	push	[bp+var_4]
	call	_read
	add	sp, 8
	mov	[bp+var_6], 0
	jmp	short loc_10366
loc_10363:
	inc	[bp+var_6]
loc_10366:
	cmp	[bp+var_6], 8
	jge	short loc_103D4
	mov	ax, 0FFFFh
	push	ax
	mov	ax, [bp+var_6]
	cwd
	shl	ax, 1
	rcl	dx, 1
	push	dx
	push	ax
	push	[bp+var_4]
	call	_lseek
	add	sp, 8
	mov	ax, 2
	push	ax
	lea	ax, [bp+var_2]
	push	ss
	push	ax
	push	[bp+var_4]
	call	_read
	add	sp, 8
	mov	ax, 0FFFFh
	push	ax
	mov	ax, [bp+var_2]
	cwd
	push	dx
	push	ax
	push	[bp+var_4]
	call	_lseek
	add	sp, 8
	mov	ax, 3200
	push	ax
	mov	bx, [bp+var_6]
	shl	bx, 1
	shl	bx, 1
	push	gs:musicBufs._segment[bx]
	push	word ptr gs:musicBufs._offset[bx]
	push	[bp+var_4]
	call	_read
	add	sp, 8
	jmp	short loc_10363
loc_103D4:
	push	[bp+var_4]
	call	_close
	add	sp, 2
	call	sub_27F63
	mov	ax, 7
	push	ax
	mov	ax, 0FFh
	push	ax
	call	sub_22CD5
	add	sp, 4
	call	configIconsBin
	call	far ptr j_nullsub_3
	mov	ax, offset aComeHearTheTaleOfSkar
	mov	dx, seg	dseg
	push	dx
	push	ax
	call	sub_1665F
	add	sp, 4
	sub	ax, ax
	push	ax
	mov	ax, offset aBardscr
	push	ds
	push	ax
	call	openFile
	add	sp, 6
	mov	[bp+var_4], ax
	inc	ax
	jnz	short loc_1043E
	push	gs:word_42564
	push	gs:word_42562
	call	_freeMaybe
	add	sp, 4
	push	cs
	call	near ptr sub_104F3
loc_1043E:
	mov	ax, 80E8h
	sub	dx, dx
	push	dx
	push	ax
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	[bp+var_4]
	call	_read
	add	sp, 0Ah
	push	[bp+var_4]
	call	_close
	add	sp, 2
	push	gs:word_42564
	push	gs:word_42562
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	call	d3comp
	add	sp, 8
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	mov	ax, gs:word_42562
	mov	dx, gs:word_42564
	add	ax, 0Dh
	push	dx
	push	ax
	call	far ptr	sub_3E97D
	add	sp, 8
	push	gs:word_42564
	push	gs:word_42562
	call	_freeMaybe
	add	sp, 4
	mov	ax, 4D0Ah
	push	ax
	call	_mallocMaybe
	add	sp, 2
	mov	gs:word_4240A, ax
	mov	gs:word_4240C, dx
	push	cs
	call	near ptr sub_116CC
	call	restoreGame
	push	buildingRvalMaybe
	push	cs
	call	near ptr sub_10560
	add	sp, 2
	push	cs
	call	near ptr sub_104F3
	mov	sp, bp
	pop	bp
	retf
_main endp

; Attributes: bp-based frame

sub_104F3 proc far
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	call	song_endMusic
	call	sub_2800B
	sub	ax, ax
	push	ax
	call	far ptr	vid_setMode
	add	sp, 2
	mov	[bp+var_2], 0
	jmp	short loc_1051D
loc_1051A:
	inc	[bp+var_2]
loc_1051D:
	cmp	[bp+var_2], 8
	jge	short loc_10550
	mov	bx, [bp+var_2]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr gs:musicBufs._offset[bx]
	mov	dx, gs:musicBufs._segment[bx]
	mov	[bp+var_6], ax
	mov	[bp+var_4], dx
	or	ax, dx
	jz	short loc_1054E
	push	dx
	push	[bp+var_6]
	call	_freeMaybe
	add	sp, 4
loc_1054E:
	jmp	short loc_1051A
loc_10550:
	mov	ax, 1
	push	ax
	call	far ptr	sub_28424
	add	sp, 2
	mov	sp, bp
	pop	bp
	retf
sub_104F3 endp

; Attributes: bp-based frame

sub_10560 proc far
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	call	far ptr j_nullsub_3
loc_1056F:
	cmp	[bp+arg_0], 0FFh
	jz	short loc_105DE
	mov	buildingRvalMaybe, 0
	mov	ax, [bp+arg_0]
	jmp	short loc_105C6
loc_10586:
	call	camp_enter
	mov	[bp+arg_0], ax
	jmp	short loc_105DC
loc_10590:
	push	cs
	call	near ptr wildMainLoop
	mov	[bp+arg_0], ax
	jmp	short loc_105DC
loc_10599:
	mov	inDungeonMaybe, 1
	push	cs
	call	near ptr dunMainLoop
	mov	[bp+arg_0], ax
	mov	inDungeonMaybe, 0
	jmp	short loc_105DC
loc_105B8:
	call	partyDied
	mov	[bp+arg_0], ax
	jmp	short loc_105DC
loc_105C2:
	jmp	short loc_105DE
	jmp	short loc_105DC
loc_105C6:
	cmp	ax, 1
	jz	short loc_10586
	cmp	ax, 2
	jz	short loc_10590
	cmp	ax, 4
	jz	short loc_10599
	cmp	ax, 5
	jz	short loc_105B8
	jmp	short loc_105C2
loc_105DC:
	jmp	short loc_1056F
loc_105DE:
	mov	sp, bp
	pop	bp
	retf
sub_10560 endp

; Attributes: bp-based frame

dunMainLoop proc far

	var_26=	dword ptr -26h
	var_22=	word ptr -22h
	var_20=	word ptr -20h
	var_1E=	word ptr -1Eh
	var_E= word ptr	-0Eh
	var_C= word ptr	-0Ch
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	levP= dword ptr	-4

	func_enter
	_chkstk		26h
	push	si

	mov	word ptr [bp+levP], offset characterIOBuf
	mov	word ptr [bp+levP+2], seg seg022

	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	mov	ax, dunLevelIndex
	add	ax, 10
	push	ax
	func_readLevelData
	lfs	bx, [bp+levP]
	mov	al, fs:[bx+dun_t.levFlags]
	sub	ah, ah
	mov	cl, 6
	shr	ax, cl
	and	ax, 3
	add	ax, 3
	mov	[bp+var_22], ax
	push	ax
	func_readGraphicsMaybe
	lfs	bx, [bp+levP]
	mov	al, fs:[bx+dun_t.monIndex]
	sub	ah, ah
	push	ax
	func_readMonsterFile

	push_ss_string	var_1E
	push_ptr_stack	levP
	std_call	decryptName, 8

	lfs	bx, [bp+levP]
	mov	al, fs:[bx+dun_t._width]
	mov	dunWidth, al
	mov	al, fs:[bx+dun_t._height]
	mov	dunHeight, al
	mov	al, fs:[bx+dun_t.levelNum]
	sub	ah, ah
	mov	dunLevelNum,	ax
	mov	al, fs:[bx+dun_t.levFlags]
	mov	levFlags, al
	and	al, 7
	mov	levelNoMaybe, al
	cmp	gs:levelChangedFlag, 0
	jz	short loc_dunMainLoop_skipDeltaSQEN

	; Add deltaSqN and deltaSqE to sq_north and sq_east
	mov	al, fs:[bx+dun_t.deltaSqN]
	cbw
	sub	sq_north, ax
	mov	al, fs:[bx+dun_t.deltaSqE]
	cbw
	sub	sq_east, ax
	mov	gs:levelChangedFlag, 0

loc_dunMainLoop_skipDeltaSQEN:
	mov	ax, bx
	mov	dx, word ptr [bp+levP+2]
	add	ax, 24h	
	mov	gs:mapDataOff, ax
	mov	gs:mapDataSeg, dx
	mov	[bp+var_C], 0
	mov	dl, dunHeight
	sub	dh, dh

loc_dunMainLoop_popRowLoop_enter:
	cmp	dx, [bp+var_C]
	jbe	short loc_dunMainLoop_popRowLoop_exit
	mov	ax, [bp+var_C]
	shl	ax, 1
	add	ax, gs:mapDataOff
	mov	word ptr [bp+var_26], ax
	mov	ax, gs:mapDataSeg
	mov	word ptr [bp+var_26+2],	ax
	lfs	bx, [bp+var_26]
	mov	ah, fs:[bx+1]
	sub	al, al
	mov	cl, fs:[bx]
	sub	ch, ch
	add	ax, cx
	add	ax, 0
	mov	bx, [bp+var_C]
	shl	bx, 1
	shl	bx, 1
	mov	word ptr gs:rowOffset[bx], ax
	mov	word ptr gs:(rowOffset+2)[bx], seg seg022
	inc	[bp+var_C]
	jmp	short loc_dunMainLoop_popRowLoop_enter

loc_dunMainLoop_popRowLoop_exit::
	mov	ax, word ptr [bp+levP]
	mov	dx, word ptr [bp+levP+2]
	add	ax, 22h	
	mov	gs:mapDataOff, ax
	mov	gs:mapDataSeg, dx

loc_dunMainLoop_wander_check:
	call	_random
	test	al, 0FCh
	jnz	short loc_dunMainLoop_battleCheck
	call	dun_wanderingCreature

loc_dunMainLoop_battleCheck:
	cmp	partyAttackFlag, 0
	jnz	short loc_dunMainLoop_doBattle
	cmp	byte_4EECC, 0
	jnz	short loc_dunMainLoop_doBattle
	call	_random
	test	al, 3Fh
	jnz	short loc_107BE
	cmp	gs:byte_42296, 0FFh
	jz	short loc_107BE
	cmp	gs:songAntiMonster, 0
	jnz	short loc_107BE

loc_dunMainLoop_doBattle:
	call	bat_init
	or	ax, ax
	jz	short loc_107B9
	mov	ax, 5
	jmp	loc_dunMainLoop_exit

loc_107B9:
	call	clearTextWindow

loc_107BE:
	push	sq_north
	push	sq_east
	push	seg027_x
	push	offset rowOffset
	std_call	dun_doSpecialSquare, 8

	push	seg023_x
	push	offset graphicsBuf
	push	sq_north
	push	sq_east
	std_call	dun_buildView, 8
	mov	[bp+var_E], ax

	push	dirFacing
	mov	al, dunHeight
	sub	ah, ah
	push	ax
	mov	al, dunWidth
	push	ax
	push	sq_north
	push	sq_east
	push	seg027_x
	push	offset rowOffset
	std_call	sub_10B3D, 0Eh

	push	dirFacing
	push	sq_north
	push	sq_east
	std_call	dun_detectSquares,6

	push_ss_string	var_1E
	std_call	setTitle, 4

	sub	ax, ax
	push	ax
	push	gs:mapDataSeg
	push	gs:mapDataOff
	std_call	map_execute, 6
loc_10886:
	cmp	buildingRvalMaybe, 0
	jz	short loc_10899
	mov	ax, buildingRvalMaybe
	jmp	loc_dunMainLoop_exit
loc_10899:
	mov	ax, 0A000h
	push	ax
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_6], ax
	push	ax
	std_call	getKeyboardCmd, 2
	mov	[bp+var_20], ax
	or	ax, ax
	jz	short loc_1090B
	mov	byte ptr word_44166,	0
	cmp	buildingRvalMaybe, 0
	jnz	loc_dunMainLoop_return_bldg_rval
loc_108D5:
	push	seg023_x
	mov	ax, offset graphicsBuf
	push	ax
	push	sq_north
	push	sq_east
	std_call	dun_buildView, 8
	mov	[bp+var_E], ax
	push_ss_string	var_1E
	std_call	setTitle, 4
	call	clearTextWindow
loc_1090B:
	cmp	[bp+var_20], 0
	jnz	short loc_10886
	mov	ax, [bp+var_6]

loc_dunMainLoop_key_Q:
	cmp	ax, 'Q'
	jnz	loc_dunMainLoop_key_split

	call	quitGame
	or	ax, ax
	jz	loc_dunMainLoop_buildingRvalMaybe_check

	mov	ax, 0FFh
	jmp	loc_dunMainLoop_exit

loc_dunMainLoop_key_split:
	jg	short loc_dunMainLoop_key_W

loc_dunMainLoop_key_qmark:
	cmp	ax, '?'
	jnz	loc_dunMainLoop_key_E

	mov	al, dunHeight
	sub	ah, ah
	push	ax
	mov	al, dunWidth
	push	ax
	push	sq_north
	push	sq_east
	push	seg027_x
	push	offset rowOffset
	std_call	dun_doMiniMap, 0Ch
	jmp	loc_dunMainLoop_buildingRvalMaybe_check

loc_dunMainLoop_key_E:
	cmp	ax, 'E'
	jnz	loc_dunMainLoop_key_K

	push	sq_north
	push	sq_east
	std_call	dun_ascendPortal, 4
	jmp	loc_dunMainLoop_buildingRvalMaybe_check

loc_dunMainLoop_key_K:
	cmp	ax, 'K'
	jnz	loc_dunMainLoop_buildingRvalMaybe_check
	jmp	loc_dunMainLoop_go_forward
	
loc_dunMainLoop_key_W:
	cmp	ax, 'W'
	jnz	loc_dunMainLoop_key_upArrow

	push	sq_north
	push	sq_east
	std_call	dun_descendPortal, 4
	jmp	loc_dunMainLoop_buildingRvalMaybe_check

loc_dunMainLoop_key_upArrow:
	cmp	ax, dosKeys_upArrow
	jnz	loc_dunMainLoop_key_leftArrow
	
loc_dunMainLoop_go_forward:
	push_imm	1
	push	[bp+var_E]
	std_call	dun_goForwardCheck, 4
	or	ax, ax
	jz	loc_dunMainLoop_buildingRvalMaybe_check
	call	clearTextWindow
	mov	si, dirFacing
	shl	si, 1
	mov	ax, sq_north
	sub	ax, dirDeltaN[si]
	mov	[bp+var_8], ax
	mov	ax, dirDeltaE[si]
	add	ax, sq_east
	mov	[bp+var_A], ax

	mov	al, dunHeight
	sub	ah, ah
	push	ax
	push	[bp+var_8]
	std_call	wrapNumber, 4

	mov	sq_north, ax
	mov	al, dunWidth
	sub	ah, ah
	push	ax
	push	[bp+var_A]
	std_call	wrapNumber ,4
	mov	sq_east, ax
	mov	gs:wallIsPhased, 0
	jmp	loc_dunMainLoop_buildingRvalMaybe_check

loc_dunMainLoop_key_leftArrow:
	cmp	ax, dosKeys_leftArrow
	jnz	loc_dunMainLoop_key_rightArrow
	mov	bx, 3
	jmp	loc_dunMainLoop_incDirFacing

loc_dunMainLoop_key_rightArrow:
	cmp	ax, dosKeys_rightArrow
	jnz	loc_dunMainLoop_key_downArrow
	mov	bx, 1
	jmp	loc_dunMainLoop_incDirFacing

loc_dunMainLoop_key_downArrow:
	cmp	ax, dosKeys_downArrow
	jnz	loc_dunMainLoop_buildingRvalMaybe_check
	mov	bx, 2

loc_dunMainLoop_incDirFacing:
	mov	ax, dirFacing
	add	ax, bx
	and	ax, 3
	mov	dirFacing, ax
	mov	gs:wallIsPhased, 0
	call	clearTextWindow

loc_dunMainLoop_buildingRvalMaybe_check:
	cmp	buildingRvalMaybe, 0
	jz	loc_dunMainLoop_wander_check

loc_dunMainLoop_return_bldg_rval:
	mov	ax, buildingRvalMaybe

loc_dunMainLoop_exit:
	pop	si
	mov	sp, bp
	pop	bp
	retf
dunMainLoop endp

; Attributes: bp-based frame

sub_10B3D proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	rowBuf=	dword ptr  6
	sqE= word ptr  0Ah
	sqN= word ptr  0Ch
	_width=	word ptr  0Eh
	_height= word ptr  10h
	_dirFacing= word ptr  12h

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	mov	bx, [bp+sqE]
	mov	ax, bx
	shl	bx, 1
	shl	bx, 1
	add	bx, ax
	mov	ax, bx
	mov	bx, [bp+sqN]
	shl	bx, 1
	shl	bx, 1
	lfs	si, [bp+rowBuf]
	lfs	si, fs:[bx+si]
	mov	bx, ax
	or	byte ptr fs:[bx+si+4], 9
	mov	[bp+var_6], 0
	jmp	short loc_10B74
loc_10B71:
	inc	[bp+var_6]
loc_10B74:
	mov	al, lightDistance
	sub	ah, ah
	cmp	ax, [bp+var_6]
	ja	short loc_10B86
	jmp	loc_10C1E
loc_10B86:
	push	[bp+sqN]
	push	[bp+sqE]
	push	cs
	call	near ptr dun_getWalls
	add	sp, 4
	mov	[bp+var_2], ax
	mov	ax, [bp+_dirFacing]
	dec	ax
	push	ax
	push	[bp+var_2]
	call	sub_27E13
	add	sp, 4
	mov	[bp+var_4], ax
	mov	bx, ax
	and	bx, 0Fh
	cmp	byte_44354[bx], 0
	jz	short loc_10BBC
	jmp	short loc_10C1E
loc_10BBC:
	push	[bp+_width]
	mov	bx, [bp+_dirFacing]
	shl	bx, 1
	mov	ax, dirDeltaE[bx]
	add	ax, [bp+sqE]
	push	ax
	push	cs
	call	near ptr wrapNumber
	add	sp, 4
	mov	[bp+sqE], ax
	push	[bp+_height]
	mov	ax, [bp+sqN]
	mov	bx, [bp+_dirFacing]
	shl	bx, 1
	sub	ax, dirDeltaN[bx]
	push	ax
	push	cs
	call	near ptr wrapNumber
	add	sp, 4
	mov	[bp+sqN], ax
	mov	bx, [bp+sqE]
	mov	ax, bx
	shl	bx, 1
	shl	bx, 1
	add	bx, ax
	mov	ax, bx
	mov	bx, [bp+sqN]
	shl	bx, 1
	shl	bx, 1
	lfs	si, [bp+rowBuf]
	lfs	si, fs:[bx+si]
	mov	bx, ax
	or	byte ptr fs:[bx+si+4], 1
	jmp	loc_10B71
loc_10C1E:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_10B3D endp

; Attributes: bp-based frame

dun_goForwardCheck proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	func_enter

	cmp	gs:stuckFlag, 0
	jz	short loc_dun_goForwardCheck_not_stuck
	call	clearTextWindow

	push_ds_string	aStuckElipsis
	func_printString
	jmp	loc_dun_goForwardCheck_return_zero

loc_dun_goForwardCheck_not_stuck:
	mov	ax, [bp+arg_0]
	mov	cl, 4
	shr	ax, cl
	and	ax, 0Fh
	mov	bx, ax
	mov	al, byte_44344[bx]
	sub	ah, ah

	or	ax, ax
	jz	loc_dun_goForwardCheck_success

loc_dun_goForwardCheck_not_zero:
	cmp	ax, 1
	jb	loc_dun_goForwardCheck_return_zero

	cmp	ax, 2
	jg	loc_dun_goForwardCheck_return_zero

	cmp	[bp+arg_2], 0
	jz	loc_dun_goForwardCheck_return_zero

loc_dun_goForwardCheck_success:
	mov	word_4EE66, 0
	call	clearTextWindow
	mov	ax, 1
	jmp	loc_dun_goForwardCheck_exit
	
loc_dun_goForwardCheck_return_zero:
	xor	ax, ax

loc_dun_goForwardCheck_exit:
	func_exit
	retf
dun_goForwardCheck endp

; Attributes: bp-based frame

wildMainLoop proc far

	var_4A=	dword ptr -4Ah
	var_46=	word ptr -46h
	var_44=	word ptr -44h
	levelName= word	ptr -42h
	square=	word ptr -32h
	var_30=	dword ptr -30h
	var_2C=	word ptr -2Ch
	var_2A=	word ptr -2Ah
	var_28=	word ptr -28h
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 4Ah	
	call	someStackOperation
	push	si
	mov	word ptr [bp+var_30], offset characterIOBuf
	mov	word ptr [bp+var_30+2],	seg seg022
	call	far ptr j_nullsub_3
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	currentLocationMaybe
	call	readLevelData
	add	sp, 6
	lfs	bx, [bp+var_30]
	mov	al, fs:[bx+map_t.levFlags]
	sub	ah, ah
	mov	cl, 6
	shr	ax, cl
	and	ax, 3
	mov	[bp+var_46], ax
	push	ax
	call	readGraphicsMaybe
	add	sp, 2
	lfs	bx, [bp+var_30]
	mov	al, fs:[bx+map_t.monsterIndex]
	sub	ah, ah
	push	ax
	call	readMonsterFile
	add	sp, 2
	lea	ax, [bp+levelName]
	push	ss
	push	ax
	push	word ptr [bp+var_30+2]
	push	word ptr [bp+var_30]
	call	decryptName
	add	sp, 8
	lfs	bx, [bp+var_30]
	mov	al, fs:[bx+map_t.levFlags]
	and	al, 7
	mov	levelNoMaybe, al
	mov	al, fs:[bx+map_t._width]
	mov	gs:mapWidth, al
	mov	al, fs:[bx+map_t._height]
	mov	gs:mapHeight, al
	mov	al, fs:[bx+map_t.wrapFlag]
	and	al, 2
	mov	gs:wildWrapFlag, al
	mov	gs:mapDataOff, map_t.rowOffset
	mov	gs:mapDataSeg, seg seg022
	mov	[bp+var_2C], 0
	mov	dl, mapHeight
	sub	dh, dh

loc_wildMainLoop_rowPopLoop_start:
	cmp	dx, [bp+var_2C]
	jbe	short loc_wildMainLoop_rowPopLoop_exit
	mov	ax, [bp+var_2C]
	shl	ax, 1
	add	ax, gs:mapDataOff
	mov	word ptr [bp+var_4A], ax
	mov	ax, gs:mapDataSeg
	mov	word ptr [bp+var_4A+2],	ax
	lfs	bx, [bp+var_4A]
	mov	ah, fs:[bx+1]
	sub	al, al
	mov	cl, fs:[bx]
	sub	ch, ch
	add	ax, cx
	add	ax, 0
	mov	bx, [bp+var_2C]
	shl	bx, 1
	shl	bx, 1
	mov	word ptr gs:rowOffset[bx], ax
	mov	word ptr gs:(rowOffset+2)[bx], seg seg022
	inc	[bp+var_2C]
	jmp	short loc_wildMainLoop_rowPopLoop_start

loc_wildMainLoop_rowPopLoop_exit:
	mov	gs:mapDataOff, map_t.dataOffset
	mov	gs:mapDataSeg, seg seg022

loc_wildMainLoop_loopStart:
	cmp	partyAttackFlag, 0
	jnz	short loc_wildMainLoop_battleCheck
	lfs	bx, [bp+var_30]
	test	byte ptr fs:[bx+12h], 1
	jz	short loc_wildMainLoop_mapExecute
	call	_random
	test	al, 1Fh
	jnz	short loc_wildMainLoop_mapExecute
	cmp	gs:songAntiMonster, 0
	jnz	short loc_wildMainLoop_mapExecute

loc_wildMainLoop_battleCheck:
	call	bat_init
	or	ax, ax
	jz	short loc_10E17
	mov	ax, 5
	jmp	loc_wildMainLoop_exit

loc_10E17:
	call	clearTextWindow

loc_wildMainLoop_mapExecute:
	sub	ax, ax
	push	ax
	push	gs:mapDataSeg
	push	gs:mapDataOff
	std_call	map_execute, 6

loc_10E48:
	cmp	buildingRvalMaybe, 0
	jnz	loc_wildMainLoop_return_bldg_rval

loc_10E5B:
	push_ss_string	levelName
	std_call	setTitle, 4

	push	sq_north
	push	sq_east
	std_call	 bigpic_buildViewMaybe, 4
	mov	[bp+square], ax

	mov	ax, 0A000h
	push	ax
	std_call	sub_14E41, 2
	mov	[bp+var_2], ax

	push	ax
	std_call	getKeyboardCmd, 2
	mov	[bp+var_44], ax
	or	ax, ax
	jz	short loc_10EEE
	mov	byte ptr word_44166, 0
	cmp	buildingRvalMaybe, 0
	jnz	loc_wildMainLoop_return_bldg_rval

loc_10EC0:
	push	sq_north
	push	sq_east
	std_call	bigpic_buildViewMaybe, 4
	mov	[bp+square], ax

	push_ss_string levelName
	std_call	setTitle, 4
	call	clearTextWindow

loc_10EEE:
	cmp	[bp+var_44], 0
	jnz	loc_10E48

	mov	ax, [bp+var_2]

loc_wildMainLoop_key_upArrow:
	cmp	ax, dosKeys_upArrow
	jnz	loc_wildMainLoop_key_split

loc_wildMainLoop_goForward:
	push	[bp+square]
	std_call	map_enterBuilding, 2
	or	ax, ax
	jz	loc_wildMainLoop_exitBuilding
	cmp	buildingRvalMaybe, 0
	jnz	loc_wildMainLoop_return_bldg_rval

loc_wildMainLoop_exitBuilding:
	push	[bp+square]
	std_call	wild_goForwardCheck, 2
	or	ax, ax
	jz	loc_wildMainLoop_loopStart

	call	clearTextWindow
	mov	si, dirFacing
	shl	si, 1
	mov	ax, sq_north
	sub	ax, dirDeltaN[si]
	mov	[bp+var_8], ax
	mov	ax, sq_east
	add	ax, dirDeltaE[si]
	mov	[bp+var_2A], ax

	test	wildWrapFlag, 2
	jz	loc_wildMainLoop_forward_nowrap

	mov	al, mapHeight
	sub	ah, ah
	push	ax
	push	[bp+var_8]
	std_call	wrapNumber, 4
	mov	sq_north, ax

	mov	al, mapWidth
	sub	ah, ah
	push	ax
	push	[bp+var_2A]
	std_call	wrapNumber, 4
	mov	sq_east, ax
	jmp	loc_wildMainLoop_loopStart

loc_wildMainLoop_forward_nowrap:
	cmp	[bp+var_8], 0
	jl	loc_wildMainLoop_loopStart

	mov	al, mapHeight
	sub	ah, ah
	cmp	ax, [bp+var_8]
	jbe	loc_wildMainLoop_loopStart

	cmp	[bp+var_2A], 0
	jl	loc_wildMainLoop_loopStart

	mov	al, mapWidth
	cmp	ax, [bp+var_2A]
	jbe	loc_wildMainLoop_loopStart

	mov	ax, [bp+var_8]
	mov	sq_north, ax
	mov	ax, [bp+var_2A]
	mov	sq_east, ax
	jmp	loc_wildMainLoop_loopStart

loc_wildMainLoop_key_split:
	jg	loc_wildMainLoop_key_center

loc_wildMainLoop_key_qmark:
	cmp	ax, '?'
	jnz	loc_wildMainLoop_key_K

	call	cmd_printLocation
	jmp	loc_wildMainLoop_loopStart

loc_wildMainLoop_key_K:
	cmp	ax, 'K'
	jz	loc_wildMainLoop_goForward

loc_wildMainLoop_key_Q:
	cmp	ax, 'Q'
	jnz	loc_wildMainLoop_loopStart

	call	quitGame
	or	ax, ax
	jz	loc_wildMainLoop_loopStart
	mov	ax, 0FFh
	jmp	loc_wildMainLoop_exit

loc_wildMainLoop_key_center:
	cmp	ax, 4C00h
	jz	loc_wildMainLoop_goForward

loc_wildMainLoop_key_leftArrow:
	cmp	ax, dosKeys_leftArrow
	jnz	loc_wildMainLoop_key_rightArrow
	mov	bx, 3
	jmp	loc_wildMainLoop_incDirFacing

loc_wildMainLoop_key_rightArrow:
	cmp	ax, dosKeys_rightArrow
	jnz	loc_wildMainLoop_key_downArrow
	mov	bx, 1
	jmp	loc_wildMainLoop_incDirFacing

loc_wildMainLoop_key_downArrow:
	cmp	ax, dosKeys_downArrow
	jnz	loc_wildMainLoop_loopStart
	mov	bx, 2

loc_wildMainLoop_incDirFacing:
	mov	ax, dirFacing
	add	ax, bx
	and	ax, 3
	mov	dirFacing, ax

	push_ds_string aFacing
	push_ss_string var_28
	func_strcat

	mov	bx, dirFacing
	shl	bx, 1
	shl	bx, 1
	push_ptr_stringList	dirStringList, bx
	push	dx
	push	ax
	func_strcat

	push_ss_string	var_28
	std_call	printStringWClear, 4
	jmp	loc_wildMainLoop_loopStart

loc_wildMainLoop_return_bldg_rval:
	mov	ax, buildingRvalMaybe

loc_wildMainLoop_exit:
	pop	si
	mov	sp, bp
	pop	bp
	retf
wildMainLoop endp

; Attributes: bp-based frame

wild_goForwardCheck proc far

	arg_0= byte ptr	 6

	func_enter

	test	[bp+arg_0], 0F0h
	jz	loc_wild_goForwardCheck_return_one

	mov	al, [bp+arg_0]
	and	al, 0F0h
	cmp	al, 0E0h
	jz	loc_wild_goForwardCheck_return_zero
	mov	al, [bp+arg_0]
	and	al, 0F0h
	cmp	al, 0F0h
	jz	loc_wild_goForwardCheck_return_one
	mov	al, [bp+arg_0]
	and	al, 0Fh
	mov	cx, ax
	cmp	cl, 1
	sbb	ax, ax
	neg	ax
	jmp	loc_wild_goForwardCheck_exit

loc_wild_goForwardCheck_return_zero:
	xor	ax, ax
	jmp	loc_wild_goForwardCheck_exit

loc_wild_goForwardCheck_return_one:
	mov	ax, 1

loc_wild_goForwardCheck_exit:
	func_exit
	retf

wild_goForwardCheck endp

; Attributes: bp-based frame

map_enterBuilding proc far

	square=	word ptr  6

	func_enter
	mov	ax, [bp+square]
	mov	cl, 4
	sar	ax, cl
	and	ax, 0Fh

	sub	ax, 1
	cmp	ax, 8
	ja	loc_map_enterBuilding_return_zero
	add	ax, ax
	xchg	ax, bx
	jmp	cs:off_111EF[bx]
off_111EF dw offset l_camp ; 0x10
dw offset l_tavern	; 0x20
dw offset l_temple	; 0x30
dw offset l_normalBuilding ; 0x40
dw offset loc_map_enterBuilding_return_zero	; 0x50
dw offset l_storageBuilding ; 0x60
dw offset l_reviewBoard	; 0x70
dw offset l_hallOfWizards	; 0x80
dw offset l_bards		; 0x90

l_camp:
	call	camp_enter
	jmp	loc_map_enterBuilding_turn_around
l_tavern:
	call	tav_enter
	jmp	loc_map_enterBuilding_turn_around
l_temple:
	call	temple_enter
	jmp	loc_map_enterBuilding_turn_around
l_normalBuilding:
	call	enterBuildingMaybe
	jmp	loc_map_enterBuilding_turn_around
l_storageBuilding:
	call	strg_enter
	jmp	loc_map_enterBuilding_turn_around
l_reviewBoard:
	call	rev_enter
	jmp	loc_map_enterBuilding_turn_around
l_hallOfWizards:
	call	enterHallOfWizards
	jmp	loc_map_enterBuilding_turn_around
l_bards:
	call	bards_enter
	jmp	loc_map_enterBuilding_turn_around

loc_map_enterBuilding_return_zero:
	sub	ax, ax
	jmp	short loc_map_enterBuilding_exit

loc_map_enterBuilding_turn_around:
	mov	buildingRvalMaybe, ax
	call	map_turnPartyAround
	mov	ax, 1

loc_map_enterBuilding_exit:
	func_exit
	retf
map_enterBuilding endp

; Attributes: bp-based frame

bigpic_buildViewMaybe proc far

	var_3E=	dword ptr -3Eh
	var_3A=	word ptr -3Ah
	var_38=	word ptr -38h
	counter= word ptr -36h
	deltaNorth= word ptr -34h
	viewMaybe= byte	ptr -32h
	var_22=	byte ptr -22h
	deltaEast= word	ptr -1Ch
	gbuf= word ptr -1Ah
	gseg= word ptr -18h
	var_2= word ptr	-2
	sqEast=	word ptr  6
	sqNorth= word ptr  8

	func_enter
	_chkstk		3Eh
	push	si
	mov	[bp+gbuf], offset graphicsBuf
	mov	[bp+gseg], seg seg023
	mov	bx, dirFacing
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr off_44268[bx]
	mov	dx, word ptr (off_44268+2)[bx]
	mov	[bp+var_3A], ax
	mov	[bp+var_38], dx
	mov	[bp+counter], 20
	jmp	short loc_11246
loc_11243:
	dec	[bp+counter]
loc_11246:
	cmp	[bp+counter], 0
	jl	short loc_11288
	mov	ax, [bp+counter]
	shl	ax, 1
	add	ax, [bp+var_3A]
	mov	dx, [bp+var_38]
	mov	word ptr [bp+var_3E], ax
	mov	word ptr [bp+var_3E+2],	dx
	lfs	bx, [bp+var_3E]
	mov	al, fs:[bx]
	cbw
	add	ax, [bp+sqEast]
	mov	[bp+deltaEast],	ax
	mov	al, fs:[bx+1]
	cbw
	add	ax, [bp+sqNorth]
	mov	[bp+deltaNorth], ax
	push	ax
	push	[bp+deltaEast]
	push	cs
	call	near ptr wild_getSquare
	add	sp, 4
	mov	si, [bp+counter]
	mov	[bp+si+viewMaybe], al
	jmp	short loc_11243
loc_11288:
	mov	ax, 44h
	push	ax
	mov	ax, 0BBBBh
	push	ax
	mov	ax, offset bigpicBuf
	mov	dx, seg	seg021
	push	dx
	push	ax
	call	bigpic_setBG
	add	sp, 8
	mov	[bp+counter], 0
	jmp	short loc_112AA
loc_112A7:
	inc	[bp+counter]
loc_112AA:
	cmp	[bp+counter], 17
	jge	short loc_112EB
	mov	bx, [bp+counter]
	mov	al, byte_44332[bx]
	cbw
	mov	si, ax
	mov	al, [bp+si+viewMaybe]
	sub	ah, ah
	and	ax, 0Fh
	mov	[bp+var_2], ax
	or	ax, ax
	jz	short loc_112E9
	push	[bp+gseg]
	push	[bp+gbuf]
	dec	ax
	push	ax
	mov	al, byte_4464A[bx]
	cbw
	push	ax
	call	bigpic_drawTopology
	add	sp, 8
loc_112E9:
	jmp	short loc_112A7
loc_112EB:
	mov	gs:byte_422A0, 0
	cmp	gs:isNight, 0
	jz	short loc_11311
	mov	ax, offset bigpicBuf
	mov	dx, seg	seg021
	push	dx
	push	ax
	call	bigpic_makeNight
	add	sp, 4
loc_11311:
	push	gs:word_4240C
	push	gs:word_4240A
	mov	ax, offset bigpicBuf
	mov	dx, seg	seg021
	push	dx
	push	ax
	call	far ptr	vid_drawBigpic
	add	sp, 8
	mov	al, [bp+var_22]
	sub	ah, ah
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
bigpic_buildViewMaybe endp

; Attributes: bp-based frame

dun_buildView proc far

	var_5C=	dword ptr -5Ch
	deltaP=	dword ptr -58h
	var_54=	word ptr -54h
	counter= word ptr -52h
	var_50=	word ptr -50h
	deltaSqN= word ptr -4Eh
	var_4C=	word ptr -4Ch
	var_1E=	word ptr -1Eh
	deltaSqE= word ptr -8
	var_2= word ptr	-2
	sqE= word ptr  6
	sqN= word ptr  8
	gbufOff= word ptr  0Ah
	gbufSeg= word ptr  0Ch

	push	bp
	mov	bp, sp
	mov	ax, 5Ch	
	call	someStackOperation
	push	si
	mov	bx, dirFacing
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr off_44474[bx]
	mov	dx, word ptr (off_44474+2)[bx]
	mov	word ptr [bp+deltaP], ax
	mov	word ptr [bp+deltaP+2],	dx
	mov	[bp+counter], 24
	jmp	short loc_11372
loc_1136F:
	dec	[bp+counter]
loc_11372:
	cmp	[bp+counter], 0
	jl	short loc_113CB
	mov	ax, [bp+counter]
	shl	ax, 1
	add	ax, word ptr [bp+deltaP]
	mov	dx, word ptr [bp+deltaP+2]
	mov	word ptr [bp+var_5C], ax
	mov	word ptr [bp+var_5C+2],	dx
	lfs	bx, [bp+var_5C]
	mov	al, fs:[bx+viewStruct.deltaEast]
	cbw
	add	ax, [bp+sqE]
	mov	[bp+deltaSqE], ax
	mov	al, fs:[bx+viewStruct.deltaNorth]
	cbw
	add	ax, [bp+sqN]
	mov	[bp+deltaSqN], ax
	push	ax
	push	[bp+deltaSqE]
	push	cs
	call	near ptr dun_getWalls
	add	sp, 4
	mov	[bp+var_50], ax
	push	dirFacing
	push	ax
	call	sub_27E13
	add	sp, 4
	mov	si, [bp+counter]
	shl	si, 1
	mov	[bp+si+var_4C],	ax
	jmp	short loc_1136F
loc_113CB:
	mov	[bp+counter], 33
	jmp	short loc_113D5
loc_113D2:
	dec	[bp+counter]
loc_113D5:
	cmp	[bp+counter], 18h
	jle	short loc_11426
	mov	si, [bp+counter]
	shl	si, 1
	lfs	bx, [bp+deltaP]
	mov	al, fs:[bx+si]
	cbw
	add	ax, [bp+sqE]
	mov	[bp+deltaSqE], ax
	mov	al, fs:[bx+si+1]
	cbw
	add	ax, [bp+sqN]
	mov	[bp+deltaSqN], ax
	mov	al, dunHeight
	sub	ah, ah
	push	ax
	mov	al, dunWidth
	push	ax
	push	[bp+deltaSqN]
	push	[bp+deltaSqE]
	mov	ax, offset rowOffset
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	cs
	call	near ptr sub_1156E
	add	sp, 0Ch
	mov	[bp+si+var_4C],	ax
	jmp	short loc_113D2
loc_11426:
	push	[bp+gbufSeg]
	push	[bp+gbufOff]
	call	dun_setBigpicBG
	add	sp, 4
	cmp	gs:wallIsPhased, 0
	jz	short loc_11444
	and	byte ptr [bp+var_1E], 0Fh
loc_11444:
	test	levFlags, 20h
	jz	loc_dun_buildView_inDungeon

	mov	ax, 4
	jmp	loc_dun_buildView_loop_preamble

loc_dun_buildView_inDungeon:
	mov	bl, lightDistance
	sub	bh, bh
	mov	al, byte_44494[bx]
	sub	ah, ah

loc_dun_buildView_loop_preamble:
	mov	[bp+counter], ax
	jmp	short loc_11462
loc_1145F:
	inc	[bp+counter]
loc_11462:
	cmp	[bp+counter], 61
	jge	short loc_114C4
	mov	bx, [bp+counter]
	cmp	byte_4460C[bx], 0
	jz	short loc_114C2
	mov	al, byte_44516[bx]
	cbw
	mov	si, ax
	shl	si, 1
	mov	ax, [bp+si+var_4C]
	mov	[bp+var_50], ax
	mov	cl, byte_44554[bx]
	sar	ax, cl
	and	ax, 0Fh
	mov	[bp+var_54], ax
	mov	bx, ax
	mov	al, byte_44484[bx]
	cbw
	mov	[bp+var_2], ax
	or	ax, ax
	jz	short loc_114C2
	push	[bp+gbufSeg]
	push	[bp+gbufOff]
	dec	ax
	push	ax
	push	[bp+counter]
	call	bigpic_drawTopology
	add	sp, 8
loc_114C2:
	jmp	short loc_1145F
loc_114C4:
	mov	gs:byte_422A0, 0
	push	gs:word_4240C
	push	gs:word_4240A
	mov	ax, offset bigpicBuf
	mov	dx, seg	seg021
	push	dx
	push	ax
	call	far ptr	vid_drawBigpic
	add	sp, 8
	mov	ax, [bp+var_1E]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
dun_buildView endp

; Attributes: bp-based frame

dun_getWalls proc far

	var_4= dword ptr -4
	sqE= word ptr  6
	sqN= word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	al, dunWidth
	sub	ah, ah
	push	ax
	push	[bp+sqE]
	push	cs
	call	near ptr wrapNumber
	add	sp, 4
	mov	[bp+sqE], ax
	mov	al, dunHeight
	sub	ah, ah
	push	ax
	push	[bp+sqN]
	push	cs
	call	near ptr wrapNumber
	add	sp, 4
	mov	[bp+sqN], ax
	mov	bx, ax
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr gs:rowOffset[bx]
	mov	dx, word ptr gs:(rowOffset+2)[bx]
	mov	cx, [bp+sqE]
	mov	bx, cx
	shl	cx, 1
	shl	cx, 1
	add	cx, bx
	add	ax, cx
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	lfs	bx, [bp+var_4]
	mov	ah, fs:[bx+1]
	sub	al, al
	mov	cl, fs:[bx]
	sub	ch, ch
	add	ax, cx
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
dun_getWalls endp

; Attributes: bp-based frame

sub_1156E proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah
	arg_6= word ptr	 0Ch
	arg_8= word ptr	 0Eh
	arg_A= word ptr	 10h

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	push	[bp+arg_8]
	push	[bp+arg_4]
	push	cs
	call	near ptr wrapNumber
	add	sp, 4
	mov	[bp+arg_4], ax
	push	[bp+arg_A]
	push	[bp+arg_6]
	push	cs
	call	near ptr wrapNumber
	add	sp, 4
	mov	[bp+arg_6], ax
	mov	bx, [bp+arg_4]
	mov	ax, bx
	shl	bx, 1
	shl	bx, 1
	add	bx, ax
	mov	ax, bx
	mov	bx, [bp+arg_6]
	shl	bx, 1
	shl	bx, 1
	lfs	si, [bp+arg_0]
	lfs	si, fs:[bx+si]
	mov	bx, ax
	mov	al, fs:[bx+si+2]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	bx, ax
	mov	cl, 5
	shr	bx, cl
	and	bx, 3
	mov	al, byte_42716[bx]
	cbw
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_1156E endp

; Returns the value at (sqNorth, sqEast)
; This is only called in the wilderness. The dungeon
; levels have 5	bytes per square, this assumes one
; byte.
; Attributes: bp-based frame

wild_getSquare proc far

	sqEast=	word ptr  6
	sqNorth= word ptr  8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	cmp	gs:wildWrapFlag, 0
	jz	short loc_1161D
	mov	al, gs:mapWidth
	sub	ah, ah
	push	ax
	push	[bp+sqEast]
	push	cs
	call	near ptr wrapNumber
	add	sp, 4
	mov	[bp+sqEast], ax
	mov	al, gs:mapHeight
	sub	ah, ah
	push	ax
	push	[bp+sqNorth]
	push	cs
	call	near ptr wrapNumber
	add	sp, 4
	mov	[bp+sqNorth], ax
	jmp	short loc_11649
loc_1161D:
	cmp	[bp+sqEast], 0
	jl	short loc_11645
	mov	al, gs:mapWidth
	sub	ah, ah
	cmp	ax, [bp+sqEast]
	jbe	short loc_11645
	cmp	[bp+sqNorth], 0
	jl	short loc_11645
	mov	al, gs:mapHeight
	cmp	ax, [bp+sqNorth]
	ja	short loc_11649
loc_11645:
	sub	ax, ax
	jmp	short loc_11663
loc_11649:
	mov	bx, [bp+sqNorth]
	shl	bx, 1
	shl	bx, 1
	lfs	bx, gs:rowOffset[bx]
	mov	si, [bp+sqEast]
	mov	al, fs:[bx+si]
	sub	ah, ah
	jmp	short $+2
loc_11663:
	pop	si
	mov	sp, bp
	pop	bp
	retf
wild_getSquare endp

; This function	returns	arg_0 mod'd to be between
; 0 and	arg_2. This handles negative numbers
; intuitively.
; Attributes: bp-based frame
wrapNumber proc	far

	arg_0= word ptr	 6
	arg_2= byte ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
loc_11673:
	cmp	[bp+arg_0], 0
	jge	short loc_11682
	mov	al, [bp+arg_2]
	cbw
	add	[bp+arg_0], ax
	jmp	short loc_11673
loc_11682:
	mov	al, [bp+arg_2]
	cbw
	mov	si, ax
	cmp	[bp+arg_0], si
	jl	short loc_11692
	sub	[bp+arg_0], si
	jmp	short loc_11682
loc_11692:
	mov	ax, [bp+arg_0]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
wrapNumber endp

; This function	returns	the memory address of the
; map data at *membuf.
; Attributes: bp-based frame
map_getDataOffsetP proc	far

	memBuf=	dword ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	lfs	bx, [bp+memBuf]
	mov	bl, fs:[bx]
	sub	bh, bh
	mov	si, word ptr [bp+memBuf]
	mov	si, fs:[si+1]
	and	si, 0FFh
	mov	cl, 8
	shl	si, cl
	lea	ax, characterIOBuf[bx+si]
	mov	dx, seg	seg022
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
map_getDataOffsetP endp

; Attributes: bp-based frame

sub_116CC proc far
	push	bp
	mov	bp, sp
	mov	sq_north, 0Bh
	mov	sq_east, 0Fh
	mov	dirFacing, 0
	mov	currentLocationMaybe, 0
	mov	sp, bp
	pop	bp
	retf
sub_116CC endp


sub_11706 proc far
	push	bp
	mov	bp, sp
	mov	bx, [bp+8]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr gs:rowOffset[bx]
	mov	dx, word ptr gs:(rowOffset+2)[bx]
	mov	cx, [bp+6]
	mov	bx, cx
	shl	cx, 1
	shl	cx, 1
	add	cx, bx
	add	ax, cx
	add	ax, 2
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_11706 endp

seg000 ends

; Segment type:	Pure code
seg001 segment word public 'CODE' use16
	assume cs:seg001
;org 0Bh
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
algn_1173B:
align 2
; Attributes: bp-based frame

txt_castSpell proc far

	_instr = word ptr -7
	counter = word ptr -2
	arg_0 = word ptr 6

	func_enter
	push	si
	_chkstk	7
	call	clearTextWindow

	push_ds_string	offset aSpellToCast
	func_printString

	push_imm	4
	push_ss_string	_instr
	func_readString

	push_ss_string	_instr
	std_call	_strlen, 4
	cmp	ax, 4
	jl	loc_txt_castSpell_exit

	lea	si, [bp+_instr]
	mov	[bp+counter], 0

loc_txt_castSpell_toupper_start:
	cmp	[bp+counter], 4
	jge	loc_txt_castSpell_toupper_exit
	mov	bx, [bp+counter]
	mov	al, ss:[si+bx]
	sub	ah, ah
	push	ax
	std_call	_str_capitalize,2

	mov	bx, [bp+counter]
	mov	ss:[si+bx], al
	inc	[bp+counter]
	jmp	loc_txt_castSpell_toupper_start

loc_txt_castSpell_toupper_exit:
	mov	[bp+counter], 0

loc_txt_castSpell_spellCmp_start:
	cmp	[bp+counter], 7Eh
	jge loc_txt_castSpell_spellNotFound

	mov	bx, [bp+counter]
	shl	bx, 1
	shl	bx, 1
	shl	bx, 1
	mov	si, word ptr spellString.abbreviation[bx]
	lea	di, [bp+_instr]
	push	ss
	pop	es
	mov	cx, 4
	repe	cmpsb
	jz	loc_txt_castSpell_spellFound

	inc	[bp+counter]
	jmp	loc_txt_castSpell_spellCmp_start

loc_txt_castSpell_spellNotFound:
	push_ds_string aNoSpellByThatName
	jmp	loc_txt_castSpell_fail

loc_txt_castSpell_spellFound:
	push	[bp+counter]
	push	[bp+arg_0]
	std_call	mage_hasLearnedSpell, 4
	or	ax, ax
	jz	loc_txt_castSpell_notLearned
	
	mov	ax, [bp+counter]
	jmp	loc_txt_castSpell_exit

loc_txt_castSpell_notLearned:
	push_ds_string	aYouDonTKnowThatSpell

loc_txt_castSpell_fail:
	func_printString

	delayNoTable	2

	func_return	0FFFFh

loc_txt_castSpell_exit:
	pop	si
	func_exit
	retf
txt_castSpell endp

getKeyboardCmd proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	[bp+arg_0], dosKeys_F1
	jl	short loc_11765
	cmp	[bp+arg_0], dosKeys_F7
	jg	short loc_11765
	push	[bp+arg_0]
	call	castSpell
	add	sp, 2
	jmp	loc_getKeyboardCmd_success
loc_11765:
	cmp	[bp+arg_0], 31h	
	jl	short loc_11786
	cmp	[bp+arg_0], 37h	
	jg	short loc_11786
	mov	ax, [bp+arg_0]
	sub	ax, 31h	
	push	ax
	call	printCharacter
	add	sp, 2
	jmp	loc_getKeyboardCmd_success
	
loc_11786:
	mov	ax, [bp+arg_0]
	jmp	loc_1182E
l_printHelp:
	push	cs
	call	near ptr printCommandHelp
	jmp	loc_getKeyboardCmd_success
l_castSpell:
	sub	ax, ax
	push	ax
	call	castSpell
	add	sp, 2
	jmp	loc_getKeyboardCmd_success
	
l_reorderParty:
	call	reorderParty
	jmp	loc_getKeyboardCmd_success
	
l_saveGame:
	call	saveGame
	jmp	loc_getKeyboardCmd_success
	
l_singBardSong:
	call	song_getNonCombatSinger
	jmp	loc_getKeyboardCmd_success
l_dropMember:
	call	dropPartyMember
	jmp	loc_getKeyboardCmd_success
l_pauseGame:
	cmp	gs:byte_42296, 0FFh
	jnz	short loc_117E1
	jmp	loc_getKeyboardCmd_fail
loc_117E1:
	mov	gs:word_42450, 1
	mov	ax, offset aPausing
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	gs:word_42450, 0
	jmp	loc_getKeyboardCmd_success
l_partyAttack:
	mov	partyAttackFlag, 1
	jmp	loc_getKeyboardCmd_fail
l_useItem:
	call	useItem
	jmp	loc_getKeyboardCmd_success
l_toggleSound:
	call	snd_toggle
	jmp	loc_getKeyboardCmd_success
loc_11828:
	jmp	loc_getKeyboardCmd_fail
loc_1182E:
	sub	ax, 42h	
	cmp	ax, 14h
	ja	short loc_11828
	add	ax, ax
	xchg	ax, bx
	jmp	cs:off_1183E[bx]
off_1183E dw offset l_singBardSong 
dw offset l_castSpell	
dw offset l_dropMember	
dw offset loc_11828	
dw offset loc_11828	
dw offset loc_11828	
dw offset l_printHelp	
dw offset loc_11828	
dw offset loc_11828	
dw offset loc_11828	
dw offset loc_11828	
dw offset loc_11828	
dw offset l_reorderParty	
dw offset loc_11828	
dw offset l_partyAttack	
dw offset loc_11828	
dw offset loc_11828	
dw offset l_saveGame	
dw offset l_pauseGame	
dw offset l_useItem	
dw offset l_toggleSound	

loc_getKeyboardCmd_fail:
	xor	ax, ax
	jmp	loc_getKeyboardCmd_exit

loc_getKeyboardCmd_success:
	mov	ax, 1

loc_getKeyboardCmd_exit:
	mov	sp, bp
	pop	bp
	retf
getKeyboardCmd endp

; Attributes: bp-based frame
anotherPrintString proc	far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	call	clearTextWindow
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	printString
	add	sp, 4
	wait4IO
	mov	sp, bp
	pop	bp
	retf
anotherPrintString endp

; Attributes: bp-based frame

printCommandHelp proc far
	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	call	clearTextWindow
	mov	ax, offset aHelpForThoseInNeed17
	push	ds
	push	ax
	call	printString
	add	sp, 4
	wait4IO
	call	clearTextWindow
	mov	ax, offset aMoreHelpBPlayABardTu
	push	ds
	push	ax
	call	printString
	add	sp, 4
	wait4IO
	mov	sp, bp
	pop	bp
	retf
printCommandHelp endp

; Attributes: bp-based frame

reorderParty proc far

	var_24=	word ptr -24h
	var_22=	word ptr -22h
	var_14=	word ptr -14h
	var_12=	word ptr -12h
	var_10=	word ptr -10h
	var_E= word ptr	-0Eh

	push	bp
	mov	bp, sp
	mov	ax, 24h	
	call	someStackOperation
	push	di
	push	si
	call	findEmptyRosterNum
	mov	[bp+var_24], ax
	cmp	ax, 1
	jg	short loc_11902
	jmp	loc_11A89
loc_11902:
	call	clearTextWindow
	mov	[bp+var_12], 0
	jmp	short loc_11911
loc_1190E:
	inc	[bp+var_12]
loc_11911:
	cmp	[bp+var_12], 7
	jge	short loc_1192D
	mov	si, [bp+var_12]
	shl	si, 1
	mov	[bp+si+var_E], 0
	mov	si, [bp+var_12]
	shl	si, 1
	mov	[bp+si+var_22],	0FFFFh
	jmp	short loc_1190E
loc_1192D:
	mov	ax, offset aNewOrder
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	[bp+var_12], 0
	jmp	short loc_11944

loc_11941:
	inc	[bp+var_12]

loc_11944:
	mov	ax, [bp+var_24]
	dec	ax
	cmp	ax, [bp+var_12]
	jle	short loc_119B4
	mov	al, byte ptr [bp+var_12]
	add	al, '1'
	mov	byte_42AF5, al
	mov	ax, offset gtChar
	push	ds
	push	ax
	call	sub_16560
	add	sp, 4

loc_11962:
	call	getCharNumber
	mov	[bp+var_10], ax
	or	ax, ax
	jge	short loc_11971
	jmp	loc_11A89

loc_11971:
	mov	ax, [bp+var_24]
	cmp	[bp+var_10], ax
	jge	short loc_11962
	mov	si, [bp+var_10]
	shl	si, 1
	cmp	[bp+si+var_E], 0
	jnz	short loc_11962
	mov	si, [bp+var_10]
	shl	si, 1
	mov	[bp+si+var_E], 1
	mov	si, [bp+var_12]
	shl	si, 1
	mov	ax, [bp+var_10]
	mov	[bp+si+var_22],	ax
	getCharP	[bp+var_10], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	sub_16595
	add	sp, 4
	jmp	short loc_11941

loc_119B4:
	mov	[bp+var_14], 0

loc_119B9:
	mov	si, [bp+var_14]
	shl	si, 1
	cmp	[bp+si+var_E], 0
	jz	short loc_119C9
	inc	[bp+var_14]
	jmp	short loc_119B9

loc_119C9:
	mov	si, [bp+var_24]
	shl	si, 1
	mov	ax, [bp+var_14]
	mov	[bp+si+var_24],	ax
	mov	al, byte ptr [bp+var_24]
	add	al, '0'
	mov	byte_42AF5, al
	mov	ax, offset gtChar
	push	ds
	push	ax
	call	sub_16560
	add	sp, 4
	getCharP	[bp+var_14], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	sub_16595
	add	sp, 4
	mov	ax, offset aUseThisOrder?
	push	ds
	push	ax
	call	printString
	add	sp, 4
	call	getYesNo
	or	ax, ax
	jz	short loc_11A1A
	jmp	short loc_11A1D
loc_11A1A:
	jmp	loc_11902
loc_11A1D:
	mov	[bp+var_12], 0
	jmp	short loc_11A27
loc_11A24:
	inc	[bp+var_12]
loc_11A27:
	mov	ax, [bp+var_24]
	dec	ax
	cmp	ax, [bp+var_12]
	jle	short loc_11A7F
	mov	di, [bp+var_12]
	shl	di, 1
	mov	si, [bp+di+var_22]
	cmp	[bp+var_12], si
	jz	short loc_11A7D
	push	si
	push	[bp+var_12]
	push	cs
	call	near ptr party_swapMembers
	add	sp, 4
	mov	ax, [bp+var_12]
	inc	ax
	mov	[bp+var_14], ax
	jmp	short loc_11A54
loc_11A51:
	inc	[bp+var_14]
loc_11A54:
	mov	ax, [bp+var_24]
	cmp	[bp+var_14], ax
	jge	short loc_11A6D
	mov	si, [bp+var_14]
	shl	si, 1
	mov	ax, [bp+var_12]
	cmp	[bp+si+var_22],	ax
	jnz	short loc_11A6B
	jmp	short loc_11A6D
loc_11A6B:
	jmp	short loc_11A51
loc_11A6D:
	mov	si, [bp+var_12]
	shl	si, 1
	mov	ax, [bp+si+var_22]
	mov	si, [bp+var_14]
	shl	si, 1
	mov	[bp+si+var_22],	ax
loc_11A7D:
	jmp	short loc_11A24
loc_11A7F:
	mov	byte ptr word_44166,	0
loc_11A89:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
reorderParty endp

; Attributes: bp-based frame

party_swapMembers proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	func_enter
	mov	ax, offset newCharBuffer
	mov	dx, seg	seg027
	push	dx
	push	ax
	getCharP	[bp+arg_0], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	copyCharacterBuf
	add	sp, 8
	getCharP	[bp+arg_0], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	getCharP	[bp+arg_2], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	copyCharacterBuf
	add	sp, 8
	getCharP	[bp+arg_2], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	mov	ax, offset newCharBuffer
	push	dx
	push	ax
	call	copyCharacterBuf
	add	sp, 8
	mov	sp, bp
	pop	bp
	retf
party_swapMembers endp

; Attributes: bp-based frame

saveGame proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, offset aDoYouWishToSaveY
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getYesNo
	or	ax, ax
	jnz	short loc_11B2A
	jmp	loc_11BF9
loc_11B2A:
	cmp	inDungeonMaybe, 0
	jz	short loc_11B3B
	mov	ax, 4
	jmp	short loc_11B3E
loc_11B3B:
	mov	ax, 2
loc_11B3E:
	mov	buildingRvalMaybe, ax
	mov	ax, 2
	push	ax
	mov	ax, offset aGame_sav
	push	ds
	push	ax
	call	openFile
	add	sp, 6
	mov	[bp+var_2], ax
	inc	ax
	jnz	short loc_11B88
	call	clearTextWindow
	mov	ax, offset aCanTOpenGameSave
	push	ds
	push	ax
	call	printString
	add	sp, 4
	wait4IO
	mov	buildingRvalMaybe, 0
	jmp	short loc_11BF9
loc_11B88:
	mov	ax, offset aSavingTheGame_
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	ax, 348h
	push	ax
	mov	ax, offset roster
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	[bp+var_2]
	call	_write
	add	sp, 8
	mov	ax, offset byte_4EECC
	mov	cx, offset currentLocationMaybe
	mov	bx, seg	dseg
	sub	ax, cx
	push	ax
	mov	ax, cx
	mov	dx, bx
	push	dx
	push	ax
	push	[bp+var_2]
	call	_write
	add	sp, 8
	push	[bp+var_2]
	call	_close
	add	sp, 2
	mov	ax, offset aYourGameHasBeenS
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getYesNo
	or	ax, ax
	jz	short loc_11BEF
	mov	ax, 0FFh
	jmp	short loc_11BF1
loc_11BEF:
	sub	ax, ax
loc_11BF1:
	mov	buildingRvalMaybe, ax
loc_11BF9:
	mov	sp, bp
	pop	bp
	retf
saveGame endp

; Attributes: bp-based frame

restoreGame proc far

	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	buildingRvalMaybe, 1
	mov	ax, offset aDoYouWishToResto
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getYesNo
	or	ax, ax
	jnz	short loc_11C2C
	jmp	loc_11CD6
loc_11C2C:
	call	sub_22DA1
	mov	ax, offset aGame_sav
	push	ds
	push	ax
	call	getDisk2
	add	sp, 4
	mov	[bp+var_2], ax
	mov	ax, 348h
	push	ax
	mov	ax, offset roster
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	[bp+var_2]
	call	_read
	add	sp, 8
	mov	ax, offset byte_4EECC
	mov	cx, offset currentLocationMaybe
	mov	bx, seg	dseg
	sub	ax, cx
	push	ax
	mov	ax, cx
	mov	dx, bx
	push	dx
	push	ax
	push	[bp+var_2]
	call	_read
	add	sp, 8
	push	[bp+var_2]
	call	_close
	add	sp, 2
	mov	[bp+var_4], 0
	jmp	short loc_11C8A
loc_11C87:
	inc	[bp+var_4]
loc_11C8A:
	cmp	[bp+var_4], 5
	jge	short loc_11CAA
	mov	bx, [bp+var_4]
	cmp	lightDuration[bx], 0
	jz	short loc_11CA8
	push	bx
	call	icon_activate
	add	sp, 2
loc_11CA8:
	jmp	short loc_11C87
loc_11CAA:
	cmp	byte_4EEBA, 6
	jb	short loc_11CBE
	cmp	byte_4EEBA, 12h
	jbe	short loc_11CC2
loc_11CBE:
	mov	al, 1
	jmp	short loc_11CC4
loc_11CC2:
	sub	al, al
loc_11CC4:
	mov	gs:isNight, al
	mov	byte ptr word_44166,	0
loc_11CD6:
	mov	sp, bp
	pop	bp
	retf
restoreGame endp

; Attributes: bp-based frame

useItem	proc far

	var_FA=	word ptr -0FAh
	var_3A=	word ptr -3Ah
	var_36=	word ptr -36h
	var_34=	word ptr -34h
	var_32=	word ptr -32h
	var_2= word ptr	-2

	func_enter
	_chkstk 0FAh

	push_ds_string	aWhoWillUseAnItem
	std_call	printStringWClear, 4
	call	getCharNumber
	mov	[bp+var_2], ax
	or	ax, ax
	jge	short loc_11D01
	jmp	loc_11E03
loc_11D01:
	getCharP	[bp+var_2], bx
	test	gs:roster.status[bx], stat_dead	or stat_stoned or stat_paralyzed
	jz	short loc_11D18
	jmp	loc_11E03
loc_11D18:
	getCharP	[bp+var_2], bx
	cmp	gs:roster.class[bx], class_monster
	jb	short loc_11D2B
	jmp	loc_11E03
loc_11D2B:
	push_ss_string	var_32
	push_ss_string	var_FA
	push_var_stack	var_2
	std_call	sub_188E8, 0Ah

	mov	[bp+var_36], ax
	or	ax, ax
	jnz	short loc_11D4B
	jmp	loc_11DE7
loc_11D4B:
	push_reg	ax
	push_ss_string	var_32
	push_ds_string	aWhichItem?
	std_call	printStringGetInput, 0Ah

	mov	[bp+var_34], ax
	or	ax, ax
	jge	short loc_11D6B
	jmp	loc_11E03
loc_11D6B:
	push	[bp+var_34]
	push	[bp+var_2]
	call	item_canBeUsed
	add	sp, 4
	or	ax, ax
	jz	short loc_11DD8
	mov	bx, curSpellNo
	mov	al, byte_47F94[bx]
	sub	ah, ah
	and	ax, 7
	mov	[bp+var_3A], ax
	cmp	ax, 4
	jge	short loc_11DB5
	mov	ax, offset aUseOn
	push	ds
	push	ax
	push	[bp+var_3A]
	call	getTarget
	add	sp, 6
	mov	[bp+var_3A], ax
	or	ax, ax
	jge	short loc_11DB5
	jmp	short loc_11E03
loc_11DB5:
	call	clearTextWindow
	sub	ax, ax
	push	ax
	push	curSpellNo
	push	[bp+var_3A]
	push	[bp+var_34]
	push	[bp+var_2]
	push	cs
	call	near ptr sub_11E07
	add	sp, 0Ah
	jmp	short loc_11DE5
loc_11DD8:
	mov	ax, offset aPowerless_
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
loc_11DE5:
	jmp	short loc_11DF7
loc_11DE7:
	mov	ax, offset aYourPocketsAreEm
	mov	dx, seg	dseg
	push	dx
	push	ax
	call	printStringWClear
	add	sp, 4
loc_11DF7:
	wait4IO
loc_11E03:
	mov	sp, bp
	pop	bp
	retf
useItem	endp

; Attributes: bp-based frame

sub_11E07 proc far

	charNo=	word ptr  6
	arg_2= word ptr	 8
	arg_4= byte ptr	 0Ah
	arg_6= word ptr	 0Ch
	arg_8= word ptr	 0Eh

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, [bp+arg_2]
	mov	cx, ax
	shl	ax, 1
	add	ax, cx
	mov	gs:byte_4227E, al
	mov	al, byte ptr [bp+charNo]
	mov	gs:byte_42288, al
	mov	al, [bp+arg_4]
	mov	gs:bat_curTarget, al
	sub	ax, ax
	push	ax
	push	[bp+arg_8]
	push	[bp+arg_6]
	push	[bp+charNo]
	call	doCastSpell
	add	sp, 8
	push	[bp+arg_2]
	push	[bp+charNo]
	push	cs
	call	near ptr sub_11E5D
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
sub_11E07 endp

; Attributes: bp-based frame

sub_11E5D proc far

	var_4= dword ptr -4
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	getCharIndex	ax, [bp+arg_0]
	mov	bx, [bp+arg_2]
	mov	cx, bx
	shl	bx, 1
	add	bx, cx
	add	bx, ax
	cmp	gs:roster.inventory.itemCount[bx], 0FFh
	jnz	short loc_11E8B
	mov	ax, 1
	jmp	loc_11F17
loc_11E8B:
	getCharIndex	ax, [bp+arg_0]
	mov	cx, [bp+arg_2]
	mov	dx, cx
	shl	cx, 1
	add	cx, dx
	add	cx, ax
	add	cx, 64h	
	mov	word ptr [bp+var_4], cx
	mov	word ptr [bp+var_4+2], seg seg027
	lfs	bx, [bp+var_4]
	dec	byte ptr fs:[bx]
	lfs	bx, [bp+var_4]
	cmp	byte ptr fs:[bx], 0
	jz	short loc_11EBC
	mov	ax, 1
	jmp	short loc_11F17
loc_11EBC:
	mov	ax, [bp+arg_2]
	mov	cx, ax
	shl	ax, 1
	add	ax, cx
	mov	gs:word_42416, ax
	mov	ax, [bp+arg_0]
	mov	gs:word_4244C, ax
	call	inven_pack
	mov	al, gs:byte_41E62
	sub	ah, ah
	cmp	ax, [bp+arg_0]
	jnz	short loc_11F17
	mov	ax, 6
	push	ax
	push	[bp+arg_0]
	call	inven_hasTypeEquipped
	add	sp, 4
	or	ax, ax
	jnz	short loc_11F17
	cmp	gs:byte_422A4, 0
	jz	short loc_11F12
	call	bat_endCombatSong
	jmp	short loc_11F17
loc_11F12:
	call	sub_22DA1
loc_11F17:
	mov	sp, bp
	pop	bp
	retf
sub_11E5D endp

; Attributes: bp-based frame
snd_toggle proc	far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	word_42B36, 1
	sbb	ax, ax
	neg	ax
	mov	word_42B36, ax
	push	ax
	call	sub_27E05
	add	sp, 2
	mov	sp, bp
	pop	bp
	retf
snd_toggle endp

; This function	prints a string	based on a structure
; that is passed to it.	The optional lines are prefaced
; with a '@'
; Attributes: bp-based frame

printVarString proc far

	var_10A= word ptr -10Ah
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= dword ptr -4
	inString= dword	ptr  6
	arg_4= dword ptr  0Ah
	arg_8= dword ptr  0Eh
	arg_C= dword ptr  12h

	push	bp
	mov	bp, sp
	mov	ax, 10Ah
	call	someStackOperation
	push	si
	sub	ax, ax
	mov	[bp+var_8], ax
	mov	[bp+var_A], ax
	lea	ax, [bp+var_10A]
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], ss
loc_11F5C:
	lfs	bx, [bp+inString]
	inc	word ptr [bp+inString]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_6], ax
	lfs	bx, [bp+var_4]
	inc	word ptr [bp+var_4]
	mov	al, byte ptr [bp+var_6]
	mov	fs:[bx], al
	cmp	[bp+var_6], 0
	jz	short loc_11F82
	cmp	[bp+var_6], '@'
	jnz	short loc_11F5C
loc_11F82:
	dec	word ptr [bp+var_4]
	lfs	bx, [bp+var_4]
	mov	byte ptr fs:[bx], 0
	lea	ax, [bp+var_10A]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	lea	ax, [bp+var_10A]
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], ss
	cmp	[bp+var_6], 0
	jnz	short loc_11FBA
	mov	bx, [bp+var_8]
	lfs	si, [bp+arg_8]
	mov	byte ptr fs:[bx+si], 0
	mov	ax, [bp+var_A]
	jmp	loc_12082
loc_11FBA:
	cmp	[bp+var_6], 40h	
	jz	short loc_11FC3
	jmp	loc_1207F
loc_11FC3:
	mov	bx, [bp+var_8]
	lfs	si, [bp+arg_4]
	cmp	byte ptr fs:[bx+si], 0
	jz	short loc_1204B
	lfs	bx, [bp+inString]
	mov	al, fs:[bx]
	mov	bx, [bp+var_8]
	lfs	si, [bp+arg_8]
	mov	fs:[bx+si], al
	cmp	gs:byte_42419, 0
	jz	short loc_11FEF
	call	txt_newLine
loc_11FEF:
	mov	al, gs:txt_numLines
	sub	ah, ah
	add	ax, 10Eh
	mov	bx, [bp+var_8]
	inc	[bp+var_8]
	shl	bx, 1
	lfs	si, [bp+arg_C]
	mov	fs:[bx+si], ax
	mov	bl, gs:txt_numLines
	sub	bh, bh
	shl	bx, 1
	mov	ax, bitMask16bit[bx]
	or	[bp+var_A], ax
loc_12023:
	lfs	bx, [bp+inString]
	inc	word ptr [bp+inString]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_6], ax
	lfs	bx, [bp+var_4]
	inc	word ptr [bp+var_4]
	mov	al, byte ptr [bp+var_6]
	mov	fs:[bx], al
	cmp	[bp+var_6], 0
	jz	short loc_12049
	cmp	[bp+var_6], 40h	
	jnz	short loc_12023
loc_12049:
	jmp	short loc_1207F
loc_1204B:
	mov	bx, [bp+var_8]
	lfs	si, [bp+arg_8]
	mov	byte ptr fs:[bx+si], 0FFh
	mov	bx, [bp+var_8]
	inc	[bp+var_8]
	shl	bx, 1
	lfs	si, [bp+arg_C]
	mov	word ptr fs:[bx+si], 0
loc_12065:
	lfs	bx, [bp+inString]
	inc	word ptr [bp+inString]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_6], ax
	or	ax, ax
	jz	short loc_1207C
	cmp	ax, 40h	
	jnz	short loc_12065
loc_1207C:
	inc	word ptr [bp+var_4]
loc_1207F:
	jmp	loc_11F82
loc_12082:
	pop	si
	mov	sp, bp
	pop	bp
	retf
printVarString endp

; Attributes: bp-based frame

cmd_printLocation proc far

	var_126= word ptr -126h
	var_124= word ptr -124h
	var_110= word ptr -110h
	var_10E= word ptr -10Eh
	var_10C= word ptr -10Ch
	var_10A= word ptr -10Ah
	var_108= word ptr -108h
	var_106= word ptr -106h
	var_104= word ptr -104h
	var_102= word ptr -102h
	var_100= word ptr -100h

	push	bp
	mov	bp, sp
	mov	ax, 126h
	call	someStackOperation
	mov	[bp+var_10E], offset characterIOBuf
	mov	[bp+var_10C], seg seg022
	mov	ax, offset aYouReIn
	push	ds
	push	ax
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	cmp	currentLocationMaybe, 0
	jnz	short loc_120DF
	mov	ax, offset aThe
	push	ds
	push	ax
	push	dx
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
loc_120DF:
	lea	ax, [bp+var_124]
	push	ss
	push	ax
	push	[bp+var_10C]
	push	[bp+var_10E]
	call	decryptName
	add	sp, 8
	lea	ax, [bp+var_124]
	push	ss
	push	ax
	push	[bp+var_108]
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	mov	bx, currentLocationMaybe
	mov	al, byte_428A6[bx]
	cbw
	mov	cx, sq_north
	sub	cx, ax
	mov	[bp+var_126], cx
	or	cx, cx
	jnz	short loc_12137
	jmp	loc_121CD
loc_12137:
	mov	ax, offset aAnd_2
	push	ds
	push	ax
	push	dx
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	cmp	[bp+var_126], 0
	jge	short loc_1216A
	mov	ax, [bp+var_126]
	neg	ax
	mov	[bp+var_126], ax
	mov	[bp+var_106], 1
	jmp	short loc_12170
loc_1216A:
	mov	[bp+var_106], 0
loc_12170:
	sub	ax, ax
	push	ax
	mov	ax, [bp+var_126]
	cwd
	push	dx
	push	ax
	push	[bp+var_108]
	push	[bp+var_10A]
	call	_itoa
	add	sp, 0Ah
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	mov	ax, [bp+var_126]
	dec	ax
	push	ax
	push	dx
	push	[bp+var_10A]
	mov	ax, offset aPaceS_1
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	push	[bp+var_106]
	push	dx
	push	ax
	mov	ax, offset aNorthSouth_0
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
loc_121CD:
	mov	bx, currentLocationMaybe
	mov	al, byte_428B0[bx]
	cbw
	mov	cx, sq_east
	sub	cx, ax
	mov	[bp+var_102], cx
	or	cx, cx
	jnz	short loc_121F1
	jmp	loc_1228A
loc_121F1:
	mov	ax, offset aAnd_2
	push	ds
	push	ax
	push	[bp+var_108]
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	cmp	[bp+var_102], 0
	jge	short loc_12227
	mov	ax, [bp+var_102]
	neg	ax
	mov	[bp+var_102], ax
	mov	[bp+var_106], 1
	jmp	short loc_1222D
loc_12227:
	mov	[bp+var_106], 0
loc_1222D:
	sub	ax, ax
	push	ax
	mov	ax, [bp+var_102]
	cwd
	push	dx
	push	ax
	push	[bp+var_108]
	push	[bp+var_10A]
	call	_itoa
	add	sp, 0Ah
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	mov	ax, [bp+var_102]
	dec	ax
	push	ax
	push	dx
	push	[bp+var_10A]
	mov	ax, offset aPaceS_1
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	push	[bp+var_106]
	push	dx
	push	ax
	mov	ax, offset aEastWest_0
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
loc_1228A:
	mov	bx, currentLocationMaybe
	mov	al, byte_428BA[bx]
	cbw
	mov	[bp+var_110], ax
	mov	bl, byte_4EEBA
	sub	bh, bh
	mov	al, byte_428C4[bx]
	cbw
	mov	[bp+var_104], ax
	mov	ax, [bp+var_102]
	or	ax, [bp+var_126]
	cmp	ax, 1
	sbb	cx, cx
	neg	cx
	push	cx
	push	[bp+var_108]
	push	[bp+var_10A]
	mov	ax, offset aOfAtThe
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	mov	bx, [bp+var_110]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (locationString+2)[bx]
	push	word ptr locationString[bx]
	push	dx
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	mov	ax, offset aItSNow
	push	ds
	push	ax
	push	dx
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	mov	bx, [bp+var_104]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (timeOfDay+2)[bx]
	push	word ptr timeOfDay[bx]
	push	dx
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
	mov	sp, bp
	pop	bp
	retf
cmd_printLocation endp

; Attributes: bp-based frame

dropPartyMember	proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, offset aWhoWillYouDrop?
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_2], ax
	or	ax, ax
	jge	short loc_12381
	sub	ax, ax
	jmp	short loc_123C4
loc_12381:
	getCharP	[bp+var_2], bx
	cmp	gs:roster.class[bx], 0Dh
	jnb	short loc_123B4
	mov	ax, offset aYouCanTDropAPart
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
	sub	ax, ax
	jmp	short loc_123C4
	jmp	short loc_123BF
loc_123B4:
	push	[bp+var_2]
	call	rost_removeMember
	add	sp, 2
loc_123BF:
	mov	ax, 1
	jmp	short $+2
loc_123C4:
	mov	sp, bp
	pop	bp
	retf
dropPartyMember	endp

; Attributes: bp-based frame

quitGame proc far
	func_enter

	push_ds_string	aQuitTheGame?
	std_call	printStringWClear, 4

	call	getYesNo
	or	ax, ax
	jz	short loc_123FE
	push_ds_string	aYouWillLoseYou
	std_call	printStringWClear, 4
	call	getYesNo
	jmp	short loc_12402
	jmp	short loc_12402
loc_123FE:
	sub	ax, ax
	jmp	short $+2
loc_12402:
	mov	sp, bp
	pop	bp
locret_12405:
	retf
quitGame endp

seg001 ends

; Segment type:	Pure code
seg002 segment byte public 'CODE' use16
	assume cs:seg002
;org 6
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
; Attributes: bp-based frame

camp_addMember proc far

	var_15C= word ptr -15Ch
	var_15A= word ptr -15Ah
	var_158= word ptr -158h
	var_156= word ptr -156h
	partyBuf= dword	ptr -154h

	push	bp
	mov	bp, sp
	mov	ax, 15Ch
	call	someStackOperation
	push	si
	call	clearTextWindow
	push	cs
	call	near ptr countSavedChars
	or	ax, ax
	jnz	short loc_12422
	jmp	loc_1258F
loc_12422:
	mov	[bp+var_15C], 0
loc_12428:
	mov	si, [bp+var_15C]
	shl	si, 1
	shl	si, 1
	mov	ax, [bp+var_15C]
	mov	cl, 7
	shl	ax, cl
	add	ax, offset partyIOBuf
	mov	word ptr [bp+si+partyBuf], ax
	mov	word ptr [bp+si+partyBuf+2], seg seg022
	mov	si, [bp+var_15C]
	inc	[bp+var_15C]
	shl	si, 1
	shl	si, 1
	lfs	bx, [bp+si+partyBuf]
	cmp	byte ptr fs:[bx], 0
	jnz	short loc_12428
	dec	[bp+var_15C]
	mov	ax, [bp+var_15C]
	mov	[bp+var_156], ax
loc_12467:
	mov	ax, [bp+var_15C]
	sub	ax, [bp+var_156]
	getCharIndex	cx, cx
	add	ax, 0
	mov	si, [bp+var_15C]
	shl	si, 1
	shl	si, 1
	mov	word ptr [bp+si+partyBuf], ax
	mov	word ptr [bp+si+partyBuf+2], seg seg022
	mov	si, [bp+var_15C]
	inc	[bp+var_15C]
	shl	si, 1
	shl	si, 1
	lfs	bx, [bp+si+partyBuf]
	cmp	byte ptr fs:[bx], 0
	jnz	short loc_12467
	dec	[bp+var_15C]
loc_124A3:
	push	[bp+var_15C]
	lea	ax, [bp+partyBuf]
	push	ss
	push	ax
	mov	ax, offset aWhoShallJoin?
	push	ds
	push	ax
	call	printStringGetInput
	add	sp, 0Ah
	mov	[bp+var_15A], ax
	or	ax, ax
	jge	short loc_124C5
	jmp	loc_125A8
loc_124C5:
	mov	ax, [bp+var_156]
	cmp	[bp+var_15A], ax
	jge	short loc_124DD
	push	[bp+var_15A]
	push	cs
	call	near ptr rost_insertParty
	add	sp, 2
	jmp	loc_125A8
loc_124DD:
	mov	si, [bp+var_15A]
	shl	si, 1
	shl	si, 1
	push	word ptr [bp+si+partyBuf+2]
	push	word ptr [bp+si+partyBuf]
	push	cs
	call	near ptr charNameInParty
	add	sp, 4
	or	ax, ax
	jl	short loc_12531
	mov	si, [bp+var_15A]
	shl	si, 1
	shl	si, 1
	push	word ptr [bp+si+partyBuf+2]
	push	word ptr [bp+si+partyBuf]
	call	printStringWClear
	add	sp, 4
	mov	ax, offset aIsAlreadyInThe
	push	ds
	push	ax
	call	printString
	add	sp, 4
	wait4IO
	mov	[bp+var_158], 1
	jmp	short loc_12537
loc_12531:
	mov	[bp+var_158], 0
loc_12537:
	cmp	[bp+var_158], 0
	jz	short loc_12541
	jmp	loc_124A3
loc_12541:
	push	cs
	call	near ptr findEmptyRosterNum
	mov	[bp+var_158], ax
	cmp	ax, 7
	jge	short loc_1258D
	getCharP [bp+var_158], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	mov	ax, [bp+var_15A]
	sub	ax, [bp+var_156]
	getCharIndex	cx, cx
	mov	bx, ax
	lea	ax, characterIOBuf[bx]
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	cs
	call	near ptr copyCharacterBuf
	add	sp, 8
	push	cs
	call	near ptr rost_insertMember
	mov	byte ptr word_44166,	0
loc_1258D:
	jmp	short loc_125A8
loc_1258F:
	mov	ax, offset aThereAreNoChar
	push	ds
	push	ax
	call	printString
	add	sp, 4
	wait4IO
loc_125A8:
	pop	si
	mov	sp, bp
	pop	bp
	retf
camp_addMember endp

; Attributes: bp-based frame

rost_insertParty proc far

	var_A= word ptr	-0Ah
	var_8= dword ptr -8
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 0Ah
	call	someStackOperation
	push	si
	mov	ax, [bp+arg_0]
	mov	cl, 7
	shl	ax, cl
	add	ax, offset partyIOBuf
	mov	word ptr [bp+var_8], ax
	mov	word ptr [bp+var_8+2], seg seg022
	call	clearTextWindow
	mov	[bp+var_A], 0
	jmp	short loc_125DA
loc_125D7:
	inc	[bp+var_A]
loc_125DA:
	cmp	[bp+var_A], 7
	jl	short loc_125E3
	jmp	loc_12704
loc_125E3:
	mov	si, [bp+var_A]
	mov	cl, 4
	shl	si, cl
	lfs	bx, [bp+var_8]
	cmp	byte ptr fs:[bx+si+10h], 0
	jnz	short loc_125FA
	jmp	loc_12704
	jmp	loc_12701
loc_125FA:
	mov	ax, [bp+var_A]
	mov	cl, 4
	shl	ax, cl
	add	ax, bx
	mov	dx, fs
	add	ax, 10h
	push	dx
	push	ax
	push	cs
	call	near ptr charNameInParty
	add	sp, 4
	or	ax, ax
	jl	short loc_1264B
	mov	ax, [bp+var_A]
	mov	cl, 4
	shl	ax, cl
	add	ax, word ptr [bp+var_8]
	mov	dx, word ptr [bp+var_8+2]
	add	ax, 10h
	push	dx
	push	ax
	call	printString
	add	sp, 4
	mov	ax, offset aIsAlreadyInThe
	push	ds
	push	ax
	call	printString
	add	sp, 4
	delayNoTable	2
	jmp	loc_12701
loc_1264B:
	push	cs
	call	near ptr findEmptyRosterNum
	mov	[bp+var_2], ax
	cmp	ax, 7
	jl	short loc_1265A
	jmp	loc_126E8
loc_1265A:
	mov	ax, [bp+var_A]
	mov	cl, 4
	shl	ax, cl
	add	ax, word ptr [bp+var_8]
	mov	dx, word ptr [bp+var_8+2]
	add	ax, 10h
	push	dx
	push	ax
	push	cs
	call	near ptr rost_charNameExists
	add	sp, 4
	mov	[bp+var_4], ax
	or	ax, ax
	jge	short loc_126AF
	mov	ax, [bp+var_A]
	mov	cl, 4
	shl	ax, cl
	add	ax, word ptr [bp+var_8]
	mov	dx, word ptr [bp+var_8+2]
	add	ax, 10h
	push	dx
	push	ax
	call	printString
	add	sp, 4
	mov	ax, offset aThereSNoOneHer
	push	ds
	push	ax
	call	printString
	add	sp, 4
	delayNoTable	2
	jmp	short loc_126E6
loc_126AF:
	getCharP [bp+var_2], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	getCharP [bp+var_4], bx
	lea	ax, characterIOBuf[bx]
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	cs
	call	near ptr copyCharacterBuf
	add	sp, 8
	push	cs
	call	near ptr rost_insertMember
	mov	byte ptr word_44166,	0
loc_126E6:
	jmp	short loc_12701
loc_126E8:
	mov	ax, offset aTheRosterIsFul
	push	ds
	push	ax
	call	printString
	add	sp, 4
	delayNoTable	2
loc_12701:
	jmp	loc_125D7
loc_12704:
	pop	si
	mov	sp, bp
	pop	bp
	retf
rost_insertParty endp

; Attributes: bp-based frame

camp_removeMember proc far

	var_24=	word ptr -24h
	var_22=	word ptr -22h
	var_20=	word ptr -20h
	var_1E=	word ptr -1Eh
	var_1C=	word ptr -1Ch
	var_1A=	word ptr -1Ah

	push	bp
	mov	bp, sp
	mov	ax, 24h	
	call	someStackOperation
	push	si
	mov	[bp+var_24], 0
	mov	ax, offset aRemoveThemAll
	mov	[bp+var_20], ax
	mov	[bp+var_1E], ds
loc_12723:
	cmp	[bp+var_24], 7
	jge	short loc_1275A
	getCharP	[bp+var_24], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jz	short loc_1275A
	getCharIndex	ax, [bp+var_24]
	add	ax, offset roster
	mov	si, [bp+var_24]
	shl	si, 1
	shl	si, 1
	mov	[bp+si+var_1C],	ax
	mov	[bp+si+var_1A],	seg seg027
	inc	[bp+var_24]
	jmp	short loc_12723
loc_1275A:
	mov	ax, [bp+var_24]
	inc	ax
	push	ax
	lea	ax, [bp+var_20]
	push	ss
	push	ax
	mov	ax, offset aSelectWhichPar
	push	ds
	push	ax
	call	printStringGetInput
	add	sp, 0Ah
	mov	[bp+var_22], ax
	or	ax, ax
	jge	short loc_1277A
	jmp	short loc_1279C
loc_1277A:
	cmp	[bp+var_22], 0
	jnz	short loc_12786
	push	cs
	call	near ptr rost_clearRoster
	jmp	short loc_12792
loc_12786:
	mov	ax, [bp+var_22]
	dec	ax
	push	ax
	push	cs
	call	near ptr rost_removeMember
	add	sp, 2
loc_12792:
	mov	byte ptr word_44166,	0
loc_1279C:
	pop	si
	mov	sp, bp
	pop	bp
	retf
camp_removeMember endp

; This function	moves all of the roster	slots below
; slotNo up one	slot. It then zeroes the tail of the
; roster. This effectively removes the character from
; the roster.
; Attributes: bp-based frame

rost_removeMember proc far

	slotNo=	word ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	jmp	short loc_127B1
loc_127AE:
	inc	[bp+slotNo]
loc_127B1:
	cmp	[bp+slotNo], 6
	jge	short loc_127D7
	getCharP	[bp+slotNo], si
	lea	ax, roster._name[si]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, stru_41EFA._name[si]
	push	dx
	push	ax
	push	cs
	call	near ptr copyCharacterBuf
	add	sp, 8
	jmp	short loc_127AE
loc_127D7:
	mov	gs:rosterTail._name, 0
	pop	si
	mov	sp, bp
	pop	bp
	retf
rost_removeMember endp

; Attributes: bp-based frame

rost_clearRoster proc far

	slotNo=	word ptr -2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+slotNo], 0
	jmp	short loc_127FB
loc_127F8:
	inc	[bp+slotNo]
loc_127FB:
	cmp	[bp+slotNo], 7
	jge	short loc_12815
	getCharP	[bp+slotNo], bx
	mov	byte ptr gs:roster._name[bx], 0
	jmp	short loc_127F8
loc_12815:
	mov	sp, bp
	pop	bp
	retf
rost_clearRoster endp

; Attributes: bp-based frame

camp_renameMember proc far

	var_25E= word ptr -25Eh
	var_25C= word ptr -25Ch
	var_25A= word ptr -25Ah
	var_258= word ptr -258h
	nameBuf= word ptr -254h
	var_22C= dword ptr -22Ch
	var_100= word ptr -100h

	push	bp
	mov	bp, sp
	mov	ax, 25Eh
	call	someStackOperation
	push	si
	call	clearTextWindow
	push	cs
	call	near ptr countSavedChars
	or	ax, ax
	jnz	short loc_12835
	jmp	loc_1297E
loc_12835:
	mov	[bp+var_25A], 0
loc_1283B:
	getCharIndex	ax, [bp+var_25A]
	add	ax, 0
	mov	si, [bp+var_25A]
	shl	si, 1
	shl	si, 1
	mov	word ptr [bp+si+var_22C], ax
	mov	word ptr [bp+si+var_22C+2], seg	seg022
	mov	si, [bp+var_25A]
	inc	[bp+var_25A]
	shl	si, 1
	shl	si, 1
	lfs	bx, [bp+si+var_22C]
	cmp	byte ptr fs:[bx], 0
	jnz	short loc_1283B
	dec	[bp+var_25A]
	push	[bp+var_25A]
	lea	ax, [bp+var_22C]
	push	ss
	push	ax
	mov	ax, offset aRenameWho?
	push	ds
	push	ax
	call	printStringGetInput
	add	sp, 0Ah
	mov	[bp+var_258], ax
	or	ax, ax
	jge	short loc_12893
	jmp	loc_12997
loc_12893:
	mov	ax, offset aWhatIs
	push	ds
	push	ax
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_25E], ax
	mov	[bp+var_25C], dx
	mov	si, [bp+var_258]
	shl	si, 1
	shl	si, 1
	push	word ptr [bp+si+var_22C+2]
	push	word ptr [bp+si+var_22C]
	push	dx
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_25E], ax
	mov	[bp+var_25C], dx
	mov	ax, offset aSNewName?
	push	ds
	push	ax
	push	dx
	push	[bp+var_25E]
	call	_strcat
	add	sp, 8
	mov	[bp+var_25E], ax
	mov	[bp+var_25C], dx
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	[bp+var_25A], 0
	jmp	short loc_12904
loc_12900:
	inc	[bp+var_25A]
loc_12904:
	cmp	[bp+var_25A], 10h
	jge	short loc_12916
	mov	si, [bp+var_25A]
	mov	byte ptr [bp+si+nameBuf], 0
	jmp	short loc_12900
loc_12916:
	mov	ax, 0Eh
	push	ax
	lea	ax, [bp+nameBuf]
	push	ss
	push	ax
	call	_readString
	add	sp, 6
	or	ax, ax
	jz	short loc_1297C
	lea	ax, [bp+nameBuf]
	push	ss
	push	ax
	push	cs
	call	near ptr rost_charNameExists
	add	sp, 4
	or	ax, ax
	jl	short loc_1294C
	mov	ax, offset aThereIsAlready
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	jmp	short loc_1297C
loc_1294C:
	mov	[bp+var_25A], 0
	jmp	short loc_12958
loc_12954:
	inc	[bp+var_25A]
loc_12958:
	cmp	[bp+var_25A], 10h
	jge	short loc_1297C
	mov	si, [bp+var_25A]
	mov	al, byte ptr [bp+si+nameBuf]
	mov	si, [bp+var_258]
	shl	si, 1
	shl	si, 1
	lfs	bx, [bp+si+var_22C]
	mov	si, [bp+var_25A]
	mov	fs:[bx+si], al
	jmp	short loc_12954
loc_1297C:
	jmp	short loc_12997
loc_1297E:
	mov	ax, offset aThereAreNoChar
	push	ds
	push	ax
	call	printString
	add	sp, 4
	wait4IO
loc_12997:
	pop	si
	mov	sp, bp
	pop	bp
	retf
camp_renameMember endp

; Attributes: bp-based frame

camp_createMember proc far

	var_23A= byte ptr -23Ah
	var_EC=	byte ptr -0ECh
	var_EA=	word ptr -0EAh
	var_E8=	word ptr -0E8h
	var_7E=	byte ptr -7Eh
	var_34=	word ptr -34h
	counter= word ptr -32h
	var_30=	word ptr -30h
	var_2E=	word ptr -2Eh
	var_24=	word ptr -24h
	var_22=	word ptr -22h
	var_20=	dword ptr -20h
	var_1C=	word ptr -1Ch
	var_8= word ptr	-8
	raceGenderValue= word ptr -6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 0ECh 
	call	someStackOperation
	push	di
	push	si
	mov	word ptr [bp+var_20], offset newCharBuffer
	mov	word ptr [bp+var_20+2],	seg seg027
loc_129B3:
	mov	[bp+counter], 0
	jmp	short loc_129BD
loc_129BA:
	inc	[bp+counter]
loc_129BD:
	cmp	[bp+counter], 78h 
	jge	short loc_129CF
	mov	bx, [bp+counter]
	lfs	si, [bp+var_20]
	mov	byte ptr fs:[bx+si], 0
	jmp	short loc_129BA
loc_129CF:
	push	cs
	call	near ptr getCharacterGender
	mov	gs:newCharBuffer.gender, al
	cmp	al, 0FFh
	jnz	short loc_129E4
	sub	ax, ax
	jmp	loc_12DAE
loc_129E4:
	push	cs
	call	near ptr getCharacterRace
	mov	gs:newCharBuffer.race, al
	cmp	al, 0FFh
	jnz	short loc_129F9
	sub	ax, ax
	jmp	loc_12DAE
loc_129F9:
	mov	al, gs:newCharBuffer.race
	sub	ah, ah
	shl	ax, 1
	mov	cl, gs:newCharBuffer.gender
	sub	ch, ch
	add	ax, cx
	mov	cx, ax
	shl	ax, 1
	shl	ax, 1
	add	ax, cx
	mov	[bp+raceGenderValue], ax
	mov	[bp+counter], 0
	jmp	short loc_12A1F
loc_12A1C:
	inc	[bp+counter]
loc_12A1F:
	cmp	[bp+counter], 5
	jge	short loc_12A5A
	call	_random
	and	ax, 7
	mov	si, [bp+raceGenderValue]
	mov	bx, [bp+counter]
	mov	cx, ax
	mov	al, byte ptr baseAttributes.male_st[bx+si]
	cbw
	add	ax, cx
	mov	si, bx
	shl	si, 1
	mov	[bp+si+var_2E],	ax
	mov	si, [bp+counter]
	shl	si, 1
	cmp	[bp+si+var_2E],	1Eh
	jle	short loc_12A58
	mov	si, [bp+counter]
	shl	si, 1
	mov	[bp+si+var_2E],	1Eh
loc_12A58:
	jmp	short loc_12A1C
loc_12A5A:
	call	_random
	and	ax, 0Fh
	add	ax, 13
	mov	[bp+var_30], ax
	mov	gs:newCharBuffer.currentHP, ax
	mov	gs:newCharBuffer.maxHP,	ax
	mov	[bp+var_24], ax
	call	clearTextWindow
	mov	ax, 5
	push	ax
	lea	ax, [bp+var_E8]
	push	ss
	push	ax
	lea	ax, [bp+var_2E]
	push	ss
	push	ax
	call	getAttributeString
	add	sp, 0Ah
	lea	ax, [bp+var_E8]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	al, gs:newCharBuffer.race
	sub	ah, ah
	mov	cx, ax
	shl	ax, 1
	shl	ax, 1
	add	ax, cx
	shl	ax, 1
	mov	[bp+raceGenderValue], ax
	sub	ax, ax
	mov	[bp+var_EA], ax
	mov	[bp+var_2], ax
	mov	al, gs:txt_numLines
	sub	ah, ah
	mov	[bp+var_8], ax
	mov	[bp+counter], 0
	jmp	short loc_12AD8
loc_12AD5:
	inc	[bp+counter]
loc_12AD8:
	cmp	[bp+counter], 10
	jge	short loc_12B30
	mov	si, [bp+raceGenderValue]
	mov	bx, [bp+counter]
	cmp	byte ptr startingClasses.canBeWarrior[bx+si], 0
	jz	short loc_12B2E
	mov	bl, gs:txt_numLines
	sub	bh, bh
	shl	bx, 1
	mov	ax, (bitMask16bit+2)[bx]
	or	[bp+var_2], ax
	mov	bx, [bp+counter]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (classString+2)[bx]
	push	word ptr classString[bx]
	push	[bp+var_EA]
	push	cs
	call	near ptr printOrderedList
	add	sp, 6
	mov	si, [bp+var_EA]
	inc	[bp+var_EA]
	shl	si, 1
	mov	ax, [bp+counter]
	mov	[bp+si+var_1C],	ax
loc_12B2E:
	jmp	short loc_12AD5
loc_12B30:
	mov	[bp+var_4], 0
	mov	[bp+var_34], 1
loc_12B3A:
	push	[bp+var_2]
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_22], ax
	mov	ax, [bp+var_8]
	add	ax, 10Eh
	cmp	ax, [bp+var_22]
	jg	short loc_12B7B
	mov	ax, [bp+var_EA]
	add	ax, [bp+var_8]
	add	ax, 10Eh
	cmp	ax, [bp+var_22]
	jl	short loc_12B7B
	mov	si, [bp+var_22]
	sub	si, [bp+var_8]
	shl	si, 1
	mov	al, [bp+si+var_23A]
	mov	gs:newCharBuffer.class,	al
	mov	[bp+var_34], 0
loc_12B7B:
	cmp	[bp+var_22], 30h 
	jle	short loc_12BA4
	mov	ax, [bp+var_EA]
	add	ax, 30h	
	cmp	ax, [bp+var_22]
	jl	short loc_12BA4
	mov	si, [bp+var_22]
	shl	si, 1
	mov	al, [bp+si+var_7E]
	mov	gs:newCharBuffer.class,	al
	mov	[bp+var_34], 0
	jmp	short loc_12BB4
loc_12BA4:
	cmp	[bp+var_22], 1Bh
	jnz	short loc_12BB4
	mov	[bp+var_34], 0
	mov	[bp+var_4], 1
loc_12BB4:
	cmp	[bp+var_34], 0
	jz	short loc_12BBD
	jmp	loc_12B3A
loc_12BBD:
	cmp	[bp+var_4], 0
	jz	short loc_12BC6
	jmp	loc_129B3
loc_12BC6:
	mov	al, gs:newCharBuffer.class
	sub	ah, ah
	mov	si, ax
	mov	di, word ptr gs:newCharBuffer.gender
	and	di, 0FFh
	mov	bx, si
	shl	bx, 1
	mov	al, byte_42F8C[bx+di]
	mov	gs:newCharBuffer.picIndex, al
	mov	ax, si
	jmp	short loc_12C3B
loc_12BEB:
	mov	gs:newCharBuffer.spells, 0E0h ;	''
	jmp	short loc_12C56
loc_12BF7:
	mov	gs:newCharBuffer.spells+2, 1Ch
	jmp	short loc_12C56
loc_12C03:
	mov	gs:newCharBuffer.specAbil, 14h
	mov	gs:newCharBuffer.specAbil+1, 14h
	mov	gs:newCharBuffer.specAbil+2, 14h
	jmp	short loc_12C56
loc_12C1B:
	mov	gs:newCharBuffer.specAbil, 1
	mov	gs:newCharBuffer.specAbil+1, 0FCh 
	jmp	short loc_12C56
loc_12C2D:
	mov	gs:newCharBuffer.specAbil, 5
	jmp	short loc_12C56
	jmp	short loc_12C56
loc_12C3B:
	cmp	ax, class_conjurer
	jz	short loc_12BEB
	cmp	ax, class_magician
	jz	short loc_12BF7
	cmp	ax, class_rogue
	jz	short loc_12C03
	cmp	ax, class_bard
	jz	short loc_12C1B
	cmp	ax, class_hunter
	jz	short loc_12C2D
	jmp	short $+2
loc_12C56:
	mov	bl, gs:newCharBuffer.class
	sub	bh, bh
	mov	al, byte_4302E[bx]
	cbw
	mov	[bp+raceGenderValue], ax
	mov	[bp+counter], 0
loc_12C6E:
	mov	si, [bp+raceGenderValue]
	mov	bx, [bp+counter]
	mov	al, startingInventory[bx+si]
	mov	[bp+var_EC], al
	cmp	al, 0FEh 
	jz	short loc_12C8A
	mov	gs:newCharBuffer.inventory.itemFlags[bx], al
	inc	[bp+counter]
	jmp	short loc_12C6E
loc_12C8A:
	mov	word ptr [bp+var_20], offset newCharBuffer.strength
	mov	word ptr [bp+var_20+2],	seg seg027
	mov	[bp+counter], 0
	jmp	short loc_12C9E
loc_12C9B:
	inc	[bp+counter]
loc_12C9E:
	cmp	[bp+counter], 5
	jge	short loc_12CB7
	mov	si, [bp+counter]
	shl	si, 1
	mov	al, byte ptr [bp+si+var_2E]
	mov	bx, [bp+counter]
	lfs	si, [bp+var_20]
	mov	fs:[bx+si], al
	jmp	short loc_12C9B
loc_12CB7:
	mov	gs:newCharBuffer.level,	1
	mov	gs:newCharBuffer.maxLevel, 1
	cmp	gs:newCharBuffer.class,	class_warrior
	jz	short loc_12CEE
	cmp	gs:newCharBuffer.class,	class_rogue
	jnb	short loc_12CEE
	call	_random
	and	ax, 0Fh
	add	ax, 8
	mov	gs:newCharBuffer.currentSppt, ax
	jmp	short loc_12CF5
loc_12CEE:
	mov	gs:newCharBuffer.currentSppt, 0
loc_12CF5:
	mov	ax, gs:newCharBuffer.currentSppt
	mov	gs:newCharBuffer.maxSppt, ax
loc_12CFD:
	mov	ax, offset aNameYourNewCha
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	ax, 0Eh
	push	ax
	mov	ax, offset newCharBuffer
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	_readString
	add	sp, 6
	or	ax, ax
	jnz	short loc_12D25
	jmp	loc_12DAE
loc_12D25:
	cmp	gs:newCharBuffer._name,	2Ah 
	jnz	short loc_12D37
	mov	gs:newCharBuffer._name,	58h 
loc_12D37:
	mov	ax, offset newCharBuffer
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	cs
	call	near ptr rost_charNameExists
	add	sp, 4
	or	ax, ax
	jl	short loc_12D6A
	mov	ax, offset aThereIsAlready
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
	mov	[bp+var_4], 1
	jmp	short loc_12D6F
loc_12D6A:
	mov	[bp+var_4], 0
loc_12D6F:
	cmp	[bp+var_4], 0
	jnz	short loc_12CFD
	push	cs
	call	near ptr countSavedChars
	mov	[bp+var_30], ax
	getCharP	[bp+var_30], bx
	lea	ax, characterIOBuf[bx]
	mov	dx, seg	seg022
	push	dx
	push	ax
	mov	ax, offset newCharBuffer
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	cs
	call	near ptr copyCharacterBuf
	add	sp, 8
	getCharP	[bp+var_30], bx
	mov	fs, seg022_x
	assume fs:seg022
	mov	fs:(characterIOBuf+78h)[bx], 0
loc_12DAE:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
camp_createMember endp

; Attributes: bp-based frame
getCharacterGender proc	far

	func_enter

loc_getCharacterGender_loop_start:
	push_ds_string	aDoYouWishYourC
	std_call	printStringWClear, 4

	mov	ax, 0Ch
	push	ax
	std_call	sub_14E41, 2

	cmp	ax, 1Bh
	jz	loc_getCharacterGender_return_ff

	cmp	ax, 'F'
	jz	loc_getCharacterGender_return_one
	cmp	ax, 111h
	jz	loc_getCharacterGender_return_one

	cmp	ax, 'M'
	jz	loc_getCharacterGender_return_zero
	cmp	ax, 110h
	jnz	loc_getCharacterGender_loop_start
	
loc_getCharacterGender_return_zero:
	xor	ax, ax
	jmp	loc_getCharacterGender_exit

loc_getCharacterGender_return_one:
	mov	ax, 1
	jmp	loc_getCharacterGender_exit

loc_getCharacterGender_return_ff:
	mov	ax, 0FFh

loc_getCharacterGender_exit:
	mov	sp, bp
	pop	bp
	retf
getCharacterGender endp

; Attributes: bp-based frame

getCharacterRace proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
loc_12E19:
	mov	ax, offset aSelectARaceFor
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	ax, 1FCh
	push	ax
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_2], ax
	cmp	ax, 1Bh
	jnz	short loc_12E3F
	mov	ax, 0FFh
	jmp	short loc_12E6B
loc_12E3F:
	cmp	[bp+var_2], 10Fh
	jle	short loc_12E55
	cmp	[bp+var_2], 117h
	jge	short loc_12E55
	mov	ax, [bp+var_2]
	sub	ax, 110h
	jmp	short loc_12E6B
loc_12E55:
	cmp	[bp+var_2], 30h	
	jle	short loc_12E69
	cmp	[bp+var_2], 38h	
	jge	short loc_12E69
	mov	ax, [bp+var_2]
	sub	ax, 31h	
	jmp	short loc_12E6B
loc_12E69:
	jmp	short loc_12E19
loc_12E6B:
	mov	sp, bp
	pop	bp
	retf
getCharacterRace endp

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	gs:rosterTail._name, 1
	sbb	ax, ax
	inc	ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
; Returns the character	number of the character	name.
; Returns -1 if	there is no character by the provided
; name in the party
; Attributes: bp-based frame

charNameInParty	proc far

	var_2= word ptr	-2
	_offset= word ptr  6
	_segment= word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 0
	jmp	short loc_12EA1
loc_12E9E:
	inc	[bp+var_2]
loc_12EA1:
	cmp	[bp+var_2], 7
	jge	short loc_12ED1
	getCharP	[bp+var_2], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	[bp+_segment]
	push	[bp+_offset]
	call	_strcmp
	add	sp, 8
	or	ax, ax
	jnz	short loc_12ECF
	mov	ax, [bp+var_2]
	jmp	short loc_12ED6
loc_12ECF:
	jmp	short loc_12E9E
loc_12ED1:
	mov	ax, 0FFFFh
	jmp	short $+2
loc_12ED6:
	mov	sp, bp
	pop	bp
	retf
charNameInParty	endp

; This function	returns	the index of the character
; in the saved character list matching "name". If the
; name is not found it returns 0xffff
; Attributes: bp-based frame

rost_charNameExists proc far

	counter= word ptr -2
	nameOffset= word ptr  6
	nameString= word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+counter], 0
	jmp	short loc_12EEF
loc_12EEC:
	inc	[bp+counter]
loc_12EEF:
	cmp	[bp+counter], 75
	jge	short loc_12F1F
	getCharP	[bp+counter], bx
	lea	ax, characterIOBuf[bx]
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	[bp+nameString]
	push	[bp+nameOffset]
	call	_strcmp
	add	sp, 8
	or	ax, ax
	jnz	short loc_12F1D
	mov	ax, [bp+counter]
	jmp	short loc_12F24
loc_12F1D:
	jmp	short loc_12EEC
loc_12F1F:
	mov	ax, 0FFFFh
	jmp	short $+2
loc_12F24:
	mov	sp, bp
	pop	bp
	retf
rost_charNameExists endp

; This function	prints a string	with a number in
; front	of it. e.g. 1) Wizard
; Attributes: bp-based frame

printOrderedList proc far

	var_2C=	word ptr -2Ch
	var_4= dword ptr -4
	arg_0= byte ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 2Ch	
	call	someStackOperation
	lea	ax, [bp+var_2C]
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], ss
	lfs	bx, [bp+var_4]
	inc	word ptr [bp+var_4]
	mov	al, [bp+arg_0]
	add	al, '1'
	mov	fs:[bx], al
	lfs	bx, [bp+var_4]
	inc	word ptr [bp+var_4]
	mov	byte ptr fs:[bx], ')'
	push	[bp+arg_4]
	push	[bp+arg_2]
	push	word ptr [bp+var_4+2]
	push	word ptr [bp+var_4]
	call	_strcat
	add	sp, 8
	lea	ax, [bp+var_2C]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
printOrderedList endp

; Attributes: bp-based frame

camp_deleteCharacter proc far

	counter= word ptr -15Ch
	var_15A= word ptr -15Ah
	var_158= word ptr -158h
	var_156= word ptr -156h
	var_154= dword ptr -154h
	var_150= word ptr -150h
	var_14E= word ptr -14Eh

	push	bp
	mov	bp, sp
	mov	ax, 15Ch
	call	someStackOperation
	push	si
	call	clearTextWindow
	push	cs
	call	near ptr countSavedChars
	or	ax, ax
	jnz	short loc_12F95
	jmp	loc_13120
loc_12F95:
	mov	[bp+counter], 0
loc_12F9B:
	mov	si, [bp+counter]
	shl	si, 1
	shl	si, 1
	mov	ax, [bp+counter]
	mov	cl, 7
	shl	ax, cl
	add	ax, offset partyIOBuf
	mov	word ptr [bp+si+var_154], ax
	mov	word ptr [bp+si+var_154+2], seg	seg022
	mov	si, [bp+counter]
	inc	[bp+counter]
	shl	si, 1
	shl	si, 1
	lfs	bx, [bp+si+var_154]
	cmp	byte ptr fs:[bx], 0
	jnz	short loc_12F9B
	dec	[bp+counter]
	mov	ax, [bp+counter]
	mov	[bp+var_156], ax
loc_12FDA:
	mov	ax, [bp+counter]
	sub	ax, [bp+var_156]
	getCharIndex	cx, cx
	add	ax, 0
	mov	si, [bp+counter]
	shl	si, 1
	shl	si, 1
	mov	word ptr [bp+si+var_154], ax
	mov	word ptr [bp+si+var_154+2], seg	seg022
	mov	si, [bp+counter]
	inc	[bp+counter]
	shl	si, 1
	shl	si, 1
	lfs	bx, [bp+si+var_154]
	cmp	byte ptr fs:[bx], 0
	jnz	short loc_12FDA
	dec	[bp+counter]
	push	[bp+counter]
	lea	ax, [bp+var_154]
	push	ss
	push	ax
	mov	ax, offset aDeleteWho?
	push	ds
	push	ax
	call	printStringGetInput
	add	sp, 0Ah
	mov	[bp+var_15A], ax
	or	ax, ax
	jge	short loc_13038
	jmp	loc_13139
loc_13038:
	mov	ax, [bp+var_156]
	cmp	[bp+var_15A], ax
	jge	short loc_13050
	push	[bp+var_15A]
	push	cs
	call	near ptr sub_1313E
	add	sp, 2
	jmp	loc_13139
loc_13050:
	mov	si, [bp+var_15A]
	shl	si, 1
	shl	si, 1
	push	word ptr [bp+si+var_154+2]
	push	word ptr [bp+si+var_154]
	push	cs
	call	near ptr charNameInParty
	add	sp, 4
	or	ax, ax
	jl	short loc_1309F
	mov	si, [bp+var_15A]
	shl	si, 1
	shl	si, 1
	push	word ptr [bp+si+var_154+2]
	push	word ptr [bp+si+var_154]
	call	printStringWClear
	add	sp, 4
	mov	ax, offset aIsCurrentlyInT
	push	ds
	push	ax
	call	printString
	add	sp, 4
	wait4IO
	jmp	loc_13139
loc_1309F:
	mov	ax, offset aAreYouSureYouW
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	si, [bp+var_15A]
	shl	si, 1
	shl	si, 1
	push	word ptr [bp+si+var_154+2]
	push	word ptr [bp+si+var_154]
	call	printString
	add	sp, 4
	call	getYesNo
	or	ax, ax
	jz	short loc_1311E
	mov	ax, [bp+var_15A]
	mov	[bp+var_158], ax
	jmp	short loc_130DB
loc_130D7:
	inc	[bp+var_158]
loc_130DB:
	mov	ax, [bp+counter]
	cmp	[bp+var_158], ax
	jge	short loc_1310E
	mov	si, [bp+var_158]
	shl	si, 1
	shl	si, 1
	push	word ptr [bp+si+var_154+2]
	push	word ptr [bp+si+var_154]
	mov	si, [bp+var_158]
	shl	si, 1
	shl	si, 1
	push	[bp+si+var_14E]
	push	[bp+si+var_150]
	push	cs
	call	near ptr copyCharacterBuf
	add	sp, 8
	jmp	short loc_130D7
loc_1310E:
	mov	si, [bp+counter]
	shl	si, 1
	shl	si, 1
	lfs	bx, [bp+si+var_154]
	mov	byte ptr fs:[bx], 0
loc_1311E:
	jmp	short loc_13139
loc_13120:
	mov	ax, offset aThereAreNoChar
	push	ds
	push	ax
	call	printString
	add	sp, 4
	wait4IO
loc_13139:
	pop	si
	mov	sp, bp
	pop	bp
	retf
camp_deleteCharacter endp

; Attributes: bp-based frame

sub_1313E proc far

	var_10A= dword ptr -10Ah
	var_106= dword ptr -106h
	var_102= word ptr -102h
	var_100= word ptr -100h
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 10Ah
	call	someStackOperation
	push	si
	mov	ax, [bp+arg_0]
	mov	cl, 7
	shl	ax, cl
	add	ax, offset partyIOBuf
	mov	word ptr [bp+var_106], ax
	mov	word ptr [bp+var_106+2], seg seg022
	mov	ax, offset aAreYouSureYouW
	push	ds
	push	ax
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_10A], ax
	mov	word ptr [bp+var_10A+2], dx
	push	word ptr [bp+var_106+2]
	push	word ptr [bp+var_106]
	push	dx
	push	ax
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_10A], ax
	mov	word ptr [bp+var_10A+2], dx
	lfs	bx, [bp+var_10A]
	inc	word ptr [bp+var_10A]
	mov	byte ptr fs:[bx], 3Fh ;	'?'
	lfs	bx, [bp+var_10A]
	inc	word ptr [bp+var_10A]
	mov	byte ptr fs:[bx], 0
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getYesNo
	or	ax, ax
	jz	short loc_1323F
	mov	ax, [bp+arg_0]
	mov	[bp+var_102], ax
	jmp	short loc_131CF
loc_131CB:
	inc	[bp+var_102]
loc_131CF:
	cmp	[bp+var_102], 9
	jge	short loc_13211
	mov	ax, word ptr [bp+var_106]
	mov	dx, word ptr [bp+var_106+2]
	add	ax, 80h
	mov	word ptr [bp+var_10A], ax
	mov	word ptr [bp+var_10A+2], dx
	mov	ax, 80h
	push	ax
	push	dx
	push	word ptr [bp+var_10A]
	push	dx
	push	word ptr [bp+var_106]
	call	_memcpy
	add	sp, 0Ah
	mov	ax, word ptr [bp+var_10A]
	mov	dx, word ptr [bp+var_10A+2]
	mov	word ptr [bp+var_106], ax
	mov	word ptr [bp+var_106+2], dx
	jmp	short loc_131CB
loc_13211:
	mov	word ptr [bp+var_106], offset byte_31268
	mov	word ptr [bp+var_106+2], seg seg022
	mov	[bp+var_102], 0
	jmp	short loc_13229
loc_13225:
	inc	[bp+var_102]
loc_13229:
	cmp	[bp+var_102], 80h
	jge	short loc_1323F
	mov	bx, [bp+var_102]
	lfs	si, [bp+var_106]
	mov	byte ptr fs:[bx+si], 0
	jmp	short loc_13225
loc_1323F:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_1313E endp

; Attributes: bp-based frame

saveParty proc far

	var_18=	word ptr -18h
	var_16=	word ptr -16h
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 18h
	call	someStackOperation
	mov	ax, offset aNameToSavePart
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	ax, 0Eh
	push	ax
	lea	ax, [bp+var_16]
	push	ss
	push	ax
	call	_readString
	add	sp, 6
	or	ax, ax
	jz	short loc_132A6
	push	cs
	call	near ptr countSavedParties
	mov	[bp+var_18], ax
	lea	ax, [bp+var_16]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_132AA
	add	sp, 4
	mov	[bp+var_2], ax
	or	ax, ax
	jge	short loc_13291
	mov	ax, [bp+var_18]
	mov	[bp+var_2], ax
loc_13291:
	cmp	[bp+var_2], 9
	jg	short loc_132A6
	lea	ax, [bp+var_16]
	push	ss
	push	ax
	push	[bp+var_2]
	push	cs
	call	near ptr sub_132F7
	add	sp, 6
loc_132A6:
	mov	sp, bp
	pop	bp
	retf
saveParty endp

; Attributes: bp-based frame

sub_132AA proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 0
	jmp	short loc_132BF
loc_132BC:
	inc	[bp+var_2]
loc_132BF:
	cmp	[bp+var_2], 0Ah
	jge	short loc_132EE
	mov	bx, [bp+var_2]
	mov	cl, 7
	shl	bx, cl
	lea	ax, partyIOBuf[bx]
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	_strcmp
	add	sp, 8
	or	ax, ax
	jnz	short loc_132EC
	mov	ax, [bp+var_2]
	jmp	short loc_132F3
loc_132EC:
	jmp	short loc_132BC
loc_132EE:
	mov	ax, 0FFFFh
	jmp	short $+2
loc_132F3:
	mov	sp, bp
	pop	bp
	retf
sub_132AA endp

; Attributes: bp-based frame

sub_132F7 proc far

	var_6= word ptr	-6
	var_4= dword ptr -4
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	mov	ax, [bp+arg_0]
	mov	cl, 7
	shl	ax, cl
	add	ax, offset partyIOBuf
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], seg seg022
	lfs	bx, [bp+var_4]
	mov	byte ptr fs:[bx], 3Eh
	push	[bp+arg_4]
	push	[bp+arg_2]
	mov	ax, word ptr [bp+var_4]
	mov	dx, word ptr [bp+var_4+2]
	inc	ax
	push	dx
	push	ax
	call	sub_2A912
	add	sp, 8
	mov	[bp+var_6], 0
	jmp	short loc_1333C
loc_13339:
	inc	[bp+var_6]
loc_1333C:
	cmp	[bp+var_6], 7
	jge	short loc_1336F
	getCharP	[bp+var_6], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	mov	ax, [bp+var_6]
	mov	cl, 4
	shl	ax, cl
	add	ax, word ptr [bp+var_4]
	mov	dx, word ptr [bp+var_4+2]
	add	ax, 10h
	push	dx
	push	ax
	call	sub_2A912
	add	sp, 8
	jmp	short loc_13339
loc_1336F:
	mov	sp, bp
	pop	bp
	retf
sub_132F7 endp

; Attributes: bp-based frame

countSavedParties proc far

	var_6= word ptr	-6
	var_4= dword ptr -4

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	mov	word ptr [bp+var_4], offset partyIOBuf
	mov	word ptr [bp+var_4+2], seg seg022
	mov	[bp+var_6], 0
	jmp	short loc_13393
loc_13390:
	inc	[bp+var_6]
loc_13393:
	cmp	[bp+var_6], 0Ah
	jge	short loc_133B0
	mov	bx, [bp+var_6]
	mov	cl, 7
	shl	bx, cl
	lfs	si, [bp+var_4]
	cmp	byte ptr fs:[bx+si], 0
	jnz	short loc_133AE
	mov	ax, [bp+var_6]
	jmp	short loc_133B5
loc_133AE:
	jmp	short loc_13390
loc_133B0:
	mov	ax, 0Ah
	jmp	short $+2
loc_133B5:
	pop	si
	mov	sp, bp
	pop	bp
	retf
countSavedParties endp

; Attributes: bp-based frame

saveAndExitMaybe proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, offset aPressReturnToS
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	push	cs
	call	near ptr sub_1374D
	sub	ax, ax
	push	ax
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_2], ax
	cmp	ax, 0Dh
	jnz	short loc_13412
	mov	buildingRvalMaybe, 0FFh
	push	cs
	call	near ptr countSavedChars
	mov	[bp+var_2], ax
	push	ax
	push	cs
	call	near ptr saveCharsInf
	add	sp, 2
	push	cs
	call	near ptr countSavedParties
	mov	[bp+var_2], ax
	push	ax
	push	cs
	call	near ptr savePartiesInf
	add	sp, 2
loc_13412:
	call	clearTextWindow
	mov	sp, bp
	pop	bp
	retf
saveAndExitMaybe endp

; Attributes: bp-based frame

enterWilderness	proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	cs
	call	near ptr sub_1374D
	push	cs
	call	near ptr countSavedChars
	mov	[bp+var_2], ax
	push	ax
	push	cs
	call	near ptr saveCharsInf
	add	sp, 2
	push	cs
	call	near ptr countSavedParties
	mov	[bp+var_2], ax
	push	ax
	push	cs
	call	near ptr savePartiesInf
	add	sp, 2
	mov	byte_4EEBA, 6
	sub	al, al
	mov	levelNoMaybe, al
	mov	gs:isNight, al
	mov	buildingRvalMaybe, 2
	mov	sp, bp
	pop	bp
	retf
enterWilderness	endp

; Attributes: bp-based frame

camp_enter proc	far

	var_58=	word ptr -58h
	var_56=	word ptr -56h
	var_54=	word ptr -54h
	var_52=	word ptr -52h
	var_3E=	word ptr -3Eh
	var_3C=	word ptr -3Ch
	var_14=	word ptr -14h

	push	bp
	mov	bp, sp
	mov	ax, 58h	
	call	someStackOperation
	push	si
	call	sub_22DA1
	mov	[bp+var_56], 0
	jmp	short loc_1348E
loc_1348B:
	inc	[bp+var_56]
loc_1348E:
	cmp	[bp+var_56], 5
	jge	short loc_134AE
	mov	bx, [bp+var_56]
	cmp	lightDuration[bx], 0
	jz	short loc_134AC
	push	bx
	call	sub_17920
	add	sp, 2
loc_134AC:
	jmp	short loc_1348B
loc_134AE:
	mov	gs:byte_41E61, 0
	mov	gs:songACBonus,	0
	push	cs
	call	near ptr camp_readCharsParties
	push	cs
	call	near ptr sub_1374D
	mov	ax, offset aTheRuin
	push	ds
	push	ax
	call	setTitle
	add	sp, 4
	sub	ax, ax
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
loc_134E2:
	call	clearTextWindow
	lea	ax, [bp+var_14]
	push	ss
	push	ax
	push	cs
	call	near ptr camp_configOptionList
	add	sp, 4
	lea	ax, [bp+var_3C]
	push	ss
	push	ax
	lea	ax, [bp+var_52]
	push	ss
	push	ax
	lea	ax, [bp+var_14]
	push	ss
	push	ax
	mov	ax, offset aThouArtInTheCa
	push	ds
	push	ax
	call	printVarString
	add	sp, 10h
	mov	[bp+var_54], ax
	push	cs
	call	near ptr findEmptyRosterNum
	mov	[bp+var_58], ax
	mov	ax, [bp+var_54]
	or	ah, 20h
	push	ax
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_3E], ax
	cmp	ax, 30h	
	jle	short loc_13564
	mov	ax, [bp+var_58]
	add	ax, 31h	
	cmp	ax, [bp+var_3E]
	jle	short loc_13564
	mov	ax, [bp+var_3E]
	sub	ax, 31h	
	push	ax
	call	printCharacter
	add	sp, 2
	sub	ax, ax
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
	mov	ax, offset aTheRuin
	push	ds
	push	ax
	call	setTitle
	add	sp, 4
	jmp	short loc_135A7
loc_13564:
	mov	[bp+var_56], 0
loc_13569:
	mov	si, [bp+var_56]
	cmp	byte ptr [bp+si+var_52], 0
	jz	short loc_135A7
	mov	al, byte ptr [bp+si+var_52]
	cbw
	cmp	ax, [bp+var_3E]
	jz	short loc_13585
	shl	si, 1
	mov	ax, [bp+var_3E]
	cmp	[bp+si+var_3C],	ax
	jnz	short loc_135A2
loc_13585:
	mov	bx, [bp+var_56]
	shl	bx, 1
	shl	bx, 1
	call	off_430BC[bx]
	cmp	buildingRvalMaybe, 0
	jz	short loc_135A2
	mov	ax, buildingRvalMaybe
	jmp	short loc_135AA
loc_135A2:
	inc	[bp+var_56]
	jmp	short loc_13569
loc_135A7:
	jmp	loc_134E2
loc_135AA:
	pop	si
	mov	sp, bp
	pop	bp
	retf
camp_enter endp

; Attributes: bp-based frame

camp_readCharsParties proc far

	var_A= dword ptr -0Ah
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 0Ah
	call	someStackOperation
	push	si
	mov	word ptr [bp+var_A], offset characterIOBuf
	mov	word ptr [bp+var_A+2], seg seg022
	mov	[bp+var_6], 0
	jmp	short loc_135CF
loc_135CC:
	inc	[bp+var_6]
loc_135CF:
	cmp	[bp+var_6], 4Bh	
	jge	short loc_135E6
	getCharP	[bp+var_6], bx
	lfs	si, [bp+var_A]
	mov	byte ptr fs:[bx+si], 0
	jmp	short loc_135CC
loc_135E6:
	mov	ax, offset aThieves_inf
	push	ds
	push	ax
	push	cs
	call	near ptr getDisk2
	add	sp, 4
	mov	[bp+var_4], ax
	mov	ax, 9000
	push	ax
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	[bp+var_4]
	call	_read
	add	sp, 8
	push	[bp+var_4]
	call	_close
	add	sp, 2
	push	cs
	call	near ptr countSavedChars
	mov	[bp+var_2], ax
	mov	[bp+var_6], ax
	jmp	short loc_13626
loc_13623:
	inc	[bp+var_6]
loc_13626:
	cmp	[bp+var_6], 75
	jge	short loc_1363D
	getCharP	[bp+var_6], bx
	lfs	si, [bp+var_A]
	mov	byte ptr fs:[bx+si], 0
	jmp	short loc_13623
loc_1363D:
	mov	word ptr [bp+var_A], offset partyIOBuf
	mov	word ptr [bp+var_A+2], seg seg022
	mov	[bp+var_6], 0
	jmp	short loc_13651
loc_1364E:
	inc	[bp+var_6]
loc_13651:
	cmp	[bp+var_6], 0Ah
	jge	short loc_13667
	mov	bx, [bp+var_6]
	mov	cl, 7
	shl	bx, cl
	lfs	si, [bp+var_A]
	mov	byte ptr fs:[bx+si], 0
	jmp	short loc_1364E
loc_13667:
	mov	ax, offset aParties_inf
	push	ds
	push	ax
	push	cs
	call	near ptr getDisk2
	add	sp, 4
	mov	[bp+var_4], ax
	mov	ax, 500h
	push	ax
	mov	ax, offset partyIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	[bp+var_4]
	call	_read
	add	sp, 8
	push	cs
	call	near ptr countSavedParties
	mov	[bp+var_6], ax
	jmp	short loc_13699
loc_13696:
	inc	[bp+var_6]
loc_13699:
	cmp	[bp+var_6], 0Ah
	jge	short loc_136AF
	mov	bx, [bp+var_6]
	mov	cl, 7
	shl	bx, cl
	lfs	si, [bp+var_A]
	mov	byte ptr fs:[bx+si], 0
	jmp	short loc_13696
loc_136AF:
	push	[bp+var_4]
	call	_close
	add	sp, 2
	mov	ax, [bp+var_2]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
camp_readCharsParties endp

; Attributes: bp-based frame

saveCharsInf proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, offset aThieves_inf
	push	ds
	push	ax
	push	cs
	call	near ptr getDisk2
	add	sp, 4
	mov	[bp+var_2], ax
	getCharIndex	ax, [bp+arg_0]
	inc	ax
	push	ax
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	[bp+var_2]
	call	_write
	add	sp, 8
	push	[bp+var_2]
	call	_close
	add	sp, 2
	mov	sp, bp
	pop	bp
	retf
saveCharsInf endp

; Attributes: bp-based frame

savePartiesInf proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, offset aParties_inf
	push	ds
	push	ax
	push	cs
	call	near ptr getDisk2
	add	sp, 4
	mov	[bp+var_2], ax
	mov	ax, [bp+arg_0]
	mov	cl, 7
	shl	ax, cl
	inc	ax
	push	ax
	mov	ax, offset partyIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	[bp+var_2]
	call	_write
	add	sp, 8
	push	[bp+var_2]
	call	_close
	add	sp, 2
	mov	sp, bp
	pop	bp
	retf
savePartiesInf endp

; Attributes: bp-based frame

sub_1374D proc far

	emptySlot= word	ptr -8
	counter= word ptr -6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	cs
	call	near ptr findEmptyRosterNum
	mov	[bp+emptySlot],	ax
	mov	[bp+counter], 0
	jmp	short loc_13769
loc_13766:
	inc	[bp+counter]
loc_13769:
	mov	ax, [bp+emptySlot]
	cmp	[bp+counter], ax
	jl	short loc_13774
	jmp	loc_137FD
loc_13774:
	getCharP	[bp+counter], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	cs
	call	near ptr rost_charNameExists
	add	sp, 4
	mov	[bp+var_4], ax
	or	ax, ax
	jge	short loc_137D1
	push	cs
	call	near ptr countSavedChars
	mov	[bp+var_2], ax
	getCharP	[bp+var_2], bx
	lea	ax, characterIOBuf[bx]
	mov	dx, seg	seg022
	push	dx
	push	ax
	getCharP	[bp+var_2], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	cs
	call	near ptr copyCharacterBuf
	add	sp, 8
	wait4IO
	jmp	short loc_137FA
loc_137D1:
	getCharP	[bp+var_4], bx
	lea	ax, characterIOBuf[bx]
	mov	dx, seg	seg022
	push	dx
	push	ax
	getCharP	[bp+counter], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	cs
	call	near ptr copyCharacterBuf
	add	sp, 8
loc_137FA:
	jmp	loc_13766
loc_137FD:
	mov	sp, bp
	pop	bp
	retf
sub_1374D endp

; Attributes: bp-based frame

copyCharacterBuf proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah
	arg_6= word ptr	 0Ch

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 78h	
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	[bp+arg_6]
	push	[bp+arg_4]
	call	_memcpy
	add	sp, 0Ah
	mov	sp, bp
	pop	bp
	retf
copyCharacterBuf endp

; This function	counts the number of characters	in
; the ioBuffer memory area.
; Attributes: bp-based frame

countSavedChars	proc far

	var_6= dword ptr -6
	counter= word ptr -2

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	mov	word ptr [bp+var_6], offset characterIOBuf
	mov	word ptr [bp+var_6+2], seg seg022
	mov	[bp+counter], 0
loc_13842:
	getCharP	[bp+counter], bx
	lfs	si, [bp+var_6]
	cmp	fs:[bx+si+character_t._name], 0
	jz	short loc_13858
	inc	[bp+counter]
	jmp	short loc_13842
loc_13858:
	mov	ax, [bp+counter]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
countSavedChars	endp

; This function	configures a byte-array	for use	in
; the camp.
;
; Structure:
; a[0] is zero if no empty roster slots, One otherwise
; Attributes: bp-based frame

camp_configOptionList proc far

	counter= word ptr -2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	push	cs
	call	near ptr findEmptyRosterNum
	cmp	ax, 7
	jge	short loc_1387B
	mov	al, 1
	jmp	short loc_1387D
loc_1387B:
	sub	al, al
loc_1387D:
	lfs	bx, [bp+arg_0]
	mov	fs:[bx+campStru_t.hasEmptySlot], al
	push	cs
	call	near ptr rost_isNotEmpty
	lfs	bx, [bp+arg_0]
	mov	fs:[bx+campStru_t.notEmpty], al
	cmp	fs:[bx+campStru_t.notEmpty], 1
	sbb	ax, ax
	neg	ax
	mov	fs:[bx+campStru_t.isEmpty], al
	push	cs
	call	near ptr countSavedChars
	cmp	ax, 75
	jge	short loc_138AB
	mov	al, 1
	jmp	short loc_138AD
loc_138AB:
	sub	al, al
loc_138AD:
	lfs	bx, [bp+arg_0]
	mov	fs:[bx+campStru_t.canSaveChar],	al
	mov	al, fs:[bx+campStru_t.canSaveChar]
	mov	fs:[bx+campStru_t.canSaveChar_1], al
	mov	[bp+counter], campStru_t.field_5
	jmp	short loc_138C9
loc_138C6:
	inc	[bp+counter]
loc_138C9:
	cmp	[bp+counter], 8
	jge	short loc_138DB
	mov	bx, [bp+counter]
	lfs	si, [bp+arg_0]
	mov	byte ptr fs:[bx+si], 1
	jmp	short loc_138C6
loc_138DB:
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+campStru_t.notEmpty]
	mov	fs:[bx+campStru_t.field_6], al
	push	cs
	call	near ptr rost_getLastActiveSlot
	cmp	ax, 7
	jge	short loc_138F3
	mov	al, 1
	jmp	short loc_138F5
loc_138F3:
	sub	al, al
loc_138F5:
	lfs	bx, [bp+arg_0]
	mov	fs:[bx+8], al
	pop	si
	mov	sp, bp
	pop	bp
	retf
camp_configOptionList endp

; This function	searches through the roster looking
; for an entry that has	0 as the first character of
; the name field.
; Attributes: bp-based frame
findEmptyRosterNum proc	far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 0
	jmp	short loc_13916
loc_13913:
	inc	[bp+var_2]
loc_13916:
	cmp	[bp+var_2], 7
	jge	short loc_13937
	getCharP	[bp+var_2], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jnz	short loc_13935
	mov	ax, [bp+var_2]
	jmp	short loc_1393C
loc_13935:
	jmp	short loc_13913
loc_13937:
	mov	ax, 7
	jmp	short $+2
loc_1393C:
	mov	sp, bp
	pop	bp
	retf
findEmptyRosterNum endp

; This function	returns	1 if roster slot zero
; is occupied. Zero otherwise
; Attributes: bp-based frame

rost_isNotEmpty	proc far
	push	bp
	mov	bp, sp
	cmp	gs:roster._name, 1
	sbb	ax, ax
	inc	ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
rost_isNotEmpty	endp

; This function	starts at the end of the roster	and
; returns the index of the last	slot that still	has
; a character active
; Attributes: bp-based frame

rost_getLastActiveSlot proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 6
	jmp	short loc_13972
loc_1396F:
	dec	[bp+var_2]
loc_13972:
	cmp	[bp+var_2], 0
	jl	short loc_1398D
	push	[bp+var_2]
	push	cs
	call	near ptr isRosterSlotActive
	add	sp, 2
	or	ax, ax
	jz	short loc_1398B
	mov	ax, [bp+var_2]
	jmp	short loc_13992
loc_1398B:
	jmp	short loc_1396F
loc_1398D:
	mov	ax, 63h	
	jmp	short $+2
loc_13992:
	mov	sp, bp
	pop	bp
	retf
rost_getLastActiveSlot endp

; This function	returns	0 if the roster	slot at	slotNo
; is empty, field_67 !=	0, or field_2d & 1c
; Attributes: bp-based frame
isRosterSlotActive proc	far

	slotNo=	word ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	getCharP	[bp+slotNo], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jz	short loc_139D9
	getCharP	[bp+slotNo], bx
	cmp	gs:(roster.specAbil+3)[bx], 0
	jnz	short loc_139D9
	getCharP	[bp+slotNo], bx
	test	gs:roster.status[bx], stat_dead	or stat_stoned or stat_paralyzed
	jnz	short loc_139D9
	mov	ax, 1
	jmp	short loc_139DB
loc_139D9:
	sub	ax, ax
loc_139DB:
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
isRosterSlotActive endp

; Attributes: bp-based frame

tav_enter proc far

	counter= word ptr -6
	lastCharNo= word ptr -4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	cs
	call	near ptr findEmptyRosterNum
	mov	[bp+lastCharNo], ax
	mov	[bp+counter], 0
	jmp	short loc_139FD
loc_139FA:
	inc	[bp+counter]
loc_139FD:
	cmp	[bp+counter], 7
	jge	short loc_13A0D
	mov	bx, [bp+counter]
	mov	tav_drunkLevel[bx], 0
	jmp	short loc_139FA
loc_13A0D:
	mov	ax, 83
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
	push	cs
	call	near ptr tav_setTitle
	mov	word_4FD56, ax
loc_13A20:
	mov	ax, offset aHailTravelersS
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	ax, 70h	
	push	ax
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_2], ax
	jmp	short loc_13A7F
loc_13A3E:
	push	[bp+lastCharNo]
	push	cs
	call	near ptr tav_orderDrink
	add	sp, 2
	or	ax, ax
	jz	short loc_13A50
	sub	ax, ax
	jmp	short loc_13AAE
loc_13A50:
	mov	byte ptr word_44166,	0
	jmp	short loc_13A9F
loc_13A5C:
	push	[bp+lastCharNo]
	push	cs
	call	near ptr tav_talkToBarkeep
	add	sp, 2
	mov	byte ptr word_44166,	0
	jmp	short loc_13A9F
loc_13A72:
	call	clearTextWindow
	sub	ax, ax
	jmp	short loc_13AAE
loc_13A7B:
	jmp	short loc_13A9F
	jmp	short loc_13A9F
loc_13A7F:
	cmp	ax, 45h	
	jz	short loc_13A72
	cmp	ax, 4Fh	
	jz	short loc_13A3E
	cmp	ax, 54h	
	jz	short loc_13A5C
	cmp	ax, 112h
	jz	short loc_13A3E
	cmp	ax, 113h
	jz	short loc_13A5C
	cmp	ax, 114h
	jz	short loc_13A72
	jmp	short loc_13A7B
loc_13A9F:
	wait4IO
	jmp	loc_13A20
loc_13AAE:
	mov	sp, bp
	pop	bp
	retf
tav_enter endp

; Attributes: bp-based frame

tav_orderDrink proc far

	var_112= word ptr -112h
	var_12=	word ptr -12h
	var_10=	word ptr -10h
	var_E= word ptr	-0Eh
	var_C= word ptr	-0Ch
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	lastCharNo= word ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 112h
	call	someStackOperation
	mov	ax, offset aWhoWillOrderAD
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	push	cs
	call	near ptr getCharNumber
	mov	[bp+var_C], ax
	or	ax, ax
	jge	short loc_13ADA
	sub	ax, ax
	jmp	loc_13CB6
loc_13ADA:
	getCharP	[bp+var_C], bx
	test	gs:roster.status[bx], 1Ch
	jz	short loc_13AF9
	mov	bx, [bp+var_C]
	mov	tav_drunkLevel[bx], maxDrunkLevel
	jmp	loc_13BED
loc_13AF9:
	mov	ax, offset aSeatThyself
	push	ds
	push	ax
	lea	ax, [bp+var_112]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	getCharP	[bp+var_C], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	[bp+var_2]
	push	[bp+var_4]
	call	_strcat
	add	sp, 8
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	lea	ax, [bp+var_112]
	push	ss
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	al, gs:txt_numLines
	sub	ah, ah
	add	ax, 2
	mov	[bp+var_8], ax
	mov	[bp+var_6], 0
	mov	[bp+var_E], 0
	jmp	short loc_13B64
loc_13B61:
	inc	[bp+var_E]
loc_13B64:
	cmp	[bp+var_E], 5
	jge	short loc_13B80
	mov	bx, [bp+var_8]
	add	bx, [bp+var_E]
	shl	bx, 1
	mov	ax, bitMask16bit[bx]
	or	[bp+var_6], ax
	jmp	short loc_13B61
loc_13B80:
	mov	ax, offset aWhatLlItBe?Ale
	push	ds
	push	ax
	call	printString
	add	sp, 4
loc_13B8D:
	push	[bp+var_6]
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_A], ax
	cmp	ax, 1Bh
	jz	short loc_13BA5
	cmp	ax, 119h
	jnz	short loc_13BAA
loc_13BA5:
	sub	ax, ax
	jmp	loc_13CB6
loc_13BAA:
	mov	[bp+var_12], 1
	mov	[bp+var_E], 0
	jmp	short loc_13BB9
loc_13BB6:
	inc	[bp+var_E]
loc_13BB9:
	cmp	[bp+var_E], 5
	jge	short loc_13BE7
	mov	bx, [bp+var_E]
	mov	al, byte ptr aAbmfg[bx]
	cbw
	cmp	ax, [bp+var_A]
	jz	short loc_13BD9
	mov	ax, bx
	add	ax, [bp+var_8]
	add	ax, 10Eh
	cmp	ax, [bp+var_A]
	jnz	short loc_13BE5
loc_13BD9:
	mov	ax, bx
	mov	[bp+var_10], ax
	mov	[bp+var_12], 0
	jmp	short loc_13BE7
loc_13BE5:
	jmp	short loc_13BB6
loc_13BE7:
	cmp	[bp+var_12], 0
	jnz	short loc_13B8D
loc_13BED:
	mov	bx, [bp+var_C]
	cmp	tav_drunkLevel[bx], maxDrunkLevel
	jl	short loc_13C34
	mov	ax, offset aThouAreInNoCon
	push	ds
	push	ax
	call	printString
	add	sp, 4
	push	[bp+lastCharNo]
	push	cs
	call	near ptr tav_isPartyDrunk
	add	sp, 2
	or	ax, ax
	jz	short loc_13C2F
	mov	ax, offset aInFactThyParty
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	byte_4EEBA, 16h
	mov	ax, 1
	jmp	loc_13CB6
loc_13C2F:
	sub	ax, ax
	jmp	loc_13CB6
loc_13C34:
	mov	bx, [bp+var_C]
	mov	al, byte_437D8[bx]
	cbw
	cwd
	push	dx
	push	ax
	push	bx
	push	cs
	call	near ptr payGold
	add	sp, 6
	or	ax, ax
	jz	short loc_13CA9
	mov	ax, offset aWillYouHaveIt_
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
loc_13C58:
	mov	ax, 6
	push	ax
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_A], ax
	jmp	short loc_13C8F
loc_13C69:
	push	[bp+var_10]
	push	[bp+var_C]
	push	cs
	call	near ptr tav_drink
	add	sp, 4
	sub	ax, ax
	jmp	short loc_13CB6
loc_13C7A:
	push	[bp+var_10]
	push	[bp+var_C]
	push	cs
	call	near ptr tav_getWineskin
	add	sp, 4
	sub	ax, ax
	jmp	short loc_13CB6
loc_13C8B:
	jmp	short loc_13CA5
	jmp	short loc_13CA5
loc_13C8F:
	cmp	ax, 48h	
	jz	short loc_13C69
	cmp	ax, 54h	
	jz	short loc_13C7A
	cmp	ax, 10Fh
	jz	short loc_13C69
	cmp	ax, 110h
	jz	short loc_13C7A
	jmp	short loc_13C8B
loc_13CA5:
	jmp	short loc_13C58
	jmp	short loc_13CB6
loc_13CA9:
	mov	ax, offset aNotEnoughGold_
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
loc_13CB6:
	mov	sp, bp
	pop	bp
	retf
tav_orderDrink endp

; Attributes: bp-based frame

payGold	proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	mov	ax, [bp+arg_2]
	mov	dx, [bp+arg_4]
	mov	cx, ax
	mov	bx, dx
	getCharP	[bp+arg_0], si
	cmp	word ptr gs:(roster.gold+2)[si], bx
	ja	short loc_13CEF
	jb	short loc_13CEB
	cmp	word ptr gs:roster.gold[si], cx
	jnb	short loc_13CEF
loc_13CEB:
	sub	ax, ax
	jmp	short loc_13D0D
loc_13CEF:
	mov	ax, [bp+arg_2]
	mov	dx, bx
	mov	cx, ax
	getCharP	[bp+arg_0], si
	sub	word ptr gs:roster.gold[si], cx
	sbb	word ptr gs:(roster.gold+2)[si], bx
	mov	ax, 1
	jmp	short $+2
loc_13D0D:
	pop	si
	mov	sp, bp
	pop	bp
	retf
payGold	endp

; Attributes: bp-based frame

tav_drink proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	call	clearTextWindow
	cmp	[bp+arg_2], 4
	jnz	short loc_13D39
	mov	ax, offset aNowThatSARealT
	push	ds
	push	ax
	call	printString
	add	sp, 4
	jmp	loc_13DCD
loc_13D39:
	cmp	[bp+arg_2], 3
	jnz	short loc_13D4E
	mov	ax, offset aMyGoodnessThat
	push	ds
	push	ax
	call	printString
	add	sp, 4
	jmp	short loc_13D5B
loc_13D4E:
	mov	ax, offset aBurpNotTooBad_
	push	ds
	push	ax
	call	printString
	add	sp, 4
loc_13D5B:
	mov	bx, [bp+arg_0]
	mov	si, [bp+arg_2]
	mov	al, tav_drinkStrength[si]
	add	tav_drunkLevel[bx], al
	cmp	tav_drunkLevel[bx], 0Ch
	jle	short loc_13D78
	mov	bx, [bp+arg_0]
	mov	tav_drunkLevel[bx], 0Ch
loc_13D78:
	mov	bx, [bp+arg_0]
	mov	al, tav_drunkLevel[bx]
	cbw
	mov	bx, ax
	shl	bx, 1
	shl	bx, 1
	push	word ptr (drunkString+2)[bx]
	push	word ptr drunkString[bx]
	call	printString
	add	sp, 4
	getCharP	[bp+arg_0], si
	cmp	gs:roster.class[si], class_bard
	jnz	short loc_13DCD
	mov	ax, gs:roster.level[si]
	sub	ax, 0FFh
	sbb	cx, cx
	and	ax, cx
	add	ax, 0FFh
	mov	[bp+var_2], ax
	mov	al, gs:roster.specAbil[si]
	sub	ah, ah
	cmp	ax, [bp+var_2]
	jnb	short loc_13DCD
	inc	gs:roster.specAbil[si]
loc_13DCD:
	wait4IO
	pop	si
	mov	sp, bp
	pop	bp
	retf
tav_drink endp

; Attributes: bp-based frame

tav_getWineskin	proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	cmp	[bp+arg_2], 4
	jnz	short loc_13DF3
	sub	ax, ax
	jmp	short loc_13DF6
loc_13DF3:
	mov	ax, 4
loc_13DF6:
	mov	[bp+var_2], ax
	mov	ax, 1
	push	ax
	push	[bp+var_2]
	mov	ax, 76h	
	push	ax
	push	[bp+arg_0]
	call	inven_addItem
	add	sp, 8
	or	ax, ax
	jz	short loc_13E22
	mov	ax, offset aTheBartenderFi
	push	ds
	push	ax
	call	printString
	add	sp, 4
	jmp	short loc_13E55
loc_13E22:
	mov	ax, offset aSorryBut
	push	ds
	push	ax
	call	printString
	add	sp, 4
	getCharP	[bp+arg_0], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	printString
	add	sp, 4
	mov	ax, offset aCanTCarryAnyMo
	push	ds
	push	ax
	call	printString
	add	sp, 4
loc_13E55:
	wait4IO
	mov	sp, bp
	pop	bp
	retf
tav_getWineskin	endp

; Attributes: bp-based frame

tav_isPartyDrunk proc far

	lastCharNo= word ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	jmp	short loc_13E74
loc_13E71:
	dec	[bp+lastCharNo]
loc_13E74:
	cmp	[bp+lastCharNo], 0
	jl	short loc_13E8A
	mov	bx, [bp+lastCharNo]
	cmp	tav_drunkLevel[bx], maxDrunkLevel
	jge	short loc_13E88
	sub	ax, ax
	jmp	short loc_13E8F
loc_13E88:
	jmp	short loc_13E71
loc_13E8A:
	mov	ax, 1
	jmp	short $+2
loc_13E8F:
	mov	sp, bp
	pop	bp
	retf
tav_isPartyDrunk endp

; Attributes: bp-based frame

tav_setTitle proc far
deltaN=	word ptr -8
counter= word ptr -6
var_4= word ptr	-4
deltaE=	word ptr -2
	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	mov	[bp+var_4], 4
	mov	si, dirFacing
	shl	si, 1
	mov	ax, sq_north
	sub	ax, dirDeltaN[si]
	mov	[bp+deltaN], ax
	mov	ax, dirDeltaE[si]
	add	ax, sq_east
	mov	[bp+deltaE], ax
	mov	[bp+counter], 0
	jmp	short loc_13EE2
loc_13EDF:
	inc	[bp+counter]
loc_13EE2:
	cmp	[bp+counter], 4
	jge	short loc_13F22
	mov	ax, [bp+counter]
	mov	cx, ax
	shl	ax, 1
	shl	ax, 1
	add	ax, cx
	mov	si, ax
	mov	al, byte ptr tavCoords.sqN[si]
	cbw
	cmp	ax, [bp+deltaN]
	jnz	short loc_13F20
	mov	al, tavCoords.sqE[si]
	cbw
	cmp	ax, [bp+deltaE]
	jnz	short loc_13F20
	mov	al, tavCoords.location[si]
	cbw
	cmp	ax, currentLocationMaybe
	jnz	short loc_13F20
	mov	ax, cx
	mov	[bp+var_4], ax
	jmp	short loc_13F22
loc_13F20:
	jmp	short loc_13EDF
loc_13F22:
	mov	bx, [bp+var_4]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (tavernNames+2)[bx]
	push	word ptr tavernNames[bx]
	call	setTitle
	add	sp, 4
	mov	bx, [bp+var_4]
	mov	ax, bx
	shl	bx, 1
	shl	bx, 1
	add	bx, ax
	mov	al, tavCoords.field_4[bx]
	cbw
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
tav_setTitle endp

; Attributes: bp-based frame

tav_talkToBarkeep proc far

	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 0Ah
	call	someStackOperation
	mov	ax, offset aWhoWillTalkToT
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	push	cs
	call	near ptr getCharNumber
	mov	[bp+var_8], ax
	or	ax, ax
	jge	short loc_13F78
	sub	ax, ax
	jmp	loc_14079
loc_13F78:
	call	clearTextWindow
	mov	bx, [bp+var_8]
	cmp	tav_drunkLevel[bx], 0Ch
	jl	short loc_13F8A
	jmp	loc_1406A
loc_13F8A:
	mov	ax, offset aTalkAinTCheap
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	bx, [bp+var_8]
	cmp	tav_drunkLevel[bx], 5
	jl	short loc_13FAE
	mov	ax, offset aBeerBreath
	push	ds
	push	ax
	call	printString
	add	sp, 4
loc_13FAE:
	mov	ax, offset aTheBarkeepSays
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	ax, offset aHowMuchWillYou
	push	ds
	push	ax
	call	printString
	add	sp, 4
	call	sub_16001
	cwd
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	or	dx, ax
	jnz	short loc_13FDB
	jmp	loc_14079
loc_13FDB:
	push	[bp+var_2]
	push	[bp+var_4]
	push	[bp+var_8]
	push	cs
	call	near ptr payGold
	add	sp, 6
	or	ax, ax
	jnz	short loc_13FFE
	mov	ax, offset aNotEnoughGold_
	push	ds
	push	ax
	call	printString
	add	sp, 4
	jmp	short loc_14079
loc_13FFE:
	getCharP	[bp+var_8], bx
	mov	ax, word ptr gs:roster.gold[bx]
	or	ax, word ptr gs:(roster.gold+2)[bx]
	jz	short loc_1405B
	mov	[bp+var_A], 4
	jmp	short loc_14020
loc_1401D:
	dec	[bp+var_A]
loc_14020:
	cmp	[bp+var_A], 0
	jl	short loc_14059
	mov	bx, [bp+var_A]
	mov	al, byte_43876[bx]
	sub	ah, ah
	sub	dx, dx
	cmp	dx, [bp+var_2]
	ja	short loc_14057
	jb	short loc_1403D
	cmp	ax, [bp+var_4]
	jnb	short loc_14057
loc_1403D:
	add	bx, word_4FD56
	shl	bx, 1
	shl	bx, 1
	push	word ptr (barkeepSayings+2)[bx]
	push	word ptr barkeepSayings[bx]
	call	printString
	add	sp, 4
	jmp	short loc_14059
loc_14057:
	jmp	short loc_1401D
loc_14059:
	jmp	short loc_14068
loc_1405B:
	mov	ax, offset aMoneyTalksFrie
	push	ds
	push	ax
	call	printString
	add	sp, 4
loc_14068:
	jmp	short loc_14079
loc_1406A:
	mov	ax, offset aYouAreInNoCond
	push	ds
	push	ax
	call	printString
	add	sp, 4
	jmp	short $+2
loc_14079:
	mov	sp, bp
	pop	bp
	retf
tav_talkToBarkeep endp

; Attributes: bp-based frame

temple_enter proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	call	clearTextWindow
	mov	ax, 49
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
	push	cs
	call	near ptr temple_setTitle
	push	cs
	call	near ptr findEmptyRosterNum
	mov	[bp+var_6], ax
loc_140A4:
	mov	ax, offset aWelcomeOhWearyOne
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	[bp+var_2], 70h	
	mov	ax, 70h	
	push	ax
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_4], ax
	cmp	ax, 10Eh
	jl	short loc_140D3
	cmp	ax, 119h
	jg	short loc_140D3
	sub	[bp+var_4], 4
loc_140D3:
	mov	ax, [bp+var_4]
	jmp	short loc_140F2
loc_140D8:
	push	cs
	call	near ptr temple_getHealee
	jmp	short loc_14112
loc_140DE:
	push	[bp+var_6]
	push	cs
	call	near ptr temple_getPoolGoldee
	add	sp, 2
	jmp	short loc_14112
loc_140EA:
	sub	ax, ax
	jmp	short loc_1412B
loc_140EE:
	jmp	short loc_14112
	jmp	short loc_14112
loc_140F2:
	cmp	ax, 45h	
	jz	short loc_140EA
	cmp	ax, 48h	
	jz	short loc_140D8
	cmp	ax, 50h	
	jz	short loc_140DE
	cmp	ax, 10Eh
	jz	short loc_140D8
	cmp	ax, 10Fh
	jz	short loc_140DE
	cmp	ax, 110h
	jz	short loc_140EA
	jmp	short loc_140EE
loc_14112:
	mov	byte ptr word_44166,	0
	wait4IO
	jmp	loc_140A4
loc_1412B:
	mov	sp, bp
	pop	bp
	retf
temple_enter endp

; Attributes: bp-based frame

temple_getHealee proc far

	deltaHP= word ptr -112h
	payee= word ptr	-110h
	statusAilment= word ptr	-10Eh
	var_10A= word ptr -10Ah
	var_108= word ptr -108h
	var_104= word ptr -104h
	charP= word ptr	-4
	healCost= word ptr -2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 112h
	call	someStackOperation
	push	si
	mov	ax, offset aWhoNeedethHealing
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	push	cs
	call	near ptr getCharNumber
	mov	[bp+charP], ax
	or	ax, ax
	jge	short loc_14156
	jmp	loc_1444D
loc_14156:
	mov	ax, [bp+arg_0]
	cmp	[bp+charP], ax
	jl	short loc_14161
	jmp	loc_1444D
loc_14161:
	getCharP	[bp+charP], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, [bp+var_104]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	push	[bp+charP]
	push	cs
	call	near ptr temple_getStatAilment
	add	sp, 2
	mov	[bp+statusAilment], ax
	or	ax, ax
	jz	short loc_141E5
	mov	ax, offset aIsInBadShapeIndeed_
	push	ds
	push	ax
	push	[bp+var_108]
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	mov	ax, offset aThouMustSacrifice
	push	ds
	push	ax
	push	dx
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	push	[bp+statusAilment]
	push	[bp+charP]
	push	cs
	call	near ptr temple_getHealPrice
	add	sp, 4
	mov	[bp+healCost], ax
	jmp	loc_142B5
loc_141E5:
	getCharP	[bp+charP], si
	mov	ax, gs:roster.maxHP[si]
	sub	ax, gs:roster.currentHP[si]
	mov	[bp+deltaHP], ax
	or	ax, ax
	jnz	short loc_1426D
	mov	ax, gs:roster.maxLevel[si]
	cmp	gs:roster.level[si], ax
	jnz	short loc_1423D
	mov	ax, offset aDoesNotRequireAnyHeal
	push	ds
	push	ax
	push	[bp+var_108]
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	lea	ax, [bp+var_104]
	push	ss
	push	ax
	call	printStringWClear
	add	sp, 4
	jmp	loc_1444D
loc_1423D:
	mov	ax, offset aHathBeenDrainedOfLife
	push	ds
	push	ax
	push	[bp+var_108]
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	mov	ax, 8
	push	ax
	push	[bp+charP]
	push	cs
	call	near ptr temple_getHealPrice
	add	sp, 4
	mov	[bp+healCost], ax
	jmp	short loc_142B5
loc_1426D:
	mov	ax, offset aHasWoundsWhichNeedTen
	push	ds
	push	ax
	push	[bp+var_108]
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	mov	ax, [bp+deltaHP]
	mov	cx, ax
	shl	ax, 1
	shl	ax, 1
	add	ax, cx
	shl	ax, 1
	mov	[bp+healCost], ax
	mov	ax, offset aTheDonationWillBe
	push	ds
	push	ax
	push	dx
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
loc_142B5:
	sub	ax, ax
	push	ax
	mov	ax, [bp+healCost]
	cwd
	push	dx
	push	ax
	push	[bp+var_108]
	push	[bp+var_10A]
	call	_itoa
	add	sp, 0Ah
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	mov	ax, offset aInGold_WhoWillForfeit
	push	ds
	push	ax
	push	dx
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	lea	ax, [bp+var_104]
	push	ss
	push	ax
	call	printStringWClear
	add	sp, 4
	push	cs
	call	near ptr getCharNumber
	mov	[bp+payee], ax
	or	ax, ax
	jge	short loc_1430D
	jmp	loc_1444D
loc_1430D:
	mov	ax, [bp+healCost]
	cwd
	push	dx
	push	ax
	push	[bp+payee]
	push	cs
	call	near ptr payGold
	add	sp, 6
	or	ax, ax
	jnz	short loc_14332
	mov	ax, offset aSorryButWithoutProper
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	jmp	loc_1444D
loc_14332:
	cmp	[bp+statusAilment], 0
	jz	short loc_14349
	push	[bp+statusAilment]
	push	[bp+charP]
	push	cs
	call	near ptr temple_clrStatAilment
	add	sp, 4
	jmp	short loc_143A1
loc_14349:
	getCharP	[bp+charP], si
	mov	ax, gs:roster.maxLevel[si]
	cmp	gs:roster.level[si], ax
	jz	short loc_1438F
	dec	ax
	push	ax
	push	[bp+charP]
	push	cs
	call	near ptr getXPForLevel
	add	sp, 4
	mov	word ptr gs:roster.experience[si], ax
	mov	word ptr gs:(roster.experience+2)[si], dx
	getCharP	[bp+charP], si
	mov	ax, gs:roster.maxLevel[si]
	mov	gs:roster.level[si], ax
	jmp	short loc_143A1
loc_1438F:
	getCharP	[bp+charP], si
	mov	ax, gs:roster.maxHP[si]
	mov	gs:roster.currentHP[si], ax
loc_143A1:
	mov	ax, offset aThePriestsLayHandsOn
	push	ds
	push	ax
	lea	ax, [bp+var_104]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	xor	ax, ax
	push ax
	mov	ax, 3
	push	ax
	push	[bp+charP]
	push	dx
	push	[bp+var_10A]
	push	cs
	call	near ptr printCharPronoun
	add	sp, 0Ah
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	mov	ax, offset aElipsis
	push	ds
	push	ax
	push	dx
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	mov	ax, offset aElipsisAnd
	push	ds
	push	ax
	push	dx
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	sub	ax, ax
	push	ax
	push	ax
	push	[bp+charP]
	push	dx
	push	[bp+var_10A]
	push	cs
	call	near ptr printCharPronoun
	add	sp, 0Ah
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	mov	ax, offset aIsHealed
	push	ds
	push	ax
	push	dx
	push	[bp+var_10A]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10A], ax
	mov	[bp+var_108], dx
	lea	ax, [bp+var_104]
	push	ss
	push	ax
	call	printStringWClear
	add	sp, 4
loc_1444D:
	pop	si
	mov	sp, bp
	pop	bp
	retf
temple_getHealee endp

; Attributes: bp-based frame

printCharPronoun proc far

	var_16=	word ptr -16h
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= byte ptr	 0Ah
	arg_6= word ptr	 0Ch
	arg_8= word ptr  0Eh

	push	bp
	mov	bp, sp
	mov	ax, 16h
	call	someStackOperation
	push	si
	test	[bp+arg_4], 80h
	jz	short loc_1452D
	mov	ax, word ptr [bp+arg_4]
	and	ax, 3
	getMonIndex	cx, cx
	mov	si, ax
	mov	al, gs:monGroups.packedGenAc[si]
	sub	ah, ah
	mov	cl, 6
	shr	ax, cl
	and	ax, 3
	mov	[bp+var_2], ax
	cmp	ax, 3
	jnz	short loc_1452B
	lea	ax, [bp+var_16]
	push	ss
	push	ax
	lea	ax, monGroups._name[si]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	decryptName
	add	sp, 8
	sub	ax, ax
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	lea	ax, [bp+var_16]
	push	ss
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	jmp	short loc_14586
loc_1452B:
	jmp	short loc_14564
loc_1452D:
	getCharP	word ptr [bp+arg_4], si
	mov	al, gs:roster.gender[si]
	sub	ah, ah
	and	ax, 3
	mov	[bp+var_2], ax
	cmp	ax, 3
	jnz	short loc_14564
	lea	ax, roster._name[si]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	_strcat
	add	sp, 8
	jmp	short loc_14586
loc_14564:
	mov	bx, [bp+var_2]
	add	bx, [bp+arg_6]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (pronounString+2)[bx]
	push	word ptr pronounString[bx]
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	_strcat
	add	sp, 8
	jmp	short $+2
loc_14586:
	cmp	[bp+arg_8], 0
	jz	printCharPronoun_exit
	push	ds
	push	offset aExclBlankLine
	push	dx
	push	ax
	call	_strcat
	add	sp, 8

printCharPronoun_exit:
	pop	si
	mov	sp, bp
	pop	bp
	retf
printCharPronoun endp

; Attributes: bp-based frame

temple_setTitle	proc far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	mov	si, dirFacing
	shl	si, 1
	mov	ax, sq_north
	sub	ax, dirDeltaN[si]
	mov	[bp+var_8], ax
	mov	ax, dirDeltaE[si]
	add	ax, sq_east
	mov	[bp+var_2], ax
	mov	[bp+var_4], 3
	mov	[bp+var_6], 0
	jmp	short loc_145DA
loc_145D7:
	inc	[bp+var_6]
loc_145DA:
	cmp	[bp+var_6], 3
	jge	short loc_14614
	mov	si, [bp+var_6]
	mov	cl, 2
	shl	si, cl
	mov	al, byte ptr templeLoc.sqN[si]
	sub	ah, ah
	cmp	ax, [bp+var_8]
	jnz	short loc_14612
	mov	al, templeLoc.sqE[si]
	cmp	ax, [bp+var_2]
	jnz	short loc_14612
	mov	al, templeLoc.location[si]
	cmp	ax, currentLocationMaybe
	jnz	short loc_14612
	mov	ax, [bp+var_6]
	mov	[bp+var_4], ax
	jmp	short loc_14614
loc_14612:
	jmp	short loc_145D7
loc_14614:
	mov	bx, [bp+var_4]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (templeTitles+2)[bx]
	push	word ptr templeTitles[bx]
	call	setTitle
	add	sp, 4
	pop	si
	mov	sp, bp
	pop	bp
	retf
temple_setTitle	endp

; Attributes: bp-based frame

temple_getHealPrice proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.class[bx], class_monster
	jb	short loc_14656
	mov	[bp+var_2], 1
	jmp	short loc_14670
loc_14656:
	getCharP	[bp+arg_0], bx
	mov	ax, gs:roster.level[bx]
	sub	ax, 0Dh
	sbb	cx, cx
	and	ax, cx
	add	ax, 0Dh
	mov	[bp+var_2], ax
loc_14670:
	mov	bx, [bp+arg_2]
	shl	bx, 1
	mov	ax, temple_healPrice[bx]
	imul	[bp+var_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
temple_getHealPrice endp

; Attributes: bp-based frame

temple_getStatAilment proc far

	counter= word ptr -4
	status=	word ptr -2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	getCharP	[bp+arg_0], bx
	mov	al, gs:roster.status[bx]
	sub	ah, ah
	mov	[bp+status], ax
	or	ax, ax
	jz	short loc_146CD
	mov	[bp+counter], 6
	jmp	short loc_146B1
loc_146AE:
	dec	[bp+counter]
loc_146B1:
	cmp	[bp+counter], 0
	jl	short loc_146CD
	mov	bx, [bp+counter]
	mov	al, byte_43B50[bx]
	sub	ah, ah
	test	[bp+status], ax
	jz	short loc_146CB
	mov	al, byte_43B58[bx]
	jmp	short loc_146D1
loc_146CB:
	jmp	short loc_146AE
loc_146CD:
	sub	ax, ax
	jmp	short $+2
loc_146D1:
	mov	sp, bp
	pop	bp
	retf
temple_getStatAilment endp

; Attributes: bp-based frame

temple_clrStatAilment proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	getCharP	[bp+arg_0], si
	mov	bx, [bp+arg_2]
	mov	al, statusHealMask[bx]
	and	gs:roster.status[si], al
	mov	gs:roster.hostileFlag[si], 0
	mov	ax, [bp+arg_2]
	jmp	short loc_14760
loc_14703:
	getCharP	[bp+arg_0], si
	mov	ax, 5
	push	ax
	lea	ax, roster.strength[si]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, roster.savedST[si]
	push	dx
	push	ax
	call	_doAgeStatus
	add	sp, 0Ah
	jmp	short loc_1476C
loc_14728:
	getCharP	[bp+arg_0], bx
	mov	gs:roster.currentHP[bx], 1
loc_1473B:
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.currentHP[bx], 0
	jnz	short loc_1475E
	getCharP	[bp+arg_0], bx
	mov	gs:roster.currentHP[bx], 1
loc_1475E:
	jmp	short loc_1476C
loc_14760:
	cmp	ax, 2
	jz	short loc_14703
	cmp	ax, 6
	jz	short loc_14728
	jmp	short loc_1473B
loc_1476C:
	pop	si
	mov	sp, bp
	pop	bp
	retf
temple_clrStatAilment endp

; Attributes: bp-based frame

temple_getPoolGoldee proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, offset aWhomShallGatherTh
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	push	cs
	call	near ptr getCharNumber
	mov	[bp+var_2], ax
	or	ax, ax
	jl	short loc_147CD
	mov	ax, [bp+arg_0]
	cmp	[bp+var_2], ax
	jge	short loc_147CD
	push	ax
	push	[bp+var_2]
	push	cs
	call	near ptr doPoolGold
	add	sp, 4
	getCharP	[bp+var_2], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	ax, offset aNowHathAllTheGold
	push	ds
	push	ax
	call	printString
	add	sp, 4
loc_147CD:
	mov	sp, bp
	pop	bp
	retf
temple_getPoolGoldee endp

; Attributes: bp-based frame

getCharNumber proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
loc_147DC:
	mov	ax, 2000h
	push	ax
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_2], ax
	cmp	ax, 1Bh
	jnz	short loc_147F5
	mov	ax, 0FFFFh
	jmp	short loc_14820
loc_147F5:
	cmp	[bp+var_2], 30h	
	jle	short loc_1481E
	cmp	[bp+var_2], 38h	
	jge	short loc_1481E
	sub	[bp+var_2], 31h	
	getCharP	[bp+var_2], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jz	short loc_1481E
	mov	ax, [bp+var_2]
	jmp	short loc_14820
loc_1481E:
	jmp	short loc_147DC
loc_14820:
	mov	sp, bp
	pop	bp
	retf
getCharNumber endp

; Attributes: bp-based frame
doPoolGold proc	far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	sub	ax, ax
	mov	[bp+var_4], ax
	mov	[bp+var_6], ax
	mov	[bp+var_2], ax
	jmp	short loc_14840
loc_1483D:
	inc	[bp+var_2]
loc_14840:
	mov	ax, [bp+arg_2]
	cmp	[bp+var_2], ax
	jge	short loc_1487A
	getCharP	[bp+var_2], si
	cmp	byte ptr gs:roster._name[si], 0
	jz	short loc_14878
	mov	ax, word ptr gs:roster.gold[si]
	mov	dx, word ptr gs:(roster.gold+2)[si]
	add	[bp+var_6], ax
	adc	[bp+var_4], dx
	sub	ax, ax
	mov	word ptr gs:(roster.gold+2)[si], ax
	mov	word ptr gs:roster.gold[si], ax
loc_14878:
	jmp	short loc_1483D
loc_1487A:
	mov	ax, [bp+var_6]
	mov	dx, [bp+var_4]
	mov	cx, ax
	mov	bx, dx
	getCharP	[bp+arg_0], si
	mov	word ptr gs:roster.gold[si], cx
	mov	word ptr gs:(roster.gold+2)[si], bx
	pop	si
	mov	sp, bp
	pop	bp
	retf
doPoolGold endp

; This function	gets the XP requirements for a
; given	level
; Attributes: bp-based frame

getXPForLevel proc far

	var_8= dword ptr -8
	var_4= word ptr	-4
	var_2= word ptr	-2
	playerNo= word ptr  6
	level= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	cmp	[bp+level], 11
	jle	short loc_148D7
	mov	ax, 1A80h
	mov	dx, 6
	push	dx
	push	ax
	mov	ax, [bp+level]
	cwd
	push	dx
	push	ax
	call	_level32bitMult
	sub	ax, 2380h
	sbb	dx, 43h	
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	mov	[bp+level], 0Bh
	jmp	short loc_148DF
loc_148D7:
	sub	ax, ax
	mov	[bp+var_2], ax
	mov	[bp+var_4], ax
loc_148DF:
	getCharP	[bp+playerNo], bx
	mov	bl, gs:roster.class[bx]
	sub	bh, bh
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr classXPReqs[bx]
	mov	dx, word ptr (classXPReqs+2)[bx]
	mov	word ptr [bp+var_8], ax
	mov	word ptr [bp+var_8+2], dx
	mov	bx, [bp+level]
	shl	bx, 1
	shl	bx, 1
	lfs	si, [bp+var_8]
	mov	ax, fs:[bx+si]
	mov	dx, fs:[bx+si+2]
	add	ax, [bp+var_4]
	adc	dx, [bp+var_2]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
getXPForLevel endp

; Attributes: bp-based frame
enterBuildingMaybe proc	far
	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	call	_random
	test	al, 3
	jnz	short loc_14945
	mov	partyAttackFlag, 0
	call	bat_init
loc_14945:
	cmp	currentLocationMaybe, 1
	jnz	short loc_14956
	mov	ax, 32h	
	jmp	short loc_14959
loc_14956:
	mov	ax, 45h	
loc_14959:
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
	mov	ax, offset aBuilding
	push	ds
	push	ax
	call	setTitle
	add	sp, 4
	mov	ax, offset aYouAreInAnEmpt
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
	sub	ax, ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
enterBuildingMaybe endp

; Attributes: bp-based frame
strg_enter proc	far

	var_4= word ptr	-4

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	ax, 32h	
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
	mov	ax, offset aBuilding
	push	ds
	push	ax
	call	setTitle
	add	sp, 4
	push	cs
	call	near ptr readInventoryStf
loc_149B8:
	mov	ax, offset aThePartyIsInsi
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	push	cs
	call	near ptr getCharNumber
	mov	[bp+var_4], ax
	or	ax, ax
	jl	short loc_149DA
	push	ax
	push	cs
	call	near ptr strg_getItem
	add	sp, 2
	jmp	short loc_149F2
loc_149DA:
	push	cs
	call	near ptr writeInventoryStf
	call	clearTextWindow
	mov	buildingRvalMaybe, 2
	sub	ax, ax
	jmp	short loc_149F4
loc_149F2:
	jmp	short loc_149B8
loc_149F4:
	mov	sp, bp
	pop	bp
	retf
strg_enter endp

; Attributes: bp-based frame

strg_getItem proc far

	var_372= word ptr -372h
	var_302= word ptr -302h
	var_142= word ptr -142h
	var_140= word ptr -140h
	var_13E= word ptr -13Eh
	var_13C= word ptr -13Ch
	var_13A= word ptr -13Ah
	var_138= word ptr -138h
	var_38=	word ptr -38h
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 372h
	call	someStackOperation
	push	di
	push	si
loc_14A05:
	lea	ax, [bp+var_38]
	push	ss
	push	ax
	lea	ax, [bp+var_372]
	push	ss
	push	ax
	lea	ax, [bp+var_302]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_14BD4
	add	sp, 0Ch
	mov	[bp+var_13E], ax
	or	ax, ax
	jnz	short loc_14A28
	jmp	loc_14B24
loc_14A28:
	mov	ax, offset aWould
	push	ds
	push	ax
	lea	ax, [bp+var_138]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_142], ax
	mov	[bp+var_140], dx
	getCharP	[bp+arg_0], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	[bp+var_140]
	push	[bp+var_142]
	call	_strcat
	add	sp, 8
	mov	[bp+var_142], ax
	mov	[bp+var_140], dx
	mov	ax, offset aLikeToPickup__
	push	ds
	push	ax
	push	dx
	push	[bp+var_142]
	call	_strcat
	add	sp, 8
	mov	[bp+var_142], ax
	mov	[bp+var_140], dx
	push	[bp+var_13E]
	lea	ax, [bp+var_372]
	push	ss
	push	ax
	lea	ax, [bp+var_138]
	push	ss
	push	ax
	call	printStringGetInput
	add	sp, 0Ah
	mov	[bp+var_13A], ax
	or	ax, ax
	jl	short loc_14B20
	mov	di, ax
	shl	di, 1
	mov	ax, [bp+di+var_38]
	mov	[bp+var_13C], ax
	mov	cx, ax
	shl	ax, 1
	add	ax, cx
	mov	si, ax
	mov	al, (strg_inventory+2)[si]
	sub	ah, ah
	push	ax
	mov	al, (strg_inventory+1)[si]
	push	ax
	mov	al, strg_inventory[si]
	push	ax
	push	[bp+arg_0]
	call	inven_addItem
	add	sp, 8
	or	ax, ax
	jz	short loc_14B03
	mov	bx, [bp+var_13C]
	mov	ax, bx
	shl	bx, 1
	add	bx, ax
	mov	strg_inventory[bx], 0
	mov	ax, offset aYouPickUpTheIt
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	jmp	short loc_14B1E
loc_14B03:
	mov	ax, offset aAllFull
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	delayNoTable	4
	jmp	short loc_14B4E
loc_14B1E:
	jmp	short loc_14B22
loc_14B20:
	jmp	short loc_14B4E
loc_14B22:
	jmp	short loc_14B3F
loc_14B24:
	mov	ax, offset aTheBuildingIsE
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	delayNoTable	4
	jmp	short loc_14B4E
loc_14B3F:
	delayNoTable	4
	jmp	loc_14A05
loc_14B4E:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
strg_getItem endp

; Attributes: bp-based frame

writeInventoryStf proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, offset aInventor_stf
	push	ds
	push	ax
	push	cs
	call	near ptr getDisk2
	add	sp, 4
	mov	[bp+var_2], ax
	mov	ax, 54h	
	push	ax
	mov	ax, offset strg_inventory
	mov	dx, seg	dseg
	push	dx
	push	ax
	push	[bp+var_2]
	call	_write
	add	sp, 8
	push	[bp+var_2]
	call	_close
	add	sp, 2
	mov	sp, bp
	pop	bp
	retf
writeInventoryStf endp

; Attributes: bp-based frame

readInventoryStf proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, offset aInventor_stf
	push	ds
	push	ax
	push	cs
	call	near ptr getDisk2
	add	sp, 4
	mov	[bp+var_2], ax
	mov	ax, 84
	push	ax
	mov	ax, offset strg_inventory
	mov	dx, seg	dseg
	push	dx
	push	ax
	push	[bp+var_2]
	call	_read
	add	sp, 8
	push	[bp+var_2]
	call	_close
	add	sp, 2
	mov	sp, bp
	pop	bp
	retf
readInventoryStf endp

; Attributes: bp-based frame

sub_14BD4 proc far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6
	arg_4= dword ptr  0Ah
	arg_8= dword ptr  0Eh

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	mov	[bp+var_8], 0
	mov	ax, 46h	
	push	ax
	call	sub_19813
	add	sp, 2
	or	ax, ax
	jz	short loc_14BFA
	mov	ax, 1Ch
	jmp	short loc_14BFD
loc_14BFA:
	mov	ax, 12h
loc_14BFD:
	mov	[bp+var_6], ax
	mov	[bp+var_4], 0
	jmp	short loc_14C0A
loc_14C07:
	inc	[bp+var_4]
loc_14C0A:
	mov	ax, [bp+var_6]
	cmp	[bp+var_4], ax
	jge	short loc_14C8B
	mov	bx, [bp+var_4]
	mov	ax, bx
	shl	bx, 1
	add	bx, ax
	mov	al, strg_inventory[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	or	ax, ax
	jz	short loc_14C88
	mov	bx, [bp+var_8]
	shl	bx, 1
	shl	bx, 1
	lfs	si, [bp+arg_4]
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	mov	fs:[bx+si], ax
	mov	fs:[bx+si+2], dx
	mov	bx, [bp+var_2]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (itemStr+2)[bx]
	push	word ptr itemStr[bx]
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+arg_0], ax
	mov	word ptr [bp+arg_0+2], dx
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], 0
	mov	bx, [bp+var_8]
	inc	[bp+var_8]
	shl	bx, 1
	lfs	si, [bp+arg_8]
	mov	ax, [bp+var_4]
	mov	fs:[bx+si], ax
loc_14C88:
	jmp	loc_14C07
loc_14C8B:
	mov	ax, [bp+var_8]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_14BD4 endp

; This function	inserts	a new member into the last
; active slot in the roster. Dead, paralyzed or	stoned
; members are moved down.
; Attributes: bp-based frame

rost_insertMember proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	emptySlot= word	ptr -2

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	push	cs
	call	near ptr rost_getLastActiveSlot
	mov	[bp+emptySlot],	ax
	cmp	ax, 7
	jl	short loc_14CB0
	jmp	loc_14D30
loc_14CB0:
	mov	[bp+var_4], 0
loc_14CB5:
	push	cs
	call	near ptr rost_getLastActiveSlot
	cmp	ax, [bp+var_4]
	jle	short loc_14D30
	getCharP	[bp+var_4], si
	test	gs:roster.status[si], stat_dead	or stat_stoned or stat_paralyzed
	jz	short loc_14D2B
	mov	ax, offset newCharBuffer
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, roster._name[si]
	push	dx
	push	ax
	push	cs
	call	near ptr copyCharacterBuf
	add	sp, 8
	push	[bp+var_4]
	push	cs
	call	near ptr rost_removeMember
	add	sp, 2
	cmp	gs:newCharBuffer.class,	class_illusion
	jz	short loc_14D29
	cmp	gs:newCharBuffer.specAbil+3, 0
	jnz	short loc_14D29
	push	cs
	call	near ptr findEmptyRosterNum
	mov	[bp+var_6], ax
	getCharP	[bp+var_6], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	mov	ax, offset newCharBuffer
	push	dx
	push	ax
	push	cs
	call	near ptr copyCharacterBuf
	add	sp, 8
loc_14D29:
	jmp	short loc_14D2E
loc_14D2B:
	inc	[bp+var_4]
loc_14D2E:
	jmp	short loc_14CB5
loc_14D30:
	pop	si
	mov	sp, bp
	pop	bp
	retf
rost_insertMember endp

; Attributes: bp-based frame

getDisk2 proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
loc_14D40:
	mov	ax, 2
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	openFile
	add	sp, 6
	mov	[bp+var_2], ax
	inc	ax
	jnz	short loc_14D81
	mov	ax, offset aPleaseInsertDi
	mov	dx, seg	dseg
	push	dx
	push	ax
	call	printString
	add	sp, 4
	mov	ax, offset aDisk2
	push	ds
	push	ax
	call	printString
	add	sp, 4
	wait4IO
loc_14D81:
	cmp	[bp+var_2], 0FFFFh
	jz	short loc_14D40
	mov	ax, [bp+var_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
getDisk2 endp

seg002 ends

; Segment type:	Pure code
seg003 segment byte public 'CODE' use16
	assume cs:seg003
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
; Attributes: bp-based frame

sub_14D90 proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	[bp+arg_0], 0
	jz	short loc_14DA9
	lfs	bx, disk3
	mov	byte ptr fs:[bx+5], 31h	
loc_14DA9:
	mov	sp, bp
	pop	bp
locret_14DAC:
	retf
sub_14D90 endp

; Attributes: bp-based frame

getYesNo proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	di
	push	si
	push	cs
	call	near ptr txt_newLine
	mov	al, gs:txt_numLines
	sub	ah, ah
	mov	si, ax
	mov	di, si
	shl	di, 1
	mov	ax, (bitMask16bit+2)[di]
	or	ax, bitMask16bit[di]
	mov	[bp+var_2], ax
	mov	[bp+var_4], si
	mov	ax, offset aYesNo
	push	ds
	push	ax
	push	cs
	call	near ptr printString
	add	sp, 4
loc_14DEE:
	push	[bp+var_2]
	push	cs
	call	near ptr sub_14E41
	add	sp, 2
	mov	[bp+var_6], ax
	cmp	ax, 10Eh
	jl	short loc_14E0B
	cmp	ax, 119h
	jg	short loc_14E0B
	mov	ax, [bp+var_4]
	sub	[bp+var_6], ax
loc_14E0B:
	mov	ax, [bp+var_6]
	jmp	short loc_14E23
loc_14E10:
	push	cs
	call	near ptr clearTextWindow
	mov	ax, 1
	jmp	short loc_14E3B
loc_14E19:
	push	cs
	call	near ptr clearTextWindow
	sub	ax, ax
	jmp	short loc_14E3B
loc_14E21:
	jmp	short loc_14E39
loc_14E23:
	cmp	ax, 4Eh	
	jz	short loc_14E19
	cmp	ax, 59h	
	jz	short loc_14E10
	cmp	ax, 10Eh
	jz	short loc_14E10
	cmp	ax, 10Fh
	jz	short loc_14E19
	jmp	short loc_14E21
loc_14E39:
	jmp	short loc_14DEE
loc_14E3B:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
getYesNo endp

; Attributes: bp-based frame

sub_14E41 proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	spell_mouseClicked, 0
	push	cs
	call	near ptr sub_1766A
loc_14E50:
	call	checkMouse
	cmp	mouse_moved, 0
	jz	short loc_14E74
	call	far ptr	sub_3E974
	push	[bp+arg_0]
	push	cs
	call	near ptr updateMouseIcon
	add	sp, 2
	push	cs
	call	near ptr sub_1766A
loc_14E74:
	push	[bp+arg_0]
	push	cs
	call	near ptr getMouseClick
	add	sp, 2
	mov	[bp+var_2], ax
	or	ax, ax
	jz	short loc_14E8F
	call	far ptr	sub_3E974
	mov	spell_mouseClicked, 1
	mov	ax, [bp+var_2]
	jmp	short loc_14EC8
loc_14E8F:
	call	checkKeyboard
	or	ax, ax
	jz	short loc_14EBE
	call	far ptr	sub_3E974
	call	_readChFromKeyboard
	mov	[bp+var_2], ax
	or	al, al
	jz	short loc_14EB9
	mov	al, byte ptr [bp+var_2]
	sub	ah, ah
	push	ax
	call	_str_capitalize
	add	sp, 2
	jmp	short loc_14EC8
loc_14EB9:
	mov	ax, [bp+var_2]
	jmp	short loc_14EC8
loc_14EBE:
	push	cs
	call	near ptr sub_15226
	push	cs
	call	near ptr printRoster
	jmp	short loc_14E50
loc_14EC8:
	mov	sp, bp
	pop	bp
	retf
sub_14E41 endp

; Attributes: bp-based frame

sub_14ECC proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	ax, mouseBoxes._left[1 * sizeof mouseBox_t]
	cmp	mouse_x, ax
	jl	short loc_14F35
	mov	ax, mouseBoxes._right[1 * sizeof mouseBox_t]
	cmp	mouse_x, ax
	jge	short loc_14F35
	mov	ax, mouseBoxes._top[1 * sizeof mouseBox_t]
	cmp	mouse_y, ax
	jl	short loc_14F35
	mov	ax, mouseBoxes._bottom[1 * sizeof mouseBox_t]
	cmp	mouse_y, ax
	jge	short loc_14F35
	mov	ax, mouse_y
	sub	ax, 4
	mov	cl, 3
	sar	ax, cl
	mov	[bp+var_2], ax
	mov	ax, [bp+arg_0]
	mov	bx, [bp+var_2]
	shl	bx, 1
	test	bitMask16bit[bx], ax
	jz	short loc_14F2D
	mov	ax, 5
	jmp	short loc_14F30
loc_14F2D:
	mov	ax, 6
loc_14F30:
	mov	[bp+var_4], ax
	jmp	short loc_14F3A
loc_14F35:
	mov	[bp+var_4], 6
loc_14F3A:
	mov	ax, [bp+var_4]
	cmp	gs:word_4241E, ax
	jz	short loc_14F55
	mov	gs:word_4241E, ax
	push	ax
	call	far ptr	vid_setMouseIcon
	add	sp, 2
loc_14F55:
	mov	sp, bp
	pop	bp
	retf
sub_14ECC endp

; Attributes: bp-based frame

updateMouseIcon proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	test	[bp+arg_0], 4000h
	jz	short loc_14F74
	mov	[bp+var_2], 5
	jmp	loc_15070
loc_14F74:
	mov	[bp+var_4], 0
	jmp	short loc_14F7E
loc_14F7B:
	inc	[bp+var_4]
loc_14F7E:
	cmp	[bp+var_4], 3
	jge	short loc_14FB7
	mov	si, [bp+var_4]
	mov	cl, 3
	shl	si, cl
	mov	ax, mouse_x
	cmp	mouseBoxes._left[si],	ax
	jg	short loc_14FB5
	cmp	mouseBoxes._right[si],	ax
	jle	short loc_14FB5
	mov	ax, mouse_y
	cmp	mouseBoxes._top[si],	ax
	jg	short loc_14FB5
	cmp	mouseBoxes._bottom[si],	ax
	jle	short loc_14FB5
	jmp	short loc_14FB7
loc_14FB5:
	jmp	short loc_14F7B
loc_14FB7:
	mov	ax, [bp+var_4]
	jmp	loc_1505D
loc_14FBD:
	mov	ax, [bp+arg_0]
	test	bitMask16bit+1Eh, ax
	jz	short loc_15007
	cmp	mouse_y, 2Dh 
	jge	short loc_14FDE
	mov	[bp+var_2], 1
	jmp	short loc_15005
loc_14FDE:
	cmp	mouse_y, 4Bh 
	jle	short loc_14FED
	mov	[bp+var_2], 2
	jmp	short loc_15005
loc_14FED:
	cmp	mouse_x, 4Ah 
	jge	short loc_15000
	mov	[bp+var_2], 3
	jmp	short loc_15005
loc_15000:
	mov	[bp+var_2], 4
loc_15005:
	jmp	short loc_1500C
loc_15007:
	mov	[bp+var_2], 6
loc_1500C:
	jmp	short loc_15070
loc_1500E:
	mov	ax, mouse_y
	sub	ax, 4
	mov	cl, 3
	sar	ax, cl
	mov	[bp+var_6], ax
	mov	ax, [bp+arg_0]
	mov	bx, [bp+var_6]
	shl	bx, 1
	test	bitMask16bit[bx], ax
	jz	short loc_15038
	mov	ax, 5
	jmp	short loc_1503B
loc_15038:
	mov	ax, 6
loc_1503B:
	mov	[bp+var_2], ax
	jmp	short loc_15070
loc_15040:
	test	[bp+arg_0], 2000h
	jz	short loc_1504C
	mov	ax, 5
	jmp	short loc_1504F
loc_1504C:
	mov	ax, 6
loc_1504F:
	mov	[bp+var_2], ax
	jmp	short loc_15070
loc_15054:
	mov	[bp+var_2], 6
	jmp	short loc_15070
	jmp	short loc_15070
loc_1505D:
	or	ax, ax
	jnz	short loc_15064
	jmp	loc_14FBD
loc_15064:
	cmp	ax, 1
	jz	short loc_1500E
	cmp	ax, 2
	jz	short loc_15040
	jmp	short loc_15054
loc_15070:
	mov	ax, [bp+var_2]
	cmp	gs:word_4241E, ax
	jz	short loc_1508B
	mov	gs:word_4241E, ax
	push	ax
	call	far ptr	vid_setMouseIcon
	add	sp, 2
loc_1508B:
	pop	si
	mov	sp, bp
	pop	bp
	retf
updateMouseIcon endp

; Attributes: bp-based frame

getMouseClick proc far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	call	checkGamePort
	or	ax, ax
	jnz	short loc_150AE
	call	checkOtherGamePort
	or	ax, ax
	jz	short loc_150B3
loc_150AE:
	mov	ax, 1
	jmp	short loc_150B5
loc_150B3:
	sub	ax, ax
loc_150B5:
	mov	[bp+var_8], ax
	mov	ax, word_440BC
	cmp	[bp+var_8], ax
	jnz	short loc_150C4
	sub	ax, ax
	jmp	short loc_150C7
loc_150C4:
	mov	ax, [bp+var_8]
loc_150C7:
	mov	[bp+var_2], ax
	mov	ax, [bp+var_8]
	mov	word_440BC, ax
	cmp	[bp+var_2], 0
	jnz	short loc_150D9
	jmp	loc_151E1
loc_150D9:
	test	[bp+arg_0], 4000h
	jz	short loc_150E9
	mov	ax, 20h	
	jmp	loc_151E5
	jmp	loc_151E1
loc_150E9:
	mov	[bp+var_4], 0
	jmp	short loc_150F3
loc_150F0:
	inc	[bp+var_4]
loc_150F3:
	cmp	[bp+var_4], 3
	jge	short loc_1512C
	mov	si, [bp+var_4]
	mov	cl, 3
	shl	si, cl
	mov	ax, mouse_x
	cmp	mouseBoxes._left[si],	ax
	jg	short loc_1512A
	cmp	mouseBoxes._right[si],	ax
	jle	short loc_1512A
	mov	ax, mouse_y
	cmp	mouseBoxes._top[si],	ax
	jg	short loc_1512A
	cmp	mouseBoxes._bottom[si],	ax
	jle	short loc_1512A
	jmp	short loc_1512C
loc_1512A:
	jmp	short loc_150F0
loc_1512C:
	mov	ax, [bp+var_4]
	jmp	loc_151CE
loc_15132:
	mov	ax, [bp+arg_0]
	test	bitMask16bit+1Eh, ax
	jz	short loc_1517C
	cmp	mouse_y, 2Dh 
	jge	short loc_15154
	mov	ax, 4Bh	
	jmp	loc_151E5
	jmp	short loc_1517C
loc_15154:
	cmp	mouse_y, 4Bh 
	jle	short loc_15164
	mov	ax, 5000h
	jmp	loc_151E5
	jmp	short loc_1517C
loc_15164:
	cmp	mouse_x, 4Ah 
	jge	short loc_15177
	mov	ax, 4B00h
	jmp	short loc_151E5
	jmp	short loc_1517C
loc_15177:
	mov	ax, 4D00h
	jmp	short loc_151E5
loc_1517C:
	jmp	short loc_151E1
loc_1517E:
	mov	ax, mouse_y
	sub	ax, 4
	mov	cl, 3
	sar	ax, cl
	mov	[bp+var_6], ax
	mov	ax, [bp+arg_0]
	mov	bx, [bp+var_6]
	shl	bx, 1
	test	bitMask16bit[bx], ax
	jz	short loc_151AB
	mov	ax, [bp+var_6]
	add	ax, 10Eh
	jmp	short loc_151E5
loc_151AB:
	jmp	short loc_151E1
loc_151AD:
	test	[bp+arg_0], 2000h
	jz	short loc_151C8
	mov	ax, mouse_y
	sub	ax, 88h	
	mov	cl, 3
	sar	ax, cl
	add	ax, 30h	
	jmp	short loc_151E5
loc_151C8:
	jmp	short loc_151E1
loc_151CA:
	jmp	short loc_151E1
	jmp	short loc_151E1
loc_151CE:
	or	ax, ax
	jnz	short loc_151D5
	jmp	loc_15132
loc_151D5:
	cmp	ax, 1
	jz	short loc_1517E
	cmp	ax, 2
	jz	short loc_151AD
	jmp	short loc_151CA
loc_151E1:
	sub	ax, ax
	jmp	short $+2
loc_151E5:
	pop	si
	mov	sp, bp
	pop	bp
	retf
getMouseClick endp

; Attributes: bp-based frame

sub_151EA proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	sub	ax, ax
	push	ax
	push	cs
	call	near ptr getMouseClick
	add	sp, 2
loc_151FF:
	call	checkKeyboard
	or	ax, ax
	jnz	short loc_1520A
	jmp	short loc_151FF
loc_1520A:
	call	_readChFromKeyboard
	mov	[bp+var_2], ax
	or	al, al
	jz	short loc_1521D
	mov	al, byte ptr [bp+var_2]
	sub	ah, ah
	jmp	short loc_15222
loc_1521D:
	mov	ax, [bp+var_2]
	jmp	short $+2
loc_15222:
	mov	sp, bp
	pop	bp
	retf
sub_151EA endp

; Attributes: bp-based frame

sub_15226 proc far

	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	ax, gs:word_42294
	cmp	_clockTicks, ax
	jz	short loc_15256
	mov	ax, _clockTicks
	mov	gs:word_42294, ax
	call	sub_179C4
loc_15256:
	mov	ax, _clockTicks
	mov	cl, 5
	sar	ax, cl
	mov	[bp+var_4], ax
	cmp	gs:word_42410, ax
	jz	short loc_15296
	mov	gs:word_42410, ax
	mov	si, ax
	mov	cl, 4
	sar	si, cl
	cmp	gs:word_41E6C, si
	jz	short loc_15296
	mov	gs:word_41E6C, si
	cmp	gs:word_42450, 0
	jnz	short $+2
loc_15296:
	cmp	gs:word_42450, 0
	jz	short loc_152A5
	jmp	loc_1538E
loc_152A5:
	mov	si, gs:word_42410
	mov	cl, 4
	sar	si, cl
	cmp	gs:word_42456, si
	jnz	short loc_152C0
	jmp	loc_1538E
loc_152C0:
	mov	gs:word_42456, si
	cmp	byte_4EEBC, 0
	jz	short loc_152E3
	mov	al, byte_4EEBC
	dec	byte_4EEBC
	cmp	al, 1
	jnz	short loc_152E3
	call	sub_22DA1
loc_152E3:
	mov	ax, gs:word_4233E
	dec	gs:word_4233E
	cmp	ax, 1
	jg	short loc_1533E
	mov	gs:word_4233E, 0Ah
	mov	[bp+var_2], 0
	jmp	short loc_15306
loc_15303:
	inc	[bp+var_2]
loc_15306:
	cmp	[bp+var_2], 5
	jge	short loc_1533E
	mov	bx, [bp+var_2]
	cmp	lightDuration[bx], 0
	jz	short loc_1533C
	cmp	lightDuration[bx], 0FFh
	jz	short loc_1533C
	mov	al, lightDuration[bx]
	dec	lightDuration[bx]
	cmp	al, 1
	jnz	short loc_1533C
	push	[bp+var_2]
	call	sub_17920
	add	sp, 2
loc_1533C:
	jmp	short loc_15303
loc_1533E:
	cmp	inDungeonMaybe, 0
	jnz	short loc_15356
	cmp	gs:isNight, 0
	jz	short loc_15362
loc_15356:
	cmp	gs:regenSpptSq,	0
	jz	short loc_15378
loc_15362:
	call	regenSppt
	cmp	gs:songRegenSppt, 0
	jz	short loc_15378
	call	regenSppt
loc_15378:
	call	doEquipmentEffect
	cmp	gs:byte_41E81, 0
	jz	short loc_1538E
	call	dunsq_drainHP
loc_1538E:
	mov	ax, gs:word_42410
	mov	cl, 6
	sar	ax, cl
	mov	[bp+var_4], ax
	cmp	gs:word_42330, ax
	jz	short loc_153ED
	mov	gs:word_42330, ax
	cmp	gs:word_42450, 0
	jnz	short loc_153ED
	mov	al, byte_4EEBA
	inc	byte_4EEBA
	cmp	al, 17h
	jb	short loc_153CF
	mov	byte_4EEBA, 0
loc_153CF:
	cmp	byte_4EEBA, 6
	jb	short loc_153DF
	cmp	byte_4EEBA, 12h
	jbe	short loc_153E3
loc_153DF:
	mov	al, 1
	jmp	short loc_153E5
loc_153E3:
	sub	al, al
loc_153E5:
	mov	gs:isNight, al
loc_153ED:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_15226 endp

; Attributes: bp-based frame

	isAlphaNum proc	far
	arg_0= byte ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	al, [bp+arg_0]
	cbw
	push	ax
	call	_str_capitalize
	add	sp, 2
	mov	[bp+arg_0], al
	cmp	al, 41h	
	jl	short loc_15414
	cmp	al, 5Ah	
	jle	short loc_15420
loc_15414:
	cmp	[bp+arg_0], 30h	
	jl	short loc_15425
	cmp	[bp+arg_0], 39h	
	jg	short loc_15425
loc_15420:
	mov	ax, 1
	jmp	short loc_15427
loc_15425:
	sub	ax, ax
loc_15427:
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
isAlphaNum endp

; Attributes: bp-based frame

sub_1542D proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	cmp	[bp+arg_0], 0
	jge	short loc_15446
	push	cs
	call	near ptr sub_151EA
	jmp	short loc_15495
	jmp	short loc_15490
loc_15446:
	mov	ax, [bp+arg_0]
	mov	cx, ax
	shl	ax, 1
	shl	ax, 1
	add	ax, cx
	shl	ax, 1
	add	ax, _clockTicks
	mov	[bp+var_4], ax
loc_1545F:
	mov	ax, [bp+var_4]
	cmp	_clockTicks, ax
	jz	short loc_15490
	call	checkKeyboard
	or	ax, ax
	jz	short loc_1548E
	call	_readChFromKeyboard
	mov	[bp+var_2], ax
	or	al, al
	jz	short loc_15489
	mov	al, byte ptr [bp+var_2]
	sub	ah, ah
	jmp	short loc_1548C
loc_15489:
	mov	ax, [bp+var_2]
loc_1548C:
	jmp	short loc_15495
loc_1548E:
	jmp	short loc_1545F
loc_15490:
	mov	ax, 20h	
	jmp	short $+2
loc_15495:
	mov	sp, bp
	pop	bp
	ret
sub_1542D endp

; Attributes: bp-based frame
txt_delayNoTable	proc far

	arg_0= word ptr 6

	func_enter
	push_imm	0
	mov	ax, [bp+arg_0]
	shl	ax, 1
	shl	ax, 1
	push	ax
	std_call	getIOwithDelay, 4
	func_exit
	retf
txt_delayNoTable	endp

txt_delayWithTable	proc far

	func_enter
	push_imm	1
	mov	bl, txtDelayIndex
	sub	bh, bh
	mov	al, txtDelayTable[bx]
	sub	ah, ah
	push	ax
	std_call	getIOwithDelay, 4
	func_exit
	retf

txt_delayWithTable	endp
	

; This is where the print delay occurs during battle.
getIOwithDelay proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	cmp	[bp+arg_0], 0
	jge	short loc_154B7
	jmp	loc_15522
loc_154B7:
	mov	ax, [bp+arg_0]
	add	ax, _clockTicks
	mov	[bp+var_2], ax
	push	cs
	call	near ptr sub_1766A
loc_154D4:
	call	checkKeyboard
	or	ax, ax
	jz	short loc_154E9
	call	_readChFromKeyboard

	cmp	[bp+arg_2], 0
	jz	loc_getIOwithDelay_skipFastCheck

	sub	ah, ah
	cmp	ax, '>'
	jz	loc_getIOwithDelay_faster
	cmp	ax, '.'
	jnz	loc_getIOwithDelay_slowCheck

loc_getIOwithDelay_faster:
	mov	al, txtDelayIndex
	dec	txtDelayIndex
	or	al, al
	ja	loc_getIOwithDelay_printFaster
	mov	txtDelayIndex, 0
	jmp	loc_154D4

loc_getIOwithDelay_slowCheck:
	cmp	ax, '<'
	jz	loc_getIOwithDelay_slower
	cmp	ax, ','
	jnz	loc_getIOwithDelay_skipFastCheck

loc_getIOwithDelay_slower:
	mov	al, txtDelayIndex
	inc	txtDelayIndex
	cmp	al, 9
	jb	loc_getIOwithDelay_printSlower
	mov	txtDelayIndex, 9
	jmp	loc_154D4

loc_getIOwithDelay_printFaster:
	mov	ax, offset aFaster
	jmp	loc_getIOwithDelay_doPrint

loc_getIOwithDelay_printSlower:
	mov	ax, offset aSlower

loc_getIOwithDelay_doPrint:
	push	ds
	push	ax
	func_printString
	jmp	loc_154D4

loc_getIOwithDelay_skipFastCheck:
	call	far ptr	sub_3E974
	jmp	short loc_15522
loc_154E9:
	call	checkMouse
	push	cs
	call	near ptr sub_15226
	push	cs
	call	near ptr printRoster
	mov	ax, [bp+var_2]
	cmp	_clockTicks, ax
	jl	short loc_1550B
	call	far ptr	sub_3E974
	jmp	short loc_15522
loc_1550B:
	cmp	mouse_moved, 0
	jz	short loc_15520
	call	far ptr	sub_3E974
	push	cs
	call	near ptr sub_1766A
loc_15520:
	jmp	loc_154D4
loc_15522:
	mov	sp, bp
	pop	bp
	retf
getIOwithDelay endp

; Attributes: bp-based frame

dun_doMiniMap proc far

	var_18=	dword ptr -18h
	var_14=	word ptr -14h
	var_12=	word ptr -12h
	var_10=	word ptr -10h
	var_E= word ptr	-0Eh
	var_C= word ptr	-0Ch
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah
	arg_6= word ptr	 0Ch
	arg_8= word ptr	 0Eh
	arg_A= word ptr	 10h

	push	bp
	mov	bp, sp
	mov	ax, 18h
	call	someStackOperation
	push	si
	mov	[bp+var_2], 8
	mov	[bp+var_4], 6
loc_1553C:
	mov	gs:byte_4241A, 1
	push	cs
	call	near ptr clearTextWindow
	mov	gs:byte_4241A, 1
	mov	[bp+var_10], 0
	jmp	short loc_1555E
loc_1555B:
	inc	[bp+var_10]
loc_1555E:
	cmp	[bp+var_10], 11h
	jl	short loc_15567
	jmp	loc_156FC
loc_15567:
	mov	ax, [bp+arg_4]
	sub	ax, [bp+var_2]
	add	ax, [bp+var_10]
	mov	[bp+var_C], ax
	mov	[bp+var_12], 0
	jmp	short loc_1557D
loc_1557A:
	inc	[bp+var_12]
loc_1557D:
	cmp	[bp+var_12], 0Ch
	jl	short loc_15586
	jmp	loc_156F9
loc_15586:
	mov	ax, [bp+arg_6]
	sub	ax, [bp+var_4]
	add	ax, [bp+var_12]
	mov	[bp+var_E], ax
	or	ax, ax
	jge	short loc_15599
	jmp	loc_156F6
loc_15599:
	mov	ax, [bp+arg_A]
	cmp	[bp+var_E], ax
	jl	short loc_155A4
	jmp	loc_156F6
loc_155A4:
	cmp	[bp+var_C], 0
	jl	short loc_155AF
	mov	ax, 1
	jmp	short loc_155B1
loc_155AF:
	sub	ax, ax
loc_155B1:
	mov	cx, [bp+arg_8]
	mov	si, ax
	cmp	[bp+var_C], cx
	jge	short loc_155C0
	mov	ax, 1
	jmp	short loc_155C2
loc_155C0:
	sub	ax, ax
loc_155C2:
	test	ax, si
	jnz	short loc_155C9
	jmp	loc_156F6
loc_155C9:
	mov	ax, [bp+var_12]
	mov	cl, 3
	shl	ax, cl
	sub	ax, 5Eh	
	neg	ax
	mov	[bp+var_A], ax
	mov	ax, [bp+var_10]
	shl	ax, cl
	add	ax, 0A9h 
	mov	[bp+var_8], ax
	mov	ax, offset byte_3E948
	mov	dx, seg	seg023
	push	dx
	push	ax
	call	sub_27E2A
	add	sp, 4
	mov	bx, [bp+var_C]
	mov	ax, bx
	shl	bx, 1
	shl	bx, 1
	add	bx, ax
	mov	ax, bx
	mov	bx, [bp+var_E]
	shl	bx, 1
	shl	bx, 1
	lfs	si, [bp+arg_0]
	lfs	si, fs:[bx+si]
	mov	bx, ax
	mov	al, fs:[bx+si+4]
	sub	ah, ah
	mov	[bp+var_14], ax
	test	byte ptr [bp+var_14], 2
	jz	short loc_15621
	jmp	loc_156CC
loc_15621:
	test	byte ptr [bp+var_14], 1
	jnz	short loc_1562A
	jmp	loc_156CC
loc_1562A:
	mov	ax, [bp+var_2]
	cmp	[bp+var_10], ax
	jnz	short loc_1564E
	mov	ax, [bp+var_4]
	cmp	[bp+var_12], ax
	jnz	short loc_1564E
	mov	ax, 0Dh
	push	ax
	mov	ax, offset byte_3E948
	mov	dx, seg	seg023
	push	dx
	push	ax
	call	sub_27E3D
	add	sp, 6
loc_1564E:
	cmp	word_43F12, 0
	jz	short loc_15671
	test	byte ptr [bp+var_14], 8
	jz	short loc_1566F
	mov	ax, 0Ch
	push	ax
	mov	ax, offset byte_3E948
	mov	dx, seg	seg023
	push	dx
	push	ax
	call	sub_27E3D
	add	sp, 6
loc_1566F:
	jmp	short loc_1568B
loc_15671:
	test	byte ptr [bp+var_14], 4
	jz	short loc_1568B
	mov	ax, 0Ch
	push	ax
	mov	ax, offset byte_3E948
	mov	dx, seg	seg023
	push	dx
	push	ax
	call	sub_27E3D
	add	sp, 6
loc_1568B:
	mov	bx, [bp+var_E]
	shl	bx, 1
	shl	bx, 1
	lfs	si, [bp+arg_0]
	mov	ax, fs:[bx+si]
	mov	dx, fs:[bx+si+2]
	mov	cx, [bp+var_C]
	mov	bx, cx
	shl	cx, 1
	shl	cx, 1
	add	cx, bx
	add	ax, cx
	mov	word ptr [bp+var_18], ax
	mov	word ptr [bp+var_18+2],	dx
	lfs	bx, [bp+var_18]
	mov	ah, fs:[bx+1]
	sub	al, al
	mov	cl, fs:[bx]
	sub	ch, ch
	add	ax, cx
	mov	[bp+var_6], ax
	push	ax
	push	cs
	call	near ptr sub_15766
	add	sp, 2
	jmp	short loc_156E0
loc_156CC:
	mov	ax, 0Eh
	push	ax
	mov	ax, offset byte_3E948
	mov	dx, seg	seg023
	push	dx
	push	ax
	call	sub_27E3D
	add	sp, 6
loc_156E0:
	mov	ax, 1
	push	ax
	mov	ax, 63h	
	push	ax
	push	[bp+var_8]
	push	[bp+var_A]
	call	far ptr	sub_3E97A
	add	sp, 8
loc_156F6:
	jmp	loc_1557A
loc_156F9:
	jmp	loc_1555B
loc_156FC:
	push	cs
	call	near ptr sub_14E41
	mov	[bp+var_6], ax
	jmp	short loc_1573F
loc_15705:
	mov	ax, [bp+arg_A]
	cmp	[bp+var_4], ax
	jge	short loc_15710
	inc	[bp+var_4]
loc_15710:
	jmp	short loc_1575A
loc_15712:
	cmp	[bp+var_4], 0
	jz	short loc_1571B
	dec	[bp+var_4]
loc_1571B:
	jmp	short loc_1575A
loc_1571D:
	cmp	[bp+var_2], 0
	jz	short loc_15726
	dec	[bp+var_2]
loc_15726:
	jmp	short loc_1575A
loc_15728:
	mov	ax, [bp+arg_8]
	cmp	[bp+var_2], ax
	jge	short loc_15733
	inc	[bp+var_2]
loc_15733:
	jmp	short loc_1575A
loc_15735:
	push	cs
	call	near ptr clearTextWindow
	jmp	short loc_15761
loc_1573B:
	jmp	short loc_1575A
	jmp	short loc_1575A
loc_1573F:
	cmp	ax, 1Bh
	jz	short loc_15735
	cmp	ax, dosKeys_upArrow
	jz	short loc_15712
	cmp	ax, dosKeys_leftArrow
	jz	short loc_15728
	cmp	ax, dosKeys_rightArrow
	jz	short loc_1571D
	cmp	ax, dosKeys_downArrow
	jz	short loc_15705
	jmp	short loc_1573B
loc_1575A:
	jmp	loc_1553C
	push	cs
	call	near ptr clearTextWindow
loc_15761:
	pop	si
	mov	sp, bp
	pop	bp
	retf
dun_doMiniMap endp

; Attributes: bp-based frame

sub_15766 proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	mov	[bp+var_4], 0
	jmp	short loc_1577B
loc_15778:
	inc	[bp+var_4]
loc_1577B:
	cmp	[bp+var_4], 4
	jge	short loc_157BF
	mov	ax, [bp+var_4]
	dec	ax
	push	ax
	push	[bp+arg_0]
	call	sub_27E13
	add	sp, 4
	and	ax, 0Fh
	mov	[bp+var_6], ax
	mov	bx, ax
	cmp	byte_43EBC[bx],	80h
	jnb	short loc_157BD
	mov	al, byte_43EBC[bx]
	sub	ah, ah
	or	ax, [bp+var_4]
	mov	[bp+var_2], ax
	push	ax
	mov	ax, offset byte_3E948
	mov	dx, seg	seg023
	push	dx
	push	ax
	call	sub_27E3D
	add	sp, 6
loc_157BD:
	jmp	short loc_15778
loc_157BF:
	mov	sp, bp
	pop	bp
	retf
sub_15766 endp

; Attributes: bp-based frame

_mfunc_getString proc far

	memOffset= word	ptr  6
	memSegment= word ptr  8
	rbuf= dword ptr	 0Ah

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, [bp+memOffset]
	mov	dx, [bp+memSegment]
	mov	dataBufOff, ax
	mov	dataBufSeg, dx
	mov	bitsLeft, 0
	mov	_str_capFlag, 0
loc_157E6:
	push	cs
	call	near ptr _mfunc_unpackChar
	lfs	bx, [bp+rbuf]
	inc	word ptr [bp+rbuf]
	mov	fs:[bx], al
	or	al, al
	jz	short loc_157F9
	jmp	short loc_157E6
loc_157F9:
	mov	ax, dataBufOff
	mov	dx, dataBufSeg
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
_mfunc_getString endp

; Attributes: bp-based frame

_mfunc_unpackChar proc far

	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
loc_15811:
	mov	ax, 5
	push	ax
	push	cs
	call	near ptr _mfunc_extractCh
	add	sp, 2
	mov	[bp+var_2], ax
	jmp	short loc_15895
loc_15821:
	sub	ax, ax
	jmp	loc_158A8
	jmp	short loc_158A5
loc_15828:
	mov	_str_capFlag, 1
	jmp	short loc_158A5
loc_15830:
	mov	ax, 6
	push	ax
	push	cs
	call	near ptr _mfunc_extractCh
	add	sp, 2
	mov	[bp+var_2], ax
	mov	bx, ax
	mov	al, _str_Hialphabet[bx]
	cbw
	mov	[bp+var_4], ax
	cmp	_str_capFlag, 0
	jz	short loc_15862
	mov	_str_capFlag, 0
	push	ax
	call	_str_capitalize
	add	sp, 2
	jmp	short loc_158A8
	jmp	short loc_15867
loc_15862:
	mov	ax, [bp+var_4]
	jmp	short loc_158A8
loc_15867:
	jmp	short loc_158A5
loc_15869:
	mov	bx, [bp+var_2]
	mov	al, _str_Loalphabet[bx-1]
	cbw
	mov	[bp+var_4], ax
	cmp	_str_capFlag, 0
	jz	short loc_1588E
	mov	_str_capFlag, 0
	push	ax
	call	_str_capitalize
	add	sp, 2
	jmp	short loc_158A8
	jmp	short loc_15893
loc_1588E:
	mov	ax, [bp+var_4]
	jmp	short loc_158A8
loc_15893:
	jmp	short loc_158A5
loc_15895:
	or	ax, ax
	jz	short loc_15821
	cmp	ax, 30
	jz	short loc_15828
	cmp	ax, 31
	jz	short loc_15830
	jmp	short loc_15869
loc_158A5:
	jmp	loc_15811
loc_158A8:
	mov	sp, bp
	pop	bp
	retf
_mfunc_unpackChar endp

; Attributes: bp-based frame

_mfunc_extractCh proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 0
loc_158BC:
	mov	ax, [bp+arg_0]
	dec	[bp+arg_0]
	or	ax, ax
	jz	short loc_158FE
	dec	bitsLeft
	jns	short loc_158E4
	mov	bx, dataBufOff
	inc	dataBufOff
	mov	fs, dataBufSeg
	mov	al, fs:[bx]
	mov	curStrByte, al
	mov	bitsLeft, 7
loc_158E4:
	shl	[bp+var_2], 1
	cmp	curStrByte, 80h
	jb	short loc_158F3
	mov	ax, 1
	jmp	short loc_158F5
loc_158F3:
	sub	ax, ax
loc_158F5:
	or	[bp+var_2], ax
	shl	curStrByte, 1
	jmp	short loc_158BC
loc_158FE:
	mov	ax, [bp+var_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
_mfunc_extractCh endp

; This function	copies 16 bytes	from fromBuffer	to
; toBuffer and AND's each byte with 0x7f to remove
; the "encryption"
; Attributes: bp-based frame

decryptName proc far

	var_4= byte ptr	-4
	var_2= word ptr	-2
	fromBuffer= dword ptr  6
	toBuffer= dword	ptr  0Ah

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	[bp+var_2], 0
	jmp	short loc_1591C
loc_15919:
	inc	[bp+var_2]
loc_1591C:
	cmp	[bp+var_2], 16
	jge	short loc_1594A
	lfs	bx, [bp+fromBuffer]
	mov	al, fs:[bx]
	mov	[bp+var_4], al
	cmp	al, 0FFh
	jz	short loc_15946
	or	al, al
	jz	short loc_15946
	inc	word ptr [bp+fromBuffer]
	mov	al, fs:[bx]
	and	al, 7Fh
	lfs	bx, [bp+toBuffer]
	inc	word ptr [bp+toBuffer]
	mov	fs:[bx], al
	jmp	short loc_15948
loc_15946:
	jmp	short loc_1594A
loc_15948:
	jmp	short loc_15919
loc_1594A:
	lfs	bx, [bp+toBuffer]
	inc	word ptr [bp+toBuffer]
	mov	byte ptr fs:[bx], 0
	mov	sp, bp
	pop	bp
	retf
decryptName endp

; Attributes: bp-based frame

printStringGetInput proc far

	var_20=	word ptr -20h
	var_1E=	word ptr -1Eh
	var_1C=	word ptr -1Ch
	var_1A=	word ptr -1Ah
	var_18=	word ptr -18h
	var_16=	word ptr -16h
	var_14=	word ptr -14h
	var_12=	word ptr -12h
	var_10=	word ptr -10h
	var_E= word ptr	-0Eh
	var_C= word ptr	-0Ch
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= dword ptr  0Ah
	arg_8= word ptr	 0Eh

	push	bp
	mov	bp, sp
	mov	ax, 20h	
	call	someStackOperation
	push	si
	mov	[bp+var_12], 0
	mov	[bp+var_16], 0
	sub	ax, ax
	mov	[bp+var_1E], ax
	mov	[bp+var_10], ax
	mov	[bp+var_E], 1
	push	cs
	call	near ptr sub_1766A
loc_1597F:
	cmp	[bp+var_E], 0
	jnz	short loc_15988
	jmp	loc_15A61
loc_15988:
	call	far ptr	sub_3E974
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr printStringWClear
	add	sp, 4
	mov	al, gs:txt_numLines
	sub	ah, ah
	inc	ax
	mov	[bp+var_A], ax
	mov	ax, 0Ah
	sub	ax, [bp+var_A]
	mov	[bp+var_6], ax
	mov	ax, [bp+var_12]
	add	ax, [bp+var_6]
	cmp	ax, [bp+arg_8]
	jle	short loc_159BF
	mov	ax, [bp+arg_8]
loc_159BF:
	mov	[bp+var_1C], ax
	mov	ax, [bp+var_12]
	mov	[bp+var_1A], ax
	jmp	short loc_159CD
loc_159CA:
	inc	[bp+var_1A]
loc_159CD:
	mov	ax, [bp+var_1C]
	cmp	[bp+var_1A], ax
	jge	short loc_159EF
	mov	bx, [bp+var_1A]
	shl	bx, 1
	shl	bx, 1
	lfs	si, [bp+arg_4]
	push	word ptr fs:[bx+si+2]
	push	word ptr fs:[bx+si]
	push	cs
	call	near ptr printString
	add	sp, 4
	jmp	short loc_159CA
loc_159EF:
	mov	[bp+var_4], 0
	mov	ax, [bp+var_12]
	add	ax, [bp+var_6]
	cmp	ax, [bp+arg_8]
	jle	short loc_15A07
	mov	ax, [bp+arg_8]
	sub	ax, [bp+var_12]
	jmp	short loc_15A0A
loc_15A07:
	mov	ax, [bp+var_6]
loc_15A0A:
	mov	[bp+var_14], ax
	mov	[bp+var_1A], 0
	jmp	short loc_15A17
loc_15A14:
	inc	[bp+var_1A]
loc_15A17:
	mov	ax, [bp+var_14]
	cmp	[bp+var_1A], ax
	jge	short loc_15A35
	mov	bx, [bp+var_1A]
	add	bx, [bp+var_A]
	shl	bx, 1
	mov	ax, bitMask16bit[bx]
	or	[bp+var_4], ax
	jmp	short loc_15A14
loc_15A35:
	mov	ax, bitMask16bit+16h
	or	[bp+var_4], ax
	push	cs
	call	near ptr sub_15D0C
	mov	ax, [bp+var_16]
	add	ax, [bp+var_A]
	sub	ax, [bp+var_12]
	push	ax
	call	far ptr	sub_3E96E
	add	sp, 2
	push	cs
	call	near ptr sub_1766A
	mov	[bp+var_E], 0
	jmp	short loc_15A65
loc_15A61:
	push	cs
	call	near ptr sub_15226
loc_15A65:
	call	checkMouse
	cmp	mouse_moved, 0
	jz	short loc_15A8E
	call	far ptr	sub_3E974
	push	[bp+var_4]
	push	cs
	call	near ptr sub_14ECC
	add	sp, 2
	mov	[bp+var_2], 1
	push	cs
	call	near ptr sub_1766A
loc_15A8E:
	push	[bp+var_4]
	push	cs
	call	near ptr sub_15D62
	add	sp, 2
	mov	[bp+var_8], ax
	or	ax, ax
	jnz	short loc_15AA2
	jmp	loc_15BA9
loc_15AA2:
	call	checkGamePort
	or	ax, ax
	jnz	short loc_15AB4
	call	checkOtherGamePort
	or	ax, ax
	jz	short loc_15AB9
loc_15AB4:
	mov	ax, 1
	jmp	short loc_15ABB
loc_15AB9:
	sub	ax, ax
loc_15ABB:
	mov	[bp+var_20], ax
	cmp	[bp+var_1E], ax
	jnz	short loc_15AC7
	sub	ax, ax
	jmp	short loc_15ACA
loc_15AC7:
	mov	ax, [bp+var_20]
loc_15ACA:
	mov	[bp+var_10], ax
	mov	ax, [bp+var_20]
	mov	word_440BC, ax
	cmp	[bp+var_8], 10Eh
	jl	short loc_15B27
	cmp	[bp+var_8], 118h
	jg	short loc_15B27
	cmp	[bp+var_2], 0
	jz	short loc_15AFB
	mov	ax, [bp+var_8]
	sub	ax, [bp+var_A]
	add	ax, [bp+var_12]
	sub	ax, 10Eh
	mov	[bp+var_16], ax
	mov	[bp+var_2], 0
loc_15AFB:
	cmp	[bp+var_10], 0
	jz	short loc_15B0C
	call	far ptr	sub_3E974
	mov	ax, [bp+var_16]
	jmp	loc_15D07
loc_15B0C:
	mov	ax, [bp+var_C]
	cmp	[bp+var_16], ax
	jz	short loc_15B19
	mov	ax, 1
	jmp	short loc_15B1B
loc_15B19:
	sub	ax, ax
loc_15B1B:
	mov	[bp+var_E], ax
	mov	ax, [bp+var_16]
	mov	[bp+var_C], ax
	jmp	loc_15BA9
loc_15B27:
	mov	ax, [bp+var_8]
	jmp	short loc_15B98
loc_15B2C:
	cmp	[bp+var_10], 0
	jz	short loc_15B5A
	mov	ax, [bp+arg_8]
	sub	ax, 5
	cmp	ax, [bp+var_12]
	jle	short loc_15B5A
	add	[bp+var_12], 5
	mov	ax, [bp+var_12]
	add	ax, 2
	mov	[bp+var_16], ax
	mov	si, [bp+arg_8]
	dec	si
	cmp	ax, si
	jle	short loc_15B55
	mov	[bp+var_16], si
loc_15B55:
	mov	[bp+var_E], 1
loc_15B5A:
	jmp	short loc_15BA9
loc_15B5C:
	cmp	[bp+var_10], 0
	jz	short loc_15B81
	cmp	[bp+var_12], 5
	jle	short loc_15B6E
	sub	[bp+var_12], 5
	jmp	short loc_15B73
loc_15B6E:
	mov	[bp+var_12], 0
loc_15B73:
	mov	ax, [bp+var_12]
	add	ax, 2
	mov	[bp+var_16], ax
	mov	[bp+var_E], 1
loc_15B81:
	jmp	short loc_15BA9
loc_15B83:
	cmp	[bp+var_10], 0
	jz	short loc_15B94
	call	far ptr	sub_3E974
	mov	ax, 0FFFFh
	jmp	loc_15D07
loc_15B94:
	jmp	short loc_15BA9
	jmp	short loc_15BA9
loc_15B98:
	cmp	ax, 1Bh
	jz	short loc_15B83
	cmp	ax, 4800h
	jz	short loc_15B5C
	cmp	ax, 5000h
	jz	short loc_15B2C
	jmp	short loc_15B94
loc_15BA9:
	call	checkKeyboard
	or	ax, ax
	jnz	short loc_15BB5
	jmp	loc_15D04
loc_15BB5:
	call	_readChFromKeyboard
	mov	[bp+var_18], ax
	or	al, al
	jz	short loc_15BD4
	mov	al, byte ptr [bp+var_18]
	sub	ah, ah
	push	ax
	call	_str_capitalize
	add	sp, 2
	mov	[bp+var_8], ax
	jmp	short loc_15BDA
loc_15BD4:
	mov	ax, [bp+var_18]
	mov	[bp+var_8], ax
loc_15BDA:
	mov	[bp+var_E], 1
	mov	ax, [bp+var_8]
	jmp	loc_15CC7
loc_15BE5:
	call	far ptr	sub_3E974
	mov	ax, [bp+var_16]
	jmp	loc_15D07
loc_15BF0:
	call	far ptr	sub_3E974
	mov	ax, 0FFFFh
	jmp	loc_15D07
loc_15BFB:
	cmp	[bp+var_16], 0
	jz	short loc_15C04
	dec	[bp+var_16]
loc_15C04:
	mov	ax, [bp+var_12]
	cmp	[bp+var_16], ax
	jge	short loc_15C0F
	dec	[bp+var_12]
loc_15C0F:
	jmp	loc_15D04
loc_15C12:
	mov	ax, [bp+arg_8]
	dec	ax
	cmp	ax, [bp+var_16]
	jle	short loc_15C1E
	inc	[bp+var_16]
loc_15C1E:
	mov	ax, [bp+var_12]
	add	ax, [bp+var_6]
	cmp	ax, [bp+var_16]
	jg	short loc_15C2C
	inc	[bp+var_12]
loc_15C2C:
	jmp	loc_15D04
loc_15C2F:
	mov	ax, [bp+var_16]
	add	ax, [bp+var_6]
	mov	cx, [bp+arg_8]
	dec	cx
	cmp	ax, cx
	jge	short loc_15C48
	mov	ax, [bp+var_6]
	add	[bp+var_16], ax
	add	[bp+var_12], ax
	jmp	short loc_15C6B
loc_15C48:
	mov	ax, [bp+arg_8]
	dec	ax
	mov	[bp+var_16], ax
	mov	ax, [bp+var_6]
	cmp	[bp+var_16], ax
	jl	short loc_15C66
	mov	ax, [bp+arg_8]
	mov	cx, [bp+var_6]
	sar	cx, 1
	sub	ax, cx
	mov	[bp+var_12], ax
	jmp	short loc_15C6B
loc_15C66:
	mov	[bp+var_12], 0
loc_15C6B:
	jmp	loc_15D04
loc_15C6E:
	mov	ax, [bp+var_6]
	cmp	[bp+var_16], ax
	jg	short loc_15C82
	mov	[bp+var_16], 0
	mov	[bp+var_12], 0
	jmp	short loc_15C97
loc_15C82:
	mov	ax, [bp+var_6]
	sub	[bp+var_16], ax
	cmp	[bp+var_12], ax
	jle	short loc_15C92
	sub	[bp+var_12], ax
	jmp	short loc_15C97
loc_15C92:
	mov	[bp+var_12], 0
loc_15C97:
	jmp	short loc_15D04
loc_15C99:
	sub	ax, ax
	mov	[bp+var_12], ax
	mov	[bp+var_16], ax
	jmp	short loc_15D04
loc_15CA3:
	mov	ax, [bp+arg_8]
	dec	ax
	mov	[bp+var_16], ax
	mov	ax, [bp+var_6]
	cmp	[bp+var_16], ax
	jge	short loc_15CB6
	sub	ax, ax
	jmp	short loc_15CC0
loc_15CB6:
	mov	ax, [bp+var_16]
	mov	cx, [bp+var_6]
	sar	cx, 1
	sub	ax, cx
loc_15CC0:
	mov	[bp+var_12], ax
loc_15CC3:
	jmp	short loc_15D04
	jmp	short loc_15D04
loc_15CC7:
	cmp	ax, 4800h
	jnz	short loc_15CCF
	jmp	loc_15BFB
loc_15CCF:
	jg	short loc_15CE8
	cmp	ax, 0Dh
	jnz	short loc_15CD9
	jmp	loc_15BE5
loc_15CD9:
	cmp	ax, 1Bh
	jnz	short loc_15CE1
	jmp	loc_15BF0
loc_15CE1:
	cmp	ax, 4700h
	jz	short loc_15C99
	jmp	short loc_15CC3
loc_15CE8:
	cmp	ax, 4900h
	jz	short loc_15C6E
	cmp	ax, 4F00h
	jz	short loc_15CA3
	cmp	ax, 5000h
	jnz	short loc_15CFA
	jmp	loc_15C12
loc_15CFA:
	cmp	ax, 5100h
	jnz	short loc_15D02
	jmp	loc_15C2F
loc_15D02:
	jmp	short loc_15CC3
loc_15D04:
	jmp	loc_1597F
loc_15D07:
	pop	si
	mov	sp, bp
	pop	bp
	retf
printStringGetInput endp

; Attributes: bp-based frame

sub_15D0C proc far
	push	bp
	mov	bp, sp
	mov	ax, 1
	push	ax
	mov	ax, 61h	
	push	ax
	mov	ax, 0B2h 
	push	ax
	mov	ax, 5Eh	
	push	ax
	call	far ptr	sub_3E97A
	add	sp, 8
	mov	ax, 1
	push	ax
	mov	ax, 62h	
	push	ax
	mov	ax, 120h
	push	ax
	mov	ax, 5Eh	
	push	ax
	call	far ptr	sub_3E97A
	add	sp, 8
	mov	ax, 1
	push	ax
	mov	ax, 5Eh	
	push	ax
	mov	ax, 0E0h 
	push	ax
	mov	ax, offset aEsc
	push	ds
	push	ax
	push	cs
	call	near ptr sub_16F1E
	add	sp, 0Ah
	mov	sp, bp
	pop	bp
	retf
sub_15D0C endp

; Attributes: bp-based frame

sub_15D62 proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	[bp+var_2], 0
	mov	ax, mouseBoxes._left[1 * sizeof mouseBox_t]
	cmp	mouse_x, ax
	jge	short loc_15D83
	jmp	loc_15E0B
loc_15D83:
	mov	ax, mouseBoxes._right[1 * sizeof mouseBox_t]
	cmp	mouse_x, ax
	jge	short loc_15E0B
	mov	ax, mouseBoxes._top[1 * sizeof mouseBox_t]
	cmp	mouse_y, ax
	jl	short loc_15E0B
	mov	ax, mouseBoxes._bottom[1 * sizeof mouseBox_t]
	cmp	mouse_y, ax
	jge	short loc_15E0B
	mov	ax, mouse_y
	sub	ax, 4
	mov	cl, 3
	sar	ax, cl
	mov	[bp+var_4], ax
	cmp	ax, 0Bh
	jnz	short loc_15DEB
	mov	ax, mouseBoxes._left[1 * sizeof mouseBox_t]
	add	ax, 32h	
	cmp	mouse_x, ax
	jge	short loc_15DD0
	mov	[bp+var_2], 4800h
	jmp	short loc_15DE9
loc_15DD0:
	mov	ax, mouseBoxes._right[1 * sizeof mouseBox_t]
	sub	ax, 32h	
	cmp	mouse_x, ax
	jge	short loc_15DE4
	mov	[bp+var_2], 1Bh
	jmp	short loc_15DE9
loc_15DE4:
	mov	[bp+var_2], 5000h
loc_15DE9:
	jmp	short loc_15E0B
loc_15DEB:
	mov	ax, [bp+arg_0]
	mov	bx, [bp+var_4]
	shl	bx, 1
	test	bitMask16bit[bx], ax
	jz	short loc_15E06
	mov	ax, [bp+var_4]
	add	ax, 10Eh
	jmp	short loc_15E08
loc_15E06:
	sub	ax, ax
loc_15E08:
	mov	[bp+var_2], ax
loc_15E0B:
	mov	ax, [bp+var_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_15D62 endp

; Attributes: bp-based frame

_readString proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	mov	[bp+var_6], 0
	push	cs
	call	near ptr txt_newLine
	push	cs
	call	near ptr sub_15F3F
loc_15E2D:
	push	cs
	call	near ptr sub_151EA
	mov	[bp+var_2], ax
	cmp	ax, 0Dh
	jnz	short loc_15E3C
	jmp	loc_15F0D
loc_15E3C:
	mov	[bp+var_4], ax
	push	ax
	push	cs
	call	near ptr isAlphaNum
	add	sp, 2
	or	ax, ax
	jnz	short loc_15E6F
	cmp	[bp+var_2], 20h	
	jz	short loc_15E6F
	cmp	[bp+var_2], 2Dh	
	jz	short loc_15E6F
	cmp	[bp+var_2], 2Eh	
	jz	short loc_15E6F
	cmp	[bp+var_2], 2Ch	
	jz	short loc_15E6F
	cmp	[bp+var_2], 3Ah	
	jz	short loc_15E6F
	cmp	[bp+var_2], 5Ch	
	jnz	short loc_15EAC
loc_15E6F:
	mov	ax, [bp+arg_4]
	cmp	[bp+var_6], ax
	jge	short loc_15EAA
	mov	bx, [bp+var_6]
	lfs	si, [bp+arg_0]
	mov	al, byte ptr [bp+var_2]
	mov	fs:[bx+si], al
	sub	ax, ax
	push	ax
	mov	ax, 5Fh	
	push	ax
	push	cs
	call	near ptr sub_15FC5
	add	sp, 4
	mov	bx, [bp+var_6]
	inc	[bp+var_6]
	lfs	si, [bp+arg_0]
	mov	al, fs:[bx+si]
	cbw
	push	ax
	push	cs
	call	near ptr sub_15F92
	add	sp, 2
	push	cs
	call	near ptr sub_15F3F
loc_15EAA:
	jmp	short loc_15F0A
loc_15EAC:
	cmp	[bp+var_2], 8
	jnz	short loc_15EDB
	cmp	[bp+var_6], 0
	jle	short loc_15EDB
	dec	[bp+var_6]
	mov	bx, [bp+var_6]
	lfs	si, [bp+arg_0]
	mov	al, fs:[bx+si]
	cbw
	push	ax
	push	cs
	call	near ptr txt_charSpacing
	add	sp, 2
	push	ax
	push	cs
	call	near ptr sub_15F5C
	add	sp, 2
	push	cs
	call	near ptr sub_15F3F
	jmp	short loc_15F0A
loc_15EDB:
	cmp	[bp+var_2], 1Bh
	jnz	short loc_15F0A
loc_15EE1:
	cmp	[bp+var_6], 0
	jle	short loc_15F06
	dec	[bp+var_6]
	mov	bx, [bp+var_6]
	lfs	si, [bp+arg_0]
	mov	al, fs:[bx+si]
	cbw
	push	ax
	push	cs
	call	near ptr txt_charSpacing
	add	sp, 2
	push	ax
	push	cs
	call	near ptr sub_15F5C
	add	sp, 2
	jmp	short loc_15EE1
loc_15F06:
	push	cs
	call	near ptr sub_15F3F
loc_15F0A:
	jmp	loc_15E2D
loc_15F0D:
	mov	bx, [bp+var_6]
	lfs	si, [bp+arg_0]
	mov	byte ptr fs:[bx+si], 0
	sub	ax, ax
	push	ax
	mov	ax, 5Fh	
	push	ax
	push	cs
	call	near ptr sub_15FC5
	add	sp, 4
	cmp	[bp+var_6], 0
	jz	short loc_15F35
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short loc_15F3A
	jmp	short loc_15F3A
loc_15F35:
	sub	ax, ax
	cwd
	jmp	short $+2
loc_15F3A:
	pop	si
	mov	sp, bp
	pop	bp
	retf
_readString endp

; Attributes: bp-based frame

sub_15F3F proc far
	push	bp
	mov	bp, sp
	mov	ax, 1
	push	ax
	mov	ax, 60h	
	push	ax
	push	cs
	call	near ptr sub_15FC5
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
sub_15F3F endp

; Attributes: bp-based frame

sub_15F5C proc far

	arg_0= byte ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	sub	ax, ax
	push	ax
	mov	ax, 5Fh	
	push	ax
	push	cs
	call	near ptr sub_15FC5
	add	sp, 4
	mov	al, [bp+arg_0]
	sub	gs:byte_42419, al
	sub	ax, ax
	push	ax
	mov	ax, 5Fh	
	push	ax
	push	cs
	call	near ptr sub_15FC5
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
sub_15F5C endp

; Attributes: bp-based frame

sub_15F92 proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 1
	push	ax
	mov	ax, [bp+arg_0]
	sub	ax, 20h	
	push	ax
	push	cs
	call	near ptr sub_15FC5
	add	sp, 4
	push	[bp+arg_0]
	push	cs
	call	near ptr txt_charSpacing
	add	sp, 2
	add	gs:byte_42419, al
	mov	sp, bp
	pop	bp
	retf
sub_15F92 endp

; Attributes: bp-based frame

sub_15FC5 proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	[bp+arg_2]
	push	[bp+arg_0]
	mov	al, gs:byte_42419
	sub	ah, ah
	add	ax, 0A8h 
	push	ax
	mov	al, gs:txt_numLines
	sub	ah, ah
	mov	cl, 3
	shl	ax, cl
	add	ax, 6
	push	ax
	call	far ptr	sub_3E97A
	add	sp, 8
	mov	sp, bp
	pop	bp
	retf
sub_15FC5 endp

; Attributes: bp-based frame

sub_16001 proc far

	var_14=	word ptr -14h
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 14h
	call	someStackOperation
	mov	ax, 10h
	push	ax
	lea	ax, [bp+var_14]
	push	ss
	push	ax
	push	cs
	call	near ptr _readString
	add	sp, 6
	or	dx, ax
	jz	short loc_1603F
	lea	ax, [bp+var_4]
	push	ss
	push	ax
	mov	ax, offset aU
	push	ds
	push	ax
	lea	ax, [bp+var_14]
	push	ss
	push	ax
	call	sscanf
	add	sp, 0Ch
	mov	ax, [bp+var_4]
	mov	dx, [bp+var_2]
	jmp	short loc_16044
loc_1603F:
	sub	ax, ax
	cwd
	jmp	short $+2
loc_16044:
	mov	sp, bp
	pop	bp
	retf
sub_16001 endp

; Attributes: bp-based frame

_strcat	proc far

	toStr= dword ptr  6
	fromStr= dword ptr  0Ah

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation

loc_16052:
	lfs	bx, [bp+fromStr]
	inc	word ptr [bp+fromStr]
	mov	al, fs:[bx]
	lfs	bx, [bp+toStr]
	inc	word ptr [bp+toStr]
	mov	fs:[bx], al
	or	al, al
	jz	short loc_1606A
	jmp	short loc_16052

loc_1606A:
	lfs	bx, [bp+toStr]
	mov	byte ptr fs:[bx], 0
	dec	word ptr [bp+toStr]
	mov	ax, word ptr [bp+toStr]
	mov	dx, word ptr [bp+toStr+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
_strcat	endp

;_strncpy proc far

;	toptr=dword ptr -6
;	counter= word ptr -2
;	fromStr= dword ptr 6
;	toStr= dword ptr 0Ah
;	_len= word ptr 0Eh

;	func_enter
;	_chkstk	2

;	mov	ax, word ptr [bp+tostr]
;	mov	dx, word ptr [bp+tostr+2]
;	mov	word ptr [bp+toptr], ax
;	mov	word ptr [bp+toptr+2], dx
;	mov	[bp+counter], 0

;loc_strncpy_loop:
;	lfs	bx, [bp+fromStr]
;	mov	al, byte ptr fs:[bx]
;	inc	[bp+fromStr]
;	lfs	bx, [bp+toptr]
;	mov	byte ptr fs:[bx], al
;	inc	[bp+toptr]
;	or	al, al
;	jz	short loc_strncpy_exit
;	inc	[bp+counter]
;	mov	ax, [bp+counter]
;	cmp	ax, [bp+_len]
;	jnz	loc_strncpy_loop

;loc_strncpy_exit:
;	lfs	bx, [bp+toptr]
;	mov	byte ptr fs:[bx], 0
;	func_exit
;	retf
;_strncpy endp
	

; Attributes: bp-based frame

_itoa proc far

	var_4= word ptr	-4
	var_2= byte ptr	-2
	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah
	arg_6= word ptr	 0Ch
	arg_8= word ptr	 0Eh

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	[bp+var_2], 20h	
	cmp	[bp+arg_8], 0
	jnz	short loc_160A6
	push	[bp+arg_6]
	push	[bp+arg_4]
	push	cs
	call	near ptr sub_16185
	add	sp, 4
	mov	[bp+arg_8], ax
loc_160A6:
	cmp	[bp+arg_6], 0
	jge	short loc_160C3
	mov	ax, [bp+arg_4]
	mov	dx, [bp+arg_6]
	neg	ax
	adc	dx, 0
	neg	dx
	mov	[bp+arg_4], ax
	mov	[bp+arg_6], dx
	mov	[bp+var_2], 2Dh	
loc_160C3:
	mov	ax, 0Ah
	cwd
	push	dx
	push	ax
	push	[bp+arg_6]
	push	[bp+arg_4]
	call	_32bitMod
	add	al, 30h	
	mov	si, [bp+arg_8]
	lfs	bx, [bp+arg_0]
	mov	fs:[bx+si-1], al
	mov	ax, [bp+arg_8]
	dec	ax
	mov	[bp+var_4], ax
	jmp	short loc_160EC
loc_160E9:
	dec	[bp+var_4]
loc_160EC:
	cmp	[bp+var_4], 0
	jle	short loc_1613B
	mov	ax, 0Ah
	cwd
	push	dx
	push	ax
	lea	ax, [bp+arg_4]
	push	ax
	call	_32bitDivide
	mov	ax, [bp+arg_4]
	or	ax, [bp+arg_6]
	jz	short loc_16128
	mov	ax, 0Ah
	cwd
	push	dx
	push	ax
	push	[bp+arg_6]
	push	[bp+arg_4]
	call	_32bitMod
	add	al, 30h	
	mov	si, [bp+var_4]
	lfs	bx, [bp+arg_0]
	mov	fs:[bx+si-1], al
	jmp	short loc_16139
loc_16128:
	mov	si, [bp+var_4]
	lfs	bx, [bp+arg_0]
	mov	al, [bp+var_2]
	mov	fs:[bx+si-1], al
	mov	[bp+var_2], 20h	
loc_16139:
	jmp	short loc_160E9
loc_1613B:
	cmp	[bp+arg_6], 0
	jg	short loc_1614F
	jl	short loc_16149
	cmp	[bp+arg_4], 0Ah
	jnb	short loc_1614F
loc_16149:
	cmp	[bp+var_2], 2Dh	
	jnz	short loc_16175
loc_1614F:
	mov	[bp+var_4], 0
	jmp	short loc_16159
loc_16156:
	inc	[bp+var_4]
loc_16159:
	mov	ax, [bp+arg_8]
	cmp	[bp+var_4], ax
	jge	short loc_1616D
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], 2Ah
	jmp	short loc_16156
loc_1616D:
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short loc_16180
loc_16175:
	mov	ax, [bp+arg_8]
	add	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
loc_16180:
	pop	si
	mov	sp, bp
	pop	bp
	retf
_itoa endp

; Attributes: bp-based frame

sub_16185 proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	cmp	[bp+arg_2], 0
	jge	short loc_1619D
	mov	[bp+var_2], 2
	jmp	short loc_161A2
loc_1619D:
	mov	[bp+var_2], 1
loc_161A2:
	jmp	short loc_161A7
loc_161A4:
	inc	[bp+var_2]
loc_161A7:
	mov	ax, 0Ah
	cwd
	push	dx
	push	ax
	lea	ax, [bp+arg_0]
	push	ax
	call	_32bitDivide
	or	dx, ax
	jz	short loc_161BC
	jmp	short loc_161A4
loc_161BC:
	mov	ax, [bp+var_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_16185 endp

; Attributes: bp-based frame

sub_161C5 proc far

	var_24=	word ptr -24h
	var_4= dword ptr -4
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 24h	
	call	someStackOperation
	push	[bp+arg_2]
	push	[bp+arg_0]
	lea	ax, [bp+var_24]
	push	ss
	push	ax
	push	cs
	call	near ptr _strcat
	add	sp, 8
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	mov	ax, 3
	push	ax
	mov	ax, [bp+arg_4]
	cwd
	push	dx
	push	ax
	push	word ptr [bp+var_4+2]
	push	word ptr [bp+var_4]
	push	cs
	call	near ptr _itoa
	add	sp, 0Ah
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	lfs	bx, [bp+var_4]
	mov	byte ptr fs:[bx], 0
	lea	ax, [bp+var_24]
	push	ss
	push	ax
	push	cs
	call	near ptr printString
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
sub_161C5 endp

; Attributes: bp-based frame

sub_1621C proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 64h	
	imul	[bp+arg_4]
	mov	cl, 8
	sar	ax, cl
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_161C5
	add	sp, 6
	mov	sp, bp
	pop	bp
	retf
sub_1621C endp

; Attributes: bp-based frame

str_pluralize proc far

	var_2= word ptr	-2
	srcString= dword ptr  6
	destString= dword ptr  0Ah
	value= word ptr	 0Eh

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 0
loc_16252:
	mov	ax, [bp+var_2]
	jmp	loc_16328
loc_16258:
	lfs	bx, [bp+srcString]
	mov	al, fs:[bx]
	lfs	bx, [bp+destString]
	mov	fs:[bx], al
	cmp	al, 2Fh	
	jnz	short loc_1627B
	cmp	[bp+value], 0
	jz	short loc_16273
	mov	ax, 1
	jmp	short loc_16276
loc_16273:
	mov	ax, 2
loc_16276:
	mov	[bp+var_2], ax
	jmp	short loc_162A0
loc_1627B:
	lfs	bx, [bp+destString]
	cmp	byte ptr fs:[bx], 5Ch
	jnz	short loc_16297
	cmp	[bp+value], 0
	jz	short loc_1628F
	mov	ax, 3
	jmp	short loc_16292
loc_1628F:
	mov	ax, 4
loc_16292:
	mov	[bp+var_2], ax
	jmp	short loc_162A0
loc_16297:
	cmp	byte ptr fs:[bx], 0
	jz	short loc_162A0
	inc	word ptr [bp+destString]
loc_162A0:
	jmp	loc_16350
loc_162A3:
	lfs	bx, [bp+srcString]
	cmp	byte ptr fs:[bx], 5Ch
	jnz	short loc_162B1
	mov	[bp+var_2], 3
loc_162B1:
	jmp	loc_16350
loc_162B4:
	lfs	bx, [bp+srcString]
	mov	al, fs:[bx]
	lfs	bx, [bp+destString]
	mov	fs:[bx], al
	cmp	al, 5Ch	
	jnz	short loc_162CC
	mov	[bp+var_2], 4
	jmp	loc_16350
loc_162CC:
	lfs	bx, [bp+srcString]
	cmp	byte ptr fs:[bx], 0
	jz	short loc_162D8
	inc	word ptr [bp+destString]
loc_162D8:
	jmp	short loc_16350
loc_162DA:
	lfs	bx, [bp+srcString]
	mov	al, fs:[bx]
	lfs	bx, [bp+destString]
	mov	fs:[bx], al
	cmp	al, 5Ch	
	jnz	short loc_162F1
	mov	[bp+var_2], 5
	jmp	short loc_162FD
loc_162F1:
	lfs	bx, [bp+srcString]
	cmp	byte ptr fs:[bx], 0
	jz	short loc_162FD
	inc	word ptr [bp+destString]
loc_162FD:
	jmp	short loc_16350
loc_162FF:
	lfs	bx, [bp+srcString]
	cmp	byte ptr fs:[bx], 5Ch
	jnz	short loc_1630D
	mov	[bp+var_2], 5
loc_1630D:
	jmp	short loc_16350
loc_1630F:
	lfs	bx, [bp+srcString]
	cmp	byte ptr fs:[bx], 0
	jz	short loc_16324
	mov	al, fs:[bx]
	lfs	bx, [bp+destString]
	inc	word ptr [bp+destString]
	mov	fs:[bx], al
loc_16324:
	jmp	short loc_16350
	jmp	short loc_16350
loc_16328:
	or	ax, ax
	jnz	short loc_1632F
	jmp	loc_16258
loc_1632F:
	cmp	ax, 1
	jnz	short loc_16337
	jmp	loc_162A3
loc_16337:
	cmp	ax, 2
	jnz	short loc_1633F
	jmp	loc_162B4
loc_1633F:
	cmp	ax, 3
	jz	short loc_162DA
	cmp	ax, 4
	jz	short loc_162FF
	cmp	ax, 5
	jz	short loc_1630F
	jmp	short loc_16324
loc_16350:
	lfs	bx, [bp+srcString]
	inc	word ptr [bp+srcString]
	cmp	byte ptr fs:[bx], 0
	jz	short loc_1635F
	jmp	loc_16252
loc_1635F:
	mov	ax, word ptr [bp+destString]
	mov	dx, word ptr [bp+destString+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
str_pluralize endp

; Attributes: bp-based frame

sub_1636B proc far

	var_54=	dword ptr -54h
	var_50=	word ptr -50h
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 54h	
	call	someStackOperation
	push	[bp+arg_4]
	lea	ax, [bp+var_50]
	push	ss
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr str_pluralize
	add	sp, 0Ah
	mov	word ptr [bp+var_54], ax
	mov	word ptr [bp+var_54+2],	dx
	lfs	bx, [bp+var_54]
	mov	byte ptr fs:[bx], 0
	lea	ax, [bp+var_50]
	push	ss
	push	ax
	push	cs
	call	near ptr printString
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
sub_1636B endp

; Attributes: bp-based frame


printStringWClear proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	cs
	call	near ptr clearTextWindow
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr printString
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
printStringWClear endp

; Attributes: bp-based frame

printString proc far

	var_62=	word ptr -62h
	var_12=	dword ptr -12h
	var_E= word ptr	-0Eh
	var_C= word ptr	-0Ch
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 62h	
	call	someStackOperation
	push	si
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	mov	word ptr [bp+var_12], ax
	mov	word ptr [bp+var_12+2],	dx
	mov	[bp+var_E], 0
	mov	[bp+var_A], 0
	mov	[bp+var_C], 0
loc_163EE:
	lfs	bx, [bp+arg_0]
	cmp	byte ptr fs:[bx], 0
	jnz	short loc_163FA
	jmp	loc_1655B
loc_163FA:
	lfs	bx, [bp+var_12]
	inc	word ptr [bp+var_12]
	mov	al, fs:[bx]
	cbw
	mov	[bp+var_4], ax
	jmp	loc_1653E
loc_1640A:
	mov	si, [bp+var_E]
	mov	byte ptr [bp+si+var_62], 0
	cmp	[bp+var_E], 0
	jz	short loc_16423
	lea	ax, [bp+var_62]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_16560
	add	sp, 4
loc_16423:
	jmp	loc_1655B
loc_16426:
	mov	si, [bp+var_E]
	mov	byte ptr [bp+si+var_62], 0
	cmp	[bp+var_E], 0
	jz	short loc_16441
	lea	ax, [bp+var_62]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_16560
	add	sp, 4
loc_16441:
	push	cs
	call	near ptr txt_newLine
loc_16445:
	mov	ax, [bp+var_C]
	inc	[bp+var_C]
	cmp	ax, 32h	
	jle	short loc_16457
	push	cs
	call	near ptr _return_three
	jmp	loc_1655B
loc_16457:
	mov	ax, word ptr [bp+var_12]
	mov	dx, word ptr [bp+var_12+2]
	mov	word ptr [bp+arg_0], ax
	mov	word ptr [bp+arg_0+2], dx
	mov	[bp+var_A], 0
	mov	[bp+var_E], 0
	jmp	loc_16558
loc_16470:
	cmp	[bp+var_A], 0
	jnz	short loc_16479
	jmp	loc_16558
loc_16479:
	mov	si, [bp+var_E]
	inc	[bp+var_E]
	mov	al, byte ptr [bp+var_4]
	mov	byte ptr [bp+si+var_62], al
	push	[bp+var_4]
	push	cs
	call	near ptr txt_charSpacing
	add	sp, 2
	add	[bp+var_A], ax
	cmp	[bp+var_A], 8Ah	
	jge	short loc_1649C
	jmp	loc_1653C
loc_1649C:
	mov	ax, [bp+var_C]
	inc	[bp+var_C]
	cmp	ax, 32h	
	jle	short loc_164AE
	push	cs
	call	near ptr _return_three
	jmp	loc_1655B
loc_164AE:
	mov	ax, [bp+var_E]
	mov	[bp+var_2], ax
	mov	ax, word ptr [bp+var_12]
	mov	dx, word ptr [bp+var_12+2]
	mov	[bp+var_8], ax
	mov	[bp+var_6], dx
loc_164C0:
	dec	[bp+var_E]
	mov	si, [bp+var_E]
	cmp	byte ptr [bp+si+var_62], 20h 
	jz	short loc_164D5
	or	si, si
	jl	short loc_164D5
	dec	word ptr [bp+var_12]
	jmp	short loc_164C0
loc_164D5:
	cmp	[bp+var_E], 0
	jz	short loc_16506
	mov	si, [bp+var_E]
	mov	byte ptr [bp+si+var_62], 0
	lea	ax, [bp+var_62]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_16560
	add	sp, 4
	mov	[bp+var_A], 0
	mov	[bp+var_E], 0
	mov	ax, word ptr [bp+var_12]
	mov	dx, word ptr [bp+var_12+2]
	mov	word ptr [bp+arg_0], ax
	mov	word ptr [bp+arg_0+2], dx
	jmp	short loc_1653C
loc_16506:
	mov	si, [bp+var_2]
	mov	byte ptr [bp+si+var_62], 6Fh 
	mov	ax, [bp+var_8]
	mov	dx, [bp+var_6]
	dec	ax
	mov	word ptr [bp+var_12], ax
	mov	word ptr [bp+var_12+2],	dx
	lea	ax, [bp+var_62]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_16560
	add	sp, 4
	mov	[bp+var_A], 0
	mov	[bp+var_E], 0
	mov	ax, word ptr [bp+var_12]
	mov	dx, word ptr [bp+var_12+2]
	mov	word ptr [bp+arg_0], ax
	mov	word ptr [bp+arg_0+2], dx
loc_1653C:
	jmp	short loc_16558
loc_1653E:
	or	ax, ax
	jnz	short loc_16545
	jmp	loc_1640A
loc_16545:
	cmp	ax, 0Ah
	jnz	short loc_1654D
	jmp	loc_16426
loc_1654D:
	cmp	ax, 20h	
	jnz	short loc_16555
	jmp	loc_16470
loc_16555:
	jmp	loc_16479
loc_16558:
	jmp	loc_163EE
loc_1655B:
	pop	si
	mov	sp, bp
	pop	bp
	retf
printString endp

; Attributes: bp-based frame

sub_16560 proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	gs:byte_4241A, 1
	cmp	gs:byte_42419, 0
	jz	short loc_16584
	push	cs
	call	near ptr txt_newLine
loc_16584:
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_16595
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
sub_16560 endp

; Attributes: bp-based frame

sub_16595 proc far

	var_2= byte ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
loc_165A0:
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_2], al
	or	al, al
	jz	short loc_165FE
	mov	ax, 1
	push	ax
	mov	al, [bp+var_2]
	cbw
	sub	ax, 20h	
	push	ax
	mov	al, gs:byte_42419
	sub	ah, ah
	add	ax, 0A8h 
	push	ax
	mov	al, gs:txt_numLines
	sub	ah, ah
	mov	cl, 3
	shl	ax, cl
	add	ax, 6
	push	ax
	call	far ptr	sub_3E97A
	add	sp, 8
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	cbw
	push	ax
	push	cs
	call	near ptr txt_charSpacing
	add	sp, 2
	add	gs:byte_42419, al
	jmp	short loc_165A0
loc_165FE:
	mov	sp, bp
	pop	bp
	retf
sub_16595 endp

; Attributes: bp-based frame

txt_newLine proc far
	push	bp
	mov	bp, sp
	mov	gs:byte_42419, 0
	mov	al, gs:txt_numLines
	inc	gs:txt_numLines
	cmp	al, 0Bh
	jb	short loc_16635
	push	cs
	call	near ptr sub_16639
	mov	gs:txt_numLines, 0Bh
loc_16635:
	mov	sp, bp
	pop	bp
	retf
txt_newLine endp

; Attributes: bp-based frame

sub_16639 proc far
	push	bp
	mov	bp, sp
	mov	ax, 50h	
	push	ax
	call	far ptr	sub_3E980
	add	sp, 2
	mov	ax, 50h	
	push	ax
	call	far ptr	sub_3E980
	add	sp, 2
	mov	sp, bp
	pop	bp
	retf
sub_16639 endp

; Attributes: bp-based frame

sub_1665F proc far

	var_A30= word ptr -0A30h
	var_A2E= word ptr -0A2Eh
	var_25E= word ptr -25Eh
	var_25C= word ptr -25Ch
	var_25A= word ptr -25Ah
	var_258= word ptr -258h
	var_256= word ptr -256h
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 0A30h
	call	someStackOperation
	push	si
	lea	ax, [bp+var_258]
	push	ss
	push	ax
	lea	ax, [bp+var_A2E]
	push	ss
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_169D4
	add	sp, 0Ch
	mov	[bp+var_A30], ax
	mov	[bp+var_25A], 0FFF8h
	jmp	short loc_16694
loc_16690:
	inc	[bp+var_25A]
loc_16694:
	mov	ax, [bp+var_A30]
	sub	ax, 4
	cmp	ax, [bp+var_25A]
	jg	short loc_166A4
	jmp	loc_1672C
loc_166A4:
	sub	ax, ax
	push	ax
	mov	ax, 5Ch	
	push	ax
	mov	ax, 96h	
	push	ax
	mov	ax, 1Ch
	push	ax
	sub	ax, ax
	push	ax
	call	far ptr	sub_3E96B
	add	sp, 0Ah
	mov	[bp+var_25C], 0
	jmp	short loc_166CA
loc_166C6:
	inc	[bp+var_25C]
loc_166CA:
	cmp	[bp+var_25C], 8
	jge	short loc_16717
	mov	ax, [bp+var_25C]
	add	ax, [bp+var_25A]
	mov	[bp+var_25E], ax
	or	ax, ax
	jl	short loc_16715
	mov	ax, [bp+var_A30]
	cmp	[bp+var_25E], ax
	jge	short loc_16715
	sub	ax, ax
	push	ax
	mov	ax, [bp+var_25C]
	mov	cl, 3
	shl	ax, cl
	add	ax, 1Ch
	push	ax
	mov	ax, 3
	push	ax
	mov	si, [bp+var_25E]
	shl	si, 1
	shl	si, 1
	push	[bp+si+var_256]
	push	[bp+si+var_258]
	push	cs
	call	near ptr sub_16F1E
	add	sp, 0Ah
loc_16715:
	jmp	short loc_166C6
loc_16717:
	mov	ax, 2
	push	ax
	push	cs
	call	near ptr sub_1542D
	add	sp, 2
	cmp	ax, 1Bh
	jnz	short loc_16729
	jmp	short loc_1672C
loc_16729:
	jmp	loc_16690
loc_1672C:
	pop	si
	mov	sp, bp
	pop	bp
locret_16730:
	retf
sub_1665F endp

; Attributes: bp-based frame

doVictoryMaybe proc far

	var_A38= word ptr -0A38h
	var_A36= word ptr -0A36h
	var_266= word ptr -266h
	var_264= word ptr -264h
	var_262= word ptr -262h
	var_260= word ptr -260h
	var_25E= word ptr -25Eh
	var_25C= word ptr -25Ch
	var_25A= word ptr -25Ah
	var_258= word ptr -258h
	var_256= word ptr -256h

	push	bp
	mov	bp, sp
	mov	ax, 0A38h
	call	someStackOperation
	push	si
	mov	[bp+var_262], 0
	jmp	short loc_16749
loc_16745:
	inc	[bp+var_262]
loc_16749:
	cmp	[bp+var_262], 5
	jge	short loc_1675E
	push	[bp+var_262]
	call	sub_17920
	add	sp, 2
	jmp	short loc_16745
loc_1675E:
	mov	gs:byte_422A0, 0
	mov	ax, 80E8h
	sub	dx, dx
	push	dx
	push	ax
	call	_mallocMaybe
	add	sp, 4
	mov	[bp+var_25E], ax
	mov	[bp+var_25C], dx
loc_1677F:
	sub	ax, ax
	push	ax
	mov	ax, offset aVict
	push	ds
	push	ax
	call	openFile
	add	sp, 6
	mov	[bp+var_260], ax
	inc	ax
	jnz	short loc_167BC
	mov	ax, offset aPleaseInsertDi
	push	ds
	push	ax
	push	cs
	call	near ptr printString
	add	sp, 4
	push	dseg_0
	push	disk1
	push	cs
	call	near ptr printString
	add	sp, 4
	wait4IO
loc_167BC:
	cmp	[bp+var_260], 0FFFFh
	jz	short loc_1677F
	mov	ax, 80E8h
	sub	dx, dx
	push	dx
	push	ax
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	[bp+var_260]
	call	_read
	add	sp, 0Ah
	push	[bp+var_260]
	call	_close
	add	sp, 2
	push	[bp+var_25C]
	push	[bp+var_25E]
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	call	d3comp
	add	sp, 8
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	mov	ax, [bp+var_25E]
	mov	dx, [bp+var_25C]
	add	ax, 0Dh
	push	dx
	push	ax
	call	far ptr	sub_3E97D
	add	sp, 8
	wait4IO
	mov	[bp+var_25A], 0
	jmp	short loc_16836
loc_16832:
	inc	[bp+var_25A]
loc_16836:
	cmp	[bp+var_25A], 5
	jl	short loc_16840
	jmp	loc_1690F
loc_16840:
	lea	ax, [bp+var_258]
	push	ss
	push	ax
	lea	ax, [bp+var_A36]
	push	ss
	push	ax
	mov	bx, [bp+var_25A]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (someMessageList+2)[bx]
	push	word ptr someMessageList[bx]
	push	cs
	call	near ptr sub_169D4
	add	sp, 0Ch
	mov	[bp+var_A38], ax
	mov	[bp+var_262], 0FFF8h
	jmp	short loc_16879
loc_16875:
	inc	[bp+var_262]
loc_16879:
	mov	ax, [bp+var_A38]
	sub	ax, 4
	cmp	ax, [bp+var_262]
	jg	short loc_16889
	jmp	loc_1690C
loc_16889:
	mov	ax, 0Bh
	push	ax
	mov	ax, 0BEh 
	push	ax
	mov	ax, 0A1h 
	push	ax
	mov	ax, 7Eh	
	push	ax
	mov	ax, 0Ah
	push	ax
	call	far ptr	sub_3E96B
	add	sp, 0Ah
	mov	[bp+var_264], 0
	jmp	short loc_168B1
loc_168AD:
	inc	[bp+var_264]
loc_168B1:
	cmp	[bp+var_264], 8
	jge	short loc_168FE
	mov	ax, [bp+var_264]
	add	ax, [bp+var_262]
	mov	[bp+var_266], ax
	or	ax, ax
	jl	short loc_168FC
	mov	ax, [bp+var_A38]
	cmp	[bp+var_266], ax
	jge	short loc_168FC
	sub	ax, ax
	push	ax
	mov	ax, [bp+var_264]
	mov	cl, 3
	shl	ax, cl
	add	ax, 7Eh	
	push	ax
	mov	ax, 0Dh
	push	ax
	mov	si, [bp+var_266]
	shl	si, 1
	shl	si, 1
	push	[bp+si+var_256]
	push	[bp+si+var_258]
	push	cs
	call	near ptr sub_16F1E
	add	sp, 0Ah
loc_168FC:
	jmp	short loc_168AD
loc_168FE:
	mov	ax, 2
	push	ax
	push	cs
	call	near ptr sub_1542D
	add	sp, 2
	jmp	loc_16875
loc_1690C:
	jmp	loc_16832
loc_1690F:
	sub	ax, ax
	push	ax
	mov	ax, offset aBardscr
	push	ds
	push	ax
	call	openFile
	add	sp, 6
	mov	[bp+var_260], ax
	inc	ax
	jnz	short loc_1694C
	mov	ax, offset aPleaseInsertDi
	push	ds
	push	ax
	push	cs
	call	near ptr printString
	add	sp, 4
	push	dseg_0
	push	disk1
	push	cs
	call	near ptr printString
	add	sp, 4
	mov	ax, 0FFFFh
	push	ax
	push	cs
	call	near ptr sub_1542D
	add	sp, 2
loc_1694C:
	cmp	[bp+var_260], 0FFFFh
	jz	short loc_1690F
	mov	ax, 80E8h
	sub	dx, dx
	push	dx
	push	ax
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	[bp+var_260]
	call	_read
	add	sp, 0Ah
	push	[bp+var_260]
	call	_close
	add	sp, 2
	push	[bp+var_25C]
	push	[bp+var_25E]
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	call	d3comp
	add	sp, 8
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	mov	ax, [bp+var_25E]
	mov	dx, [bp+var_25C]
	add	ax, 0Dh
	push	dx
	push	ax
	call	far ptr	sub_3E97D
	add	sp, 8
	push	[bp+var_25C]
	push	[bp+var_25E]
	call	_freeMaybe
	add	sp, 4
	call	sub_116CC
	mov	buildingRvalMaybe, 1
	pop	si
	mov	sp, bp
	pop	bp
	retf
doVictoryMaybe endp

; Attributes: bp-based frame

sub_169D4 proc far

	var_10=	word ptr -10h
	var_E= word ptr	-0Eh
	var_C= dword ptr -0Ch
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_2= word ptr	-2
	arg_0= dword ptr  6
	arg_4= dword ptr  0Ah
	arg_8= dword ptr  0Eh

	push	bp
	mov	bp, sp
	mov	ax, 10h
	call	someStackOperation
	push	si
	mov	[bp+var_8], 0
	mov	[bp+var_E], 0
	mov	bx, [bp+var_E]
	inc	[bp+var_E]
	shl	bx, 1
	shl	bx, 1
	lfs	si, [bp+arg_8]
	mov	ax, word ptr [bp+arg_4]
	mov	dx, word ptr [bp+arg_4+2]
	mov	fs:[bx+si], ax
	mov	fs:[bx+si+2], dx
loc_16A04:
	lfs	bx, [bp+arg_0]
	cmp	byte ptr fs:[bx], 0
	jnz	short loc_16A10
	jmp	loc_16B01
loc_16A10:
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	cbw
	mov	[bp+var_6], ax
	jmp	loc_16AEC
loc_16A1D:
	lfs	bx, [bp+arg_4]
	inc	word ptr [bp+arg_4]
	mov	byte ptr fs:[bx], 0
	mov	ax, [bp+var_E]
	jmp	loc_16B10
loc_16A2D:
	lfs	bx, [bp+arg_4]
	inc	word ptr [bp+arg_4]
	mov	byte ptr fs:[bx], 0
	mov	bx, [bp+var_E]
	inc	[bp+var_E]
	shl	bx, 1
	shl	bx, 1
	lfs	si, [bp+arg_8]
	mov	ax, word ptr [bp+arg_4]
	mov	dx, word ptr [bp+arg_4+2]
	mov	fs:[bx+si], ax
	mov	fs:[bx+si+2], dx
	mov	[bp+var_8], 0
	lfs	bx, [bp+arg_0]
	cmp	byte ptr fs:[bx], 20h
	jnz	short loc_16A62
	inc	word ptr [bp+arg_0]
loc_16A62:
	jmp	loc_16AFE
loc_16A65:
	lfs	bx, [bp+arg_4]
	inc	word ptr [bp+arg_4]
	mov	al, byte ptr [bp+var_6]
	mov	fs:[bx], al
	push	[bp+var_6]
	push	cs
	call	near ptr txt_charSpacing
	add	sp, 2
	add	[bp+var_8], ax
	cmp	[bp+var_8], 96h	
	jl	short loc_16AEA
	mov	ax, word ptr [bp+arg_4]
	mov	dx, word ptr [bp+arg_4+2]
	dec	ax
	mov	word ptr [bp+var_C], ax
	mov	word ptr [bp+var_C+2], dx
	mov	[bp+var_2], 0
loc_16A97:
	lfs	bx, [bp+var_C]
	cmp	byte ptr fs:[bx], 20h
	jz	short loc_16AC0
	cmp	[bp+var_8], 0
	jle	short loc_16AC0
	dec	word ptr [bp+var_C]
	mov	al, fs:[bx]
	cbw
	push	ax
	push	cs
	call	near ptr txt_charSpacing
	add	sp, 2
	mov	[bp+var_10], ax
	add	[bp+var_2], ax
	sub	[bp+var_8], ax
	jmp	short loc_16A97
loc_16AC0:
	lfs	bx, [bp+var_C]
	inc	word ptr [bp+var_C]
	mov	byte ptr fs:[bx], 0
	mov	bx, [bp+var_E]
	inc	[bp+var_E]
	shl	bx, 1
	shl	bx, 1
	lfs	si, [bp+arg_8]
	mov	ax, word ptr [bp+var_C]
	mov	dx, word ptr [bp+var_C+2]
	mov	fs:[bx+si], ax
	mov	fs:[bx+si+2], dx
	mov	ax, [bp+var_2]
	mov	[bp+var_8], ax
loc_16AEA:
	jmp	short loc_16AFE
loc_16AEC:
	or	ax, ax
	jnz	short loc_16AF3
	jmp	loc_16A1D
loc_16AF3:
	cmp	ax, 0Ah
	jnz	short loc_16AFB
	jmp	loc_16A2D
loc_16AFB:
	jmp	loc_16A65
loc_16AFE:
	jmp	loc_16A04
loc_16B01:
	lfs	bx, [bp+arg_4]
	inc	word ptr [bp+arg_4]
	mov	byte ptr fs:[bx], 0
	mov	ax, [bp+var_E]
	jmp	short $+2
loc_16B10:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_169D4 endp

; Attributes: bp-based frame

printRoster proc far

	tmp= word ptr -32h
	counter= word ptr -30h
	charNo=	word ptr -2Eh
	var_2C=	dword ptr -2Ch
	rosterLine= word ptr -28h
	var_26=	byte ptr -26h
	var_24=	byte ptr -24h

	push	bp
	mov	bp, sp
	mov	ax, 32h	
	call	someStackOperation
	push	si
	cmp	byte ptr word_44166,	0
	jz	short loc_16B30
	jmp	loc_16DF3
loc_16B30:
	call	rost_updateParty
	mov	byte ptr word_44166,	1
	call	far ptr	sub_3E974
	mov	[bp+charNo], 0
	jmp	short loc_16B4E
loc_16B4B:
	inc	[bp+charNo]
loc_16B4E:
	cmp	[bp+charNo], 7
	jl	short loc_16B57
	jmp	loc_16DEF
loc_16B57:
	getCharP	[bp+charNo], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jnz	short loc_16B6E
	jmp	loc_16DD9
loc_16B6E:
	mov	[bp+counter], 0
loc_16B73:
	getCharP	[bp+charNo], bx
	add	bx, [bp+counter]
	mov	al, byte ptr gs:roster._name[bx]
	mov	si, [bp+counter]
	mov	byte ptr [bp+si+rosterLine], al
	or	al, al
	jz	short loc_16B92
	inc	[bp+counter]
	jmp	short loc_16B73
loc_16B92:
	push	[bp+charNo]
	lea	ax, [bp+rosterLine]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_16DF8
	add	sp, 6
	mov	ax, 3
	push	ax
	getCharP	[bp+charNo], bx
	mov	al, gs:roster.ac[bx]
	cbw
	sub	ax, 10
	neg	ax
	cwd
	push	dx
	push	ax
	lea	ax, [bp+rosterLine]
	push	ss
	push	ax
	push	cs
	call	near ptr _itoa
	add	sp, 10
	mov	word ptr [bp+var_2C], ax
	mov	word ptr [bp+var_2C+2],	dx
	lfs	bx, [bp+var_2C]
	mov	byte ptr fs:[bx], 0
	mov	ax, 1
	push	ax
	push	[bp+charNo]
	mov	ax, 10h
	push	ax
	lea	ax, [bp+rosterLine]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_16E4F
	add	sp, 0Ah
	getCharP	[bp+charNo], bx
	cmp	gs:roster.status[bx], 0
	jz	short loc_16C7A
	mov	[bp+counter], 6
	jmp	short loc_16C0D
loc_16C0A:
	dec	[bp+counter]
loc_16C0D:
	cmp	[bp+counter], 0
	jl	short loc_16C78
	getCharP	[bp+charNo], bx
	mov	al, gs:roster.status[bx]
	sub	ah, ah
	mov	bx, [bp+counter]
	mov	cx, ax
	mov	al, byte_43EEA[bx]
	cbw
	test	cx, ax
	jz	short loc_16C76
	mov	[bp+tmp], 0
	jmp	short loc_16C3E
loc_16C3B:
	inc	[bp+tmp]
loc_16C3E:
	cmp	[bp+tmp], 4
	jge	short loc_16C59
	mov	si, [bp+counter]
	shl	si, 1
	shl	si, 1
	mov	bx, [bp+tmp]
	mov	al, byte ptr aOldPsndnutspossparade[bx+si]
	mov	si, bx
	mov	byte ptr [bp+si+rosterLine], al
	jmp	short loc_16C3B
loc_16C59:
	mov	[bp+var_24], 0
	mov	ax, 1
	push	ax
	push	[bp+charNo]
	mov	ax, 14h
	push	ax
	lea	ax, [bp+rosterLine]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_16E4F
	add	sp, 0Ah
	jmp	short loc_16C78
loc_16C76:
	jmp	short loc_16C0A
loc_16C78:
	jmp	short loc_16CC2
loc_16C7A:
	mov	ax, 3
	push	ax
	getCharP	[bp+charNo], bx
	sub	ax, ax
	push	ax
	push	gs:roster.maxHP[bx]
	lea	ax, [bp+rosterLine]
	push	ss
	push	ax
	push	cs
	call	near ptr _itoa
	add	sp, 0Ah
	mov	word ptr [bp+var_2C], ax
	mov	word ptr [bp+var_2C+2],	dx
	lfs	bx, [bp+var_2C]
	mov	byte ptr fs:[bx], 0
	mov	ax, 1
	push	ax
	push	[bp+charNo]
	mov	ax, 14h
	push	ax
	lea	ax, [bp+rosterLine]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_16E4F
	add	sp, 0Ah
loc_16CC2:
	mov	ax, 3
	push	ax
	getCharP	[bp+charNo], bx
	sub	ax, ax
	push	ax
	push	gs:roster.currentHP[bx]
	lea	ax, [bp+rosterLine]
	push	ss
	push	ax
	push	cs
	call	near ptr _itoa
	add	sp, 0Ah
	mov	word ptr [bp+var_2C], ax
	mov	word ptr [bp+var_2C+2],	dx
	lfs	bx, [bp+var_2C]
	mov	byte ptr fs:[bx], 0
	sub	ax, ax
	push	ax
	push	[bp+charNo]
	mov	ax, 18h
	push	ax
	lea	ax, [bp+rosterLine]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_16E4F
	add	sp, 0Ah
	mov	ax, 3
	push	ax
	getCharP	[bp+charNo], bx
	sub	ax, ax
	push	ax
	push	gs:roster.maxSppt[bx]
	lea	ax, [bp+rosterLine]
	push	ss
	push	ax
	push	cs
	call	near ptr _itoa
	add	sp, 0Ah
	mov	word ptr [bp+var_2C], ax
	mov	word ptr [bp+var_2C+2],	dx
	lfs	bx, [bp+var_2C]
	mov	byte ptr fs:[bx], 0
	mov	ax, 1
	push	ax
	push	[bp+charNo]
	mov	ax, 1Ch
	push	ax
	lea	ax, [bp+rosterLine]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_16E4F
	add	sp, 0Ah
	mov	ax, 3
	push	ax
	getCharP	[bp+charNo], bx
	sub	ax, ax
	push	ax
	push	gs:roster.currentSppt[bx]
	lea	ax, [bp+rosterLine]
	push	ss
	push	ax
	push	cs
	call	near ptr _itoa
	add	sp, 0Ah
	mov	word ptr [bp+var_2C], ax
	mov	word ptr [bp+var_2C+2],	dx
	lfs	bx, [bp+var_2C]
	mov	byte ptr fs:[bx], 0
	sub	ax, ax
	push	ax
	push	[bp+charNo]
	mov	ax, 20h	
	push	ax
	lea	ax, [bp+rosterLine]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_16E4F
	add	sp, 0Ah
	getCharP	[bp+charNo], bx
	mov	al, gs:roster.class[bx]
	sub	ah, ah
	mov	si, ax
	shl	si, 1
	mov	al, byte ptr aWawisocomarobapahumoa[si]
	mov	byte ptr [bp+rosterLine], al
	mov	al, byte ptr (aWawisocomarobapahumoa+1)[si]
	mov	byte ptr [bp+rosterLine+1], al
	mov	[bp+var_26], ah
	mov	ax, 1
	push	ax
	push	[bp+charNo]
	mov	ax, 24h	
	push	ax
	lea	ax, [bp+rosterLine]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_16E4F
	add	sp, 0Ah
	jmp	short loc_16DEC
loc_16DD9:
	mov	byte ptr [bp+rosterLine], 0
	push	[bp+charNo]
	lea	ax, [bp+rosterLine]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_16DF8
	add	sp, 6
loc_16DEC:
	jmp	loc_16B4B
loc_16DEF:
	push	cs
	call	near ptr sub_1766A
loc_16DF3:
	pop	si
	mov	sp, bp
	pop	bp
	retf
printRoster endp

; Attributes: bp-based frame

sub_16DF8 proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, [bp+arg_4]
	mov	cl, 3
	shl	ax, cl
	mov	[bp+var_2], ax
	mov	ax, 7
	push	ax
	mov	ax, [bp+var_2]
	add	ax, 97h	
	push	ax
	mov	ax, 13Ah
	push	ax
	mov	ax, [bp+var_2]
	add	ax, 90h	
	push	ax
	mov	ax, 0Bh
	push	ax
	call	far ptr	sub_3E96B
	add	sp, 0Ah
	mov	ax, 1
	push	ax
	mov	ax, [bp+var_2]
	add	ax, 90h	
	push	ax
	mov	ax, 0Ch
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_16F1E
	add	sp, 0Ah
	mov	sp, bp
	pop	bp
	retf
sub_16DF8 endp

; Attributes: bp-based frame

sub_16E4F proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah
	arg_6= word ptr	 0Ch
	arg_8= word ptr	 0Eh

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	[bp+arg_8], 1
	sbb	ax, ax
	neg	ax
	push	ax
	mov	ax, [bp+arg_6]
	mov	cl, 3
	shl	ax, cl
	add	ax, 90h	
	push	ax
	mov	ax, [bp+arg_4]
	shl	ax, cl
	add	ax, 0Ch
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_16F67
	add	sp, 0Ah
	mov	sp, bp
	pop	bp
	retf
sub_16E4F endp

; Attributes: bp-based frame

setTitle proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	sub	ax, ax
	push	ax
	mov	ax, 71h	
	push	ax
	mov	ax, 82h	
	push	ax
	mov	ax, 6Ah	
	push	ax
	mov	ax, 12h
	push	ax
	call	far ptr	sub_3E96B
	add	sp, 0Ah
	mov	ax, 70h	
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_16EE0
	add	sp, 6
	mov	[bp+var_2], ax
	sub	ax, ax
	push	ax
	mov	ax, 6Ah	
	push	ax
	mov	ax, [bp+var_2]
	add	ax, 12h
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_16F1E
	add	sp, 0Ah
	mov	sp, bp
	pop	bp
	retf
setTitle endp

; Attributes: bp-based frame

sub_16EE0 proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 0
loc_16EF0:
	lfs	bx, [bp+arg_0]
	cmp	byte ptr fs:[bx], 0
	jz	short loc_16F0D
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	cbw
	push	ax
	push	cs
	call	near ptr txt_charSpacing
	add	sp, 2
	add	[bp+var_2], ax
	jmp	short loc_16EF0
loc_16F0D:
	mov	ax, [bp+arg_4]
	sub	ax, [bp+var_2]
	cwd
	sub	ax, dx
	sar	ax, 1
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_16EE0 endp

; Attributes: bp-based frame

sub_16F1E proc far

	var_2= byte ptr	-2
	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah
	arg_6= word ptr	 0Ch
	arg_8= word ptr	 0Eh

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
loc_16F29:
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_2], al
	or	al, al
	jz	short loc_16F63
	push	[bp+arg_8]
	cbw
	sub	ax, 20h	
	push	ax
	push	[bp+arg_4]
	push	[bp+arg_6]
	call	far ptr	sub_3E97A
	add	sp, 8
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx]
	cbw
	push	ax
	push	cs
	call	near ptr txt_charSpacing
	add	sp, 2
	add	[bp+arg_4], ax
	inc	word ptr [bp+arg_0]
	jmp	short loc_16F29
loc_16F63:
	mov	sp, bp
	pop	bp
	retf
sub_16F1E endp

; Attributes: bp-based frame

sub_16F67 proc far

	var_2= byte ptr	-2
	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah
	arg_6= word ptr	 0Ch
	arg_8= word ptr	 0Eh

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
loc_16F72:
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_2], al
	or	al, al
	jz	short loc_16F9E
	push	[bp+arg_8]
	cbw
	sub	ax, 20h	
	push	ax
	push	[bp+arg_4]
	push	[bp+arg_6]
	call	far ptr	sub_3E97A
	add	sp, 8
	add	[bp+arg_4], 8
	inc	word ptr [bp+arg_0]
	jmp	short loc_16F72
loc_16F9E:
	mov	sp, bp
	pop	bp
	retf
sub_16F67 endp

; Attributes: bp-based frame

clearTextWindow	proc far
	push	bp
	mov	bp, sp
	cmp	gs:byte_4241A, 0
	jz	short loc_16FF0
	sub	al, al
	mov	gs:txt_numLines, al
	mov	gs:byte_42419, al
	mov	ax, 0Fh
	push	ax
	mov	ax, 66h	
	push	ax
	mov	ax, 132h
	push	ax
	mov	ax, 6
	push	ax
	mov	ax, 0A7h 
	push	ax
	call	far ptr	sub_3E96B
	add	sp, 0Ah
	mov	gs:byte_4241A, 0
loc_16FF0:
	mov	sp, bp
	pop	bp
	retf
clearTextWindow	endp

; Attributes: bp-based frame

txt_charSpacing	proc far

	arg_0= byte ptr	 6

	push	bp
	mov	bp, sp
	mov	al, [bp+arg_0]
	cbw
	push	ax
	push	cs
	call	near ptr isLowerAndNotM
	add	sp, 2
	or	ax, ax
	jz	short loc_17013
	mov	ax, 8
	jmp	short loc_17023
loc_17013:
	cmp	[bp+arg_0], 69h	
	jnz	short loc_1701E
	mov	ax, 3
	jmp	short loc_17023
loc_1701E:
	mov	ax, 6
	jmp	short $+2
loc_17023:
	mov	sp, bp
	pop	bp
	retf
txt_charSpacing	endp

; Attributes: bp-based frame

isLowerAndNotM proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	[bp+arg_0], 61h	
	jl	short loc_1703D
	cmp	[bp+arg_0], 7Ah	
	jle	short loc_17043
loc_1703D:
	cmp	[bp+arg_0], 20h	
	jnz	short loc_17049
loc_17043:
	cmp	[bp+arg_0], 6Dh	
	jnz	short loc_1704E
loc_17049:
	mov	ax, 1
	jmp	short loc_17050
loc_1704E:
	sub	ax, ax
loc_17050:
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
isLowerAndNotM endp

; Attributes: bp-based frame

sub_17056 proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
loc_17061:
	sub	ax, ax
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	openFile
	add	sp, 6
	mov	[bp+var_2], ax
	inc	ax
	jnz	short loc_1709E
	mov	ax, offset aPleaseInsertDi
	push	ds
	push	ax
	push	cs
	call	near ptr printString
	add	sp, 4
	push	dseg_0
	push	disk1
	push	cs
	call	near ptr printString
	add	sp, 4
	wait4IO
loc_1709E:
	cmp	[bp+var_2], 0FFFFh
	jz	short loc_17061
	push	[bp+var_2]
	call	dcmp_init
	add	sp, 2
	mov	ax, 7D00h
	push	ax
	mov	ax, offset characterIOBuf
	mov	dx, seg	seg022
	push	dx
	push	ax
	call	dcmp_decompress
	add	sp, 6
	push	[bp+var_2]
	call	_close
	add	sp, 2
	mov	sp, bp
	pop	bp
	retf
sub_17056 endp

; Attributes: bp-based frame

configIconsBin proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
loc_170DD:
	sub	ax, ax
	push	ax
	mov	ax, offset aIcons_bin
	push	ds
	push	ax
	call	openFile
	add	sp, 6
	mov	[bp+var_2], ax
	inc	ax
	jnz	short loc_17119
	mov	ax, offset aPleaseInsertDi
	push	ds
	push	ax
	push	cs
	call	near ptr printString
	add	sp, 4
	push	dseg_0
	push	disk1
	push	cs
	call	near ptr printString
	add	sp, 4
	wait4IO
loc_17119:
	cmp	[bp+var_2], 0FFFFh
	jz	short loc_170DD
	push	[bp+var_2]
	call	dcmp_init
	add	sp, 2
	mov	ax, 474h
	push	ax
	mov	ax, offset iconLight
	mov	dx, seg	seg023
	push	dx
	push	ax
	call	dcmp_decompress
	add	sp, 6
	mov	ax, 820h
	push	ax
	mov	ax, offset iconCompass
	mov	dx, seg	seg023
	push	dx
	push	ax
	call	dcmp_decompress
	add	sp, 6
	mov	ax, 550h
	push	ax
	mov	ax, offset iconAreaEnchant
	mov	dx, seg	seg023
	push	dx
	push	ax
	call	dcmp_decompress
	add	sp, 6
	mov	ax, 1E0h
	push	ax
	mov	ax, offset iconShield
	mov	dx, seg	seg023
	push	dx
	push	ax
	call	dcmp_decompress
	add	sp, 6
	mov	ax, 640h
	push	ax
	mov	ax, offset iconLevitation
	mov	dx, seg	seg023
	push	dx
	push	ax
	call	dcmp_decompress
	add	sp, 6
	push	[bp+var_2]
	call	_close
	add	sp, 2
	mov	sp, bp
	pop	bp
	retf
configIconsBin endp

; Attributes: bp-based frame

bigpic_drawPicNumber proc far

	var_E= word ptr	-0Eh
	var_C= word ptr	-0Ch
	var_8= word ptr	-8
	var_6= word ptr	-6
	fd= word ptr -4
	var_2= word ptr	-2
	indexNo= word ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 0Eh
	call	someStackOperation
	push	si
	cmp	[bp+indexNo], 0FEh
	jnz	short loc_171CF
	mov	ax, 7
	push	ax
	mov	ax, 66h	
	push	ax
	mov	ax, 7Fh	
	push	ax
	mov	ax, 0Fh
	push	ax
	mov	ax, 11h
	push	ax
	call	far ptr	sub_3E96B
	add	sp, 0Ah
	jmp	loc_17362
loc_171CF:
	mov	ax, 58h
	imul	word_4414C
	mov	si, ax
	mov	bx, [bp+indexNo]
	cmp	bigpicIndex[bx+si-58h],	0FFh
	jnz	short loc_171E7
	xor	byte ptr word_4414C, 3
loc_171E7:
	mov	ax, 58h
	imul	word_4414C
	mov	si, ax
	cmp	bigpicIndex[bx+si-58h],	0FFh
	jnz	short loc_17206
	mov	ax, offset aPictureGetErro
	push	ds
	push	ax
	push	cs
	call	near ptr printString
	add	sp, 4
	jmp	loc_17362
loc_17206:
	mov	ax, 88
	imul	word_4414C
	mov	si, ax
	mov	bx, [bp+indexNo]
	mov	al, bigpicIndex[bx+si-58h]
	sub	ah, ah
	mov	[bp+var_2], ax
loc_1721B:
	sub	ax, ax
	push	ax
	mov	bx, word_4414C
	shl	bx, 1
	shl	bx, 1
	push	word ptr lowPic[bx-2]
	push	word ptr lowPic[bx-4]
	call	openFile
	add	sp, 6
	mov	[bp+fd], ax
	inc	ax
	jnz	short loc_1726A
	mov	ax, offset aPleaseInsertDi
	push	ds
	push	ax
	push	cs
	call	near ptr printString
	add	sp, 4
	mov	bx, word_4414C
	shl	bx, 1
	shl	bx, 1
	push	dseg_0[bx]
	push	disk1[bx]
	push	cs
	call	near ptr printString
	add	sp, 4
	wait4IO
loc_1726A:
	cmp	[bp+fd], 0FFFFh
	jz	short loc_1721B
	mov	ax, 0FFFFh
	push	ax
	mov	ax, [bp+var_2]
	shl	ax, 1
	shl	ax, 1
	sub	cx, cx
	push	cx
	push	ax
	push	[bp+fd]
	call	_lseek
	add	sp, 8
	mov	ax, 4
	push	ax
	lea	ax, [bp+var_8]
	push	ss
	push	ax
	push	[bp+fd]
	call	_read
	add	sp, 8
	mov	ax, 0FFFFh
	push	ax
	push	[bp+var_6]
	push	[bp+var_8]
	push	[bp+fd]
	call	_lseek
	add	sp, 8
	mov	ax, 19712
	push	ax
	call	_mallocMaybe
	add	sp, 2
	mov	[bp+var_E], ax
	mov	[bp+var_C], dx
	mov	ax, 19712
	push	ax
	push	dx
	push	[bp+var_E]
	push	[bp+fd]
	call	_read
	add	sp, 8
	push	gs:word_4240C
	push	gs:word_4240A
	push	[bp+var_C]
	push	[bp+var_E]
	call	d3comp
	add	sp, 8
	push	[bp+var_C]
	push	[bp+var_E]
	call	_freeMaybe
	add	sp, 4
	push	[bp+fd]
	call	_close
	add	sp, 2
	push	gs:word_4240C
	push	gs:word_4240A
	push	cs
	call	near ptr sub_17367
	add	sp, 4
	mov	ax, offset bigpicBuf
	mov	dx, seg	seg021
	push	dx
	push	ax
	push	gs:word_4240C
	push	gs:word_4240A
	call	far ptr	vid_drawBigpic
	add	sp, 8
	cmp	[bp+indexNo], 35h 
	jz	short loc_1734A
	mov	al, 1
	jmp	short loc_1734C
loc_1734A:
	sub	al, al
loc_1734C:
	mov	gs:byte_422A0, al
	mov	gs:bigpicImageNo, 0
	sub	ax, ax
	jmp	short $+2
loc_17362:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bigpic_drawPicNumber endp

; Attributes: bp-based frame

sub_17367 proc far

	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	si, 1340h
	jmp	short loc_17379
loc_17378:
	inc	si
loc_17379:
	cmp	si, 4D00h
	jge	short loc_1738F
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx]
	xor	fs:[bx+1340h], al
	inc	word ptr [bp+arg_0]
	jmp	short loc_17378
loc_1738F:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_17367 endp

; Attributes: bp-based frame

readLevelData proc far

	var_E= word ptr	-0Eh
	memOffset= word	ptr -0Ch
	memSegment= word ptr -0Ah
	var_6= word ptr	-6
	fd= word ptr -4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 0Eh
	call	someStackOperation
	mov	bx, [bp+arg_0]
	shl	bx, 1
	mov	al, byte ptr stru_43F6E.fileType[bx]
	sub	ah, ah
	mov	[bp+var_E], ax
loc_173AD:
	sub	ax, ax
	push	ax
	mov	bx, [bp+var_E]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (disk3+2)[bx]
	push	word ptr disk3[bx]
	call	openFile
	add	sp, 6
	mov	[bp+fd], ax
	inc	ax
	jnz	short loc_173FA
	mov	ax, offset aPleaseInsertDi
	push	ds
	push	ax
	push	cs
	call	near ptr printString
	add	sp, 4
	mov	bx, [bp+var_E]
	shl	bx, 1
	shl	bx, 1
	push	dseg_0[bx]
	push	disk1[bx]
	push	cs
	call	near ptr printString
	add	sp, 4
	wait4IO
loc_173FA:
	cmp	[bp+fd], 0FFFFh
	jz	short loc_173AD
	mov	bx, [bp+arg_0]
	shl	bx, 1
	mov	al, stru_43F6E.fileIndexMaybe[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	ax, 0FFFFh
	push	ax
	mov	ax, [bp+var_2]
	shl	ax, 1
	cwd
	push	dx
	push	ax
	push	[bp+fd]
	call	_lseek
	add	sp, 8
	mov	ax, 2
	push	ax
	lea	ax, [bp+var_6]
	push	ss
	push	ax
	push	[bp+fd]
	call	_read
	add	sp, 8
	mov	ax, 0FFFFh
	push	ax
	sub	ax, ax
	push	ax
	push	[bp+var_6]
	push	[bp+fd]
	call	_lseek
	add	sp, 8
	mov	ax, 4000
	push	ax
	call	_mallocMaybe
	add	sp, 2
	mov	[bp+memOffset],	ax
	mov	[bp+memSegment], dx
	mov	ax, 4000
	push	ax
	push	dx
	push	[bp+memOffset]
	push	[bp+fd]
	call	_read
	add	sp, 8
	push	[bp+arg_4]
	push	[bp+arg_2]
	push	[bp+memSegment]
	push	[bp+memOffset]
	call	d3comp
	add	sp, 8
	push	[bp+memSegment]
	push	[bp+memOffset]
	call	_freeMaybe
	add	sp, 4
	push	[bp+fd]
	call	_close
	add	sp, 2
	mov	sp, bp
	pop	bp
	retf
readLevelData endp

; Attributes: bp-based frame

readGraphicsMaybe proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	ax, word_4414E
	cmp	[bp+arg_0], ax
	jnz	short loc_174BA
	jmp	loc_17541
loc_174BA:
	sub	ax, ax
	push	ax
	mov	bx, [bp+arg_0]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (off_43F2E+2)[bx]
	push	word ptr off_43F2E[bx]
	call	openFile
	add	sp, 6
	mov	[bp+var_2], ax
	inc	ax
	jnz	short loc_17513
	mov	bx, [bp+arg_0]
	mov	al, byte_43F4A[bx]
	sub	ah, ah
	mov	[bp+var_4], ax
	mov	ax, offset aPleaseInsertDi
	push	ds
	push	ax
	push	cs
	call	near ptr printString
	add	sp, 4
	mov	bx, [bp+var_4]
	shl	bx, 1
	shl	bx, 1
	push	dseg_0[bx]
	push	disk1[bx]
	push	cs
	call	near ptr printString
	add	sp, 4
	wait4IO
loc_17513:
	cmp	[bp+var_2], 0FFFFh
	jz	short loc_174BA
	mov	ax, [bp+arg_0]
	mov	word_4414E, ax
	mov	ax, 4A38h
	push	ax
	mov	ax, offset graphicsBuf
	mov	dx, seg	seg023
	push	dx
	push	ax
	push	[bp+var_2]
	call	_read
	add	sp, 8
	push	[bp+var_2]
	call	_close
	add	sp, 2
loc_17541:
	mov	sp, bp
	pop	bp
	retf
readGraphicsMaybe endp

; Attributes: bp-based frame

readMonsterFile	proc far

	var_A= word ptr	-0Ah
	_size= word ptr -8
	var_6= word ptr -6
	var_4= word ptr	-4
	_fd= word ptr	-2
	index= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 0Ah
	call	someStackOperation
	mov	ax, 480h
	push	ax
	sub	ax, ax
	push	ax
	mov	ax, offset monsterBuf
	mov	dx, seg	seg023
	push	dx
	push	ax
	call	_memset
	add	sp, 8
	mov	[bp+_size], 0

	; If the index is the last index in the file, read the full 0x480 bytes.
	; Otherwise, read the index, then read the next index, subtract to get the
	; length of the monster roster for the level.
	;
	cmp	[bp+index], 17
	jz	loc_readMonsterFile_hardcode_size
	cmp	[bp+index], 40
	jnz	loc_readMonsterFile_skip_hardcode

loc_readMonsterFile_hardcode_size:
	mov	[bp+_size], 480h

loc_readMonsterFile_skip_hardcode:
	cmp	[bp+index], 11h
	jge	short loc_17571
	sub	ax, ax
	jmp	short loc_17574
loc_17571:
	mov	ax, 1
loc_17574:
	mov	[bp+var_A], ax
loc_17577:
	sub	ax, ax
	push	ax
	mov	bx, [bp+var_A]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (monsterFiles+2)[bx]
	push	word ptr monsterFiles[bx]
	call	openFile
	add	sp, 6
	mov	[bp+_fd], ax
	inc	ax
	jnz	short loc_175C4
	mov	ax, offset aPleaseInsertDi
	push	ds
	push	ax
	push	cs
	call	near ptr printString
	add	sp, 4
	mov	bx, [bp+var_A]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (disk2+2)[bx]
	push	word ptr disk2[bx]
	push	cs
	call	near ptr printString
	add	sp, 4
	wait4IO
loc_175C4:
	cmp	[bp+_fd], 0FFFFh
	jz	short loc_17577
	cmp	[bp+var_A], 0
	jz	short loc_175D4
	sub	[bp+index], 11h
loc_175D4:
	push_imm	0FFFFh
	mov	ax, [bp+index]
	shl	ax, 1
	cwd
	push_reg	dx
	push_reg	ax
	push_var_stack	_fd
	func_lseek

	push_imm	2
	push_ss_string	var_4
	push_var_stack	_fd
	func_read

	cmp		[bp+_size], 0
	jnz		loc_readMonsterFile_read_data

	push_imm	2
	push_ss_string	var_6
	push_var_stack	_fd
	func_read

	mov		ax, [bp+var_6]
	sub		ax, [bp+var_4]
	mov		[bp+_size], ax

loc_readMonsterFile_read_data:
	push_imm	0FFFFh
	mov		ax, [bp+var_4]
	cwd
	push_reg	dx
	push_reg	ax
	push_var_stack	_fd
	func_lseek

	push_var_stack	_size
	mov		ax, offset monsterBuf
	mov		dx, seg	seg023
	push_reg	dx
	push_reg	ax
	push_var_stack	_fd
	func_read

	push_var_stack	_fd
	func_close

	mov	sp, bp
	pop	bp
	retf
readMonsterFile	endp

; Attributes: bp-based frame

sub_1763A proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	cs
	call	near ptr clearTextWindow
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr printString
	add	sp, 4
	wait4IO
	call	sub_104F3
	mov	sp, bp
	pop	bp
	retf
sub_1763A endp

; Attributes: bp-based frame

sub_1766A proc far
	push	bp
	mov	bp, sp
	cmp	gs:byte_422A0, 0
	jz	short loc_17688
	push	cs
	call	near ptr sub_17691
	or	ax, ax
	jz	short loc_1768D
loc_17688:
	call	far ptr	sub_3E971
loc_1768D:
	mov	sp, bp
	pop	bp
	retf
sub_1766A endp

; Attributes: bp-based frame

sub_17691 proc far
	push	bp
	mov	bp, sp
	mov	ax, mouseBoxes._left
	cmp	mouse_x, ax
	jl	short loc_176CB
	mov	ax, mouseBoxes._right
	cmp	mouse_x, ax
	jge	short loc_176CB
	mov	ax, mouseBoxes._top
	cmp	mouse_y, ax
	jl	short loc_176CB
	mov	ax, mouseBoxes._bottom
	cmp	mouse_y, ax
	jl	short loc_176D0
loc_176CB:
	mov	ax, 1
	jmp	short loc_176D2
loc_176D0:
	sub	ax, ax
loc_176D2:
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_17691 endp

; This function	doesn't really do anything but
; return 3...
; Attributes: bp-based frame

_return_three proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 3
	mov	ax, 3
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
_return_three endp

; Attributes: bp-based frame
_doNothing proc	far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	sp, bp
	pop	bp
	retf
_doNothing endp

; Attributes: bp-based frame

_doNothing_0 proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	sp, bp
	pop	bp
	retf
_doNothing_0 endp

; Attributes: bp-based frame

_doNothing_1 proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	sp, bp
	pop	bp
	retf
_doNothing_1 endp

; Attributes: bp-based frame

_doNothing_2 proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	sp, bp
	pop	bp
locret_17728:
	retf
_doNothing_2 endp


sub_17729	proc far
	push	bp
	mov	bp, sp
	mov	sp, bp
	pop	bp
	retf
sub_17729	endp

seg003 ends

; Segment type:	Pure code
seg004 segment word public 'CODE' use16
	assume cs:seg004
;org 7
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
algn_17737:
align 2
; Attributes: bp-based frame

bigpic_drawTopology proc far

	headerSize= word ptr -1Eh
	height=	word ptr -1Ch
	_offset= dword ptr -1Ah
	gbufOff= word ptr -12h
	gbufSeg= word ptr -10h
	row= word ptr -0Eh
	column=	word ptr -0Ch
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_2= word ptr	-2
	quadrant= word ptr  6
	sq= word ptr  8
	gbuf= dword ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 1Eh
	call	someStackOperation
	push	di
	push	si
	cmp	inDungeonMaybe, 0
	jz	short loc_17756
	mov	ax, 10h
	jmp	short loc_17759
loc_17756:
	mov	ax, 14h
loc_17759:
	mov	[bp+headerSize], ax
	mov	si, [bp+quadrant]
	shl	si, 1
	mov	al, byte ptr stru_44592.field_0[si]
	cbw
	mov	[bp+column], ax
	mov	al, stru_44592.field_1[si]
	cbw
	mov	[bp+row], ax
	mov	bx, [bp+quadrant]
	mov	al, byte_44278[bx]
	cbw
	mov	[bp+var_6], ax
	mov	al, byte_442F4[bx]
	cbw
	mov	cx, [bp+sq]
	shl	cx, 1
	shl	cx, 1
	add	ax, cx
	mov	[bp+var_8], ax
	mov	ax, [bp+headerSize]
	cmp	[bp+var_8], ax
	jl	short loc_177A8
	jmp	loc_1786B
loc_177A8:
	mov	di, [bp+var_8]
	lfs	bx, [bp+gbuf]
	mov	ah, fs:[bx+di+1]
	sub	al, al
	mov	bx, di
	mov	di, word ptr [bp+gbuf]
	mov	cl, fs:[bx+di]
	sub	ch, ch
	add	ax, cx
	add	ax, di
	mov	dx, fs
	add	ax, 9
	mov	word ptr [bp+_offset], ax
	mov	word ptr [bp+_offset+2], dx
	lfs	bx, [bp+_offset]
	inc	word ptr [bp+_offset]
	mov	al, fs:[bx]
	cbw
	mov	[bp+var_2], ax
	mov	bx, word ptr [bp+_offset]
	inc	word ptr [bp+_offset]
	mov	al, fs:[bx]
	cbw
	mov	[bp+height], ax
	mov	ax, word ptr [bp+_offset]
	add	ax, 2
	mov	[bp+gbufOff], ax
	mov	[bp+gbufSeg], dx
	cmp	[bp+column], 0
	jge	short loc_17813
	mov	ax, [bp+column]
	sub	[bp+gbufOff], ax
	mov	ax, [bp+var_6]
	add	ax, [bp+column]
	jns	short loc_17809
	sub	ax, ax
loc_17809:
	mov	[bp+var_A], ax
	mov	[bp+column], 0
	jmp	short loc_1782F
loc_17813:
	mov	ax, [bp+column]
	add	ax, [bp+var_6]
	cmp	ax, 56
	jle	short loc_17829
	mov	ax, 55
	sub	ax, [bp+column]
	mov	[bp+var_A], ax
	jmp	short loc_1782F
loc_17829:
	mov	ax, [bp+var_6]
	mov	[bp+var_A], ax
loc_1782F:
	cmp	[bp+var_2], 0
	jz	short loc_1786B
	mov	bx, [bp+quadrant]
	mov	al, byte_444D8[bx]
	cbw
	push	ax
	mov	al, byte_442B6[bx]
	cbw
	push	ax
	push	[bp+height]
	push	[bp+var_2]
	push	[bp+var_A]
	push	[bp+row]
	push	[bp+column]
	push	[bp+gbufSeg]
	push	[bp+gbufOff]
	call	_bigpic_copyTopoElem
	add	sp, 12h
loc_1786B:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
bigpic_drawTopology endp

; Attributes: bp-based frame

dun_setBigpicBG	proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	func_enter
	_chkstk		4

	test	levFlags, 20h
	jz	loc_dun_setBigpicBG_inDungeon

	push_imm	44h
	push_imm	0BBBBh
	mov		ax, offset bigpicBuf
	mov		dx, seg seg021
	push		dx
	push		ax
	std_call	bigpic_setBG, 8
	jmp	loc_dun_setBigpicBG_exit
	

loc_dun_setBigpicBG_inDungeon:
	push	si
	lfs	bx, [bp+arg_0]
	mov	ah, fs:(graphicsBuf+11h)[bx]
	sub	al, al
	mov	cl, fs:(graphicsBuf+10h)[bx]
	sub	ch, ch
	add	ax, cx
	add	ax, bx
	mov	dx, fs
	add	ax, 0Dh
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	mov	ax, 9A0h
	push	ax
	push	dx
	push	[bp+var_4]
	mov	ax, offset bigpicBuf
	mov	dx, seg	seg021
	push	dx
	push	ax
	call	_memcpy
	add	sp, 0Ah
	lfs	bx, [bp+arg_0]
	mov	ah, fs:(graphicsBuf+13h)[bx]
	sub	al, al
	mov	cl, fs:(graphicsBuf+12h)[bx]
	sub	ch, ch
	add	ax, cx
	add	ax, bx
	mov	dx, fs
	add	ax, 0Dh
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	mov	ax, 9A0h
	push	ax
	push	dx
	push	[bp+var_4]
	mov	ax, (offset bigpicBuf+9A0h)
	mov	dx, seg	seg021
	push	dx
	push	ax
	call	_memcpy
	add	sp, 0Ah
	cmp	lightDistance, 4
	jnb	short loc_dun_setBigpicBG_exit
	mov	al, lightDistance
	sub	ah, ah
	mov	si, ax
	shl	si, 1
	push	bigpicLightSize[si]
	sub	ax, ax
	push	ax
	mov	bx, bigpicLightOffset[si]
	lea	ax, bigpicBuf[bx]
	mov	dx, seg	seg021
	push	dx
	push	ax
	call	_memset
	add	sp, 8
	pop	si
loc_dun_setBigpicBG_exit:
	func_exit
	retf
dun_setBigpicBG	endp

seg004 ends

; Segment type:	Pure code
seg005 segment byte public 'CODE' use16
	assume cs:seg005
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
; Attributes: bp-based frame

sub_17920 proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	bx, [bp+arg_0]
	mov	al, byte_4472A[bx]
	sub	ah, ah
	push	ax
	push	bx
	push	cs
	call	near ptr icon_draw
	add	sp, 4
	mov	bx, [bp+arg_0]
	mov	lightDuration[bx], 0
	mov	ax, [bp+arg_0]
	jmp	short loc_1797C
loc_1794E:
	sub	al, al
	mov	lightDistance, al
	mov	gs:byte_41E61, al
	jmp	short loc_1798C
loc_17962:
	mov	detectType, 0
	jmp	short loc_1798C
loc_1796E:
	mov	byte_4EECB, 0
loc_17978:
	jmp	short loc_1798C
	jmp	short loc_1798C
loc_1797C:
	or	ax, ax
	jz	short loc_1794E
	cmp	ax, 2
	jz	short loc_17962
	cmp	ax, 3
	jz	short loc_1796E
	jmp	short loc_17978
loc_1798C:
	mov	sp, bp
	pop	bp
locret_1798F:
	retf
sub_17920 endp

; Attributes: bp-based frame

icon_activate proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	mov	bx, [bp+arg_0]
	mov	iconActiveFlagMaybe[bx], 1
	mov	bx, [bp+arg_0]
	mov	si, bx
	sub	al, al
	mov	byte_44718[si],	al
	mov	byte_44730[bx],	al
	sub	ax, ax
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr icon_draw
	add	sp, 4
	pop	si
	mov	sp, bp
	pop	bp
	retf
icon_activate endp

; Attributes: bp-based frame

sub_179C4 proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	al, byte ptr dirFacing
	mov	byte_44731, al
	cmp	gs:byte_422A0, 0
	jz	short loc_17A34
	mov	ax, gs:word_4245A
	inc	gs:word_4245A
	test	al, 3
	jnz	short loc_17A34
	inc	gs:bigpicImageNo
	and	gs:bigpicImageNo, 3
	mov	ax, offset bigpicBuf
	mov	dx, seg	seg021
	push	dx
	push	ax
	mov	al, gs:bigpicImageNo
	sub	ah, ah
	mov	cx, 1340h
	mul	cx
	add	ax, gs:word_4240A
	mov	dx, gs:word_4240C
	push	dx
	push	ax
	call	far ptr	vid_drawBigpic
	add	sp, 8
	jmp	short loc_17A9C
loc_17A34:
	cmp	gs:word_42560, 0
	jz	short loc_17A9C
	mov	ax, gs:word_4245A
	inc	gs:word_4245A
	test	al, 7
	jnz	short loc_17A9C
	inc	gs:bigpicImageNo
	cmp	gs:bigpicImageNo, 3
	jnz	short loc_17A6D
	mov	gs:word_42560, 0
loc_17A6D:
	mov	ax, offset bigpicBuf
	mov	dx, seg	seg021
	push	dx
	push	ax
	mov	al, gs:bigpicImageNo
	sub	ah, ah
	mov	cx, 1340h
	mul	cx
	add	ax, gs:word_4240A
	mov	dx, gs:word_4240C
	push	dx
	push	ax
	call	far ptr	vid_drawBigpic
	add	sp, 8
loc_17A9C:
	mov	[bp+var_2], 0
	jmp	short loc_17AA6
loc_17AA3:
	inc	[bp+var_2]
loc_17AA6:
	cmp	[bp+var_2], 5
	jge	short loc_17B1E
	mov	bx, [bp+var_2]
	cmp	lightDuration[bx], 0
	jz	short loc_17B1C
	mov	si, bx
	mov	al, byte_44718[si]
	cmp	byte_44730[bx],	al
	jz	short loc_17AE0
	mov	al, byte_44730[si]
	mov	byte_44718[bx],	al
	mov	bx, [bp+var_2]
	mov	al, byte_44730[bx]
	cbw
	push	ax
	push	bx
	push	cs
	call	near ptr icon_draw
	add	sp, 4
loc_17AE0:
	mov	bx, [bp+var_2]
	cmp	byte_4471E[bx],	0
	jz	short loc_17B1C
	mov	al, iconActiveFlagMaybe[bx]
	dec	iconActiveFlagMaybe[bx]
	cmp	al, 1
	jnz	short loc_17B1C
	mov	bx, [bp+var_2]
	mov	si, bx
	mov	al, byte_4471E[si]
	mov	iconActiveFlagMaybe[bx], al
	mov	bx, [bp+var_2]
	inc	byte_44730[bx]
	mov	al, byte_44730[bx]
	mov	bx, [bp+var_2]
	cmp	al, byte_4472A[bx]
	jnz	short loc_17B1C
	mov	byte_44730[bx],	0
loc_17B1C:
	jmp	short loc_17AA3
loc_17B1E:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_179C4 endp

; Attributes: bp-based frame

icon_draw proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= byte ptr	 6
	arg_2= byte ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	bl, [bp+arg_0]
	sub	bh, bh
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr iconDataList[bx]
	mov	dx, word ptr (iconDataList+2)[bx]
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
loc_17B46:
	mov	al, [bp+arg_2]
	dec	[bp+arg_2]
	or	al, al
	jz	short loc_17B60
	mov	bl, [bp+arg_0]
	sub	bh, bh
	shl	bx, 1
	mov	ax, word_4470E[bx]
	add	[bp+var_4], ax
	jmp	short loc_17B46
loc_17B60:
	mov	al, [bp+arg_0]
	sub	ah, ah
	mov	si, ax
	mov	al, iconWidth[si]
	push	ax
	mov	al, iconHeight[si]
	push	ax
	mov	al, iconXOffset[si]
	push	ax
	push	[bp+var_2]
	push	[bp+var_4]
	call	far ptr	sub_3E986
	add	sp, 0Ah
	pop	si
	mov	sp, bp
	pop	bp
locret_17B88:
	retf
icon_draw endp

seg005 ends

; Segment type:	Pure code
seg006 segment word public 'CODE' use16
	assume cs:seg006
;org 9
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
algn_17B89:
align 2
; Attributes: bp-based frame

rost_updateParty proc far

	charNo=	word ptr -2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+charNo], 0
	jmp	short loc_17B9F
loc_17B9C:
	inc	[bp+charNo]
loc_17B9F:
	cmp	[bp+charNo], 7
	jge	short loc_17BC5
	getCharP	[bp+charNo], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jz	short loc_17BC3
	push	[bp+charNo]
	push	cs
	call	near ptr rost_update
	add	sp, 2
loc_17BC3:
	jmp	short loc_17B9C
loc_17BC5:
	mov	sp, bp
	pop	bp
	retf
rost_updateParty endp

; Attributes: bp-based frame

rost_update proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	charNo=	word ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	getCharP	[bp+charNo], bx
	test	gs:roster.status[bx], stat_dead	or stat_stoned
	jz	short loc_17C23
	mov	ax, itemEff_resurrect
	push	ax
	push	[bp+charNo]
	push	cs
	call	near ptr hasEffectEquipped
	add	sp, 4
	or	ax, ax
	jnz	short loc_17C23
	push	cs
	call	near ptr inven_pack
	getCharP	[bp+charNo], bx
	and	gs:roster.status[bx], stat_poisoned or stat_old	or stat_paralyzed or stat_possessed or stat_nuts or stat_unknown
	getCharP	[bp+charNo], si
	mov	ax, gs:roster.maxHP[si]
	mov	gs:roster.currentHP[si], ax
loc_17C23:
	cmp	gs:songHalfDamage, 0
	jz	short loc_17C6D
	mov	al, gs:byte_41E62
	sub	ah, ah
	cmp	ax, [bp+charNo]
	jnz	short loc_17C6D
	getCharP	[bp+charNo], bx
	cmp	gs:roster.level[bx], 60
	jbe	short loc_17C57
	mov	ax, 0Fh
	jmp	short loc_17C68
loc_17C57:
	getCharP	[bp+charNo], bx
	mov	ax, gs:roster.level[bx]
	shr	ax, 1
	shr	ax, 1
loc_17C68:
	mov	[bp+var_6], ax
	jmp	short loc_17C72
loc_17C6D:
	mov	[bp+var_6], 0
loc_17C72:
	push	[bp+charNo]
	push	cs
	call	near ptr sub_17D8E
	add	sp, 2
	push	[bp+charNo]
	mov	si, ax
	push	cs
	call	near ptr rost_getDexACBonus
	add	sp, 2
	mov	cx, ax
	getCharP	[bp+charNo], bx
	mov	al, gs:roster.acBase[bx]
	sub	ah, ah
	mov	bx, [bp+charNo]
	mov	dl, gs:byte_42444[bx]
	sub	dh, dh
	add	ax, dx
	add	ax, cx
	add	ax, si
	add	ax, [bp+var_6]
	mov	[bp+var_4], ax
	getCharP	bx, bx
	cmp	gs:roster.class[bx], 9
	jnz	short loc_17CE4
	getCharP	[bp+charNo], bx
	mov	ax, gs:roster.level[bx]
	sub	ax, 0FFh
	sbb	cx, cx
	and	ax, cx
	add	ax, 0FFh
	add	[bp+var_4], ax
loc_17CE4:
	mov	al, byte_4EECB
	sub	ah, ah
	mov	cl, gs:byte_4244E
	sub	ch, ch
	add	ax, cx
	mov	cl, gs:songACBonus
	add	ax, cx
	mov	cl, gs:byte_42274
	sub	ax, cx
	mov	[bp+var_2], ax
	or	ax, ax
	jle	short loc_17D1B
	add	[bp+var_4], ax
loc_17D1B:
	mov	al, byte ptr [bp+var_4]
	cmp	ax, 60
	jle	loc_acOkay
	mov	ax, 60

loc_acOkay:
	mov	cx, ax
	getCharP	[bp+charNo], bx
	mov	gs:roster.ac[bx], cl
	getCharP	[bp+charNo], bx
	cmp	gs:roster.currentHP[bx], 0
	jnz	short loc_17D4F
	getCharP	[bp+charNo], bx
	or	gs:roster.status[bx], stat_dead
loc_17D4F:
	pop	si
	mov	sp, bp
	pop	bp
	retf
rost_update endp

; Attributes: bp-based frame
rost_getDexACBonus proc	far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	getCharP	[bp+arg_0], bx
	mov	al, gs:roster.dexterity[bx]
	sub	ah, ah
	sub	ax, 14
	mov	[bp+var_2], ax
	or	ax, ax
	jle	short loc_17D86
	mov	bx, ax
	mov	al, acDexterityBonus[bx]
	sub	ah, ah
	jmp	short loc_17D88
loc_17D86:
	sub	ax, ax
loc_17D88:
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
rost_getDexACBonus endp

; Attributes: bp-based frame

sub_17D8E proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	[bp+var_2], 0
	mov	[bp+var_4], 0
	jmp	short loc_17DA9
loc_17DA5:
	add	[bp+var_4], 3
loc_17DA9:
	cmp	[bp+var_4], 36
	jge	short loc_17DE9
	getCharP	[bp+arg_0], bx
	add	bx, [bp+var_4]
	mov	al, gs:roster.inventory.itemFlags[bx]
	and	al, 3
	cmp	al, 1
	jnz	short loc_17DE7
	getCharP	[bp+arg_0], bx
	add	bx, [bp+var_4]
	mov	bl, gs:roster.inventory.itemNo[bx]
	sub	bh, bh
	mov	al, item_acBonWeapDam[bx]
	sub	ah, ah
	and	ax, 0Fh
	add	[bp+var_2], ax
loc_17DE7:
	jmp	short loc_17DA5
loc_17DE9:
	mov	ax, [bp+var_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_17D8E endp

; Attributes: bp-based frame

hasEffectEquipped proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	playerNo= word ptr  6
	effectNo= word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	getCharP	[bp+playerNo], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jz	short loc_17E85
	mov	[bp+var_4], 1
	jmp	short loc_17E1C
loc_17E18:
	add	[bp+var_4], 3
loc_17E1C:
	cmp	[bp+var_4], 24h	
	jge	short loc_17E85
	getCharP	[bp+playerNo], bx
	add	bx, [bp+var_4]
	mov	al, gs:roster.inventory.itemFlags[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	bx, ax
	mov	al, itemEffectList[bx]
	and	ax, 0Fh
	cmp	ax, [bp+effectNo]
	jnz	short loc_17E83
	mov	ax, [bp+var_4]
	dec	ax
	mov	gs:word_42416, ax
	mov	ax, [bp+playerNo]
	mov	gs:word_4244C, ax
	getCharP	[bp+playerNo], bx
	add	bx, [bp+var_4]
	mov	al, gs:roster.acBase[bx]
	and	al, 3
	cmp	al, 1
	jnz	short loc_17E7E
	sub	ax, ax
	jmp	short loc_17E81
loc_17E7E:
	mov	ax, 1
loc_17E81:
	jmp	short loc_17E8A
loc_17E83:
	jmp	short loc_17E18
loc_17E85:
	mov	ax, 0FFFFh
	jmp	short $+2
loc_17E8A:
	mov	sp, bp
	pop	bp
	retf
hasEffectEquipped endp

; Attributes: bp-based frame

	inven_pack proc	far
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	ax, gs:word_42416
	mov	[bp+var_2], ax
	jmp	short loc_17EAA
loc_17EA7:
	inc	[bp+var_2]
loc_17EAA:
	cmp	[bp+var_2], 33
	jge	short loc_17ED1
	getCharP	gs:word_4244C, si
	add	si, [bp+var_2]
	mov	al, gs:(roster.inventory.itemFlags+3)[si]
	mov	gs:roster.inventory.itemFlags[si], al
	jmp	short loc_17EA7
loc_17ED1:
	mov	[bp+var_2], 33
	jmp	short loc_17EDB
loc_17ED8:
	inc	[bp+var_2]
loc_17EDB:
	cmp	[bp+var_2], 36
	jge	short loc_17EFE
	getCharP	gs:word_4244C, bx
	add	bx, [bp+var_2]
	mov	gs:roster.inventory.itemFlags[bx], 0
	jmp	short loc_17ED8
loc_17EFE:
	pop	si
	mov	sp, bp
	pop	bp
	retf
inven_pack endp

; Attributes: bp-based frame

inven_addItem proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	charNo=	word ptr  6
	arg_2= word ptr	 8
	arg_4= byte ptr	 0Ah
	arg_6= byte ptr	 0Ch

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	getCharP	[bp+charNo], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jnz	short loc_17F27
	sub	ax, ax
	jmp	loc_17FCC
loc_17F27:
	mov	[bp+var_4], 0
	jmp	short loc_17F32
loc_17F2E:
	add	[bp+var_4], 3
loc_17F32:
	cmp	[bp+var_4], 24h	
	jl	short loc_17F3B
	jmp	loc_17FC8
loc_17F3B:
	getCharP	[bp+charNo], bx
	add	bx, [bp+var_4]
	cmp	gs:roster.inventory.itemNo[bx],	0
	jnz	short loc_17FC5
	getCharP	[bp+charNo], bx
	mov	bl, gs:roster.class[bx]
	sub	bh, bh
	mov	al, classEquipMask[bx]
	sub	ah, ah
	mov	bx, [bp+arg_2]
	mov	cl, itemEquipMask[bx]
	sub	ch, ch
	test	ax, cx
	jz	short loc_17F78
	sub	ax, ax
	jmp	short loc_17F7B
loc_17F78:
	mov	ax, itemFlag_unequipable
loc_17F7B:
	mov	[bp+var_2], ax
	mov	al, [bp+arg_4]
	or	al, byte ptr [bp+var_2]
	mov	cx, ax
	getCharP	[bp+charNo], bx
	add	bx, [bp+var_4]
	mov	gs:roster.inventory.itemFlags[bx], cl
	mov	al, byte ptr [bp+arg_2]
	mov	cx, ax
	getCharP	[bp+charNo], bx
	add	bx, [bp+var_4]
	mov	gs:roster.inventory.itemNo[bx],	cl
	mov	al, [bp+arg_6]
	mov	cx, ax
	getCharP	[bp+charNo], bx
	add	bx, [bp+var_4]
	mov	gs:roster.inventory.itemCount[bx], cl
	mov	ax, 1
	jmp	short loc_17FCC
loc_17FC5:
	jmp	loc_17F2E
loc_17FC8:
	sub	ax, ax
	jmp	short $+2
loc_17FCC:
	mov	sp, bp
	pop	bp
	retf
inven_addItem endp

; This function	returns	1 if the item can be
; used.
; Attributes: bp-based frame

item_canBeUsed proc far

	var_2= word ptr	-2
	charNo=	word ptr  6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	getCharIndex	ax, [bp+charNo]
	mov	bx, [bp+arg_2]
	mov	cx, bx
	shl	bx, 1
	add	bx, cx
	add	bx, ax
	mov	al, gs:roster.inventory.itemFlags[bx]
	and	al, 3
	cmp	al, 2
	jnz	short loc_17FFF
	sub	ax, ax
	jmp	short loc_18073
loc_17FFF:
	getCharIndex	ax, [bp+charNo]
	mov	bx, [bp+arg_2]
	mov	cx, bx
	shl	bx, 1
	add	bx, cx
	add	bx, ax
	mov	al, gs:roster.inventory.itemNo[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	bx, ax
	mov	al, itemSpellNo[bx]
	mov	curSpellNo, ax
	cmp	ax, 0FFh
	jnz	short loc_18031
	sub	ax, ax
	jmp	short loc_18073
loc_18031:
	getCharIndex	ax, [bp+charNo]
	mov	bx, [bp+arg_2]
	mov	cx, bx
	shl	bx, 1
	add	bx, cx
	add	bx, ax
	cmp	gs:roster.inventory.itemCount[bx], 0
	jnz	short loc_18052
	sub	ax, ax
	jmp	short loc_18073
loc_18052:
	mov	bx, [bp+var_2]
	cmp	itemTypeList[bx], itType_quiver
	jnz	short loc_1806E
	mov	ax, itType_bow
	push	ax
	push	[bp+charNo]
	push	cs
	call	near ptr sub_18077
	add	sp, 4
	jmp	short loc_18073
	jmp	short loc_18073
loc_1806E:
	mov	ax, 1
	jmp	short $+2
loc_18073:
	mov	sp, bp
	pop	bp
	retf
item_canBeUsed endp

; Attributes: bp-based frame

sub_18077 proc far

	var_4= word ptr	-4
	counter= word ptr -2
	playerNo= word ptr  6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	[bp+counter], 0
	jmp	short loc_1808D
loc_18089:
	add	[bp+counter], 3
loc_1808D:
	cmp	[bp+counter], inventorySize
	jge	short loc_180DD
	getCharP	[bp+playerNo], bx
	add	bx, [bp+counter]
	mov	al, gs:roster.inventory.itemNo[bx]
	sub	ah, ah
	mov	[bp+var_4], ax
	mov	bx, ax
	mov	al, itemTypeList[bx]
	and	ax, 0Fh
	cmp	ax, [bp+arg_2]
	jnz	short loc_180DB
	cmp	[bp+arg_2], itType_weapon
	jnz	short loc_180D6
	getCharP	[bp+playerNo], bx
	add	bx, [bp+counter]
	mov	al, gs:roster.inventory.itemFlags[bx]
	and	al, 3
	cmp	al, itemFlag_equipped
	jnz	short loc_180DB
loc_180D6:
	mov	ax, 1
	jmp	short loc_180E1
loc_180DB:
	jmp	short loc_18089
loc_180DD:
	sub	ax, ax
	jmp	short $+2
loc_180E1:
	mov	sp, bp
	pop	bp
	retf
sub_18077 endp

; Attributes: bp-based frame

inven_hasTypeEquipped proc far

	var_4= word ptr	-4
	counter= word ptr -2
	playerNo= word ptr  6
	itemType= word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	[bp+counter], 0
	jmp	short loc_180FB
loc_180F7:
	add	[bp+counter], 3
loc_180FB:
	cmp	[bp+counter], inventorySize
	jge	short loc_18145
	getCharP	[bp+playerNo], bx
	add	bx, [bp+counter]
	mov	al, gs:roster.inventory.itemNo[bx]
	sub	ah, ah
	mov	[bp+var_4], ax
	mov	bx, ax
	mov	al, itemTypeList[bx]
	and	ax, 0Fh
	cmp	ax, [bp+itemType]
	jnz	short loc_18143
	getCharP	[bp+playerNo], bx
	add	bx, [bp+counter]
	mov	al, gs:roster.inventory.itemFlags[bx]
	and	al, 3
	cmp	al, itemFlag_equipped
	jnz	short loc_18143
	mov	ax, 1
	jmp	short loc_18149
loc_18143:
	jmp	short loc_180F7
loc_18145:
	sub	ax, ax
	jmp	short $+2
loc_18149:
	mov	sp, bp
	pop	bp
	retf
inven_hasTypeEquipped endp

; This function	returns	the slot number	of an equipped
; item that matches the	type requested
; Attributes: bp-based frame

inven_getTypeEqSlot proc far

	var_4= word ptr	-4
	counter= word ptr -2
	playerNo= word ptr  6
	itemType= word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	[bp+counter], 0
	jmp	short loc_18163
loc_1815F:
	add	[bp+counter], 3
loc_18163:
	cmp	[bp+counter], inventorySize
	jge	short loc_181AD
	getCharP	[bp+playerNo], bx
	add	bx, [bp+counter]
	mov	al, gs:roster.inventory.itemNo[bx]
	sub	ah, ah
	mov	[bp+var_4], ax
	mov	bx, ax
	mov	al, itemTypeList[bx]
	and	ax, 0Fh
	cmp	ax, [bp+itemType]
	jnz	short loc_181AB
	getCharP	[bp+playerNo], bx
	add	bx, [bp+counter]
	mov	al, gs:roster.inventory.itemFlags[bx]
	and	al, 3
	cmp	al, itemFlag_equipped
	jnz	short loc_181AB
	mov	ax, [bp+var_4]
	jmp	short loc_181B2
loc_181AB:
	jmp	short loc_1815F
loc_181AD:
	mov	ax, 0FFFFh
	jmp	short $+2
loc_181B2:
	mov	sp, bp
	pop	bp
	retf
inven_getTypeEqSlot endp

; Attributes: bp-based frame

printCharacter proc far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	call	findEmptyRosterNum
	mov	[bp+var_2], ax
	cmp	[bp+arg_0], ax
	jl	short loc_181D1
	jmp	loc_18302
loc_181D1:
	getCharP	[bp+arg_0], bx
	mov	al, gs:roster.picIndex[bx]
	sub	ah, ah
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
	getCharP	[bp+arg_0], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	setTitle
	add	sp, 4
loc_18206:
	push	[bp+var_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr printCharStats
	add	sp, 4
	mov	[bp+var_4], 0
	mov	al, gs:txt_numLines
	sub	ah, ah
	sub	ax, 2
	mov	[bp+var_8], ax
	jmp	short loc_1822D
loc_1822A:
	inc	[bp+var_8]
loc_1822D:
	mov	al, gs:txt_numLines
	sub	ah, ah
	cmp	ax, [bp+var_8]
	jb	short loc_1824F
	mov	bx, [bp+var_8]
	shl	bx, 1
	mov	ax, bitMask16bit[bx]
	or	[bp+var_4], ax
	jmp	short loc_1822A
loc_1824F:
	push	[bp+var_4]
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_6], ax
	cmp	ax, 50h	
	jz	short loc_18274
	mov	al, gs:txt_numLines
	sub	ah, ah
	add	ax, 10Ch
	cmp	ax, [bp+var_6]
	jnz	short loc_18284
loc_18274:
	push	[bp+var_2]
	push	[bp+arg_0]
	call	doPoolGold
	add	sp, 4
	jmp	short loc_182A9
loc_18284:
	cmp	[bp+var_6], 54h	
	jz	short loc_1829C
	mov	al, gs:txt_numLines
	sub	ah, ah
	add	ax, 10Dh
	cmp	ax, [bp+var_6]
	jnz	short loc_182A9
loc_1829C:
	push	[bp+var_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr getGoldTradee
	add	sp, 4
loc_182A9:
	cmp	[bp+var_6], 1Bh
	jz	short loc_182C4
	mov	al, gs:txt_numLines
	sub	ah, ah
	add	ax, 10Eh
	cmp	ax, [bp+var_6]
	jz	short loc_182C4
	jmp	loc_18206
loc_182C4:
	call	clearTextWindow
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.class[bx], class_monster
	jnb	short loc_182EA
	push	[bp+var_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr printInventoryScreen
	add	sp, 4
loc_182EA:
	push	[bp+arg_0]
	push	cs
	call	near ptr charHasSpecialAbils
	add	sp, 2
	or	ax, ax
	jz	short loc_18302
	push	[bp+arg_0]
	push	cs
	call	near ptr printCharAbilities
	add	sp, 2
loc_18302:
	mov	sp, bp
	pop	bp
	retf
printCharacter endp

; Attributes: bp-based frame

sub_18306 proc far

	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], 20h
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], 23h
	mov	ax, 2
	push	ax
	mov	ax, [bp+arg_4]
	cwd
	push	dx
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	call	_itoa
	add	sp, 0Ah
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_18306 endp

; Attributes: bp-based frame
item_trade proc	far

	var_4E=	word ptr -4Eh
	var_4C=	word ptr -4Ch
	var_4A=	word ptr -4Ah
	var_48=	word ptr -48h
	var_46=	word ptr -46h
	var_44=	word ptr -44h
	var_42=	word ptr -42h
	var_40=	word ptr -40h
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 4Eh	
	call	someStackOperation
	mov	ax, offset aWhoDoes
	push	ds
	push	ax
	lea	ax, [bp+var_40]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_44], ax
	mov	[bp+var_42], dx
	getCharP	[bp+arg_0], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	[bp+var_42]
	push	[bp+var_44]
	call	_strcat
	add	sp, 8
	mov	[bp+var_44], ax
	mov	[bp+var_42], dx
	mov	ax, offset aWantToGiveItTo
	push	ds
	push	ax
	push	dx
	push	[bp+var_44]
	call	_strcat
	add	sp, 8
	mov	[bp+var_44], ax
	mov	[bp+var_42], dx
	lea	ax, [bp+var_40]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_4E], ax
	or	ax, ax
	jge	short loc_183BD
	jmp	loc_1844C
loc_183BD:
	mov	ax, [bp+arg_2]
	mov	cx, ax
	shl	ax, 1
	add	ax, cx
	mov	[bp+var_4A], ax
	getCharP	[bp+arg_0], bx
	add	bx, [bp+var_4A]
	mov	al, gs:[bx+62h]
	sub	ah, ah
	and	ax, 0FCh
	mov	[bp+var_46], ax
	getCharP	[bp+arg_0], bx
	add	bx, [bp+var_4A]
	mov	al, gs:[bx+63h]
	sub	ah, ah
	mov	[bp+var_4C], ax
	getCharP	[bp+arg_0], bx
	add	bx, [bp+var_4A]
	mov	al, gs:[bx+64h]
	sub	ah, ah
	mov	[bp+var_48], ax
	push	ax
	push	[bp+var_46]
	push	[bp+var_4C]
	push	[bp+var_4E]
	push	cs
	call	near ptr inven_addItem
	add	sp, 8
	or	ax, ax
	jz	short loc_18433
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr item_discard
	add	sp, 4
	jmp	short loc_1844C
loc_18433:
	mov	ax, offset aAllFull
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
loc_1844C:
	mov	sp, bp
	pop	bp
	retf
item_trade endp

; Attributes: bp-based frame

item_discard proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, [bp+arg_2]
	mov	cx, ax
	shl	ax, 1
	add	ax, cx
	mov	gs:word_42416, ax
	mov	ax, [bp+arg_0]
	mov	gs:word_4244C, ax
	push	cs
	call	near ptr inven_pack
	mov	sp, bp
	pop	bp
	retf
item_discard endp

; Attributes: bp-based frame

	item_equip proc	far
	itemType= word ptr -0Ah
	var_8= word ptr	-8
	counter= word ptr -6
	itemNo=	word ptr -4
	playerNo= word ptr  6
	slotNo=	word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 0Ah
	call	someStackOperation
	getCharIndex	ax, [bp+playerNo]
	mov	bx, [bp+slotNo]
	mov	cx, bx
	shl	bx, 1
	add	bx, cx
	add	bx, ax
	mov	al, gs:roster.inventory.itemNo[bx]
	sub	ah, ah
	mov	[bp+itemNo], ax
	mov	bx, ax
	mov	al, itemTypeList[bx]
	and	ax, 0Fh
	mov	[bp+itemType], ax
	or	ax, ax
	jnz	short loc_184BB
	jmp	loc_18555
loc_184BB:
	getCharIndex	ax, [bp+playerNo]
	mov	bx, cx
	shl	bx, 1
	add	bx, cx
	add	bx, ax
	and	gs:roster.inventory.itemFlags[bx], 0FCh
	getCharIndex	ax, [bp+playerNo]
	mov	bx, [bp+slotNo]
	mov	cx, bx
	shl	bx, 1
	add	bx, cx
	add	bx, ax
	or	gs:roster.inventory.itemFlags[bx], itemFlag_equipped
	mov	[bp+counter], 0
	jmp	short loc_184F1
loc_184ED:
	add	[bp+counter], 3
loc_184F1:
	cmp	[bp+counter], 36
	jge	short loc_18555
	mov	ax, [bp+slotNo]
	mov	cx, ax
	shl	ax, 1
	add	ax, cx
	cmp	ax, [bp+counter]
	jz	short loc_18553
	getCharP	[bp+playerNo], bx
	add	bx, [bp+counter]
	mov	al, gs:roster.inventory.itemNo[bx]
	sub	ah, ah
	mov	[bp+var_8], ax
	mov	bx, ax
	mov	al, itemTypeList[bx]
	and	ax, 0Fh
	cmp	ax, [bp+itemType]
	jnz	short loc_18553
	getCharP	[bp+playerNo], bx
	add	bx, [bp+counter]
	mov	al, gs:roster.inventory.itemFlags[bx]
	and	al, 3
	cmp	al, 2
	jz	short loc_18553
	getCharP	[bp+playerNo], bx
	add	bx, [bp+counter]
	and	gs:roster.inventory.itemFlags[bx], 0FCh
loc_18553:
	jmp	short loc_184ED
loc_18555:
	mov	sp, bp
	pop	bp
	retf
item_equip endp

; Attributes: bp-based frame

item_unequip proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	getCharIndex	ax, [bp+arg_0]
	mov	bx, [bp+arg_2]
	mov	cx, bx
	shl	bx, 1
	add	bx, cx
	add	bx, ax
	and	gs:roster.inventory.itemFlags[bx], 0FCh
	getCharIndex	ax, [bp+arg_0]
	mov	bx, [bp+arg_2]
	mov	cx, bx
	shl	bx, 1
	add	bx, cx
	add	bx, ax
	mov	al, gs:roster.inventory.itemNo[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	bx, ax
	mov	al, itemTypeList[bx]
	and	al, 0Fh
	cmp	al, 6
	jnz	short loc_185B1
	push	[bp+arg_0]
	call	song_stopPlaying
	add	sp, 2
loc_185B1:
	mov	sp, bp
	pop	bp
	retf
item_unequip endp

; Attributes: bp-based frame

item_identify proc far

	var_46=	word ptr -46h
	var_44=	word ptr -44h
	var_4= dword ptr -4
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 46h	
	call	someStackOperation
	getCharP	[bp+arg_0], bx
	test	gs:roster.status[bx], 1Ch
	jz	short loc_185D7
	jmp	loc_18699
loc_185D7:
	getCharP	[bp+arg_0], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, [bp+var_44]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	mov	ax, [bp+arg_2]
	mov	cx, ax
	shl	ax, 1
	add	ax, cx
	mov	[bp+var_46], ax
	call	_random
	mov	cx, ax
	getCharP	[bp+arg_0], bx
	cmp	gs:(roster.specAbil+1)[bx], cl
	jbe	short loc_18634
	getCharP	[bp+arg_0], bx
	add	bx, [bp+var_46]
	and	gs:roster.inventory.itemFlags[bx], 3Fh
	jmp	short loc_18645
loc_18634:
	getCharP	[bp+arg_0], bx
	add	bx, [bp+var_46]
	or	gs:roster.inventory.itemFlags[bx], 40h
loc_18645:
	getCharP	[bp+arg_0], bx
	add	bx, [bp+var_46]
	cmp	gs:roster.inventory.itemFlags[bx], 80h
	jb	short loc_1865D
	mov	ax, 1
	jmp	short loc_1865F
loc_1865D:
	sub	ax, ax
loc_1865F:
	push	ax
	push	word ptr [bp+var_4+2]
	push	word ptr [bp+var_4]
	mov	ax, offset aTriesToIdentif
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	lfs	bx, [bp+var_4]
	mov	byte ptr fs:[bx], 0
	lea	ax, [bp+var_44]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	wait4IO
loc_18699:
	mov	sp, bp
	pop	bp
	retf
item_identify endp

; Attributes: bp-based frame

printInventoryScreen proc far

	var_116= word ptr -116h
	var_114= word ptr -114h
	var_112= word ptr -112h
	var_52=	word ptr -52h
	var_50=	word ptr -50h
	var_4E=	word ptr -4Eh
	var_4C=	word ptr -4Ch
	var_1C=	word ptr -1Ch
	var_1A=	word ptr -1Ah
	var_14=	word ptr -14h
	var_E= word ptr	-0Eh
	var_C= word ptr	-0Ch
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 116h
	call	someStackOperation
	push	si
loc_186A9:
	lea	ax, [bp+var_4C]
	push	ss
	push	ax
	lea	ax, [bp+var_112]
	push	ss
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_188E8
	add	sp, 0Ah
	mov	[bp+var_50], ax
	or	ax, ax
	jnz	short loc_186E1
	mov	ax, offset aYourPocketsAreEm
	push	ds
	push	ax
	call	printString
	add	sp, 4
	wait4IO
	jmp	loc_18832
loc_186E1:
	push	[bp+var_50]
	lea	ax, [bp+var_4C]
	push	ss
	push	ax
	mov	ax, offset aInventory
	push	ds
	push	ax
	call	printStringGetInput
	add	sp, 0Ah
	mov	[bp+var_1C], ax
	call	clearTextWindow
	cmp	[bp+var_1C], 0
	jge	short loc_18707
	jmp	loc_18832
loc_18707:
	push	[bp+var_1C]
	push	[bp+arg_0]
	lea	ax, [bp+var_14]
	push	ss
	push	ax
	push	cs
	call	near ptr inven_getInvOptions
	add	sp, 8
	call	clearTextWindow
	lea	ax, [bp+var_C]
	push	ss
	push	ax
	lea	ax, [bp+var_1A]
	push	ss
	push	ax
	lea	ax, [bp+var_14]
	push	ss
	push	ax
	mov	ax, offset aDoYouWishTo@tr
	push	ds
	push	ax
	call	printVarString
	add	sp, 10h
	mov	[bp+var_4E], ax
	getCharIndex	ax, [bp+arg_0]
	mov	bx, [bp+var_1C]
	mov	cx, bx
	shl	bx, 1
	add	bx, cx
	add	bx, ax
	cmp	gs:roster.inventory.itemNo[bx],	76h 
	jz	short loc_18770
	getCharIndex	ax, [bp+arg_0]
	mov	bx, cx
	shl	bx, 1
	add	bx, cx
	add	bx, ax
	cmp	gs:roster.inventory.itemNo[bx],	7Dh 
	jnz	short loc_187B8
loc_18770:
	getCharIndex	ax, [bp+arg_0]
	mov	bx, [bp+var_1C]
	mov	cx, bx
	shl	bx, 1
	add	bx, cx
	add	bx, ax
	mov	al, gs:roster.inventory.itemFlags[bx]
	sub	ah, ah
	shr	ax, 1
	shr	ax, 1
	and	ax, 0Fh
	mov	[bp+var_116], ax
	mov	ax, offset aItSFilledWith
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	bx, [bp+var_116]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (wineskinString+2)[bx]
	push	word ptr wineskinString[bx]
	call	printString
	add	sp, 4
loc_187B8:
	push	[bp+var_4E]
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_E], ax
	cmp	ax, 1Bh
	jnz	short loc_187D3
	mov	[bp+var_114], 1
	jmp	short loc_18828
loc_187D3:
	mov	[bp+var_114], 0
	mov	[bp+var_52], 0
loc_187DE:
	mov	si, [bp+var_52]
	cmp	byte ptr [bp+si+var_1A], 0
	jz	short loc_18828
	mov	al, byte ptr [bp+si+var_1A]
	cbw
	cmp	ax, [bp+var_E]
	jz	short loc_187FA
	shl	si, 1
	mov	ax, [bp+var_E]
	cmp	[bp+si+var_C], ax
	jnz	short loc_18823
loc_187FA:
	call	clearTextWindow
	push	[bp+var_1C]
	push	[bp+arg_0]
	mov	bx, [bp+var_52]
	shl	bx, 1
	shl	bx, 1
	call	off_46C1A[bx]
	add	sp, 4
	mov	byte ptr word_44166,	0
	mov	[bp+var_114], 1
loc_18823:
	inc	[bp+var_52]
	jmp	short loc_187DE
loc_18828:
	cmp	[bp+var_114], 0
	jz	short loc_187B8
	jmp	loc_186A9
loc_18832:
	pop	si
	mov	sp, bp
	pop	bp
	retf
printInventoryScreen endp

; Attributes: bp-based frame

inven_getInvOptions proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah
	arg_6= word ptr	 0Ch

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	getCharIndex	ax, [bp+arg_4]
	mov	bx, [bp+arg_6]
	mov	cx, bx
	shl	bx, 1
	add	bx, cx
	add	bx, ax
	mov	al, gs:roster.inventory.itemFlags[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	al, byte ptr [bp+var_2]
	and	al, 3
	cmp	al, 1
	jnz	short loc_1886F
	mov	al, 1
	jmp	short loc_18871
loc_1886F:
	sub	al, al
loc_18871:
	lfs	bx, [bp+arg_0]
	mov	fs:[bx+3], al
	mov	[bp+var_4], 0
	jmp	short loc_18882
loc_1887F:
	inc	[bp+var_4]
loc_18882:
	cmp	[bp+var_4], 3
	jge	short loc_1889F
	lfs	bx, [bp+arg_0]
	cmp	byte ptr fs:[bx+3], 1
	sbb	ax, ax
	neg	ax
	mov	bx, [bp+var_4]
	mov	si, word ptr [bp+arg_0]
	mov	fs:[bx+si], al
	jmp	short loc_1887F
loc_1889F:
	lfs	bx, [bp+arg_0]
	mov	byte ptr fs:[bx+4], 0
	lfs	bx, [bp+arg_0]
	cmp	byte ptr fs:[bx], 0
	jz	short loc_188E3
	mov	al, byte ptr [bp+var_2]
	and	al, 3
	cmp	al, 2
	jnz	short loc_188BE
	mov	byte ptr fs:[bx+2], 0
loc_188BE:
	mov	al, byte ptr [bp+var_2]
	and	al, 0C0h
	cmp	al, 80h
	jnz	short loc_188E3
	getCharP	[bp+arg_4], bx
	cmp	gs:roster.class[bx], class_rogue
	jnz	short loc_188E3
	lfs	bx, [bp+arg_0]
	mov	byte ptr fs:[bx+4], 1
loc_188E3:
	pop	si
	mov	sp, bp
	pop	bp
	retf
inven_getInvOptions endp

; Attributes: bp-based frame

sub_188E8 proc far

	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= dword ptr  8
	arg_6= dword ptr  0Ch

	push	bp
	mov	bp, sp
	mov	ax, 0Ah
	call	someStackOperation
	push	si
	mov	[bp+var_6], 0
	mov	[bp+var_4], 0
	jmp	short loc_18904
loc_18900:
	add	[bp+var_4], 3
loc_18904:
	cmp	[bp+var_4], inventorySize
	jl	short loc_1890D
	jmp	loc_18A2A
loc_1890D:
	getCharP	[bp+arg_0], bx
	add	bx, [bp+var_4]
	cmp	gs:roster.inventory.itemNo[bx],	0
	jnz	short loc_18927
	jmp	loc_18A22
loc_18927:
	getCharP	[bp+arg_0], bx
	add	bx, [bp+var_4]
	mov	al, gs:roster.inventory.itemFlags[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	bx, [bp+var_6]
	inc	[bp+var_6]
	shl	bx, 1
	shl	bx, 1
	lfs	si, [bp+arg_6]
	mov	ax, word ptr [bp+arg_2]
	mov	dx, word ptr [bp+arg_2+2]
	mov	fs:[bx+si], ax
	mov	fs:[bx+si+2], dx
	cmp	[bp+var_2], itemFlag_identified
	jl	short loc_18968
	test	byte ptr [bp+var_2], 3
	jnz	short loc_18968
	mov	[bp+var_2], 3
loc_18968:
	lfs	bx, [bp+arg_2]
	inc	word ptr [bp+arg_2]
	mov	si, [bp+var_2]
	and	si, 3
	mov	al, itemCharFlags[si]
	mov	fs:[bx], al
	getCharP	[bp+arg_0], bx
	add	bx, [bp+var_4]
	mov	al, gs:roster.inventory.itemNo[bx]
	sub	ah, ah
	mov	[bp+var_A], ax
	getCharP	[bp+arg_0], bx
	add	bx, [bp+var_4]
	mov	al, gs:roster.inventory.itemFlags[bx]
	sub	ah, ah
	push	ax
	push	[bp+var_A]
	push	word ptr [bp+arg_2+2]
	push	word ptr [bp+arg_2]
	push	cs
	call	near ptr item_getName
	add	sp, 8
	mov	word ptr [bp+arg_2], ax
	mov	word ptr [bp+arg_2+2], dx
	getCharP	[bp+arg_0], bx
	add	bx, [bp+var_4]
	mov	al, gs:roster.inventory.itemCount[bx]
	sub	ah, ah
	mov	[bp+var_8], ax
	cmp	ax, 0FFh
	jz	short loc_18A16
	cmp	ax, 1
	jz	short loc_189F6
	push	ax
	push	word ptr [bp+arg_2+2]
	push	word ptr [bp+arg_2]
	push	cs
	call	near ptr sub_18306
	add	sp, 6
	mov	word ptr [bp+arg_2], ax
	mov	word ptr [bp+arg_2+2], dx
	jmp	short loc_18A16
loc_189F6:
	mov	bx, [bp+var_A]
	cmp	byte_464B8[bx],	1
	jz	short loc_18A16
	push	[bp+var_8]
	push	word ptr [bp+arg_2+2]
	push	word ptr [bp+arg_2]
	push	cs
	call	near ptr sub_18306
	add	sp, 6
	mov	word ptr [bp+arg_2], ax
	mov	word ptr [bp+arg_2+2], dx
loc_18A16:
	lfs	bx, [bp+arg_2]
	inc	word ptr [bp+arg_2]
	mov	byte ptr fs:[bx], 0
	jmp	short loc_18A27
loc_18A22:
	mov	ax, [bp+var_6]
	jmp	short loc_18A2F
loc_18A27:
	jmp	loc_18900
loc_18A2A:
	mov	ax, [bp+var_6]
	jmp	short $+2
loc_18A2F:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_188E8 endp

; Attributes: bp-based frame

item_getName proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	itemNo=	word ptr  0Ah
	itemFlags= byte	ptr  0Ch

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	test	[bp+itemFlags],	itemFlag_identified
	jz	short loc_18A74
	mov	bx, [bp+itemNo]
	mov	al, itemTypeList[bx]
	sub	ah, ah
	and	ax, 0Fh
	mov	[bp+var_2], ax
	mov	bx, ax
	shl	bx, 1
	shl	bx, 1
	push	word ptr (genericItemStr+2)[bx]
	push	word ptr genericItemStr[bx]
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	_strcat
	add	sp, 8
	jmp	short loc_18A93
	jmp	short loc_18A93
loc_18A74:
	mov	bx, [bp+itemNo]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (itemStr+2)[bx]
	push	word ptr itemStr[bx]
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	_strcat
	add	sp, 8
	jmp	short $+2
loc_18A93:
	mov	sp, bp
	pop	bp
	retf
item_getName endp

; Attributes: bp-based frame

printCharStats proc far

	var_DC=	word ptr -0DCh
	var_28=	word ptr -28h
	var_26=	word ptr -26h
	var_1C=	word ptr -1Ch
	var_1A=	dword ptr -1Ah
	var_16=	dword ptr -16h
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 0DEh 
	call	someStackOperation
	push	si
	call	clearTextWindow
	getCharP	[bp+arg_0], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, [bp+var_DC]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_1A], ax
	mov	word ptr [bp+var_1A+2],	dx
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.class[bx], class_illusion
	jz	short loc_18AE6
	mov	ax, 1
	jmp	short loc_18AE8
loc_18AE6:
	sub	ax, ax
loc_18AE8:
	push	ax
	push	word ptr [bp+var_1A+2]
	push	word ptr [bp+var_1A]
	mov	ax, offset aIsAN
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	word ptr [bp+var_1A], ax
	mov	word ptr [bp+var_1A+2],	dx
	lfs	bx, [bp+var_1A]
	mov	byte ptr fs:[bx], 20h
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.class[bx], 0Dh
	jb	short loc_18B20
	jmp	loc_18BE9
loc_18B20:
	mov	ax, offset aLevel
	push	ds
	push	ax
	push	word ptr [bp+var_1A+2]
	push	word ptr [bp+var_1A]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_1A], ax
	mov	word ptr [bp+var_1A+2],	dx
	mov	ax, 3
	push	ax
	getCharP	[bp+arg_0], bx
	sub	ax, ax
	push	ax
	push	gs:roster.level[bx]
	push	word ptr [bp+var_1A+2]
	push	word ptr [bp+var_1A]
	call	_itoa
	add	sp, 0Ah
	mov	word ptr [bp+var_1A], ax
	mov	word ptr [bp+var_1A+2],	dx
	lfs	bx, [bp+var_1A]
	inc	word ptr [bp+var_1A]
	mov	byte ptr fs:[bx], 20h
	getCharP	[bp+arg_0], bx
	mov	bl, gs:roster.gender[bx]
	sub	bh, bh
	shl	bx, 1
	shl	bx, 1
	push	word ptr (genderString+2)[bx]
	push	word ptr genderString[bx]
	push	word ptr [bp+var_1A+2]
	push	word ptr [bp+var_1A]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_1A], ax
	mov	word ptr [bp+var_1A+2],	dx
	lfs	bx, [bp+var_1A]
	inc	word ptr [bp+var_1A]
	mov	byte ptr fs:[bx], 20h
	getCharP	[bp+arg_0], bx
	mov	bl, gs:roster.race[bx]
	sub	bh, bh
	shl	bx, 1
	shl	bx, 1
	push	word ptr (raceString+2)[bx]
	push	word ptr raceString[bx]
	push	word ptr [bp+var_1A+2]
	push	word ptr [bp+var_1A]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_1A], ax
	mov	word ptr [bp+var_1A+2],	dx
	lfs	bx, [bp+var_1A]
	inc	word ptr [bp+var_1A]
	mov	byte ptr fs:[bx], 20h
loc_18BE9:
	getCharP	[bp+arg_0], bx
	mov	bl, gs:roster.class[bx]
	sub	bh, bh
	shl	bx, 1
	shl	bx, 1
	push	word ptr (classString+2)[bx]
	push	word ptr classString[bx]
	push	word ptr [bp+var_1A+2]
	push	word ptr [bp+var_1A]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_1A], ax
	mov	word ptr [bp+var_1A+2],	dx
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.class[bx], class_monster
	jnb	short loc_18C9F
	getCharIndex	ax, [bp+arg_0]
	add	ax, offset roster.strength
	mov	word ptr [bp+var_16], ax
	mov	word ptr [bp+var_16+2],	seg seg027
	mov	[bp+var_28], 0
	jmp	short loc_18C51
loc_18C4E:
	inc	[bp+var_28]
loc_18C51:
	cmp	[bp+var_28], 5
	jge	short loc_18C6B
	mov	bx, [bp+var_28]
	lfs	si, [bp+var_16]
	mov	al, fs:[bx+si]
	sub	ah, ah
	mov	si, bx
	shl	si, 1
	mov	[bp+si+var_26],	ax
	jmp	short loc_18C4E
loc_18C6B:
	getCharP	[bp+arg_0], bx
	mov	ax, gs:roster.currentHP[bx]
	mov	[bp+var_1C], ax
	lfs	bx, [bp+var_1A]
	inc	word ptr [bp+var_1A]
	mov	byte ptr fs:[bx], 0Ah
	mov	ax, 5
	push	ax
	push	word ptr [bp+var_1A+2]
	push	word ptr [bp+var_1A]
	lea	ax, [bp+var_26]
	push	ss
	push	ax
	push	cs
	call	near ptr getAttributeString
	add	sp, 0Ah
loc_18C9F:
	lea	ax, [bp+var_DC]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.class[bx], class_monster
	jnb	short loc_18D0B
	lea	ax, [bp+var_DC]
	push	ss
	push	ax
	getCharP	[bp+arg_0], bx
	sub	ax, ax
	push	ax
	push	gs:roster.maxSppt[bx]
	mov	ax, offset aSpellPoints
	push	ds
	push	ax
	push	cs
	call	near ptr printNumberAndString
	add	sp, 0Ch
	lea	ax, [bp+var_DC]
	push	ss
	push	ax
	getCharP	[bp+arg_0], bx
	push	word ptr gs:(roster.experience+2)[bx]
	push	word ptr gs:roster.experience[bx]
	mov	ax, offset aExpr
	push	ds
	push	ax
	push	cs
	call	near ptr printNumberAndString
	add	sp, 0Ch
loc_18D0B:
	lea	ax, [bp+var_DC]
	push	ss
	push	ax
	getCharP	[bp+arg_0], bx
	push	word ptr gs:(roster.gold+2)[bx]
	push	word ptr gs:roster.gold[bx]
	mov	ax, offset aGold
	push	ds
	push	ax
	push	cs
	call	near ptr printNumberAndString
	add	sp, 0Ch
	mov	ax, offset aPoolGoldTradeG
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	ax, offset aEscToContinue
	push	ds
	push	ax
	call	printString
	add	sp, 4
	pop	si
	mov	sp, bp
	pop	bp
	retf
printCharStats endp

; Attributes: bp-based frame

printNumberAndString proc far

	var_4= dword ptr -4
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah
	arg_6= word ptr	 0Ch
	arg_8= word ptr	 0Eh
	arg_A= word ptr	 10h

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	[bp+arg_A]
	push	[bp+arg_8]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	sub	ax, ax
	push	ax
	push	[bp+arg_6]
	push	[bp+arg_4]
	push	dx
	push	word ptr [bp+var_4]
	call	_itoa
	add	sp, 0Ah
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	lfs	bx, [bp+var_4]
	mov	byte ptr fs:[bx], 0
	push	[bp+arg_A]
	push	[bp+arg_8]
	call	printString
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
printNumberAndString endp

; Attributes: bp-based frame
getAttributeString proc	far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= dword ptr -4
	arg_0= dword ptr  6
	arg_4= dword ptr  0Ah
	arg_8= word ptr	 0Eh

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	mov	ax, offset aStiqdxcnlkhp
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], ds
	mov	[bp+var_8], 0
	jmp	short loc_18DC9
loc_18DC6:
	inc	[bp+var_8]
loc_18DC9:
	mov	ax, [bp+arg_8]
	cmp	[bp+var_8], ax
	jl	short loc_18DD4
	jmp	loc_18E54
loc_18DD4:
	lfs	bx, [bp+var_4]
	inc	word ptr [bp+var_4]
	mov	al, fs:[bx]
	lfs	bx, [bp+arg_4]
	inc	word ptr [bp+arg_4]
	mov	fs:[bx], al
	lfs	bx, [bp+var_4]
	inc	word ptr [bp+var_4]
	mov	al, fs:[bx]
	lfs	bx, [bp+arg_4]
	inc	word ptr [bp+arg_4]
	mov	fs:[bx], al
	lfs	bx, [bp+arg_4]
	inc	word ptr [bp+arg_4]
	mov	byte ptr fs:[bx], 3Ah
	lfs	bx, [bp+arg_0]
	add	word ptr [bp+arg_0], 2
	mov	ax, fs:[bx]
	mov	[bp+var_6], ax
	cmp	ax, 63h	
	jle	short loc_18E19
	mov	[bp+var_6], 63h	
loc_18E19:
	cmp	[bp+var_6], 0Ah
	jge	short loc_18E29
	lfs	bx, [bp+arg_4]
	inc	word ptr [bp+arg_4]
	mov	byte ptr fs:[bx], 20h ;	' '
loc_18E29:
	mov	ax, 2
	push	ax
	mov	ax, [bp+var_6]
	cwd
	push	dx
	push	ax
	push	word ptr [bp+arg_4+2]
	push	word ptr [bp+arg_4]
	call	_itoa
	add	sp, 0Ah
	mov	word ptr [bp+arg_4], ax
	mov	word ptr [bp+arg_4+2], dx
	lfs	bx, [bp+arg_4]
	inc	word ptr [bp+arg_4]
	mov	byte ptr fs:[bx], 20h
	jmp	loc_18DC6
loc_18E54:
	lfs	bx, [bp+arg_4]
	mov	byte ptr fs:[bx], 0
	mov	sp, bp
	pop	bp
	retf
getAttributeString endp

; Attributes: bp-based frame

getGoldTradee proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	call	clearTextWindow
	mov	ax, offset aTradeGoldToWho
	push	ds
	push	ax
	call	printString
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_2], ax
	or	ax, ax
	jl	short loc_18E91
	mov	ax, [bp+arg_2]
	cmp	[bp+var_2], ax
	jle	short loc_18E94
loc_18E91:
	jmp	loc_18F1E
loc_18E94:
	call	clearTextWindow
	mov	ax, offset aHowMuchGoldWil
	push	ds
	push	ax
	call	printString
	add	sp, 4
	call	sub_16001
	mov	[bp+var_6], ax
	mov	[bp+var_4], dx
	or	dx, ax
	jnz	short loc_18EB7
	jmp	short loc_18F1E
loc_18EB7:
	push	[bp+var_4]
	push	[bp+var_6]
	push	[bp+arg_0]
	call	payGold
	add	sp, 6
	or	ax, ax
	jnz	short loc_18EE0
	call	clearTextWindow
	mov	ax, offset aNotEnoughGold_
	push	ds
	push	ax
	call	printString
	add	sp, 4
	jmp	short loc_18F1E
loc_18EE0:
	mov	ax, [bp+var_6]
	mov	dx, [bp+var_4]
	mov	cx, ax
	mov	bx, dx
	getCharP	[bp+var_2], si
	add	word ptr gs:roster.gold[si], cx
	adc	word ptr gs:(roster.gold+2)[si], bx
	call	clearTextWindow
	mov	ax, offset aDone
	push	ds
	push	ax
	call	printString
	add	sp, 4
	wait4IO
loc_18F1E:
	pop	si
	mov	sp, bp
	pop	bp
	retf
getGoldTradee endp

; Attributes: bp-based frame
printCharAbilities proc	far

	var_206= word ptr -206h
	var_204= word ptr -204h
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 206h
	call	someStackOperation
	push	si
	getCharP	[bp+arg_0], bx
	mov	al, gs:[bx+5Bh]
	sub	ah, ah
	jmp	loc_190D5
loc_18F45:
	mov	ax, offset aRogueAbilities
	push	ds
	push	ax
	call	printString
	add	sp, 4
	getCharP	[bp+arg_0], bx
	mov	al, gs:roster.specAbil[bx]
	sub	ah, ah
	push	ax
	mov	ax, offset aDisarmTraps
	push	ds
	push	ax
	call	sub_1621C
	add	sp, 6
	getCharP	[bp+arg_0], bx
	mov	al, gs:(roster.specAbil+1)[bx]
	sub	ah, ah
	push	ax
	mov	ax, offset aIdentifyChest
	push	ds
	push	ax
	call	sub_1621C
	add	sp, 6
	getCharP	[bp+arg_0], bx
	mov	al, gs:(roster.specAbil+1)[bx]
	sub	ah, ah
	push	ax
	mov	ax, offset aIdentifyItem
	push	ds
	push	ax
	call	sub_1621C
	add	sp, 6
	getCharP	[bp+arg_0], bx
	mov	al, gs:(roster.specAbil+2)[bx]
	sub	ah, ah
	push	ax
	mov	ax, offset aHideInShadows
	push	ds
	push	ax
	call	sub_1621C
	add	sp, 6
	getCharP	[bp+arg_0], bx
	mov	al, gs:(roster.specAbil+2)[bx]
	sub	ah, ah
	push	ax
	mov	ax, offset aCriticalHit
	push	ds
	push	ax
	call	sub_1621C
	add	sp, 6
	jmp	loc_190F0
loc_18FFA:
	mov	ax, offset aBardAbilities
	push	ds
	push	ax
	call	printString
	add	sp, 4
	getCharP	[bp+arg_0], bx
	mov	al, gs:roster.specAbil[bx]
	sub	ah, ah
	push	ax
	mov	ax, offset aNumberOfTunesL
	push	ds
	push	ax
	call	sub_161C5
	add	sp, 6
	jmp	loc_190F0
loc_1902B:
	mov	ax, offset aHunterAbilitie
	push	ds
	push	ax
	call	printString
	add	sp, 4
	getCharP	[bp+arg_0], bx
	mov	al, gs:roster.specAbil[bx]
	sub	ah, ah
	push	ax
	mov	ax, offset aCriticalHit
	push	ds
	push	ax
	call	sub_1621C
	add	sp, 6
	jmp	loc_190F0
loc_1905C:
	mov	[bp+var_6], 0
	mov	[bp+var_4], 0
	jmp	short loc_1906B
loc_19068:
	inc	[bp+var_4]
loc_1906B:
	cmp	[bp+var_4], 7Eh	
	jge	short loc_190A5
	push	[bp+var_4]
	push	[bp+arg_0]
	push	cs
	call	near ptr mage_hasLearnedSpell
	add	sp, 4
	or	ax, ax
	jz	short loc_190A3
	mov	bx, [bp+var_4]
	mov	cl, 3
	shl	bx, cl
	mov	ax, word ptr spellString.fullName[bx]
	mov	dx, word ptr (spellString.fullName+2)[bx]
	mov	si, [bp+var_6]
	inc	[bp+var_6]
	shl	si, 1
	shl	si, 1
	mov	[bp+si+var_206], ax
	mov	[bp+si+var_204], dx
loc_190A3:
	jmp	short loc_19068
loc_190A5:
	cmp	[bp+var_6], 0
	jz	short loc_190C6
	push	[bp+var_6]
	lea	ax, [bp+var_206]
	push	ss
	push	ax
	mov	ax, offset aKnownSpells
	push	ds
	push	ax
	call	printStringGetInput
	add	sp, 0Ah
	mov	[bp+var_2], ax
	jmp	short loc_190D3
loc_190C6:
	mov	ax, offset aYouDonTKnowAny
	push	ds
	push	ax
	call	printString
	add	sp, 4
loc_190D3:
	jmp	short loc_190F0
loc_190D5:
	cmp	ax, class_rogue
	jnz	short loc_190DD
	jmp	loc_18F45
loc_190DD:
	cmp	ax, offset word_42676
	jnz	short loc_190E5
	jmp	loc_18FFA
loc_190E5:
	cmp	ax, 8
	jnz	short loc_190ED
	jmp	loc_1902B
loc_190ED:
	jmp	loc_1905C
loc_190F0:
	wait4IO
	pop	si
	mov	sp, bp
	pop	bp
	retf
printCharAbilities endp

; Attributes: bp-based frame

mage_hasLearnedSpell proc far

	charNo=	word ptr  6
	spell= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	getCharP	[bp+charNo], bx
	mov	ax, [bp+spell]
	mov	cl, 3
	sar	ax, cl
	add	bx, ax
	mov	al, gs:roster.spells[bx]
	sub	ah, ah
	mov	bx, [bp+spell]
	and	bx, 7
	mov	cl, byteMaskList[bx]
	sub	ch, ch
	and	ax, cx
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mage_hasLearnedSpell endp

; Attributes: bp-based frame

mage_learnSpell	proc far

	charNo=	word ptr  6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	bx, [bp+arg_2]
	and	bx, 7
	mov	al, byteMaskList[bx]
	mov	cx, ax
	getCharP	[bp+charNo], bx
	mov	ax, [bp+arg_2]
	mov	dx, cx
	mov	cl, 3
	sar	ax, cl
	add	bx, ax
	or	gs:roster.spells[bx], dl
	mov	sp, bp
	pop	bp
	retf
mage_learnSpell	endp

; This function	returns	one if the character class
; has special abilities	that need to be	printed
; Attributes: bp-based frame

charHasSpecialAbils proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.class[bx], class_monster
	jb	short loc_1919D
	sub	ax, ax
	jmp	short loc_191C9
loc_1919D:
	getCharP	[bp+arg_0], bx
	mov	al, gs:roster.class[bx]
	sub	ah, ah
	jmp	short loc_191B9
loc_191AE:
	sub	ax, ax
	jmp	short loc_191C9
loc_191B2:
	mov	ax, 1
	jmp	short loc_191C9
	jmp	short loc_191C9
loc_191B9:
	or	ax, ax
	jz	short loc_191AE
	cmp	ax, class_paladin
	jz	short loc_191AE
	cmp	ax, class_monk
	jz	short loc_191AE
	jmp	short loc_191B2
loc_191C9:
	mov	sp, bp
	pop	bp
locret_191CC:
	retf
charHasSpecialAbils endp

seg006 ends

; Segment type:	Pure code
seg007 segment word public 'CODE' use16
	assume cs:seg007
;org 0Dh
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
algn_191CD:
align 2
; This function	sets the direction facing in the
; opposite direction. Used when	exiting	buildings.
; If the party was facing north, after this function
; they would be	facing south.
; Attributes: bp-based frame

map_turnPartyAround proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, dirFacing
	add	ax, 2
	and	ax, 3
	mov	dirFacing, ax
	mov	sp, bp
	pop	bp
locret_191ED:
	retf
map_turnPartyAround endp

; Attributes: bp-based frame
map_movePartyOneSq proc	far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	mov	si, dirFacing
	shl	si, 1
	mov	ax, dirDeltaN[si]
	sub	sq_north, ax
	mov	ax, dirDeltaE[si]
	add	sq_east, ax
	pop	si
	mov	sp, bp
	pop	bp
	retf
map_movePartyOneSq endp

; This function	is the mechanism behind	an if-then
; clause in the	code.
; Attributes: bp-based frame

_mfunc_ifBranch	proc far

	memOff=	word ptr  6
	memSeg=	word ptr  8
	rval= word ptr	0Ah

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	[bp+rval], 0
	jz	short loc_1926C
	cmp	gs:breakAfterFunc, 0
	jz	short loc_1925F
	push	[bp+memSeg]
	push	[bp+memOff]
	call	map_getDataOffsetP
	add	sp, 4
	mov	[bp+memOff], ax
	mov	[bp+memSeg], dx
	jmp	short loc_1926A
loc_1925F:
	mov	gs:breakAfterFunc, 1
loc_1926A:
	jmp	short loc_1927C
loc_1926C:
	cmp	gs:breakAfterFunc, 0
	jz	short loc_1927C
	add	[bp+memOff], 2
loc_1927C:
	mov	ax, [bp+memOff]
	mov	dx, [bp+memSeg]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
_mfunc_ifBranch	endp

; Attributes: bp-based frame

dun_changeLevels proc far

	var_4= dword ptr -4

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	word ptr [bp+var_4], offset characterIOBuf
	mov	word ptr [bp+var_4+2], seg seg022
	mov	si, dunLevelNum
	lfs	bx, [bp+var_4]
	mov	al, fs:[bx+si+dun_t.dunLevel]
	sub	ah, ah
	mov	dunLevelIndex, ax
	mov	al, fs:[bx+dun_t.deltaSqN]
	cbw
	add	sq_north, ax
	mov	al, fs:[bx+dun_t.deltaSqE]
	cbw
	add	sq_east, ax
	mov	gs:levelChangedFlag, 1
	mov	buildingRvalMaybe, 4
	pop	si
	mov	sp, bp
	pop	bp
	retf
dun_changeLevels endp

; Attributes: bp-based frame

dun_setExitLocation proc far

	var_4= dword ptr -4

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	word ptr [bp+var_4], offset characterIOBuf
	mov	word ptr [bp+var_4+2], seg seg022
	lfs	bx, [bp+var_4]
	mov	al, fs:[bx+dun_t.exitSqN]
	sub	ah, ah
	mov	sq_north, ax
	mov	al, fs:[bx+dun_t.exitSqE]
	mov	sq_east, ax
	mov	al, fs:[bx+dun_t.exitLocation]
	mov	currentLocationMaybe, ax
	mov	buildingRvalMaybe, 2
	mov	sp, bp
	pop	bp
	retf
dun_setExitLocation endp

; Attributes: bp-based frame

mfunc_downStairs proc far

	dataOffset= word ptr  6
	dataSegment= word ptr  8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	word_4EE66, 0
	jnz	short loc_193B0
	mov	word_4EE66, 1
	call	clearTextWindow
	mov	al, levFlags
	sub	ah, ah
	and	ax, 10h
	push	ax
	mov	ax, offset aThereAreStairs
	push	ds
	push	ax
	call	sub_1636B
	add	sp, 6
	call	getYesNo
	or	ax, ax
	jz	short loc_193B0
	push	[bp+dataSegment]
	push	[bp+dataOffset]
	push	cs
	call	near ptr mfunc_zero4ee66
	add	sp, 4
	dec	dunLevelNum
	jns	short loc_193AC
	push	cs
	call	near ptr dun_setExitLocation
	jmp	short loc_193B0
loc_193AC:
	push	cs
	call	near ptr dun_changeLevels
loc_193B0:
	mov	ax, [bp+dataOffset]
	mov	dx, [bp+dataSegment]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_downStairs endp

; Attributes: bp-based frame

mfunc_upStairs proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	word_4EE66, 0
	jnz	short loc_1941F
	mov	word_4EE66, 1
	call	clearTextWindow
	mov	al, levFlags
	and	al, 10h
	cmp	al, 1
	sbb	cx, cx
	neg	cx
	push	cx
	mov	ax, offset aThereAreStairs
	push	ds
	push	ax
	call	sub_1636B
	add	sp, 6
	call	getYesNo
	or	ax, ax
	jz	short loc_1941F
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr mfunc_zero4ee66
	add	sp, 4
	inc	dunLevelNum
	push	cs
	call	near ptr dun_changeLevels
loc_1941F:
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_upStairs endp

; Attributes: bp-based frame

sub_1942B proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	jmp	short loc_1949E
convertToGeomancer:
	mov	al, gs:byte_42288
	sub	ah, ah
	push	ax
	call	convertToGeomancer
	add	sp, 2
	jmp	short loc_194B4
loc_1945B:
	cmp	inDungeonMaybe, 0
	jz	short loc_1946E
	call	sub_253D0
	jmp	short loc_19473
loc_1946E:
	call	cmd_printLocation
loc_19473:
	jmp	short loc_194B4
doVictory:
	call	doVictoryMaybe
	jmp	short loc_194B4
loc_1947C:
	call	geomancerSomething
	mov	gs:breakAfterFunc, ax
	jmp	short loc_194B4
loc_1948B:
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr sub_1B0BA
	add	sp, 4
	jmp	short loc_194BC
	jmp	short loc_194B4
	jmp	short loc_194B4
loc_1949E:
	cmp	ax, 3
	jz	short convertToGeomancer
	cmp	ax, 4
	jz	short loc_1945B
	cmp	ax, 5
	jz	short doVictory
	cmp	ax, 9
	jz	short loc_1947C
	jmp	short loc_1948B
loc_194B4:
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
loc_194BC:
	mov	sp, bp
	pop	bp
	retf
sub_1942B endp

; Attributes: bp-based frame

mfunc_teleport proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr mfunc_zero4ee66
	add	sp, 4
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	sq_north, ax
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	sq_east, ax
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_2], ax
	cmp	inDungeonMaybe, 0
	jz	short loc_19557
	cmp	ax, 80h
	jb	short loc_19531
	mov	buildingRvalMaybe, 2
	and	ax, 7Fh
	mov	currentLocationMaybe, ax
	jmp	short loc_19555
loc_19531:
	mov	ax, [bp+var_2]
	cmp	dunLevelIndex, ax
	jz	short loc_1954A
	mov	buildingRvalMaybe, 4
loc_1954A:
	mov	ax, [bp+var_2]
	mov	dunLevelIndex, ax
loc_19555:
	jmp	short loc_1959D
loc_19557:
	cmp	[bp+var_2], 80h
	jb	short loc_19579
	mov	buildingRvalMaybe, 4
	mov	ax, [bp+var_2]
	and	ax, 7Fh
	mov	dunLevelIndex, ax
	jmp	short loc_1959D
loc_19579:
	mov	ax, [bp+var_2]
	cmp	currentLocationMaybe, ax
	jz	short loc_19592
	mov	buildingRvalMaybe, 2
loc_19592:
	mov	ax, [bp+var_2]
	mov	currentLocationMaybe, ax
loc_1959D:
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_teleport endp

; Attributes: bp-based frame

mfunc_battle proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	byte_4EEC9, al
	cmp	al, 4
	jb	short loc_195E3
	mov	ax, offset aZounds
	push	ds
	push	ax
	call	printString
	add	sp, 4
	wait4IO
loc_195E3:
	mov	[bp+var_2], 0
	jmp	short loc_195ED
loc_195EA:
	inc	[bp+var_2]
loc_195ED:
	mov	al, byte_4EEC9
	sub	ah, ah
	cmp	ax, [bp+var_2]
	jbe	short loc_1962A
	getMonP	[bp+var_2], si
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	byte ptr gs:monGroups._name[si], al
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	gs:monGroups.groupSize[si], al
	jmp	short loc_195EA
loc_1962A:
	mov	gs:byte_42458, 1
	mov	partyAttackFlag, 0
	call	bat_init
	or	ax, ax
	jz	short loc_19665
	mov	buildingRvalMaybe, 5
	mov	gs:breakAfterFunc, 0
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short loc_19683
loc_19665:
	cmp	gs:runAwayFlag,	1
	sbb	ax, ax
	neg	ax
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
loc_19683:
	pop	si
	mov	sp, bp
	pop	bp
	retf
mfunc_battle endp

; Attributes: bp-based frame

mfunc_clearPrintString proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	call	clearTextWindow
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr mfunc_printString
	add	sp, 4
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_clearPrintString endp

; Replace the opcode at	*membuf	with 0xff effectively
; removing the code from the level. Used so the	party
; only runs the	code at	the current square once	per
; level.
; Attributes: bp-based frame

mfunc_ffcode proc far

	var_4= dword ptr -4
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	map_getDataOffsetP
	add	sp, 4
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	lfs	bx, [bp+var_4]
	mov	byte ptr fs:[bx], 0FFh
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	add	ax, 2
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ffcode endp

; This function	draws the bigpic image located at
; *memBuf;
; Attributes: bp-based frame

mfunc_drawBigpic proc far

	picNo= word ptr	-2
	memBuf=	dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+memBuf]
	inc	word ptr [bp+memBuf]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+picNo], ax
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
	mov	ax, word ptr [bp+memBuf]
	mov	dx, word ptr [bp+memBuf+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_drawBigpic endp

; This function	reads an 0x80AND'd string from *membuf
; and sets the title. The string is 0xff terminated.
; Attributes: bp-based frame

mfunc_setTitle proc far

	var_102= word ptr -102h
	var_100= word ptr -100h
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 102h
	call	someStackOperation
	push	si
	mov	[bp+var_102], 0
loc_1971F:
	lfs	bx, [bp+arg_0]
	cmp	byte ptr fs:[bx], 0FFh
	jz	short loc_1973E
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	and	al, 7Fh
	mov	si, [bp+var_102]
	inc	[bp+var_102]
	mov	byte ptr [bp+si+var_100], al
	jmp	short loc_1971F
loc_1973E:
	mov	si, [bp+var_102]
	mov	byte ptr [bp+si+var_100], 0
	inc	word ptr [bp+arg_0]
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	setTitle
	add	sp, 4
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
mfunc_setTitle endp

; Attributes: bp-based frame

mfunc_getChMaybe proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	wait4IO
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_getChMaybe endp

; Attributes: bp-based frame

mfunc_clearTextWindow proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	call	clearTextWindow
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_clearTextWindow endp

; Attributes: bp-based frame

mfunc_ifFlag proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	push	ax
	push	cs
	call	near ptr sub_19813
	add	sp, 2
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifFlag endp

; Attributes: bp-based frame

mfunc_ifNotFlag	proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	push	ax
	push	cs
	call	near ptr sub_19813
	add	sp, 2
	cmp	ax, 1
	sbb	cx, cx
	neg	cx
	push	cx
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifNotFlag	endp

; Attributes: bp-based frame

sub_19813 proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	ax, [bp+arg_0]
	mov	cl, 3
	shr	ax, cl
	mov	[bp+var_4], ax
	mov	ax, [bp+arg_0]
	and	ax, 7
	mov	[bp+var_2], ax
	mov	bx, [bp+var_4]
	mov	al, mfuncFlags[bx]
	sub	ah, ah
	mov	bx, [bp+var_2]
	mov	cl, byteMaskList[bx]
	sub	ch, ch
	and	ax, cx
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_19813 endp

; Attributes: bp-based frame

sub_19855 proc far

	var_1C=	dword ptr -1Ch
	var_18=	word ptr -18h
	var_14=	word ptr -14h
	var_12=	dword ptr -12h
	var_E= word ptr	-0Eh
	charBufOff= word ptr -0Ch
	charBufSeg= word ptr -0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 1Ch
	call	someStackOperation
	mov	[bp+charBufOff], offset	characterIOBuf
	mov	[bp+charBufSeg], seg seg022
	mov	ax, [bp+charBufOff]
	mov	dx, [bp+charBufSeg]
	add	ax, 24h	
	mov	[bp+var_6], ax
	mov	[bp+var_4], dx
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_E], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_14], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_18], ax
	mov	ax, [bp+var_E]
	shl	ax, 1
	add	ax, [bp+var_6]
	mov	word ptr [bp+var_1C], ax
	mov	word ptr [bp+var_1C+2],	dx
	lfs	bx, [bp+var_1C]
	mov	ah, fs:[bx+1]
	sub	al, al
	mov	cl, fs:[bx]
	sub	ch, ch
	add	ax, cx
	mov	cx, [bp+var_14]
	mov	dx, cx
	shl	cx, 1
	shl	cx, 1
	add	cx, dx
	add	ax, cx
	add	ax, offset characterIOBuf
	mov	word ptr [bp+var_12], ax
	mov	word ptr [bp+var_12+2],	seg seg022
	mov	ax, [bp+var_18]
	and	ax, 0Fh
	mov	[bp+var_2], ax
	mov	cl, 4
	shr	[bp+var_18], cl
	test	byte ptr [bp+var_18], 2
	jz	short loc_198EC
	inc	word ptr [bp+var_12]
loc_198EC:
	test	byte ptr [bp+var_18], 1
	jz	short loc_1990E
	lfs	bx, [bp+var_12]
	mov	al, fs:[bx]
	sub	ah, ah
	and	ax, 0F0h
	mov	[bp+var_8], ax
	mov	ax, [bp+var_2]
	or	[bp+var_8], ax
	mov	al, byte ptr [bp+var_8]
	mov	fs:[bx], al
	jmp	short loc_1992C
loc_1990E:
	lfs	bx, [bp+var_12]
	mov	al, fs:[bx]
	sub	ah, ah
	and	ax, 0Fh
	mov	[bp+var_8], ax
	mov	ax, [bp+var_2]
	mov	cl, 4
	shl	ax, cl
	or	[bp+var_8], ax
	mov	al, byte ptr [bp+var_8]
	mov	fs:[bx], al
loc_1992C:
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_19855 endp

; Attributes: bp-based frame

mfunc_setFlag proc far

	flagNo=	word ptr -2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+flagNo], ax
	mov	ax, 0FFh
	push	ax
	push	[bp+flagNo]
	push	cs
	call	near ptr _updateFlags
	add	sp, 4
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_setFlag endp

; Attributes: bp-based frame

mfunc_clearFlag	proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	sub	ax, ax
	push	ax
	push	[bp+var_2]
	push	cs
	call	near ptr _updateFlags
	add	sp, 4
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_clearFlag	endp

; Attributes: bp-based frame

_updateFlags proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	flagNo=	word ptr  6
	arg_2= byte ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	mov	ax, [bp+flagNo]
	mov	cl, 3
	shr	ax, cl
	mov	[bp+var_6], ax
	mov	ax, [bp+flagNo]
	and	ax, 7
	mov	[bp+var_4], ax
	mov	bx, [bp+var_6]
	mov	al, mfuncFlags[bx]
	sub	ah, ah
	mov	bx, [bp+var_4]
	mov	cl, flagMaskList[bx]
	sub	ch, ch
	and	ax, cx
	mov	[bp+var_2], ax
	mov	al, byteMaskList[bx]
	and	al, [bp+arg_2]
	or	al, byte ptr [bp+var_2]
	mov	bx, [bp+var_6]
	mov	mfuncFlags[bx], al
	mov	sp, bp
	pop	bp
	retf
_updateFlags endp

; Attributes: bp-based frame
mfunc_ifCurSpellEQ proc	far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	cmp	ax, curSpellNo
	jnz	short loc_19A21
	mov	ax, 1
	jmp	short loc_19A23
loc_19A21:
	sub	ax, ax
loc_19A23:
	mov	[bp+var_2], ax
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifCurSpellEQ endp

; Attributes: bp-based frame

mfunc_setMapRval proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	gs:mapRval, 1
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_setMapRval endp

; Attributes: bp-based frame

mfunc_printString proc far

	var_100= word ptr -100h
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 100h
	call	someStackOperation
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	_mfunc_getString
	add	sp, 8
	mov	[bp+arg_0], ax
	mov	[bp+arg_2], dx
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_printString endp

; Attributes: bp-based frame

mfunc_doNothing	proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_doNothing	endp

; Attributes: bp-based frame
mfunc_ifChHasItemF proc	far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_4], ax
	mov	al, charSize
	mul	gs:byte_42288
	mov	bx, ax
	mov	al, gs:byte_4227E
	sub	ah, ah
	add	bx, ax
	mov	al, gs:roster.inventory.itemFlags[bx]
	mov	[bp+var_6], ax
	sar	ax, 1
	sar	ax, 1
	and	ax, 0Fh
	mov	[bp+var_2], ax
	cmp	[bp+var_4], ax
	jnz	short loc_19B02
	mov	ax, 1
	jmp	short loc_19B04
loc_19B02:
	sub	ax, ax
loc_19B04:
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifChHasItemF endp

; Attributes: bp-based frame

mfunc_getItem proc far

	var_10C= word ptr -10Ch
	var_10A= word ptr -10Ah
	var_108= word ptr -108h
	var_106= word ptr -106h
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 10Ch
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_108], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_2], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_6], ax
loc_19B4A:
	call	clearTextWindow
	mov	ax, offset aWhoWantsToGetT
	push	ds
	push	ax
	lea	ax, [bp+var_106]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_10C], ax
	mov	[bp+var_10A], dx
	push	[bp+var_108]
	push	[bp+var_2]
	push	dx
	push	ax
	call	item_getName
	add	sp, 8
	mov	[bp+var_10C], ax
	mov	[bp+var_10A], dx
	lea	ax, [bp+var_106]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_4], ax
	or	ax, ax
	jge	short loc_19BB0
	sub	ax, ax
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	loc_19CB5
loc_19BB0:
	push	[bp+var_6]
	push	[bp+var_108]
	push	[bp+var_2]
	push	[bp+var_4]
	call	inven_addItem
	add	sp, 8
	or	ax, ax
	jz	short loc_19C46
	getCharP	[bp+var_4], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, [bp+var_106]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_10C], ax
	mov	[bp+var_10A], dx
	mov	ax, offset aGotThe
	push	ds
	push	ax
	push	dx
	push	[bp+var_10C]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10C], ax
	mov	[bp+var_10A], dx
	push	[bp+var_108]
	push	[bp+var_2]
	push	dx
	push	ax
	call	item_getName
	add	sp, 8
	mov	[bp+var_10C], ax
	mov	[bp+var_10A], dx
	lea	ax, [bp+var_106]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	ax, 1
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short loc_19CB5
	jmp	short loc_19CB2
loc_19C46:
	mov	ax, offset aSorryBut
	push	ds
	push	ax
	lea	ax, [bp+var_106]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_10C], ax
	mov	[bp+var_10A], dx
	getCharP	[bp+var_4], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	[bp+var_10A]
	push	[bp+var_10C]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10C], ax
	mov	[bp+var_10A], dx
	mov	ax, offset aCanTCarryAny_0
	push	ds
	push	ax
	push	dx
	push	[bp+var_10C]
	call	_strcat
	add	sp, 8
	mov	[bp+var_10C], ax
	mov	[bp+var_10A], dx
	lea	ax, [bp+var_106]
	push	ss
	push	ax
	call	printString
	add	sp, 4
loc_19CB2:
	jmp	loc_19B4A
loc_19CB5:
	mov	sp, bp
	pop	bp
	retf
mfunc_getItem endp

; Attributes: bp-based frame

mfunc_ifHasItem	proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	push	ax
	push	cs
	call	near ptr sub_19D2A
	add	sp, 2
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifHasItem	endp

; Attributes: bp-based frame
mfunc_ifNotHasItem proc	far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	push	ax
	push	cs
	call	near ptr sub_19D2A
	add	sp, 2
	cmp	ax, 1
	sbb	cx, cx
	neg	cx
	push	cx
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifNotHasItem endp

; Attributes: bp-based frame

sub_19D2A proc far

	charNo=	word ptr -4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	[bp+charNo], 0
	jmp	short loc_19D3F
loc_19D3C:
	inc	[bp+charNo]
loc_19D3F:
	cmp	[bp+charNo], 7
	jge	short loc_19D92
	mov	[bp+var_2], 1
	jmp	short loc_19D50
loc_19D4C:
	add	[bp+var_2], 3
loc_19D50:
	cmp	[bp+var_2], inventorySize
	jge	short loc_19D90
	getCharP	[bp+charNo], bx
	add	bx, [bp+var_2]
	mov	al, gs:roster.inventory.itemFlags[bx]
	sub	ah, ah
	cmp	ax, [bp+arg_0]
	jnz	short loc_19D8E
	mov	al, byte ptr [bp+var_2]
	dec	al
	mov	gs:byte_4227E, al
	mov	al, byte ptr [bp+charNo]
	mov	gs:byte_42288, al
	mov	ax, 1
	jmp	short loc_19D96
loc_19D8E:
	jmp	short loc_19D4C
loc_19D90:
	jmp	short loc_19D3C
loc_19D92:
	sub	ax, ax
	jmp	short $+2
loc_19D96:
	mov	sp, bp
	pop	bp
	retf
sub_19D2A endp

; Attributes: bp-based frame

mfunc_ifW4ee66 proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, word_4EE66
	mov	[bp+var_2], ax
	mov	word_4EE66, 1
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifW4ee66 endp

; Attributes: bp-based frame

mfunc_ifYesNo proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	call	getYesNo
	mov	[bp+var_2], ax
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifYesNo endp

; Attributes: bp-based frame
mfunc_goto proc	far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	map_getDataOffsetP
	add	sp, 4
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_goto endp

; Attributes: bp-based frame

mfunc_battleNoCry proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	gs:byte_4228B, 1
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr mfunc_battle
	add	sp, 4
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_battleNoCry endp

; Attributes: bp-based frame

mfunc_zero4ee66	proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	word_4EE66, 0
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_zero4ee66	endp

; Attributes: bp-based frame

mfunc_turnAround proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	cs
	call	near ptr map_turnPartyAround
	push	cs
	call	near ptr map_movePartyOneSq
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_turnAround endp

; Attributes: bp-based frame

mfunc_removeItem proc far

	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	push	ax
	push	cs
	call	near ptr _removeItem
	add	sp, 2
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_removeItem endp

; Attributes: bp-based frame

_removeItem proc far

	charNo=	word ptr -4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	[bp+charNo], 0
	jmp	short loc_19EB4
loc_19EB1:
	inc	[bp+charNo]
loc_19EB4:
	cmp	[bp+charNo], 7
	jge	short loc_19F08
	mov	[bp+var_2], 1
	jmp	short loc_19EC5
loc_19EC1:
	add	[bp+var_2], 3
loc_19EC5:
	cmp	[bp+var_2], 24h	
	jge	short loc_19F06
	getCharP	[bp+charNo], bx
	add	bx, [bp+var_2]
	mov	al, gs:roster.inventory.itemFlags[bx]
	sub	ah, ah
	cmp	ax, [bp+arg_0]
	jnz	short loc_19F04
	mov	ax, [bp+var_2]
	dec	ax
	mov	gs:word_42416, ax
	mov	ax, [bp+charNo]
	mov	gs:word_4244C, ax
	call	inven_pack
	jmp	short loc_19F06
loc_19F04:
	jmp	short loc_19EC1
loc_19F06:
	jmp	short loc_19EB1
loc_19F08:
	mov	sp, bp
	pop	bp
	retf
_removeItem endp

; Attributes: bp-based frame

mfunc_incRegister proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	bx, ax
	shl	bx, 1
	inc	_mfunc_regs[bx]
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_incRegister endp

; Attributes: bp-based frame

mfunc_decRegister proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	bx, ax
	shl	bx, 1
	dec	_mfunc_regs[bx]
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_decRegister endp

; Attributes: bp-based frame
mfunc_ifRegNotZero proc	far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	bx, ax
	shl	bx, 1
	cmp	_mfunc_regs[bx], 1
	sbb	ax, ax
	neg	ax
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifRegNotZero endp

; Attributes: bp-based frame

mfunc_ifRegister proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	bx, ax
	shl	bx, 1
	push	_mfunc_regs[bx]
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifRegister endp

; Attributes: bp-based frame

mfunc_drainHP proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	ah, fs:[bx]
	sub	al, al
	add	[bp+var_2], ax
	mov	[bp+var_4], 0
	jmp	short loc_1A01A
loc_1A017:
	inc	[bp+var_4]
loc_1A01A:
	cmp	[bp+var_4], 7
	jge	short loc_1A05E
	mov	ax, [bp+var_2]
	mov	cx, ax
	getCharP	[bp+var_4], bx
	cmp	gs:roster.currentHP[bx], cx
	jbe	short loc_1A047
	getCharP	[bp+var_4], bx
	sub	gs:roster.currentHP[bx], cx
	jmp	short loc_1A05C
loc_1A047:
	getCharP	[bp+var_4], si
	mov	gs:roster.currentHP[si], 0
	or	gs:roster.status[si], 4
loc_1A05C:
	jmp	short loc_1A017
loc_1A05E:
	call	rost_getLastActiveSlot
	cmp	ax, 7
	jle	short loc_1A073
	mov	buildingRvalMaybe, 5
loc_1A073:
	mov	byte ptr word_44166,	0
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
mfunc_drainHP endp

; Attributes: bp-based frame

mfunc_ifInBox proc far

	var_E= word ptr	-0Eh
	var_C= word ptr	-0Ch
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 0Eh
	call	someStackOperation
	push	si
	mov	ax, sq_north
	mov	[bp+var_C], ax
	mov	ax, sq_east
	mov	[bp+var_E], ax
	cmp	inDungeonMaybe, 0
	jnz	short loc_1A0DB
	mov	si, dirFacing
	shl	si, 1
	mov	ax, dirDeltaN[si]
	sub	[bp+var_C], ax
	mov	ax, dirDeltaE[si]
	add	[bp+var_E], ax
loc_1A0DB:
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_8], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_6], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_4], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_2], ax
	mov	ax, [bp+var_8]
	cmp	[bp+var_C], ax
	jl	short loc_1A132
	mov	ax, [bp+var_4]
	cmp	[bp+var_C], ax
	jg	short loc_1A132
	mov	ax, [bp+var_6]
	cmp	[bp+var_E], ax
	jl	short loc_1A132
	mov	ax, [bp+var_2]
	cmp	[bp+var_E], ax
	jg	short loc_1A132
	mov	ax, 1
	jmp	short loc_1A134
loc_1A132:
	sub	ax, ax
loc_1A134:
	mov	[bp+var_A], ax
	push	ax
	push	fs
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
mfunc_ifInBox endp

; Attributes: bp-based frame

mfunc_invANDc3 proc far

	var_6= dword ptr -6
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	shl	ax, 1
	shl	ax, 1
	mov	[bp+var_2], ax
	mov	al, 78h	
	mul	gs:byte_42288
	mov	cl, gs:byte_4227E
	sub	ch, ch
	add	ax, cx
	add	ax, offset roster.inventory
	mov	word ptr [bp+var_6], ax
	mov	word ptr [bp+var_6+2], seg seg027
	lfs	bx, [bp+var_6]
	mov	al, fs:[bx]
	and	al, 0C3h
	or	al, byte ptr [bp+var_2]
	mov	fs:[bx], al
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_invANDc3 endp

; Attributes: bp-based frame

mfunc_addToInv proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	al, 78h	
	mul	gs:byte_42288
	mov	si, ax
	mov	al, gs:byte_4227E
	sub	ah, ah
	add	si, ax
	mov	al, gs:roster.inventory.itemCount[si]
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	cl, fs:[bx]
	sub	ch, ch
	add	ax, cx
	mov	[bp+var_2], ax
	mov	al, gs:roster.inventory.itemNo[si]
	sub	ah, ah
	mov	[bp+var_4], ax
	cmp	[bp+var_2], 0FEh 
	jle	short loc_1A1FC
	mov	[bp+var_2], 0FEh 
loc_1A1FC:
	mov	bx, [bp+var_4]
	mov	al, byte_464B8[bx]
	sub	ah, ah
	sub	ax, [bp+var_2]
	sbb	cx, cx
	and	ax, cx
	add	ax, [bp+var_2]
	mov	cx, ax
	mov	al, 78h	
	mul	gs:byte_42288
	mov	bx, ax
	mov	al, gs:byte_4227E
	sub	ah, ah
	add	bx, ax
	mov	gs:roster.inventory.itemCount[bx], cl
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
mfunc_addToInv endp

; Attributes: bp-based frame

mfunc_subFromInv proc far

	var_A= dword ptr -0Ah
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 0Ah
	call	someStackOperation
	mov	al, 78h	
	mul	gs:byte_42288
	mov	cl, gs:byte_4227E
	sub	ch, ch
	add	ax, cx
	add	ax, offset roster.inventory.itemCount
	mov	word ptr [bp+var_A], ax
	mov	word ptr [bp+var_A+2], seg seg027
	lfs	bx, [bp+var_A]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_4], ax
	cmp	[bp+var_2], 0FEh 
	jz	short loc_1A2A6
	cmp	[bp+var_2], ax
	jl	short loc_1A29E
	mov	al, byte ptr [bp+var_2]
	sub	al, byte ptr [bp+var_4]
	jmp	short loc_1A2A0
loc_1A29E:
	sub	al, al
loc_1A2A0:
	lfs	bx, [bp+var_A]
	mov	fs:[bx], al
loc_1A2A6:
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_subFromInv endp

; Attributes: bp-based frame

mfunc_addToRegister proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_4], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_2], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	ah, fs:[bx]
	sub	al, al
	add	[bp+var_2], ax
	mov	ax, [bp+var_2]
	mov	bx, [bp+var_4]
	shl	bx, 1
	add	_mfunc_regs[bx], ax
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_addToRegister endp

; Attributes: bp-based frame

mfunc_subFromRegister proc far

	register= word ptr -4
	value= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+register], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+value], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	ah, fs:[bx]
	sub	al, al
	add	[bp+value], ax
	mov	ax, [bp+value]
	mov	bx, [bp+register]
	shl	bx, 1
	sub	_mfunc_regs[bx], ax
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_subFromRegister endp

; Attributes: bp-based frame
mfunc_setDirFacing proc	far

	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	dirFacing, ax
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_setDirFacing endp

; Attributes: bp-based frame

mfunc_getStrFromUser proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, 10h
	push	ax
	mov	ax, offset mfunc_ioBuf
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	_readString
	add	sp, 6
	mov	[bp+var_2], 0
	jmp	short loc_1A3A4
loc_1A3A1:
	inc	[bp+var_2]
loc_1A3A4:
	cmp	[bp+var_2], 10h
	jge	short loc_1A3CF
	mov	bx, [bp+var_2]
	mov	al, gs:mfunc_ioBuf[bx]
	sub	ah, ah
	push	ax
	call	_str_capitalize
	add	sp, 2
	mov	bx, [bp+var_2]
	mov	gs:mfunc_ioBuf[bx], al
	jmp	short loc_1A3A1
loc_1A3CF:
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_getStrFromUser endp

; Attributes: bp-based frame
map_strcmp proc	far

	arg_0= dword ptr  6
	arg_4= dword ptr  0Ah

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
loc_1A3E5:
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx]
	and	al, 7Fh
	lfs	bx, [bp+arg_4]
	inc	word ptr [bp+arg_4]
	cmp	al, fs:[bx]
	jnz	short loc_1A3FD
	inc	word ptr [bp+arg_0]
	jmp	short loc_1A3E5
loc_1A3FD:
	lfs	bx, [bp+arg_0]
	cmp	byte ptr fs:[bx], 0FFh
	jnz	short loc_1A40B
	mov	ax, 1
	jmp	short loc_1A40D
loc_1A40B:
	sub	ax, ax
loc_1A40D:
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
map_strcmp endp

; Attributes: bp-based frame

mfunc_ifStrEq proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, offset mfunc_ioBuf
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr map_strcmp
	add	sp, 8
	mov	[bp+var_2], ax
loc_1A436:
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	cmp	byte ptr fs:[bx], 0FFh
	jz	short loc_1A444
	jmp	short loc_1A436
loc_1A444:
	push	[bp+var_2]
	push	fs
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifStrEq endp

; Attributes: bp-based frame

mfunc_setRegFromBuf proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_4], ax
	lea	ax, [bp+var_2]
	push	ss
	push	ax
	mov	ax, offset aD
	push	ds
	push	ax
	mov	ax, offset mfunc_ioBuf
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	sscanf
	add	sp, 0Ch
	mov	ax, [bp+var_2]
	mov	bx, [bp+var_4]
	shl	bx, 1
	mov	_mfunc_regs[bx], ax
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_setRegFromBuf endp

; Attributes: bp-based frame
mfunc_getCharacter proc	far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	call	getCharNumber
	mov	[bp+var_2], ax
	or	ax, ax
	jl	short loc_1A4CA
	mov	al, byte ptr [bp+var_2]
	mov	gs:byte_42288, al
loc_1A4CA:
	cmp	[bp+var_2], 0
	jl	short loc_1A4D5
	mov	ax, 1
	jmp	short loc_1A4D7
loc_1A4D5:
	sub	ax, ax
loc_1A4D7:
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_getCharacter endp

; Attributes: bp-based frame

mfunc_ifGiveGold proc far

	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 0Ah
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_6], ax
	mov	al, 78h	
	mul	gs:byte_42288
	mov	bx, ax
	mov	ax, word ptr gs:roster.gold[bx]
	mov	dx, word ptr gs:(roster.gold+2)[bx]
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	mov	bx, [bp+var_6]
	shl	bx, 1
	mov	ax, _mfunc_regs[bx]
	cwd
	mov	[bp+var_A], ax
	mov	[bp+var_8], dx
	mov	ax, [bp+var_4]
	mov	dx, [bp+var_2]
	cmp	[bp+var_8], dx
	ja	short loc_1A571
	jb	short loc_1A54C
	cmp	[bp+var_A], ax
	ja	short loc_1A571
loc_1A54C:
	mov	ax, [bp+var_A]
	mov	dx, [bp+var_8]
	mov	cx, ax
	mov	al, 78h	
	mul	gs:byte_42288
	mov	bx, ax
	sub	word ptr gs:roster.gold[bx], cx
	sbb	word ptr gs:(roster.gold+2)[bx], dx
	jmp	short loc_1A58A
loc_1A571:
	mov	ax, offset aYouDonTHaveEno
	push	ds
	push	ax
	call	printString
	add	sp, 4
	delayNoTable	3
loc_1A58A:
	mov	bx, [bp+var_6]
	shl	bx, 1
	mov	ax, _mfunc_regs[bx]
	cwd
	cmp	dx, [bp+var_2]
	ja	short loc_1A5AA
	jb	short loc_1A5A5
	cmp	ax, [bp+var_4]
	ja	short loc_1A5AA
loc_1A5A5:
	mov	ax, 1
	jmp	short loc_1A5AC
loc_1A5AA:
	sub	ax, ax
loc_1A5AC:
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifGiveGold endp

; Attributes: bp-based frame

sub_1A5C0 proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	bx, ax
	shl	bx, 1
	mov	ax, _mfunc_regs[bx]
	cwd
	mov	cx, ax
	mov	al, 78h	
	mul	gs:byte_42288
	mov	bx, ax
	add	word ptr gs:roster.gold[bx], cx
	adc	word ptr gs:(roster.gold+2)[bx], dx
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_1A5C0 endp

; Attributes: bp-based frame

mfunc_ifRegLT proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_4], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_2], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	ah, fs:[bx]
	sub	al, al
	add	[bp+var_2], ax
	mov	ax, [bp+var_2]
	mov	bx, [bp+var_4]
	shl	bx, 1
	cmp	_mfunc_regs[bx], ax
	jge	short loc_1A65B
	mov	ax, 1
	jmp	short loc_1A65D
loc_1A65B:
	sub	ax, ax
loc_1A65D:
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifRegLT endp

; Attributes: bp-based frame

mfunc_ifRegEQ proc far
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_4], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_2], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	ah, fs:[bx]
	sub	al, al
	add	[bp+var_2], ax
	mov	ax, [bp+var_2]
	mov	bx, [bp+var_4]
	shl	bx, 1
	cmp	_mfunc_regs[bx], ax
	jnz	short loc_1A6BC
	mov	ax, 1
	jmp	short loc_1A6BE
loc_1A6BC:
	sub	ax, ax
loc_1A6BE:
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifRegEQ endp

; Attributes: bp-based frame

mfunc_ifRegGE proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_4], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	[bp+var_2], ax
	mov	bx, word ptr [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	ah, fs:[bx]
	sub	al, al
	add	[bp+var_2], ax
	mov	ax, [bp+var_2]
	mov	bx, [bp+var_4]
	shl	bx, 1
	cmp	_mfunc_regs[bx], ax
	jl	short loc_1A71D
	mov	ax, 1
	jmp	short loc_1A71F
loc_1A71D:
	sub	ax, ax
loc_1A71F:
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifRegGE endp

; Attributes: bp-based frame

mfunc_learnSpell proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	push	ax
	mov	al, gs:byte_42288
	push	ax
	call	mage_learnSpell
	add	sp, 4
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_learnSpell endp

; Attributes: bp-based frame

mfunc_setRegister proc far

	regNum=	word ptr -4
	val= word ptr -2
	memBuf=	dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	lfs	bx, [bp+memBuf]
	inc	word ptr [bp+memBuf]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+regNum], ax
	mov	bx, word ptr [bp+memBuf]
	inc	word ptr [bp+memBuf]
	mov	al, fs:[bx]
	mov	[bp+val], ax
	mov	bx, word ptr [bp+memBuf]
	inc	word ptr [bp+memBuf]
	mov	ah, fs:[bx]
	sub	al, al
	add	[bp+val], ax
	mov	ax, [bp+val]
	mov	bx, [bp+regNum]
	shl	bx, 1
	mov	_mfunc_regs[bx], ax
	mov	ax, word ptr [bp+memBuf]
	mov	dx, word ptr [bp+memBuf+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_setRegister endp

; Attributes: bp-based frame

mfunc_chHasItemNo proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	al, 78h	
	mul	gs:byte_42288
	mov	bx, ax
	mov	al, gs:byte_4227E
	sub	ah, ah
	add	bx, ax
	mov	al, gs:roster.inventory.itemNo[bx]
	cmp	ax, [bp+var_2]
	jnz	short loc_1A7FF
	mov	ax, 1
	jmp	short loc_1A801
loc_1A7FF:
	sub	ax, ax
loc_1A801:
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_chHasItemNo endp

; Attributes: bp-based frame
mfunc_packInvMaybe proc	far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	al, gs:byte_42288
	sub	ah, ah
	mov	gs:word_4244C, ax
	mov	al, gs:byte_4227E
	mov	gs:word_42416, ax
	call	inven_pack
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_packInvMaybe endp

; Attributes: bp-based frame

mfunc_addMonToParty proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_4], ax
	call	findEmptyRosterNum
	mov	[bp+var_2], ax
	cmp	ax, 7
	jge	short loc_1A89E
	getMonP	[bp+var_4], bx
	lea	ax, monsterBuf[bx]
	mov	dx, seg	seg023
	push	dx
	push	ax
	push	[bp+var_2]
	call	_sp_convertMonToSummon
	add	sp, 6
	mov	byte ptr word_44166,	0
loc_1A89E:
	cmp	[bp+var_2], 7
	jge	short loc_1A8A9
	mov	ax, 1
	jmp	short loc_1A8AB
loc_1A8A9:
	sub	ax, ax
loc_1A8AB:
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_addMonToParty endp

; Attributes: bp-based frame
mfunc_ifMonInParty proc	far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	[bp+var_4], 0
	mov	[bp+var_2], 0
	jmp	short loc_1A8DA
loc_1A8D7:
	inc	[bp+var_2]
loc_1A8DA:
	cmp	[bp+var_2], 7
	jge	short loc_1A917
	getCharP	[bp+var_2], si
	cmp	gs:roster.class[si], class_monster
	jnz	short loc_1A915
	lea	ax, roster._name[si]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr map_strcmp
	add	sp, 8
	or	ax, ax
	jz	short loc_1A915
	mov	[bp+var_4], 1
	jmp	short loc_1A917
loc_1A915:
	jmp	short loc_1A8D7
loc_1A917:
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	cmp	byte ptr fs:[bx], 0FFh
	jz	short loc_1A925
	jmp	short loc_1A917
loc_1A925:
	mov	al, byte ptr [bp+var_2]
	mov	gs:byte_42288, al
	push	[bp+var_4]
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
mfunc_ifMonInParty endp

; Attributes: bp-based frame

mfunc_clrPrtStrOffset proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	call	clearTextWindow
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr mfunc_printStrAtOffset
	add	sp, 4
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_clrPrtStrOffset endp

; Attributes: bp-based frame

mfunc_ifIsNight	proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	gs:isNight, 1
	sbb	ax, ax
	neg	ax
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifIsNight	endp

; Attributes: bp-based frame

mfunc_rmMonFromParty proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	al, gs:byte_42288
	sub	ah, ah
	push	ax
	call	rost_removeMember
	add	sp, 2
	mov	byte ptr word_44166,	0
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_rmMonFromParty endp

; Attributes: bp-based frame

sub_1A9C8 proc far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	and	ax, 7
	mov	[bp+var_8], ax
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	cl, 3
	shr	ax, cl
	mov	[bp+var_2], ax
	mov	[bp+var_6], 0
	mov	[bp+var_4], 0
	jmp	short loc_1A9FF
loc_1A9FC:
	inc	[bp+var_4]
loc_1A9FF:
	cmp	[bp+var_4], 7
	jge	short loc_1AA36
	getCharP	[bp+var_4], bx
	add	bx, [bp+var_2]
	mov	al, gs:roster.chronoQuest[bx]
	sub	ah, ah
	mov	bx, [bp+var_8]
	mov	cl, byteMaskList[bx]
	sub	ch, ch
	test	ax, cx
	jz	short loc_1AA34
	mov	[bp+var_6], 1
	jmp	short loc_1AA36
loc_1AA34:
	jmp	short loc_1A9FC
loc_1AA36:
	push	[bp+var_6]
	push	cs
	call	near ptr chron_questFlagSet
	add	sp, 2
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_1A9C8 endp

; This function	returns	1 if there is a	character
; in the party that has	the bit	set in chronoQuest
; that matches the passed in quest mask.
; Attributes: bp-based frame
chron_questFlagSet proc	far

	qIndex=	word ptr -8
	rval= word ptr -6
	charNo=	word ptr -4
	qByte= word ptr	-2
	questMask= word	ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	mov	ax, [bp+questMask]
	and	ax, 7
	mov	[bp+qIndex], ax
	mov	ax, [bp+questMask]
	mov	cl, 3
	sar	ax, cl
	mov	[bp+qByte], ax
	mov	[bp+rval], 0
	mov	[bp+charNo], 0
	jmp	short loc_1AA82
loc_1AA7F:
	inc	[bp+charNo]
loc_1AA82:
	cmp	[bp+charNo], 7
	jge	short loc_1AACB
	getCharP	[bp+charNo], si
	cmp	byte ptr gs:roster._name[si], 0
	jz	short loc_1AAC9
	cmp	gs:roster.class[si], class_monster
	jnb	short loc_1AAC9
	mov	bx, [bp+qByte]
	add	bx, si
	mov	al, gs:roster.chronoQuest[bx]
	sub	ah, ah
	mov	bx, [bp+qIndex]
	mov	cl, byteMaskList[bx]
	sub	ch, ch
	test	ax, cx
	jz	short loc_1AAC9
	mov	[bp+rval], 1
	jmp	short loc_1AACB
loc_1AAC9:
	jmp	short loc_1AA7F
loc_1AACB:
	mov	ax, [bp+rval]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
chron_questFlagSet endp

; Attributes: bp-based frame

sub_1AAD5 proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	push	ax
	push	cs
	call	near ptr chron_questFlagNotSet
	add	sp, 2
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_1AAD5 endp

; This function	returns	one if there is	a character
; in the party that does NOT have the quest mask
; set.
; Attributes: bp-based frame

chron_questFlagNotSet proc far

	var_8= word ptr	-8
	rval= word ptr -6
	charNo=	word ptr -4
	var_2= word ptr	-2
	questMask= word	ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	mov	ax, [bp+questMask]
	and	ax, 7
	mov	[bp+var_8], ax
	mov	ax, [bp+questMask]
	mov	cl, 3
	sar	ax, cl
	mov	[bp+var_2], ax
	mov	[bp+rval], 0
	mov	[bp+charNo], 0
	jmp	short loc_1AB38
loc_1AB35:
	inc	[bp+charNo]
loc_1AB38:
	cmp	[bp+charNo], 7
	jge	short loc_1AB81
	getCharP	[bp+charNo], si
	cmp	byte ptr gs:roster._name[si], 0
	jz	short loc_1AB7F
	cmp	gs:roster.class[si], class_monster
	jnb	short loc_1AB7F
	mov	bx, [bp+var_2]
	add	bx, si
	mov	al, gs:roster.chronoQuest[bx]
	sub	ah, ah
	mov	bx, [bp+var_8]
	mov	cl, byteMaskList[bx]
	sub	ch, ch
	test	ax, cx
	jnz	short loc_1AB7F
	mov	[bp+rval], 1
	jmp	short loc_1AB81
loc_1AB7F:
	jmp	short loc_1AB35
loc_1AB81:
	mov	ax, [bp+rval]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
chron_questFlagNotSet endp

; Attributes: bp-based frame

mfunc_setChronQuestFlag	proc far
arg_0= dword ptr  6
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	push	ax
	push	cs
	call	near ptr chron_setQuestFlag
	add	sp, 2
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_setChronQuestFlag	endp

; Attributes: bp-based frame
chron_setQuestFlag proc	far

	var_6= word ptr	-6
	charNo=	word ptr -4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	mov	ax, [bp+arg_0]
	and	ax, 7
	mov	[bp+var_6], ax
	mov	ax, [bp+arg_0]
	mov	cl, 3
	sar	ax, cl
	mov	[bp+var_2], ax
	mov	[bp+charNo], 0
	jmp	short loc_1ABDD
loc_1ABDA:
	inc	[bp+charNo]
loc_1ABDD:
	cmp	[bp+charNo], 7
	jge	short loc_1AC1B
	getCharP	[bp+charNo], si
	cmp	gs:roster.class[si], class_monster
	jnb	short loc_1AC19
	cmp	byte ptr gs:roster._name[si], 0
	jz	short loc_1AC19
	mov	bx, [bp+var_6]
	mov	al, byteMaskList[bx]
	mov	bx, [bp+var_2]
	add	bx, si
	or	gs:roster.chronoQuest[bx], al
loc_1AC19:
	jmp	short loc_1ABDA
loc_1AC1B:
	pop	si
	mov	sp, bp
	pop	bp
	retf
chron_setQuestFlag endp

; Attributes: bp-based frame

sub_1AC20 proc far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	and	ax, 7
	mov	[bp+var_8], ax
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	cl, 3
	shr	ax, cl
	mov	[bp+var_2], ax
	mov	[bp+var_6], 0
	jmp	short loc_1AC53
loc_1AC50:
	inc	[bp+var_6]
loc_1AC53:
	cmp	[bp+var_6], 7
	jge	short loc_1AC91
	getCharP	[bp+var_6], si
	cmp	gs:roster.class[si], class_monster
	jnb	short loc_1AC8F
	cmp	byte ptr gs:roster._name[si], 0
	jz	short loc_1AC8F
	mov	bx, [bp+var_8]
	mov	al, flagMaskList[bx]
	mov	bx, [bp+var_2]
	add	bx, si
	and	gs:roster.chronoQuest[bx], al
loc_1AC8F:
	jmp	short loc_1AC50
loc_1AC91:
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_1AC20 endp

; Attributes: bp-based frame

sub_1AC9E proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	push	ax
	push	cs
	call	near ptr _partyCharUnderLevel
	add	sp, 2
	mov	[bp+var_4], ax
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_1AC9E endp

; This function	returns	0 if there is a	character
; in the party whose level is less than	the passed
; in level. If there is	not it returns 1.
; Attributes: bp-based frame

_partyCharUnderLevel proc far

	rval= word ptr -4
	counter= word ptr -2
	level= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	[bp+rval], 1
	mov	[bp+counter], 0
	jmp	short loc_1ACF1
loc_1ACEE:
	inc	[bp+counter]
loc_1ACF1:
	cmp	[bp+counter], 7
	jge	short loc_1AD1E
	getCharP	[bp+counter], si
	cmp	byte ptr gs:roster._name[si], 0
	jz	short loc_1AD1C
	mov	ax, [bp+level]
	cmp	gs:roster.level[si], ax
	jnb	short loc_1AD1C
	mov	[bp+rval], 0
	jmp	short loc_1AD1E
loc_1AD1C:
	jmp	short loc_1ACEE
loc_1AD1E:
	mov	ax, [bp+rval]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
_partyCharUnderLevel endp

; Attributes: bp-based frame

mfunc_isWildSqFlagSet proc far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	si, dirFacing
	shl	si, 1
	mov	ax, sq_north
	sub	ax, dirDeltaN[si]
	mov	[bp+var_6], ax
	mov	ax, dirDeltaE[si]
	add	ax, sq_east
	mov	[bp+var_8], ax
	push	[bp+var_6]
	push	ax
	call	wild_getSquare
	add	sp, 4
	and	ax, 0Fh
	mov	[bp+var_4], ax
	mov	ax, [bp+var_2]
	cmp	[bp+var_4], ax
	jnz	short loc_1AD95
	mov	ax, 1
	jmp	short loc_1AD97
loc_1AD95:
	sub	ax, ax
loc_1AD97:
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
mfunc_isWildSqFlagSet endp

; Attributes: bp-based frame

mfunc_wildSetSqFlag proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_6], ax
	mov	si, dirFacing
	shl	si, 1
	mov	ax, sq_north
	sub	ax, dirDeltaN[si]
	mov	[bp+var_2], ax
	mov	ax, dirDeltaE[si]
	add	ax, sq_east
	mov	[bp+var_4], ax
	cmp	gs:wildWrapFlag, 0
	jz	short loc_1AE38
	mov	al, gs:mapHeight
	sub	ah, ah
	push	ax
	push	[bp+var_2]
	call	wrapNumber
	add	sp, 4
	mov	[bp+var_2], ax
	mov	al, gs:mapWidth
	sub	ah, ah
	push	ax
	push	[bp+var_4]
	call	wrapNumber
	add	sp, 4
	mov	[bp+var_4], ax
loc_1AE38:
	cmp	[bp+var_2], 0
	jl	short loc_1AE79
	mov	al, gs:mapHeight
	sub	ah, ah
	cmp	ax, [bp+var_2]
	jb	short loc_1AE79
	cmp	[bp+var_4], 0
	jl	short loc_1AE79
	mov	al, gs:mapWidth
	cmp	ax, [bp+var_4]
	jb	short loc_1AE79
	mov	bx, [bp+var_2]
	shl	bx, 1
	shl	bx, 1
	lfs	bx, gs:rowOffset[bx]
	mov	si, [bp+var_4]
	mov	al, byte ptr [bp+var_6]
	mov	fs:[bx+si], al
loc_1AE79:
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
mfunc_wildSetSqFlag endp

; Attributes: bp-based frame

mfunc_ifIsClass	proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	al, 78h	
	mul	gs:byte_42288
	mov	bx, ax
	mov	al, gs:roster.class[bx]
	sub	ah, ah
	cmp	ax, [bp+var_2]
	jnz	short loc_1AEC1
	mov	ax, 1
	jmp	short loc_1AEC3
loc_1AEC1:
	sub	ax, ax
loc_1AEC3:
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr _mfunc_ifBranch
	add	sp, 6
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_ifIsClass	endp

; Attributes: bp-based frame

mfunc_printStrAtOffset proc far

	var_104= word ptr -104h
	var_102= word ptr -102h
	var_100= word ptr -100h
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 104h
	call	someStackOperation
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	map_getDataOffsetP
	add	sp, 4
	mov	[bp+var_104], ax
	mov	[bp+var_102], dx
	add	[bp+arg_0], 2
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	push	dx
	push	[bp+var_104]
	call	_mfunc_getString
	add	sp, 8
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_printStrAtOffset endp

; Attributes: bp-based frame

mfunc_clrAndTeleport proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 0FEh
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr mfunc_teleport
	add	sp, 4
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mfunc_clrAndTeleport endp

; Attributes: bp-based frame

map_execute proc far

	dataOffsetP= dword ptr -0Ch
	opcode=	word ptr -8
	dataCount= word	ptr -6
	sqNorth= word ptr -4
	sqEast=	word ptr -2
	memBuf=	dword ptr  6
	spellFlag= word	ptr  0Ah

	push	bp
	mov	bp, sp
	mov	ax, 0Ch
	call	someStackOperation
	push	word ptr [bp+memBuf+2]
	push	word ptr [bp+memBuf]
	call	map_getDataOffsetP
	add	sp, 4
	mov	word ptr [bp+memBuf], ax
	mov	word ptr [bp+memBuf+2],	dx
	lfs	bx, [bp+memBuf]
	inc	word ptr [bp+memBuf]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+dataCount],	ax
	mov	gs:mapRval, 0
loc_1AF8A:
	mov	ax, [bp+dataCount]
	dec	[bp+dataCount]
	or	ax, ax
	jnz	short loc_1AF97
	jmp	loc_1B0AC
loc_1AF97:
	lfs	bx, [bp+memBuf]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+sqNorth], ax
	cmp	[bp+spellFlag],	0
	jz	short loc_1AFAC
	xor	byte ptr [bp+sqNorth], 80h
loc_1AFAC:
	mov	al, fs:[bx+1]
	sub	ah, ah
	mov	[bp+sqEast], ax
	cmp	[bp+sqNorth], 7Fh 
	jz	short loc_1AFCC
	mov	ax, [bp+sqNorth]
	cmp	sq_north, ax
	jz	short loc_1AFCC
	jmp	loc_1B0A5
loc_1AFCC:
	cmp	[bp+sqEast], 0FFh
	jz	short loc_1AFE4
	mov	ax, [bp+sqEast]
	cmp	sq_east, ax
	jz	short loc_1AFE4
	jmp	loc_1B0A5
loc_1AFE4:
	mov	ax, word ptr [bp+memBuf]
	mov	dx, word ptr [bp+memBuf+2]
	add	ax, 2
	push	dx
	push	ax
	call	map_getDataOffsetP
	add	sp, 4
	mov	word ptr [bp+dataOffsetP], ax
	mov	word ptr [bp+dataOffsetP+2], dx
loc_1AFFD:
	lfs	bx, [bp+dataOffsetP]
	inc	word ptr [bp+dataOffsetP]
	mov	al, fs:[bx]
	sub	ah, ah
	mov	[bp+opcode], ax
	cmp	ax, 0FFh
	jnz	short loc_1B01D
	mov	gs:breakAfterFunc, 0
	jmp	short loc_1B080
loc_1B01D:
	mov	ax, [bp+opcode]
	and	ax, 80h
	mov	gs:breakAfterFunc, ax
	and	[bp+opcode], 7Fh
	cmp	[bp+opcode], 46h
	jbe	short loc_1B050
	mov	ax, offset aBadOpcode
	push	ds
	push	ax
	call	printString
	add	sp, 4
	wait4IO
	jmp	short loc_1B0B6
loc_1B050:
	mov	bx, [bp+opcode]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr off_46CFC[bx]
	mov	dx, word ptr (off_46CFC+2)[bx]
	mov	word ptr gs:dword_42436, ax
	mov	word ptr gs:dword_42436+2, dx
	push	word ptr [bp+dataOffsetP+2]
	push	word ptr [bp+dataOffsetP]
	call	gs:dword_42436
	add	sp, 4
	mov	word ptr [bp+dataOffsetP], ax
	mov	word ptr [bp+dataOffsetP+2], dx
loc_1B080:
	cmp	gs:breakAfterFunc, 0
	jz	short loc_1B08F
	jmp	loc_1AFFD
loc_1B08F:
	cmp	buildingRvalMaybe, 0
	jz	short loc_1B0A5
	mov	ax, gs:mapRval
	jmp	short loc_1B0B6
loc_1B0A5:
	add	word ptr [bp+memBuf], 4
	jmp	loc_1AF8A
loc_1B0AC:
	mov	ax, gs:mapRval
	jmp	short $+2
loc_1B0B6:
	mov	sp, bp
	pop	bp
	retf
map_execute endp

; Attributes: bp-based frame

sub_1B0BA proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, offset aThisFunctionIs
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	jmp	short loc_1B0E6
	wait4IO
loc_1B0E6:
	mov	sp, bp
	pop	bp
locret_1B0E9:
	retf
sub_1B0BA endp

seg007 ends

; Segment type:	Pure code
seg008 segment byte public 'CODE' use16
	assume cs:seg008
;org 0Ah
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
; Entry	point for a battle
; Attributes: bp-based frame

bat_init proc far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	mov	al, gs:byte_4266B
	mov	gs:bat_curSong,	al
	mov	al, gs:byte_42420
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	al, gs:byte_41E62
	mov	[bp+var_6], ax
	call	sub_22DA1
	push	cs
	call	near ptr bat_getOpponents
	mov	[bp+var_8], 0
	sub	al, al
	mov	gs:partyFrozenFlag, al
	mov	gs:runAwayFlag,	al
loc_1B13D:
	push	cs
	call	near ptr bat_sortMonGroupByDist
	push	cs
	call	near ptr bat_setBigpic
	push	[bp+var_8]
	inc	[bp+var_8]
	push	cs
	call	near ptr bat_printOpponents
	add	sp, 2
	cmp	gs:partyFrozenFlag, 0
	jnz	short loc_1B18C
	push	cs
	call	near ptr bat_getPartyOptions
	cmp	gs:runAwayFlag,	0
	jz	short loc_1B18C
partyRan:
	push	[bp+var_2]
	push	[bp+var_6]
	mov	al, gs:bat_curSong
	sub	ah, ah
	push	ax
	call	bat_end
	add	sp, 6
	sub	ax, ax
	jmp	loc_1B291
loc_1B18C:
	mov	gs:txt_numLines, 0Bh
	call	bat_doCombatRound
	call	bat_partyDisbelieves
	cmp	gs:monDisbelieveFlag, 0
	jnz	short loc_1B1AF
	call	bat_isAMonGroupActive
	or	ax, ax
	jz	short loc_1B1AF
	call	bat_monDisbelieve
loc_1B1AF:
	call	bat_doPoisonEffect
	call	doEquipmentEffect
	mov	al, gs:songRegenHP
	sub	ah, ah
	push	ax
	call	bat_doHPRegen
	add	sp, 2
	mov	al, gs:monDisbelieveFlag
	sub	ah, ah
	push	ax
	call	bat_updatePartyAndMonG
	add	sp, 2
	push	cs
	call	near ptr bat_endCombatSong
	mov	byte ptr word_44166,	0
	call	rost_getLastActiveSlot
	cmp	ax, 7
	jle	short loc_1B215
partyDied:
	push	[bp+var_2]
	push	[bp+var_6]
	mov	al, gs:bat_curSong
	sub	ah, ah
	push	ax
	call	bat_end
	add	sp, 6
	mov	ax, 1
	jmp	short loc_1B291
loc_1B215:
	call	bat_isAMonGroupActive
	or	ax, ax
	jz	short loc_1B227
	call	_return_zero
	or	ax, ax
	jz	short loc_1B28E
loc_1B227:
	cmp	partyAttackFlag, 0
	jz	short partyWon
	mov	ax, offset aDoYouWishToCon
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getYesNo
	or	ax, ax
	jnz	short loc_1B266
	push	[bp+var_2]
	push	[bp+var_6]
	mov	al, gs:bat_curSong
	sub	ah, ah
	push	ax
	call	bat_end
	add	sp, 6
	sub	ax, ax
	jmp	short loc_1B291
loc_1B266:
	jmp	short loc_1B28E
partyWon:
	call	bat_getReward
	mov	[bp+var_4], ax
	push	[bp+var_2]
	push	[bp+var_6]
	mov	al, gs:bat_curSong
	sub	ah, ah
	push	ax
	call	bat_end
	add	sp, 6
	mov	ax, [bp+var_4]
	jmp	short loc_1B291
loc_1B28E:
	jmp	loc_1B13D
loc_1B291:
	mov	sp, bp
	pop	bp
	retf
bat_init endp

; Attributes: bp-based frame

bat_doCombatRound proc far

	charNo=	word ptr -0Ch
	charPri= word ptr -0Ah
	monPri=	word ptr -8
	groupNo= word ptr -4
	monNo= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 0Ch
	call	someStackOperation
	push	cs
	call	near ptr bat_getAttackPriority
loc_1B2A4:
	lea	ax, [bp+charNo]
	push	ss
	push	ax
	push	cs
	call	near ptr bat_getHighCharPrio
	add	sp, 4
	mov	[bp+charPri], ax
	lea	ax, [bp+groupNo]
	push	ss
	push	ax
	lea	ax, [bp+monNo]
	push	ss
	push	ax
	push	cs
	call	near ptr bat_getHighMonPriority
	add	sp, 8
	mov	[bp+monPri], ax

	cmp	[bp+charPri], 0
	jnz	short loc_comparePri
	cmp	[bp+monPri], 0
	jz	loc_doCombatRoundExit

loc_comparePri:
	cmp	[bp+charPri], ax
	jl	short loc_1B2DE
	push	[bp+charNo]
	push	cs
	call	near ptr bat_doCharAttack
	add	sp, 2
	jmp	short loc_1B2EB
loc_1B2DE:
	push	[bp+groupNo]
	push	[bp+monNo]
	push	cs
	call	near ptr bat_doMonAttack
	add	sp, 4
loc_1B2EB:
	cmp	gs:byte_42419, 0
	jz	short loc_1B2FC
	call	txt_newLine
loc_1B2FC:
	call	txt_newLine
	mov	byte ptr word_44166,	0
	jmp	loc_1B2A4

loc_doCombatRoundExit:
	mov	sp, bp
	pop	bp
	retf
bat_doCombatRound endp

; Attributes: bp-based frame

bat_doCharAttack proc far

	charNo=	word ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	bx, [bp+charNo]
	mov	gs:bat_charPriority[bx], 0
	getCharP	[bp+charNo], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jnz	short loc_1B343
	jmp	loc_1B3FA
loc_1B343:
	getCharP	[bp+charNo], bx
	test	gs:roster.status[bx], stat_dead	or stat_stoned or stat_paralyzed
	jz	short loc_1B356
	jmp	loc_1B3FA
loc_1B356:
	getCharP	[bp+charNo], bx
	cmp	gs:roster.class[bx], class_monster
	jb	short loc_1B373
	push	[bp+charNo]
	push	cs
	call	near ptr bat_doSummonAttack
	add	sp, 2
	jmp	loc_1B3FA
loc_1B373:
	mov	bx, [bp+charNo]
	mov	al, gs:charActionList[bx]
	sub	ah, ah
	jmp	short loc_1B3DA
loc_1B383:
	mov	bx, [bp+charNo]
	mov	al, gs:byte_42244[bx]
	sub	ah, ah
	push	ax
	push	bx
	push	cs
	call	near ptr bat_doCharMeleeAttack
	add	sp, 4
	jmp	short loc_1B3FA
loc_1B39C:
	push	[bp+charNo]
	push	cs
	call	near ptr bat_doCharCastSpell
	add	sp, 2
	jmp	short loc_1B3FA
loc_1B3A8:
	push	[bp+charNo]
	push	cs
	call	near ptr bat_doCharUseItem
	add	sp, 2
	jmp	short loc_1B3FA
loc_1B3B4:
	push	[bp+charNo]
	push	cs
	call	near ptr bat_hideInShadows
	add	sp, 2
	jmp	short loc_1B3FA
loc_1B3C0:
	push	[bp+charNo]
	push	cs
	call	near ptr bat_doCharSong
	add	sp, 2
	jmp	short loc_1B3FA
loc_1B3CC:
	push	[bp+charNo]
	push	cs
	call	near ptr bat_charMeleeAttack
	add	sp, 2
loc_1B3D6:
	jmp	short loc_1B3FA
	jmp	short loc_1B3FA
loc_1B3DA:
	sub	ax, 1
	cmp	ax, 7
	ja	short loc_1B3D6
	add	ax, ax
	xchg	ax, bx
	jmp	cs:off_1B3EA[bx]
off_1B3EA dw offset loc_1B383
dw offset loc_1B3FA
dw offset loc_1B383
dw offset loc_1B39C
dw offset loc_1B3A8
dw offset loc_1B3B4
dw offset loc_1B3C0
dw offset loc_1B3CC
loc_1B3FA:
	mov	sp, bp
	pop	bp
	retf
bat_doCharAttack endp

; Attributes: bp-based frame

bat_doMonAttack	proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	monNo= word ptr	 6
	groupNo= word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	mov	bx, [bp+monNo]
	mov	cl, 6
	shl	bx, cl
	mov	ax, [bp+groupNo]
	shl	ax, 1
	add	bx, ax
	mov	gs:bat_monPriorityList[bx], 0
	call	_random
	and	ax, 6
	mov	[bp+var_6], ax
	getMonP	[bp+monNo], si
	add	si, [bp+var_6]
	mov	al, gs:monGroups.attackType._type[si]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	al, gs:monGroups.attackType.damage[si]
	mov	[bp+var_4], ax

	; Jump to Tarjan's attack to test
	;jmp	loc_1B4BD

	cmp	[bp+var_2], 80h
	jge	short loc_1B468
	push	[bp+var_2]
	push	[bp+groupNo]
	push	[bp+monNo]
	push	cs
	call	near ptr bat_monCastSpell
	add	sp, 6
	jmp	short loc_1B4D6
loc_1B468:
	mov	ax, [bp+var_2]
	sub	ax, 0F0h
	and 	ax, 7Fh
	mov	[bp+var_6], ax
	cmp	[bp+var_6], 0Ah
	jge	short loc_1B494
	push	[bp+var_4]
	push	[bp+var_6]
	push	[bp+groupNo]
	push	[bp+monNo]
	push	cs
	call	near ptr bat_doMonMelee
	add	sp, 8
	jmp	short loc_1B4D6
loc_1B494:
	mov	ax, [bp+var_6]
	jmp	short loc_1B4C5
loc_1B499:
	push	[bp+var_4]
	push	[bp+groupNo]
	push	[bp+monNo]
	push	cs
	call	near ptr bat_monSummonMon
	add	sp, 6
	jmp	short loc_1B4D6
loc_1B4AB:
	push	[bp+var_4]
	push	[bp+groupNo]
	push	[bp+monNo]
	push	cs
	call	near ptr bat_monBreathAttack
	add	sp, 6
	jmp	short loc_1B4D6
loc_1B4BD:
	push	cs
	call	near ptr bat_doTarjanAttack
loc_1B4C1:
	jmp	short loc_1B4D6
	jmp	short loc_1B4D6
loc_1B4C5:
	cmp	ax, 0Ah
	jz	short loc_1B499
	cmp	ax, 10h
	jz	short loc_1B4AB
	cmp	ax, 13h
	jz	short loc_1B4BD
	jmp	short loc_1B4C1
loc_1B4D6:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_doMonAttack	endp

; Attributes: bp-based frame

bat_monCastSpell proc far

	arg_0= word ptr	 6
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, 7
	push	ax
	push	cs
	call	near ptr bat_getRandomChar
	add	sp, 2
	mov	gs:bat_curTarget, al
	sub	ax, ax
	push	ax
	mov	ax, 1
	push	ax
	push	[bp+arg_4]
	mov	ax, [bp+arg_0]
	or	al, 80h
	push	ax
	call	doCastSpell
	add	sp, 8
	mov	sp, bp
	pop	bp
	retf
bat_monCastSpell endp

; Attributes: bp-based frame

bat_doTarjanAttack proc far

	counter =	word ptr -2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+counter], 0

loc_tarLoopEntry:
	inc	[bp+counter]
	mov	ax, 15h
	push	ax
	mov	ax, 80h
	push	ax
	call	far ptr doSummon
	add	sp, 4

	cmp	[bp+counter], 0Ah
	jl	loc_tarLoopEntry

	mov	sp, bp
	pop	bp
	retf
bat_doTarjanAttack endp

; Attributes: bp-based frame

bat_monSummonMon proc far

	var_104= word ptr -104h
	var_102= word ptr -102h
	var_100= word ptr -100h
	arg_0= word ptr	 6
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 104h
	call	someStackOperation
	push	si
	push	[bp+arg_0]
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	push	cs
	call	near ptr bat_getMonAttackerName
	add	sp, 6
	mov	[bp+var_104], ax
	mov	[bp+var_102], dx
	mov	ax, offset aSummonsHelpAnd
	push	ds
	push	ax
	push	dx
	push	[bp+var_104]
	call	_strcat
	add	sp, 8
	mov	[bp+var_104], ax
	mov	[bp+var_102], dx
	call	_random
	sub	ah, ah
	cmp	ax, [bp+arg_4]
	jnb	short loc_1B590
	getMonP	[bp+arg_0], bx
	mov	al, gs:monGroups.groupSize[bx]
	and	al, 1Fh
	cmp	al, 1Fh
	jz	short loc_1B590
	test	gs:byte_4240E, 2
	jz	short loc_1B5B0
loc_1B590:
	mov	ax, offset aNoneAppears___
	push	ds
	push	ax
	push	[bp+var_102]
	push	[bp+var_104]
	call	_strcat
	add	sp, 8
	mov	[bp+var_104], ax
	mov	[bp+var_102], dx
	jmp	loc_1B63E
loc_1B5B0:
	mov	ax, offset aAnotherJoinsTheFray
	push	ds
	push	ax
	push	[bp+var_102]
	push	[bp+var_104]
	call	_strcat
	add	sp, 8
	mov	[bp+var_104], ax
	mov	[bp+var_102], dx
	getMonP	[bp+arg_0], si
	inc	gs:monGroups.groupSize[si]
	mov	al, gs:monGroups.hpDice[si]
	sub	ah, ah
	push	ax
	push	cs
	call	near ptr dice_doYDX
	add	sp, 2
	mov	cx, gs:monGroups.hpBase[si]
	add	cx, ax
	mov	bl, gs:monGroups.groupSize[si]
	and	bx, 1Fh
	shl	bx, 1
	mov	ax, [bp+arg_0]
	mov	dx, cx
	mov	cl, 6
	shl	ax, cl
	add	bx, ax
	mov	gs:monHpList[bx], dx
	getMonP	[bp+arg_0], bx
	mov	bl, gs:monGroups.groupSize[bx]
	and	bx, 1Fh
	shl	bx, 1
	mov	ax, [bp+arg_0]
	shl	ax, cl
	add	bx, ax
	mov	gs:bat_monPriorityList[bx], 0
loc_1B63E:
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_monSummonMon endp

; Attributes: bp-based frame

bat_monBreathAttack proc far

	var_114= dword ptr -114h
	var_110= word ptr -110h
	var_10E= word ptr -10Eh
	var_10C= byte ptr -10Ch
	var_10A= byte ptr -10Ah
	target=	word ptr -106h
	var_104= word ptr -104h
	var_102= word ptr -102h
	var_100= word ptr -100h
	arg_0= word ptr	 6
	arg_4= byte ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 114h
	call	someStackOperation
	push	di
	push	si
	push	[bp+arg_0]
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	push	cs
	call	near ptr bat_getMonAttackerName
	add	sp, 6
	mov	[bp+var_104], ax
	mov	[bp+var_102], dx
	mov	ax, 7
	push	ax
	push	cs
	call	near ptr bat_getRandomChar
	add	sp, 2
	mov	[bp+target], ax
	lea	ax, [bp+var_10E]
	mov	word ptr [bp+var_114], ax
	mov	word ptr [bp+var_114+2], ss
	mov	[bp+var_110], 0
	jmp	short loc_1B69D
loc_1B699:
	inc	[bp+var_110]
loc_1B69D:
	cmp	[bp+var_110], 7
	jge	short loc_1B6B5
	mov	bx, [bp+var_110]
	mov	al, byte ptr breathAttack.effectStrIndex[bx]
	lfs	si, [bp+var_114]
	mov	fs:[bx+si], al
	jmp	short loc_1B699
loc_1B6B5:
	getMonP	[bp+arg_0], bx
	mov	al, gs:monGroups.breathFlag[bx]
	mov	[bp+var_10C], al
	sub	ah, ah
	xor	al, 0Ah
	push	ax
	push	[bp+var_102]
	push	[bp+var_104]
	mov	ax, offset aFirBreathEs
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_104], ax
	mov	[bp+var_102], dx

	null_terminate [bp+var_104]

	mov	al, [bp+arg_4]
	mov	[bp+var_10A], al
	mov	al, byte ptr [bp+target]
	mov	gs:bat_curTarget, al
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	getMonP	[bp+arg_0], bx
	mov	al, gs:monGroups.breathRange[bx]
	sub	ah, ah
	push	ax
	sub	sp, 8
	lea	si, [bp+var_10E]
	mov	di, sp
	push	ss
	pop	es
	assume es:nothing
	movsw
	movsw
	movsw
	movsb
	push	[bp+arg_0]
	call	bat_doBreathAttack
	add	sp, 0Ch
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
bat_monBreathAttack endp

; Attributes: bp-based frame

bat_doMonMelee proc far

	var_122= byte ptr -122h
	var_120= word ptr -120h
	var_11E= word ptr -11Eh
	var_11C= word ptr -11Ch
	var_11A= word ptr -11Ah
	var_118= word ptr -118h
	var_116= word ptr -116h
	var_106= dword ptr -106h
	var_102= word ptr -102h
	var_100= word ptr -100h
	monNo= word ptr	 6
	arg_2= word ptr  8
	arg_4= word ptr  0Ah
	arg_6= word ptr	 0Ch

	push	bp
	mov	bp, sp
	mov	ax, 122h
	call	someStackOperation
	push	si
	lea	ax, [bp+var_116]
	push	ss
	push	ax
	getMonP	[bp+monNo], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	decryptName
	add	sp, 8
	lea	ax, [bp+var_100]
	mov	word ptr [bp+var_106], ax
	mov	word ptr [bp+var_106+2], ss
	getMonP	[bp+monNo], si
	mov	al, gs:monGroups.distance[si]
	and	al, 0Fh
	cmp	al, 2
	jnb	short loc_1B792
	jmp	loc_1B8E8
loc_1B792:
	mov	al, gs:monGroups.packedGenAc[si]
	and	al, 0C0h
	cmp	al, 0C0h 
	jnz	short loc_1B7A5
	mov	[bp+var_11A], 0
	jmp	short loc_1B818
loc_1B7A5:
	getMonP	[bp+monNo], bx
	mov	al, gs:monGroups.groupSize[bx]
	and	al, 1Fh
	cmp	al, 2
	jnb	short loc_1B7F5
	mov	[bp+var_11A], 0
	lfs	bx, [bp+var_106]
	inc	word ptr [bp+var_106]
	mov	byte ptr fs:[bx], 'A'
	mov	al, byte ptr [bp+var_116]
	cbw
	push	ax
	push	cs
	call	near ptr str_startsWithVowel
	add	sp, 2
	or	ax, ax
	jz	short loc_1B7E7
	lfs	bx, [bp+var_106]
	inc	word ptr [bp+var_106]
	mov	byte ptr fs:[bx], 'n'
loc_1B7E7:
	lfs	bx, [bp+var_106]
	inc	word ptr [bp+var_106]
	mov	byte ptr fs:[bx], ' '
	jmp	short loc_1B818
loc_1B7F5:
	mov	[bp+var_11A], 1
	mov	ax, offset aThe
	push	ds
	push	ax
	push	word ptr [bp+var_106+2]
	push	word ptr [bp+var_106]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_106], ax
	mov	word ptr [bp+var_106+2], dx
loc_1B818:
	push	[bp+var_11A]
	push	word ptr [bp+var_106+2]
	push	word ptr [bp+var_106]
	lea	ax, [bp+var_116]
	push	ss
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	word ptr [bp+var_106], ax
	mov	word ptr [bp+var_106+2], dx
	push	[bp+var_11A]
	push	dx
	push	ax
	mov	ax, offset aAdvanceS
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	word ptr [bp+var_106], ax
	mov	word ptr [bp+var_106+2], dx
	getMonP	[bp+monNo], bx
	mov	al, gs:monGroups.distance[bx]
	mov	[bp+var_122], al
	sub	ah, ah
	mov	si, ax
	mov	cl, 4
	shr	ax, cl
	mov	[bp+var_11E], ax
	mov	ax, si
	and	ax, 0Fh
	mov	[bp+var_102], ax
	mov	ax, [bp+var_11E]
	cmp	[bp+var_102], ax
	jle	short loc_1B893
	mov	ax, [bp+var_102]
	sub	ax, [bp+var_11E]
	jmp	short loc_1B896
loc_1B893:
	mov	ax, 1
loc_1B896:
	mov	[bp+var_120], ax
	mov	al, byte ptr [bp+var_120]
	mov	cl, [bp+var_122]
	and	cl, 0F0h
	add	al, cl
	mov	cx, ax
	getMonP	[bp+monNo], bx
	mov	gs:monGroups.distance[bx], cl
	mov	[bp+var_118], 0
	jmp	short loc_1B8C2
loc_1B8BE:
	inc	[bp+var_118]
loc_1B8C2:
	cmp	[bp+var_118], 20h 
	jge	short loc_1B8E5
	mov	bx, [bp+monNo]
	mov	cl, 6
	shl	bx, cl
	mov	ax, [bp+var_118]
	shl	ax, 1
	add	bx, ax
	mov	gs:bat_monPriorityList[bx], 0
	jmp	short loc_1B8BE
loc_1B8E5:
	jmp	loc_1BA3B
loc_1B8E8:
	push	[bp+monNo]
	push	word ptr [bp+var_106+2]
	push	word ptr [bp+var_106]
	push	cs
	call	near ptr bat_getMonAttackerName
	add	sp, 6
	mov	word ptr [bp+var_106], ax
	mov	word ptr [bp+var_106+2], dx
	call	_random
	and	ax, 1
	mov	cx, ax
	getMonP	[bp+monNo], bx
	mov	al, gs:monGroups.flags[bx]
	sub	ah, ah
	and	ax, mon_attackStr
	shl	ax, 1
	add	ax, cx
	mov	[bp+var_11C], ax
	mov	bx, ax
	shl	bx, 1
	shl	bx, 1
	push	word ptr (monMeleeAttString+2)[bx]
	push	word ptr monMeleeAttString[bx]
	push	word ptr [bp+var_106+2]
	push	word ptr [bp+var_106]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_106], ax
	mov	word ptr [bp+var_106+2], dx
	lfs	bx, [bp+var_106]
	inc	word ptr [bp+var_106]
	mov	byte ptr fs:[bx], ' '
	mov	ax, 3
	push	ax
	push	cs
	call	near ptr bat_getRandomChar
	add	sp, 2
	mov	gs:bat_curTarget, al
	sub	ah, ah
	push	ax
	push	word ptr [bp+var_106+2]
	push	word ptr [bp+var_106]
	push	cs
	call	near ptr bat_getAttackerName
	add	sp, 6
	mov	word ptr [bp+var_106], ax
	mov	word ptr [bp+var_106+2], dx

	; Push the special attack value
	push	[bp+arg_4]

	push	[bp+arg_6]
	mov	al, gs:bat_curTarget
	sub	ah, ah
	push	ax
	push	[bp+monNo]
	push	cs
	call	near ptr bat_monHitChar
	add	sp, 8
	or	ax, ax
	jnz	short loc_1B9C4
	mov	ax, offset aButMisses
	push	ds
	push	ax
	push	word ptr [bp+var_106+2]
	push	word ptr [bp+var_106]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_106], ax
	mov	word ptr [bp+var_106+2], dx
	jmp	loc_1BA3B
loc_1B9C4:
	sub	ax, ax
	push	ax
	push	word ptr [bp+var_106+2]
	push	word ptr [bp+var_106]
	push	cs
	call	near ptr bat_printHitDamage
	add	sp, 6
	mov	word ptr [bp+var_106], ax
	mov	word ptr [bp+var_106+2], dx
	mov	al, gs:bat_curTarget
	sub	ah, ah
	push	ax
	push	cs
	call	near ptr bat_doHPDamage
	add	sp, 2
	or	ax, ax
	jz	short loc_1BA2F
	push	word ptr [bp+var_106+2]
	push	word ptr [bp+var_106]
	push	cs
	call	near ptr bat_getKillString
	add	sp, 4
	mov	word ptr [bp+var_106], ax
	mov	word ptr [bp+var_106+2], dx
	mov	ax, 1
	push	ax
	mov	ax, 3
	push	ax
	mov	al, gs:bat_curTarget
	sub	ah, ah
	push	ax
	push	dx
	push	word ptr [bp+var_106]
	call	printCharPronoun
	add	sp, 0Ah
	mov	word ptr [bp+var_106], ax
	mov	word ptr [bp+var_106+2], dx
	jmp	loc_1BA3B
loc_1BA2F:
	strcat_offset	aPeriodBlankLine, var_106
loc_1BA3B:
	lfs	bx, [bp+var_106]
	inc	word ptr [bp+var_106]
	mov	byte ptr fs:[bx], 0
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	byte ptr word_44166,	0
	delayWithTable
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_doMonMelee endp

; Attributes: bp-based frame

bat_getMonAttackerName proc far

	var_10=	word ptr -10h
	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 10h
	call	someStackOperation
	lea	ax, [bp+var_10]
	push	ss
	push	ax
	getMonP	[bp+arg_4], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	decryptName
	add	sp, 8
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], 41h
	mov	al, byte ptr [bp+var_10]
	cbw
	push	ax
	push	cs
	call	near ptr str_startsWithVowel
	add	sp, 2
	or	ax, ax
	jz	short loc_1BABD
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], 'n'
loc_1BABD:
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], ' '
	sub	ax, ax
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	lea	ax, [bp+var_10]
	push	ss
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	word ptr [bp+arg_0], ax
	mov	word ptr [bp+arg_0+2], dx
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], ' '
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
bat_getMonAttackerName endp

; Attributes: bp-based frame

bat_getRandomChar proc far

	var_4= word ptr	-4
	counter= word ptr -2
	_mask= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	[bp+counter], 0
	jmp	short loc_1BB0E
loc_1BB0B:
	inc	[bp+counter]
loc_1BB0E:
	cmp	[bp+counter], 7
	jge	short loc_1BB32
	call	_random
	and	ax, [bp+_mask]
	mov	[bp+var_4], ax
	push	ax
	push	cs
	call	near ptr bat_charCanBeAttacked
	add	sp, 2
	or	ax, ax
	jz	short loc_1BB30
	mov	ax, [bp+var_4]
	jmp	short loc_1BB36
loc_1BB30:
	jmp	short loc_1BB0B
loc_1BB32:
	sub	ax, ax
	jmp	short $+2
loc_1BB36:
	mov	sp, bp
	pop	bp
	retf
bat_getRandomChar endp

; Attributes: bp-based frame

bat_monHitChar proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	monNo= word ptr	 6
	target=	word ptr  8
	field_17= word ptr  0Ah
	spAttack = word ptr 0Ch

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	gs:specialAttackVal, 0
	mov	gs:damageAmount, 0
	mov	bx, [bp+target]
	cmp	gs:byte_42280[bx], 0
	jz	short loc_1BB70
	sub	ax, ax
	jmp	loc_1BC04
loc_1BB70:
	getCharP	bx, bx
	mov	al, gs:roster.ac[bx]
	cbw
	mov	bx, [bp+monNo]
	mov	cl, gs:byte_4229C[bx]
	sub	ch, ch
	add	ax, cx
	mov	[bp+var_2], ax
	cmp	ax, 3Fh
	jle	short loc_1BB9E
	mov	[bp+var_2], 3Fh
loc_1BB9E:
	getMonP	bx, si
	mov	al, gs:monGroups.toHitHi[si]
	sub	ah, ah
	push	ax
	mov	al, gs:monGroups.toHitLo[si]
	push	ax
	push	cs
	call	near ptr randomBetweenXandY
	add	sp, 4
	mov	bx, [bp+monNo]
	mov	cl, gs:byte_42422[bx]
	sub	ch, ch
	add	cx, ax
	mov	[bp+var_4], cx
	mov	ax, [bp+var_2]
	cmp	cx, ax
	jge	short loc_1BBDC
	sub	ax, ax
	jmp	short loc_1BC04
loc_1BBDC:

	; Add monster special attack
	mov	ax, [bp+spAttack]
	mov	gs:specialAttackVal, ax

	push	[bp+field_17]
	push	cs
	call	near ptr dice_doYDX
	add	sp, 2
	mov	bx, [bp+monNo]
	mov	cl, gs:byte_42422[bx]
	sub	ch, ch
	add	cx, ax
	mov	gs:damageAmount, cx
	mov	ax, 1
	jmp	short $+2
loc_1BC04:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_monHitChar endp

; Attributes: bp-based frame

bat_charCanBeAttacked proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	[bp+arg_0], 7
	jnz	short loc_1BC1D
	sub	ax, ax
	jmp	short loc_1BC85
loc_1BC1D:
	getCharP	[bp+arg_0], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jnz	short loc_1BC35
	sub	ax, ax
	jmp	short loc_1BC85
loc_1BC35:
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.class[bx], class_illusion
	jnz	short loc_1BC55
	cmp	gs:monDisbelieveFlag, 0
	jnz	short loc_1BC55
	sub	ax, ax
	jmp	short loc_1BC85
loc_1BC55:
	mov	bx, [bp+arg_0]
	cmp	gs:byte_42280[bx], 0
	jz	short loc_1BC68
	sub	ax, ax
	jmp	short loc_1BC85
loc_1BC68:
	getCharP	bx, bx
	mov	al, gs:roster.status[bx]
	and	al, 0Ch
	mov	cx, ax
	cmp	cl, 1
	sbb	ax, ax
	neg	ax
	jmp	short $+2
loc_1BC85:
	mov	sp, bp
	pop	bp
	retf
bat_charCanBeAttacked endp

; Attributes: bp-based frame
bat_doSummonAttack proc	far

	var_C= word ptr	-0Ch
	attDamage= word	ptr -0Ah
	var_8= word ptr	-8
	attType= word ptr -6
	var_4= dword ptr -4
	charNo=	word ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 0Ch
	call	someStackOperation
	push	si

	getCharIndex	ax, [bp+charNo]
	add	ax, offset roster
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], seg seg027
	lfs	bx, [bp+var_4]
	cmp	fs:[bx+summonStat_t.class], class_illusion
	jnz	short loc_1BCBF
	cmp	gs:monDisbelieveFlag, 0
	jz	short loc_1BCBF
	jmp	loc_1BD50
loc_1BCBF:
	call	_random
	and	ax, 6
	mov	[bp+var_8], ax
	mov	si, ax
	lfs	bx, [bp+var_4]
	mov	al, fs:[bx+si+summonStat_t.attacks._type]
	sub	ah, ah
	mov	[bp+attType], ax
	mov	al, fs:[bx+si+summonStat_t.attacks.damage]
	mov	[bp+attDamage],	ax
	cmp	[bp+attType], 80h
	jge	short loc_1BCF6
	push	ax
	push	[bp+attType]
	push	[bp+charNo]
	push	cs
	call	near ptr bat_summonCastSpell
	add	sp, 6
	jmp	short loc_1BD50
loc_1BCF6:
	mov	ax, [bp+attType]
	sub	ax, 0F0h
	and	ax, 7Fh
	mov	[bp+var_C], ax
	cmp	[bp+var_C], 0Ah
	jge	short loc_1BD1F
	push	[bp+attDamage]
	push	[bp+var_C]
	push	[bp+charNo]
	push	cs
	call	near ptr bat_summonMeleeAttack
	add	sp, 6
	jmp	short loc_1BD50
loc_1BD1F:
	mov	ax, [bp+var_C]
	jmp	short loc_1BD44
loc_1BD24:
	push	[bp+attDamage]
	push	[bp+charNo]
	push	cs
	call	near ptr bat_summonBreathAttack
	add	sp, 4
	jmp	short loc_1BD50
loc_1BD33:
	push	[bp+attDamage]
	push	[bp+charNo]
	push	cs
	call	near ptr bat_doCombatSong
	add	sp, 4
loc_1BD40:
	jmp	short loc_1BD50
	jmp	short loc_1BD50
loc_1BD44:
	cmp	ax, 10h
	jz	short loc_1BD24
	cmp	ax, 11h
	jz	short loc_1BD33
	jmp	short loc_1BD40
loc_1BD50:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_doSummonAttack endp

; Attributes: bp-based frame

bat_summonCastSpell proc far

	target=	word ptr -6
	charP= dword ptr -4
	charNo=	word ptr  6
	spellNo= word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	getCharIndex	ax, [bp+charNo]
	add	ax, offset roster
	mov	word ptr [bp+charP], ax
	mov	word ptr [bp+charP+2], seg seg027
	mov	bx, [bp+spellNo]
	test	byte_47F94[bx], 20h
	jz	short loc_1BD90
	mov	ax, 7
	push	ax
	push	cs
	call	near ptr bat_getRandomChar
	add	sp, 2
	mov	[bp+target], ax
	jmp	short loc_1BDB7
loc_1BD90:
	lfs	bx, [bp+charP]
	cmp	fs:[bx+summonStat_t.hostileFlag], 0
	jz	short loc_1BDA7
	mov	ax, 7
	push	ax
	push	cs
	call	near ptr bat_getRandomChar
	add	sp, 2
	jmp	short loc_1BDAA
loc_1BDA7:
	mov	ax, 80h
loc_1BDAA:
	mov	[bp+target], ax
	mov	ax, [bp+charNo]
	cmp	[bp+target], ax
	jnz	short loc_1BDB7
	jmp	short loc_1BDD7
loc_1BDB7:
	mov	al, byte ptr [bp+target]
	mov	gs:bat_curTarget, al
	sub	ax, ax
	push	ax
	mov	ax, 1
	push	ax
	push	[bp+spellNo]
	push	[bp+charNo]
	call	doCastSpell
	add	sp, 8
loc_1BDD7:
	mov	sp, bp
	pop	bp
	retf
bat_summonCastSpell endp

; Attributes: bp-based frame

bat_summonMeleeAttack proc far

	var_6= word ptr	-6
	var_4= dword ptr -4
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	cmp	[bp+arg_0], 4
	jl	short loc_1BDEE
	jmp	short loc_1BE3F
loc_1BDEE:
	getCharIndex	ax, [bp+arg_0]
	add	ax, offset roster
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], seg seg027
	lfs	bx, [bp+var_4]
	cmp	fs:[bx+summonStat_t.hostileFlag], 0
	jz	short loc_1BE16
	mov	ax, 7
	push	ax
	push	cs
	call	near ptr bat_getRandomChar
	add	sp, 2
	jmp	short loc_1BE19
loc_1BE16:
	mov	ax, 80h
loc_1BE19:
	mov	[bp+var_6], ax
	mov	ax, [bp+arg_4]
	mov	gs:summonMeleeDamage, ax
	mov	ax, [bp+arg_2]
	mov	gs:summonMeleeType, ax
	push	[bp+var_6]
	push	[bp+arg_0]
	push	cs
	call	near ptr bat_doCharMeleeAttack
	add	sp, 4
loc_1BE3F:
	mov	sp, bp
	pop	bp
	retf
bat_summonMeleeAttack endp

; Attributes: bp-based frame

bat_summonBreathAttack proc far

	var_104 = word ptr -118h
	var_102 = word ptr -116h
	var_100 = word ptr -114h
	argP= dword ptr	-14h
	counter= word ptr -10h
	argList= byte ptr -0Ch
	var_A= byte ptr	-0Ah
	var_8= byte ptr	-8
	charP= dword ptr -4
	charNo=	word ptr  6
	damage=	byte ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 118h
	call	someStackOperation
	push	di
	push	si

	; Get the breather's name
	push	[bp+charNo]
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	push	cs
	call	near ptr bat_getAttackerName
	add	sp, 6
	mov	[bp+var_104], ax
	mov	[bp+var_102], dx

	getCharIndex	ax, [bp+charNo]
	add	ax, offset roster
	mov	word ptr [bp+charP], ax
	mov	word ptr [bp+charP+2], seg seg027
	lfs	bx, [bp+charP]
	cmp	fs:[bx+summonStat_t.hostileFlag], 0
	jz	short loc_1BE78
	mov	ax, 7
	push	ax
	push	cs
	call	near ptr bat_getRandomChar
	add	sp, 2
	jmp	short loc_1BE7A
loc_1BE78:
	mov	al, 80h
loc_1BE7A:
	mov	gs:bat_curTarget, al
	lea	ax, [bp+argList]
	mov	word ptr [bp+argP], ax
	mov	word ptr [bp+argP+2], ss
	mov	[bp+counter], 0
	jmp	short loc_1BE95
loc_1BE92:
	inc	[bp+counter]
loc_1BE95:
	cmp	[bp+counter], 7
	jge	short loc_1BEAA
	mov	bx, [bp+counter]
	mov	al, byte ptr breathAttack.effectStrIndex[bx]
	lfs	si, [bp+argP]
	mov	fs:[bx+si], al
	jmp	short loc_1BE92
loc_1BEAA:
	lfs	bx, [bp+charP]
	mov	al, fs:[bx+summonStat_t.breathFlag]
	mov	[bp+var_A], al

	; Add the fire/breath string
	sub	ah, ah
	xor	al, 0Ah
	push	ax
	push	[bp+var_102]
	push	[bp+var_104]
	mov	ax, offset aFirBreathEs
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_104], ax
	mov	[bp+var_102], dx

	; NULL terminate the string
	null_terminate	[bp+var_104]

	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printString
	add	sp,4
	
	mov	al, [bp+damage]
	mov	[bp+var_8], al

	lfs	bx, [bp+charP]

	mov	al, fs:[bx+summonStat_t.breathRange]
	sub	ah, ah
	push	ax
	sub	sp, 8
	lea	si, [bp+argList]
	mov	di, sp
	push	ss
	pop	es
	movsw
	movsw
	movsw
	movsb
	push	[bp+charNo]
	call	bat_doBreathAttack
	add	sp, 0Ch
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
bat_summonBreathAttack endp

; Attributes: bp-based frame

bat_doCharMeleeAttack proc far

	var_10C= dword ptr -10Ch
	var_108= word ptr -108h
	var_106= word ptr -106h
	var_6= word ptr	-6
	var_4= dword ptr -4
	arg_0= word ptr 6
	arg_2= word ptr 8

	func_enter
	_chkstk	10Ch

	push	si

	cmp	[bp+arg_2], 80h
	jge	short loc_1BF22

	getCharP	[bp+arg_2], si
	cmp	gs:roster.class[si], class_monster
	jnz	short loc_1BF0D
	mov	gs:roster.hostileFlag[si], 1

loc_1BF0D:
	getCharP	[bp+arg_2], bx
	test	gs:roster.status[bx], stat_dead	or stat_stoned
	jz	short loc_1BF20
	jmp	loc_1C0F0

loc_1BF20:
	jmp	short loc_1BF3E

loc_1BF22:
	mov	ax, [bp+arg_2]
	and	ax, 3
	getMonIndex	cx, cx
	mov	bx, ax
	test	gs:monGroups.groupSize[bx], 1Fh
	jnz	short loc_1BF3E
	jmp	loc_1C0F0

loc_1BF3E:
	getCharP	[bp+arg_0], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, [bp+var_106]
	push	ss
	push	ax
	do_strcat	var_10C
	dword_appendChar	var_10C, ' '

	push_imm	1
	push	[bp+arg_0]

	std_call	sub_18077, 4

	or	ax, ax
	jz	short loc_1BF8B
	mov	[bp+var_6], 0
	jmp	short loc_1BFBF
loc_1BF8B:
	getCharP	[bp+arg_0], si
	cmp	gs:roster.class[si], class_monster
	jb	short loc_1BFBA
	add	ax, offset roster

	save_ptr_stack	seg seg027, ax, var_4
	lfs	bx, [bp+var_4]
	mov	al, fs:[bx+(character_t.spells+0Ah)]
	sub	ah, ah
	shl	ax, 1
	mov	[bp+var_6], ax
	jmp	short loc_1BFBF
loc_1BFBA:
	mov	[bp+var_6], 2
loc_1BFBF:
	call	_random
	and	ax, 1
	add	[bp+var_6], ax
	mov	bx, [bp+var_6]
	shl	bx, 1
	shl	bx, 1
	push_ptr_stringList	monMeleeAttString, bx
	push_ptr_stack		var_10C
	do_strcat	var_10C
	dword_appendChar	var_10C, ' '

	push	[bp+arg_2]
	push_ptr_stack	var_10C
	far_call	bat_getAttackerName, 6
	save_ptr_stack	dx,ax,var_10C

	push	[bp+arg_2]
	push	[bp+arg_0]
	far_call	bat_getCharDamage, 4
	mov	[bp+var_108], ax
	or	ax, ax
	jnz	short loc_1C04B

	push_ds_string	aButMisses
	push_ptr_stack	var_10C
	std_call	_strcat, 8
	save_ptr_stack	dx,ax,var_10C

	jmp	short loc_1C0B3
loc_1C04B:
	push	[bp+var_108]
	push_ptr_stack	var_10C
	far_call	bat_printHitDamage, 6
	save_ptr_stack	dx,ax,var_10C

	push_var_stack	arg_2
	far_call	bat_doHPDamage, 2
	or	ax, ax
	jz	short loc_1C0A7

	push_ptr_stack	var_10C
	far_call	bat_getKillString,4
	save_ptr_stack	dx,ax,var_10C

	push_imm	1
	push_imm	3
	push_var_stack	arg_2
	push_reg	dx
	push	word ptr [bp+var_10C]
	std_call	printCharPronoun, 0Ah
	save_ptr_stack	dx,ax,var_10C
	jmp	short loc_1C0B3

loc_1C0A7:
	strcat_offset	aPeriodBlankLine, var_10C

loc_1C0B3:
	dword_appendChar	var_10C, 0
	mov	byte ptr fs:[bx], 0
	lea	ax, [bp+var_106]
	push	ss
	push	ax
	std_Call	printString, 4

	mov	bx, [bp+arg_0]
	mov	gs:byte_42280[bx], 0
	mov	byte ptr word_44166,	0

	delayWithTable
loc_1C0F0:
	pop	si
	func_exit
	retf
bat_doCharMeleeAttack endp

; Attributes: bp-based frame

bat_getAttackerName proc far

	var_10=	word ptr -10h
	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah

	func_enter
	_chkstk	10h

	cmp	[bp+arg_4], 80h
	jge	short loc_1C12E
	getCharP	[bp+arg_4], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push_reg	dx
	push_reg	ax
	push_ptr_stack	arg_0
	do_strcat	arg_0

	jmp	short loc_1C19A
loc_1C12E:
	and	[bp+arg_4], 3
	dword_appendChar	arg_0, 'a'
	lea	ax, [bp+var_10]
	push_reg	ss
	push_reg	ax
	getMonP	[bp+arg_4], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push_reg	dx
	push_reg	ax
	std_call	decryptName, 8
	mov	al, byte ptr [bp+var_10]
	cbw
	push_reg	ax
	far_call	str_startsWithVowel, 2
	or	ax, ax
	jz	short loc_1C174
	dword_appendChar	arg_0, 'n'
loc_1C174:
	dword_appendChar	arg_0, ' '
	sub	ax, ax
	push	ax
	push_ptr_stack	arg_0
	lea	ax, [bp+var_10]
	push	ss
	push	ax
	std_call	str_pluralize, 0Ah
	save_ptr_stack	dx,ax,arg_0
loc_1C19A:
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
bat_getAttackerName endp

; This function	returns	1 if the passed	string starts
; with a vowel.	This is	for proper use of a/an in
; strings.
; Attributes: bp-based frame

str_startsWithVowel proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	[bp+arg_0]
	call	_str_capitalize
	add	sp, 2
	mov	[bp+arg_0], ax
	mov	[bp+var_2], 0
	jmp	short loc_1C1C9
loc_1C1C6:
	inc	[bp+var_2]
loc_1C1C9:
	cmp	[bp+var_2], 6
	jge	short loc_1C1E3
	mov	bx, [bp+var_2]
	mov	al, vowelList[bx]
	cbw
	cmp	ax, [bp+arg_0]
	jnz	short loc_1C1E1
	mov	ax, 1
	jmp	short loc_1C1E7
loc_1C1E1:
	jmp	short loc_1C1C6
loc_1C1E3:
	sub	ax, ax
	jmp	short $+2
loc_1C1E7:
	mov	sp, bp
	pop	bp
	retf
str_startsWithVowel endp

; Attributes: bp-based frame

bat_doCharCastSpell proc far

	charNo=	word ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	bx, [bp+charNo]
	mov	al, gs:byte_42276[bx]
	mov	gs:bat_curTarget, al
	mov	ax, 1
	push	ax
	push	ax
	mov	al, gs:byte_42244[bx]
	sub	ah, ah
	push	ax
	push	bx
	call	doCastSpell
	add	sp, 8
	mov	sp, bp
	pop	bp
	retf
bat_doCharCastSpell endp

; Attributes: bp-based frame

bat_doCharUseItem proc far

	charNo=	word ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 1
	push	ax
	mov	bx, [bp+charNo]
	mov	al, gs:byte_42244[bx]
	sub	ah, ah
	push	ax
	mov	al, gs:byte_42276[bx]
	push	ax
	mov	al, gs:byte_42334[bx]
	push	ax
	push	bx
	call	sub_11E07
	add	sp, 0Ah
	mov	sp, bp
	pop	bp
	retf
bat_doCharUseItem endp

; Attributes: bp-based frame

bat_hideInShadows proc far

	var_108= word ptr -108h
	var_106= word ptr -106h
	var_104= word ptr -104h
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 108h
	call	someStackOperation
	getCharP	[bp+arg_0], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, [bp+var_104]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_108], ax
	mov	[bp+var_106], dx
	mov	ax, offset aJumpsIntoTheShadows
	push	ds
	push	ax
	push	dx
	push	[bp+var_108]
	call	_strcat
	add	sp, 8
	mov	[bp+var_108], ax
	mov	[bp+var_106], dx
	mov	ax, itemEff_alwaysHide
	push	ax
	push	[bp+arg_0]
	call	hasEffectEquipped
	add	sp, 4
	or	ax, ax
	jz	short loc_1C2DE
	call	_random
	mov	cx, ax
	getCharP	[bp+arg_0], bx
	cmp	gs:(roster.specAbil+2)[bx], cl
	jbe	short loc_1C2F5
loc_1C2DE:
	mov	ax, offset aAndSucceeds
	mov	[bp+var_4], ax
	mov	[bp+var_2], ds
	mov	bx, [bp+arg_0]
	inc	gs:byte_42280[bx]
	jmp	short loc_1C30B
loc_1C2F5:
	mov	ax, offset aButIsDiscovered
	mov	[bp+var_4], ax
	mov	[bp+var_2], ds
	mov	bx, [bp+arg_0]
	mov	gs:byte_42280[bx], 0
loc_1C30B:
	push	[bp+var_2]
	push	[bp+var_4]
	push	[bp+var_106]
	push	[bp+var_108]
	call	_strcat
	add	sp, 8
	lea	ax, [bp+var_104]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
bat_hideInShadows endp

; Attributes: bp-based frame

bat_doCharSong proc far

	var_108= word ptr -108h
	var_106= word ptr -106h
	var_102= word ptr -102h
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 108h
	call	someStackOperation
	mov	[bp+var_2], 0
	getCharP	[bp+arg_0], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, [bp+var_102]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_108], ax
	mov	[bp+var_106], dx
	mov	ax, itemEff_freeSinging
	push	ax
	push	[bp+arg_0]
	call	hasEffectEquipped
	add	sp, 4
	or	ax, ax
	jnz	short loc_1C384
	mov	[bp+var_2], 1
	jmp	short loc_1C3AA
loc_1C384:
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.specAbil[bx],	0
	jz	short loc_1C3AA
	mov	[bp+var_2], 1
	getCharP	[bp+arg_0], bx
	dec	gs:roster.specAbil[bx]
loc_1C3AA:
	cmp	[bp+var_2], 0
	jz	short loc_1C3F4
	mov	ax, offset aPlays___
	push	ds
	push	ax
	push	[bp+var_106]
	push	[bp+var_108]
	call	_strcat
	add	sp, 8
	mov	[bp+var_108], ax
	mov	[bp+var_106], dx
	lea	ax, [bp+var_102]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	bx, [bp+arg_0]
	mov	al, gs:byte_42244[bx]
	sub	ah, ah
	push	ax
	push	bx
	push	cs
	call	near ptr bat_doCombatSong
	add	sp, 4
	jmp	short loc_1C455
loc_1C3F4:
	mov	ax, offset aLost
	push	ds
	push	ax
	push	[bp+var_106]
	push	[bp+var_108]
	call	_strcat
	add	sp, 8
	mov	[bp+var_108], ax
	mov	[bp+var_106], dx
	mov	ax, 0
	push	ax
	mov	ax, 6
	push	ax
	push	[bp+arg_0]
	push	dx
	push	[bp+var_108]
	call	printCharPronoun
	add	sp, 0Ah
	mov	[bp+var_108], ax
	mov	[bp+var_106], dx
	mov	ax, offset aVoice
	push	ds
	push	ax
	push	dx
	push	[bp+var_108]
	call	_strcat
	add	sp, 8
	mov	[bp+var_108], ax
	mov	[bp+var_106], dx
	lea	ax, [bp+var_102]
	push	ss
	push	ax
	call	printString
	add	sp, 4
loc_1C455:
	mov	sp, bp
	pop	bp
	retf
bat_doCharSong endp

; Attributes: bp-based frame

bat_charMeleeAttack proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	getCharP	[bp+arg_0], bx
	test	gs:roster.status[bx], stat_nuts
	jz	short loc_1C480
	call	_random
	test	al, 1
	jnz	short loc_1C494
loc_1C480:
	getCharIndex	ax, [bp+arg_0]
	mov	bx, ax
	cmp	gs:roster.hostileFlag[bx], 0
	jz	short loc_1C4AD
loc_1C494:
	mov	ax, 7
	push	ax
	push	cs
	call	near ptr bat_getRandomChar
	add	sp, 2
	mov	bx, [bp+arg_0]
	mov	gs:byte_42244[bx], al
	jmp	short loc_1C4C8
loc_1C4AD:
	cmp	byte ptr gs:monGroups._name, 0
	jnz	short loc_1C4BB
	jmp	short loc_1C4D2
loc_1C4BB:
	mov	bx, [bp+arg_0]
	mov	gs:byte_42244[bx], 80h
loc_1C4C8:
	push	[bp+arg_0]
	push	cs
	call	near ptr bat_doCharMeleeAttack
	add	sp, 2
loc_1C4D2:
	mov	sp, bp
	pop	bp
	retf
bat_charMeleeAttack endp

; This function	returns	the highest priority in	the
; party. The character number with the highest
; priority is returned via membuf.
; Attributes: bp-based frame

bat_getHighCharPrio proc far

	char= word ptr -6
	charNo=	word ptr -4
	highestPriority= word ptr -2
	membuf=	dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	mov	[bp+highestPriority], 0
	mov	[bp+char], 0
	mov	[bp+charNo], 0
	jmp	short loc_1C4F6
loc_1C4F3:
	inc	[bp+charNo]
loc_1C4F6:
	cmp	[bp+charNo], 7
	jge	short loc_1C51B
	mov	bx, [bp+charNo]
	mov	al, gs:bat_charPriority[bx]
	sub	ah, ah
	mov	si, ax
	cmp	[bp+highestPriority], si
	jnb	short loc_1C519
	mov	[bp+highestPriority], si
	mov	ax, bx
	mov	[bp+char], ax
loc_1C519:
	jmp	short loc_1C4F3
loc_1C51B:
	lfs	bx, [bp+membuf]
	mov	ax, [bp+char]
	mov	fs:[bx], ax
	mov	ax, [bp+highestPriority]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_getHighCharPrio endp

; This function	returns	the highest attack priority
; in the monster groups. The monster group and
; monster index	is returned in rGroup and rMon
; respectively.
; Attributes: bp-based frame

bat_getHighMonPriority proc far

	highMon= word ptr -0Ch
	monNo= word ptr	-0Ah
	groupNo= word ptr -8
	highPri= word ptr -6
	highGroup= word	ptr -4
	var_2= word ptr	-2
	rGroup=	dword ptr  6
	rMon= dword ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 0Ch
	call	someStackOperation
	push	si
	sub	ax, ax
	mov	[bp+highMon], ax
	mov	[bp+highGroup],	ax
	mov	[bp+highPri], ax
	mov	[bp+groupNo], ax
	jmp	short loc_1C54D
loc_1C54A:
	inc	[bp+groupNo]
loc_1C54D:
	cmp	[bp+groupNo], 4
	jge	short loc_1C5B1
	getMonP	[bp+groupNo], bx
	mov	al, gs:monGroups.groupSize[bx]
	sub	ah, ah
	and	ax, 1Fh
	mov	[bp+var_2], ax
	or	ax, ax
	jz	short loc_1C5AF
	mov	[bp+monNo], 0
	jmp	short loc_1C57A
loc_1C577:
	inc	[bp+monNo]
loc_1C57A:
	mov	ax, [bp+var_2]
	cmp	[bp+monNo], ax
	jge	short loc_1C5AF
	mov	bx, [bp+groupNo]
	mov	cl, 6
	shl	bx, cl
	mov	ax, [bp+monNo]
	shl	ax, 1
	add	bx, ax
	mov	si, gs:bat_monPriorityList[bx]
	cmp	[bp+highPri], si
	jge	short loc_1C5AD
	mov	[bp+highPri], si
	mov	ax, [bp+groupNo]
	mov	[bp+highGroup],	ax
	mov	ax, [bp+monNo]
	mov	[bp+highMon], ax
loc_1C5AD:
	jmp	short loc_1C577
loc_1C5AF:
	jmp	short loc_1C54A
loc_1C5B1:
	lfs	bx, [bp+rGroup]
	mov	ax, [bp+highGroup]
	mov	fs:[bx], ax
	lfs	bx, [bp+rMon]
	mov	ax, [bp+highMon]
	mov	fs:[bx], ax
	mov	ax, [bp+highPri]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_getHighMonPriority endp

; Attributes: bp-based frame

bat_getAttackPriority proc far

	var_E= word ptr	-0Eh
	var_C= word ptr	-0Ch
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= dword ptr -4

	push	bp
	mov	bp, sp
	mov	ax, 0Eh
	call	someStackOperation
	push	si
	cmp	gs:partyFrozenFlag, 0
	jz	short loc_1C611
	mov	[bp+var_C], 0
	jmp	short loc_1C5EF
loc_1C5EC:
	inc	[bp+var_C]
loc_1C5EF:
	cmp	[bp+var_C], 7
	jge	short loc_1C604
	mov	bx, [bp+var_C]
	mov	gs:bat_charPriority[bx], 0
	jmp	short loc_1C5EC
loc_1C604:
	mov	gs:partyFrozenFlag, 0
	jmp	loc_1C707
loc_1C611:
	mov	[bp+var_C], 0
	jmp	short loc_1C61B
loc_1C618:
	inc	[bp+var_C]
loc_1C61B:
	cmp	[bp+var_C], 7
	jl	short loc_1C624
	jmp	loc_1C707
loc_1C624:
	getCharP	[bp+var_C], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jnz	short loc_1C63B
	jmp	loc_1C707
loc_1C63B:
	getCharP	[bp+var_C], si
	cmp	gs:roster.class[si], class_monster
	jb	short loc_1C67B
	add	ax, offset roster
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], seg seg027
	lfs	bx, [bp+var_4]
	mov	al, fs:[bx+18h]
	sub	ah, ah
	push	ax
	mov	al, fs:[bx+17h]
	push	ax
	push	cs
	call	near ptr randomBetweenXandY
	add	sp, 4
	mov	bx, [bp+var_C]
	mov	fs:bat_charPriority[bx], al
	jmp	loc_1C704
loc_1C67B:
	mov	bx, [bp+var_C]
	cmp	gs:charActionList[bx], 6
	jnz	short loc_1C696
	mov	gs:bat_charPriority[bx], 0FFh
	jmp	short loc_1C704
loc_1C696:
	getCharP	[bp+var_C], si
	mov	bl, gs:roster.class[si]
	sub	bh, bh
	mov	al, byte_475AE[bx]
	mov	bx, [bp+var_C]
	mov	gs:bat_charPriority[bx], al
	call	rnd_2d16
	mov	cx, gs:roster.level[si]
	shr	cx, 1
	mov	dl, gs:roster.dexterity[si]
	shl	dl, 1
	add	cl, dl
	add	cl, al
	mov	bx, [bp+var_C]
	add	gs:bat_charPriority[bx], cl
	mov	bx, [bp+var_C]
	cmp	gs:bat_charPriority[bx], 0FFh
	jbe	short loc_1C6F3
	mov	gs:bat_charPriority[bx], 0FFh
	jmp	short loc_1C704
loc_1C6F3:
	mov	bx, [bp+var_C]
	cmp	gs:bat_charPriority[bx], 0
	jnz	short loc_1C704
	mov	gs:bat_charPriority[bx], 1
loc_1C704:
	jmp	loc_1C618
loc_1C707:
	mov	[bp+var_C], 0
	jmp	short loc_1C711
loc_1C70E:
	inc	[bp+var_C]
loc_1C711:
	cmp	[bp+var_C], 4
	jge	short loc_1C780
	getMonP	[bp+var_C], si
	mov	al, gs:monGroups.groupSize[si]
	sub	ah, ah
	and	ax, 1Fh
	mov	[bp+var_6], ax
	or	ax, ax
	jz	short loc_1C77E
	mov	al, gs:monGroups.oppPriorityLo[si]
	sub	ah, ah
	mov	[bp+var_E], ax
	mov	al, gs:monGroups.oppPriorityHi[si]
	mov	[bp+var_8], ax
	mov	[bp+var_A], 0
	jmp	short loc_1C750
loc_1C74D:
	inc	[bp+var_A]
loc_1C750:
	mov	ax, [bp+var_6]
	cmp	[bp+var_A], ax
	jge	short loc_1C77E
	push	[bp+var_8]
	push	[bp+var_E]
	push	cs
	call	near ptr randomBetweenXandY
	add	sp, 4
	mov	bx, [bp+var_C]
	mov	cl, 6
	shl	bx, cl
	mov	cx, [bp+var_A]
	shl	cx, 1
	add	bx, cx
	mov	gs:bat_monPriorityList[bx], ax
	jmp	short loc_1C74D
loc_1C77E:
	jmp	short loc_1C70E
loc_1C780:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_getAttackPriority endp

; Attributes: bp-based frame

bat_getOpponents proc far

	var_E= word ptr	-0Eh
	var_C= word ptr	-0Ch
	var_A= dword ptr -0Ah
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 0Eh
	call	someStackOperation
	push	si
	push	cs
	call	near ptr bat_resetData
	mov	gs:byte_422A4, 1
	cmp	gs:bat_curSong,	0
	jz	short loc_1C7D3
	mov	al, gs:byte_42420
	sub	ah, ah
	push	ax
	mov	al, charSize
	mul	gs:byte_41E62
	mov	bx, ax
	push	gs:roster.level[bx]
	push	cs
	call	near ptr bat_convertSongToCombat
	add	sp, 4
loc_1C7D3:
	cmp	partyAttackFlag, 0
	jz	short loc_1C7EC
	sub	ax, ax
	push	ax
	push	cs
	call	near ptr bat_zeroMonGroups
	add	sp, 2
	jmp	loc_1C992
loc_1C7EC:
	cmp	gs:byte_42458, 0
	jnz	short loc_1C81D
loc_1C7F8:
	call	_random
	and	al, 3
	mov	byte_4EEC9, al
	cmp	al, levelNoMaybe
	jbe	short loc_1C814
	jmp	short loc_1C7F8
loc_1C814:
	inc	byte_4EEC9
loc_1C81D:
	mov	[bp+var_4], 0
	jmp	short loc_1C827
loc_1C824:
	inc	[bp+var_4]
loc_1C827:
	mov	al, byte_4EEC9
	sub	ah, ah
	cmp	ax, [bp+var_4]
	ja	short loc_1C839
	jmp	loc_1C978
loc_1C839:
	cmp	gs:byte_42458, ah
	jz	short loc_1C889
	getMonP	[bp+var_4], si
	mov	al, byte ptr gs:monGroups._name[si]
	sub	ah, ah
	mov	[bp+var_2], ax
	getMonIndex	ax, [bp+var_2]
	add	ax, offset monsterBuf
	mov	word ptr [bp+var_A], ax
	mov	word ptr [bp+var_A+2], seg seg023
	mov	al, gs:monGroups.groupSize[si]
	sub	ah, ah
	and	ax, 1Fh
	mov	[bp+var_C], ax
	lfs	bx, [bp+var_A]
	mov	al, fs:[bx+mon_t.groupSize]
	sub	ah, ah
	and	ax, 0E0h
	mov	[bp+var_E], ax
	jmp	short loc_1C8EB
loc_1C889:
	mov	ax, 23
	push	ax
	sub	ax, ax
	push	ax
	push	cs
	call	near ptr randomBetweenXandY
	add	sp, 4
	mov	[bp+var_2], ax
	getMonIndex	ax, [bp+var_2]
	add	ax, offset monsterBuf
	mov	word ptr [bp+var_A], ax
	mov	word ptr [bp+var_A+2], seg seg023
	lfs	bx, [bp+var_A]
	test	fs:[bx+mon_t.flags], mon_noSummon
	jnz	short loc_1C889
	cmp	byte ptr fs:[bx], 0
	jz	short loc_1C889
	mov	al, fs:[bx+mon_t.groupSize]
	sub	ah, ah
	and	ax, 0E0h
	mov	[bp+var_E], ax
	test	fs:[bx+mon_t.groupSize], 1Fh
	jz	short loc_1C8E5
	mov	al, fs:[bx+mon_t.groupSize]
	sub	ah, ah
	and	ax, 1Fh
	push	ax
	mov	ax, 1
	push	ax
	push	cs
	call	near ptr randomBetweenXandY
	add	sp, 4
	jmp	short loc_1C8E8
loc_1C8E5:
	mov	ax, 1
loc_1C8E8:
	mov	[bp+var_C], ax
loc_1C8EB:
	getMonP	[bp+var_4], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	word ptr [bp+var_A+2]
	push	word ptr [bp+var_A]
	push	cs
	call	near ptr mon_copyBuffer
	add	sp, 8
	mov	al, byte ptr [bp+var_E]
	or	al, byte ptr [bp+var_C]
	mov	cx, ax
	getMonP	[bp+var_4], bx
	mov	gs:monGroups.groupSize[bx], cl
	mov	[bp+var_6], 0
	jmp	short loc_1C92C
loc_1C929:
	inc	[bp+var_6]
loc_1C92C:
	mov	ax, [bp+var_C]
	cmp	[bp+var_6], ax
	jge	short loc_1C975
	getMonP	[bp+var_4], si
	mov	al, gs:monGroups.hpDice[si]
	sub	ah, ah
	push	ax
	push	cs
	call	near ptr dice_doYDX
	add	sp, 2
	mov	cx, gs:monGroups.hpBase[si]
	add	cx, ax
	mov	bx, [bp+var_4]
	mov	ax, cx
	mov	cl, 6
	shl	bx, cl
	mov	cx, [bp+var_6]
	shl	cx, 1
	add	bx, cx
	mov	gs:monHpList[bx], ax
	jmp	short loc_1C929
loc_1C975:
	jmp	loc_1C824
loc_1C978:
	cmp	byte_4EEC9, 4
	jnb	short loc_1C992
	mov	al, byte_4EEC9
	sub	ah, ah
	push	ax
	push	cs
	call	near ptr bat_zeroMonGroups
	add	sp, 2
loc_1C992:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_getOpponents endp

; Attributes: bp-based frame

bat_zeroMonGroups proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, [bp+arg_0]
	mov	[bp+var_2], ax
	jmp	short loc_1C9AD
loc_1C9AA:
	inc	[bp+var_2]
loc_1C9AD:
	cmp	[bp+var_2], 3
	jge	short loc_1C9D5
	mov	ax, monStruSize
	push	ax
	sub	ax, ax
	push	ax
	getMonP	[bp+var_2], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	_memset
	add	sp, 8
	jmp	short loc_1C9AA
loc_1C9D5:
	mov	sp, bp
	pop	bp
	retf
bat_zeroMonGroups endp

; Attributes: bp-based frame

bat_sortMonGroupByDist proc far

	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
loc_1C9E5:
	mov	[bp+var_4], 0
	mov	[bp+var_2], 3
	jmp	short loc_1C9F4
loc_1C9F1:
	dec	[bp+var_2]
loc_1C9F4:
	cmp	[bp+var_2], 0
	jle	short loc_1CA37
	getMonP	[bp+var_2], si
	test	gs:monGroups.groupSize[si], 1Fh
	jz	short loc_1CA35
	mov	al, gs:monGroups.distance[si]-30h
	and	al, 0Fh
	mov	cl, gs:monGroups.distance[si]
	and	cl, 0Fh
	cmp	al, cl
	jbe	short loc_1CA35
	mov	[bp+var_4], 1
	mov	ax, [bp+var_2]
	dec	ax
	push	ax
	push	[bp+var_2]
	push	cs
	call	near ptr bat_swapMonGroups
	add	sp, 4
loc_1CA35:
	jmp	short loc_1C9F1
loc_1CA37:
	cmp	[bp+var_4], 0
	jnz	short loc_1C9E5
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_sortMonGroupByDist endp

; Attributes: bp-based frame

bat_swapMonGroups proc far

	var_40=	word ptr -40h
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 40h
	call	someStackOperation
	mov	ax, 64
	push	ax
	mov	bx, [bp+arg_0]
	mov	cl, 6
	shl	bx, cl
	lea	ax, monHpList[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, [bp+var_40]
	push	ss
	push	ax
	call	_memcpy
	add	sp, 0Ah
	mov	ax, 64
	push	ax
	mov	bx, [bp+arg_2]
	mov	cl, 6
	shl	bx, cl
	lea	ax, monHpList[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	mov	bx, [bp+arg_0]
	shl	bx, cl
	lea	ax, monHpList[bx]
	push	dx
	push	ax
	call	_memcpy
	add	sp, 0Ah
	mov	ax, 64
	push	ax
	lea	ax, [bp+var_40]
	push	ss
	push	ax
	mov	bx, [bp+arg_2]
	mov	cl, 6
	shl	bx, cl
	lea	ax, monHpList[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	_memcpy
	add	sp, 0Ah
	mov	ax, monStruSize
	push	ax
	getMonP	[bp+arg_0], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, [bp+var_40]
	push	ss
	push	ax
	call	_memcpy
	add	sp, 0Ah
	mov	ax, monStruSize
	push	ax
	getMonP	[bp+arg_2], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	getMonP	[bp+arg_0], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	_memcpy
	add	sp, 0Ah
	mov	ax, monStruSize
	push	ax
	lea	ax, [bp+var_40]
	push	ss
	push	ax
	getMonP	[bp+arg_2], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	_memcpy
	add	sp, 0Ah
	mov	sp, bp
	pop	bp
	retf
bat_swapMonGroups endp

; Attributes: bp-based frame
bat_printOpponents proc	far

	var_10C= word ptr -10Ch
	var_C= word ptr	-0Ch
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 10Ch
	call	someStackOperation
	cmp	gs:byte_4228B, 0
	jnz	short loc_1CB98
	mov	gs:byte_4228B, 0
	cmp	[bp+arg_0], 0
	jnz	short loc_1CB89
	call	bat_isAMonGroupActive
	or	ax, ax
	jz	short loc_1CB63
	mov	ax, 6
	push	ax
	mov	ax, 1
	push	ax
	push	cs
	call	near ptr randomBetweenXandY
	add	sp, 4
	jmp	short loc_1CB65
loc_1CB63:
	sub	ax, ax
loc_1CB65:
	mov	[bp+var_C], ax
	mov	bx, ax
	shl	bx, 1
	shl	bx, 1
	push	word ptr (battleCryString+2)[bx]
	push	word ptr battleCryString[bx]
	call	printStringWClear
	add	sp, 4
	cmp	[bp+var_C], 0
	jnz	short loc_1CB87
	jmp	loc_1CC83
loc_1CB87:
	jmp	short loc_1CB96
loc_1CB89:
	mov	ax, offset aYouStillFace
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
loc_1CB96:
	jmp	short loc_1CBA2
loc_1CB98:
	mov	gs:byte_4228B, 0
loc_1CBA2:
	lea	ax, [bp+var_10C]
	mov	[bp+var_8], ax
	mov	[bp+var_6], ss
	test	gs:monGroups.groupSize,	1Fh
	jnz	short loc_1CBCA
	mov	ax, offset aHostilePartyMembers
	push	ds
	push	ax
	call	printString
	add	sp, 4
	jmp	loc_1CC83
	jmp	short loc_1CBE0
loc_1CBCA:
	sub	ax, ax
	push	ax
	push	[bp+var_6]
	push	[bp+var_8]
	push	cs
	call	near ptr bat_printOpponentGroup
	add	sp, 6
	mov	[bp+var_8], ax
	mov	[bp+var_6], dx
loc_1CBE0:
	mov	[bp+var_A], 1
	jmp	short loc_1CBEA
loc_1CBE7:
	inc	[bp+var_A]
loc_1CBEA:
	cmp	[bp+var_A], 4
	jle	short loc_1CBF3
	jmp	loc_1CC83
loc_1CBF3:
	getMonP	[bp+var_A], bx
	test	gs:monGroups.groupSize[bx], 1Fh
	jz	short loc_1CC0D
	cmp	[bp+var_A], 4
	jnz	short loc_1CC30
loc_1CC0D:
	mov	ax, offset a__1
	push	ds
	push	ax
	push	[bp+var_6]
	push	[bp+var_8]
	call	_strcat
	add	sp, 8
	lea	ax, [bp+var_10C]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	jmp	short loc_1CC83
loc_1CC30:
	getMonP	[bp+var_A], bx
	test	gs:stru_42372.groupSize[bx], 1Fh
	jz	short loc_1CC4A
	cmp	[bp+var_A], 2
	jnz	short loc_1CC4F
loc_1CC4A:
	mov	ax, offset aAnd_1
	jmp	short loc_1CC52
loc_1CC4F:
	mov	ax, offset asc_473AE
loc_1CC52:
	mov	[bp+var_4], ax
	mov	[bp+var_2], ds
	push	ds
	push	ax
	push	[bp+var_6]
	push	[bp+var_8]
	call	_strcat
	add	sp, 8
	mov	[bp+var_8], ax
	mov	[bp+var_6], dx
	push	[bp+var_A]
	push	dx
	push	ax
	push	cs
	call	near ptr bat_printOpponentGroup
	add	sp, 6
	mov	[bp+var_8], ax
	mov	[bp+var_6], dx
	jmp	loc_1CBE7
loc_1CC83:
	mov	sp, bp
	pop	bp
	retf
bat_printOpponents endp

; This function	prints a group that the	party faces
; in combat. The format	is:
; XX Name (YY')
; Where:
;   XX - Number	of monsters in the group
;   YY - Distance to the group
; Attributes: bp-based frame

bat_printOpponentGroup proc far

	var_16=	word ptr -16h
	var_14=	word ptr -14h
	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 16h
	call	someStackOperation
	getMonP	[bp+arg_4], bx
	mov	al, gs:monGroups.groupSize[bx]
	sub	ah, ah
	and	ax, 1Fh
	mov	[bp+var_16], ax
	mov	ax, 2
	push	ax
	mov	ax, [bp+var_16]
	cwd
	push	dx
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	call	_itoa
	add	sp, 0Ah
	mov	word ptr [bp+arg_0], ax
	mov	word ptr [bp+arg_0+2], dx
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], 20h
	lea	ax, [bp+var_14]
	push	ss
	push	ax
	getMonP	[bp+arg_4], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	decryptName
	add	sp, 8
	mov	ax, [bp+var_16]
	dec	ax
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	lea	ax, [bp+var_14]
	push	ss
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	word ptr [bp+arg_0], ax
	mov	word ptr [bp+arg_0+2], dx
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], 20h ;	' '
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], 28h
	mov	ax, 2
	push	ax
	getMonP	[bp+arg_4], bx
	mov	al, gs:monGroups.distance[bx]
	sub	ah, ah
	and	ax, 0Fh
	sub	dx, dx
	mov	cx, ax
	mov	bx, dx
	shl	ax, 1
	rcl	dx, 1
	shl	ax, 1
	rcl	dx, 1
	add	ax, cx
	adc	dx, bx
	shl	ax, 1
	rcl	dx, 1
	push	dx
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	call	_itoa
	add	sp, 0Ah
	mov	word ptr [bp+arg_0], ax
	mov	word ptr [bp+arg_0+2], dx
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], 27h
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], 29h
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
bat_printOpponentGroup endp

; Attributes: bp-based frame

bat_setBigpic proc far

	var_26=	word ptr -26h
	var_24=	dword ptr -24h
	var_20=	word ptr -20h
	var_10=	word ptr -10h

	push	bp
	mov	bp, sp
	mov	ax, 26h	
	call	someStackOperation
	mov	al, gs:monGroups.groupSize
	sub	ah, ah
	and	ax, 1Fh
	mov	[bp+var_26], ax
	or	ax, ax
	jnz	short loc_1CDC3
	mov	ax, 21h	
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
	mov	ax, offset aParty
	push	ds
	push	ax
	call	setTitle
	add	sp, 4
	jmp	short loc_1CE1C
loc_1CDC3:
	lea	ax, [bp+var_20]
	push	ss
	push	ax
	mov	ax, offset monGroups
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	decryptName
	add	sp, 8
	mov	ax, [bp+var_26]
	dec	ax
	push	ax
	lea	ax, [bp+var_10]
	push	ss
	push	ax
	lea	ax, [bp+var_20]
	push	ss
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	word ptr [bp+var_24], ax
	mov	word ptr [bp+var_24+2],	dx
	lfs	bx, [bp+var_24]
	mov	byte ptr fs:[bx], 0
	lea	ax, [bp+var_10]
	push	ss
	push	ax
	call	setTitle
	add	sp, 4
	mov	al, gs:monGroups.picIndex
	sub	ah, ah
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
loc_1CE1C:
	mov	sp, bp
	pop	bp
	retf
bat_setBigpic endp

; Attributes: bp-based frame

mon_copyBuffer proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah
	arg_6= word ptr	 0Ch

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, monStruSize
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	[bp+arg_6]
	push	[bp+arg_4]
	call	_memcpy
	add	sp, 0Ah
	mov	sp, bp
	pop	bp
	retf
mon_copyBuffer endp

; Attributes: bp-based frame

bat_convertSongToCombat	proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, [bp+arg_2]
	jmp	short loc_1CEC0
loc_1CE55:
	mov	gs:songCanRun, 1
	or	gs:byte_4240E, 2
	jmp	short loc_1CEDA
loc_1CE6B:
	cmp	[bp+arg_0], 60
	jle	short loc_1CE75
	mov	al, 0Fh
	jmp	short loc_1CE7C
loc_1CE75:
	mov	ax, [bp+arg_0]
	sar	ax, 1
	sar	ax, 1
loc_1CE7C:
	mov	gs:songACBonus,	al
	or	al, al
	jnz	short loc_1CE8D
	inc	gs:songACBonus
loc_1CE8D:
	jmp	short loc_1CEDA
loc_1CE8F:
	mov	ax, [bp+arg_0]
	cmp	ax, 0Fh
	jle	short loc_1CE9E
	mov	ax, 0Fh
loc_1CE9E:
	mov	gs:songRegenHP,	al
	jmp	short loc_1CEDA
loc_1CEA4:
	mov	gs:songExtraAttack, 1
	jmp	short loc_1CEDA
loc_1CEB0:
	mov	gs:songHalfDamage, 1
	jmp	short loc_1CEDA
loc_1CEBC:
	jmp	short loc_1CEDA
	jmp	short loc_1CEDA
loc_1CEC0:
	or	ax, ax
	jz	short loc_1CE55
	cmp	ax, song_sanctuary
	jz	short loc_1CE6B
	cmp	ax, song_bringaround
	jz	short loc_1CE8F
	cmp	ax, song_duotime
	jz	short loc_1CEA4
	cmp	ax, song_shield
	jz	short loc_1CEB0
	jmp	short loc_1CEBC
loc_1CEDA:
	mov	sp, bp
	pop	bp
	retf
bat_convertSongToCombat	endp

; Attributes: bp-based frame

bat_doCombatSong proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	sub_22CD5
	add	sp, 4
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.class[bx], class_monster
	jb	short loc_1CF12
	mov	[bp+var_2], 1
	jmp	short loc_1CF2C
loc_1CF12:
	getCharP	[bp+arg_0], bx
	mov	ax, gs:roster.level[bx]
	sub	ax, 15
	sbb	cx, cx
	and	ax, cx
	add	ax, 15
	mov	[bp+var_2], ax
loc_1CF2C:
	mov	ax, [bp+arg_2]
	jmp	loc_1CFE9
loc_1CF32:
	mov	gs:songCanRun, 1
	or	gs:byte_4240E, 2
	jmp	loc_1D00E
loc_1CF49:
	mov	al, charSize
	mul	gs:byte_41E62
	mov	bx, ax
	cmp	gs:roster.level[bx], 60
	jnb	short loc_1CF7E
	mov	al, charSize
	mul	gs:byte_41E62
	mov	bx, ax
	mov	ax, gs:roster.level[bx]
	shr	ax, 1
	shr	ax, 1
	jmp	short loc_1CF80
loc_1CF7E:
	mov	al, 0Fh
loc_1CF80:
	mov	gs:songACBonus,	al
	or	al, al
	jnz	short loc_1CF91
	inc	gs:songACBonus
loc_1CF91:
	jmp	short loc_1D00E
loc_1CF93:
	mov	al, byte ptr [bp+var_2]
	mov	gs:songRegenHP,	al
	or	al, al
	jnz	short loc_1CFA7
	inc	gs:songRegenHP
loc_1CFA7:
	jmp	short loc_1D00E
loc_1CFA9:
	mov	gs:songExtraAttack, 1
	jmp	short loc_1D00E
loc_1CFB5:
	mov	gs:bat_curTarget, 80h
	mov	ax, 237
	push	ax
	push	[bp+arg_0]
	call	sub_22821
	add	sp, 4
loc_1CFCE:
	mov	gs:songHalfDamage, 1
	mov	al, byte ptr [bp+var_2]
	mov	gs:byte_4244E, al
	jmp	short loc_1D00E
loc_1CFE5:
	jmp	short loc_1D00E
	jmp	short loc_1D00E
loc_1CFE9:
	or	ax, ax
	jnz	short loc_1CFF0
	jmp	loc_1CF32
loc_1CFF0:
	cmp	ax, song_sanctuary
	jnz	short loc_1CFF8
	jmp	loc_1CF49
loc_1CFF8:
	cmp	ax, song_bringaround
	jz	short loc_1CF93
	cmp	ax, song_duotime
	jz	short loc_1CFA9
	cmp	ax, song_overture
	jz	short loc_1CFB5
	cmp	ax, song_shield
	jz	short loc_1CFCE
	jmp	short loc_1CFE5
loc_1D00E:
	mov	sp, bp
	pop	bp
	retf
bat_doCombatSong endp

; Attributes: bp-based frame

bat_endCombatSong proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	gs:byte_4266B, 0
	jz	short loc_1D09F
	mov	gs:byte_4266B, 0
	mov	al, gs:byte_42420
	sub	ah, ah
	jmp	short loc_1D080
loc_1D03A:
	and	gs:byte_4240E, 0FDh
	jmp	short loc_1D09A
loc_1D046:
	mov	gs:songHalfDamage, 0
	mov	gs:byte_4244E, 0
	jmp	short loc_1D09A
loc_1D05C:
	mov	gs:songACBonus,	0
loc_1D066:
	mov	gs:songRegenHP,	0
	jmp	short loc_1D09A
loc_1D072:
	mov	gs:songExtraAttack, 0
loc_1D07C:
	jmp	short loc_1D09A
	jmp	short loc_1D09A
loc_1D080:
	or	ax, ax
	jz	short loc_1D03A
	cmp	ax, song_sanctuary
	jz	short loc_1D05C
	cmp	ax, song_bringaround
	jz	short loc_1D066
	cmp	ax, song_duotime
	jz	short loc_1D072
	cmp	ax, song_shield
	jz	short loc_1D046
	jmp	short loc_1D07C
loc_1D09A:
	call	song_endMusic
loc_1D09F:
	mov	sp, bp
	pop	bp
	retf
bat_endCombatSong endp

; Attributes: bp-based frame

bat_resetData proc far

	counter= word ptr -2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+counter], 0
	jmp	short loc_1D0B8
loc_1D0B5:
	inc	[bp+counter]
loc_1D0B8:
	cmp	[bp+counter], 4
	jge	short loc_1D130
	mov	ax, 40h	
	push	ax
	sub	ax, ax
	push	ax
	mov	bx, [bp+counter]
	mov	cl, 6
	shl	bx, cl
	lea	ax, monHpList[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	_memset
	add	sp, 8
	mov	ax, 40h	
	push	ax
	sub	ax, ax
	push	ax
	mov	bx, [bp+counter]
	mov	cl, 6
	shl	bx, cl
	lea	ax, bat_monPriorityList[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	_memset
	add	sp, 8
	sub	al, al
	mov	bx, [bp+counter]
	mov	gs:byte_42270[bx], al
	mov	bx, [bp+counter]
	mov	gs:byte_41E50[bx], al
	mov	bx, [bp+counter]
	mov	gs:byte_4229C[bx], al
	mov	bx, [bp+counter]
	mov	gs:byte_42422[bx], al
	jmp	short loc_1D0B5
loc_1D130:
	mov	[bp+counter], 0
	jmp	short loc_1D13A
loc_1D137:
	inc	[bp+counter]
loc_1D13A:
	cmp	[bp+counter], 7
	jge	short loc_1D18D
	mov	bx, [bp+counter]
	mov	gs:charActionList[bx], 2
	sub	al, al
	mov	bx, [bp+counter]
	mov	gs:[bx+8], al
	mov	bx, [bp+counter]
	mov	gs:strengthBonus[bx], al
	mov	bx, [bp+counter]
	mov	gs:byte_42444[bx], al
	mov	bx, [bp+counter]
	mov	gs:byte_42280[bx], al
	mov	bx, [bp+counter]
	mov	gs:bat_charPriority[bx], al
	jmp	short loc_1D137
loc_1D18D:
	sub	al, al
	mov	gs:byte_42440, al
	mov	gs:byte_41E70, al
	mov	gs:byte_42274, al
	mov	gs:byte_4244E, al
	mov	gs:byte_42567, al
	mov	gs:monFrozenFlag, al
	mov	gs:byte_422A4, al
	mov	gs:byte_41E63, al
	mov	gs:byte_4240E, al
	mov	gs:monDisbelieveFlag, al
	mov	gs:antiMagicFlag, al
	mov	gs:partyFrozenFlag, al
	mov	gs:songHalfDamage, al
	mov	gs:songCanRun, al
	mov	gs:songExtraAttack, al
	mov	gs:byte_4229A, al
	mov	gs:songRegenHP,	al
	sub	ax, ax
	mov	gs:batRewardHi,	ax
	mov	gs:batRewardLo,	ax
	mov	sp, bp
	pop	bp
	retf
bat_resetData endp

; This function	returns	a random number	between	the
; low and the high
;
; Attributes: bp-based frame
randomBetweenXandY proc	far

	var_6= word ptr	-6
	var_4= word ptr	-4
	_mask= word ptr	-2
	_low= word ptr	6
	_high= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	mov	ax, [bp+_high]
	sub	ax, [bp+_low]
	mov	[bp+var_4], ax
	or	ax, ax
	jg	short loc_1D246
	mov	ax, [bp+_low]
	jmp	short loc_1D26E
loc_1D246:
	push	[bp+var_4]
	push	cs
	call	near ptr getRndDiceMask
	add	sp, 2
	mov	[bp+_mask], ax
loc_1D253:
	call	_random
	and	ax, [bp+_mask]
	mov	[bp+var_6], ax
	mov	ax, [bp+var_4]
	cmp	[bp+var_6], ax
	jg	short loc_1D253
	mov	ax, [bp+var_6]
	add	ax, [bp+_low]
	jmp	short $+2
loc_1D26E:
	mov	sp, bp
	pop	bp
	retf
randomBetweenXandY endp

; Attributes: bp-based frame

getRndDiceMask proc far

	var_2= word ptr	-2
	arg_1= byte ptr	 7

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	[bp+arg_1], 0
	mov	[bp+var_2], 0
	jmp	short loc_1D2D2
loc_1D2CF:
	inc	[bp+var_2]
loc_1D2D2:
	cmp	[bp+var_2], 8
	jge	short loc_1D2F1
	mov	bx, [bp+var_2]
	mov	al, diceMaskList[bx]
	sub	ah, ah
	mov	si, ax
	cmp	[bp+6],	si
	ja	short loc_1D2EF
	jmp	short loc_1D2FE
loc_1D2EF:
	jmp	short loc_1D2CF
loc_1D2F1:
	mov	ax, offset aBadDiceMaskRange
	push	ds
	push	ax
	call	sub_1763A
	add	sp, 4
loc_1D2FE:
	pop	si
	mov	sp, bp
	pop	bp
	retf
getRndDiceMask endp

; This function	unpacks	a single byte into the number
; of dice to roll and the sides	of the dice. A random
; number between 1DX and YDX is	returned
; Attributes: bp-based frame
dice_doYDX proc	far

	rval= word ptr -8
	counter= word ptr -6
	ndice= word ptr	-4
	dieval=	word ptr -2
	die= word ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	mov	[bp+rval], 0
	mov	ax, [bp+die]
	mov	cl, 5
	sar	ax, cl
	and	ax, 7
	mov	[bp+dieval], ax
	mov	ax, [bp+die]
	and	ax, 1Fh
	mov	[bp+ndice], ax
	mov	[bp+counter], 0
	jmp	short loc_1D333
loc_1D330:
	inc	[bp+counter]
loc_1D333:
	mov	ax, [bp+ndice]
	cmp	[bp+counter], ax
	jg	short loc_1D356
	call	_random
	mov	bx, [bp+dieval]
	mov	cl, diceMaskList[bx]
	sub	ch, ch
	and	cx, ax
	inc	cx
	add	[bp+rval], cx
	jmp	short loc_1D330
loc_1D356:
	mov	ax, [bp+rval]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
dice_doYDX endp

; Attributes: bp-based frame

party_fight proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	sub	ax, ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
party_fight endp

; Attributes: bp-based frame

party_advance proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	[bp+var_2], 0
	jmp	short loc_1D387
loc_1D384:
	inc	[bp+var_2]
loc_1D387:
	cmp	[bp+var_2], 4
	jge	short loc_1D3A8
	getMonP	[bp+var_2], si
	test	gs:monGroups.groupSize[si], 1Fh
	jz	short loc_1D3A6
	dec	gs:monGroups.distance[si]
loc_1D3A6:
	jmp	short loc_1D384
loc_1D3A8:
	mov	ax, offset aThePartyAdvances
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	[bp+var_2], 0
	jmp	short loc_1D3BF
loc_1D3BC:
	inc	[bp+var_2]
loc_1D3BF:
	cmp	[bp+var_2], 7
	jge	short loc_1D3D4
	mov	bx, [bp+var_2]
	mov	gs:charActionList[bx], 2
	jmp	short loc_1D3BC
loc_1D3D4:
	mov	ax, 1
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
party_advance endp

; Attributes: bp-based frame

party_run proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	cmp	gs:songCanRun, 0
	jz	short loc_1D404
	mov	gs:runAwayFlag,	1
	mov	ax, 1
	jmp	short loc_1D46D
loc_1D404:
	mov	[bp+var_2], 0
	jmp	short loc_1D40E
loc_1D40B:
	inc	[bp+var_2]
loc_1D40E:
	cmp	[bp+var_2], 7
	jge	short loc_1D44C
	getCharP	[bp+var_2], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jz	short loc_1D44A
	mov	ax, itemEff_alwaysRunAway
	push	ax
	push	[bp+var_2]
	call	hasEffectEquipped
	add	sp, 4
	or	ax, ax
	jnz	short loc_1D44A
	mov	gs:runAwayFlag,	1
	mov	ax, 1
	jmp	short loc_1D46D
loc_1D44A:
	jmp	short loc_1D40B
loc_1D44C:
	call	_random
	sub	ah, ah
	mov	[bp+var_2], ax
	cmp	ax, 0C0h 
	jg	short loc_1D45F
	mov	al, 1
	jmp	short loc_1D461
loc_1D45F:
	sub	al, al
loc_1D461:
	mov	gs:runAwayFlag,	al
	sub	ah, ah
	jmp	short $+2
loc_1D46D:
	mov	sp, bp
	pop	bp
	retf
party_run endp

; Attributes: bp-based frame

bat_attackOpt proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, offset aAttack
	push	ds
	push	ax
	mov	ax, 2
	push	ax
	push	cs
	call	near ptr getTarget
	add	sp, 6
	mov	[bp+var_2], ax
	or	ax, ax
	jl	short loc_1D4A2
	mov	al, byte ptr [bp+var_2]
	mov	bx, [bp+arg_0]
	mov	gs:byte_42244[bx], al
loc_1D4A2:
	cmp	[bp+var_2], 0
	jl	short loc_1D4AD
	mov	ax, 1
	jmp	short loc_1D4AF
loc_1D4AD:
	sub	ax, ax
loc_1D4AF:
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
bat_attackOpt endp

; Attributes: bp-based frame

bat_defendOpt proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 1
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
bat_defendOpt endp

; Attributes: bp-based frame

bat_castOpt proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, 1
	push	ax
	push	[bp+arg_0]
	call	anotherCastSpell
	add	sp, 4
	mov	[bp+var_2], ax
	or	ax, ax
	jge	short loc_1D4ED
	sub	ax, ax
	jmp	short loc_1D541
loc_1D4ED:
	mov	al, byte ptr curSpellNo
	mov	bx, [bp+arg_0]
	mov	gs:byte_42244[bx], al
	cmp	[bp+var_2], 4
	jg	short loc_1D52D
	mov	ax, offset aCastAt
	push	ds
	push	ax
	push	[bp+var_2]
	push	cs
	call	near ptr getTarget
	add	sp, 6
	mov	bx, [bp+arg_0]
	mov	gs:byte_42276[bx], al
	mov	ax, 1
	jmp	short loc_1D529
	sub	ax, ax
loc_1D529:
	jmp	short loc_1D541
	jmp	short loc_1D53C
loc_1D52D:
	mov	al, byte ptr [bp+var_2]
	mov	bx, [bp+arg_0]
	mov	gs:byte_42276[bx], al
loc_1D53C:
	mov	ax, 1
	jmp	short $+2
loc_1D541:
	mov	sp, bp
	pop	bp
	retf
bat_castOpt endp

; Attributes: bp-based frame

bat_useItemOpt proc far

	var_F8=	word ptr -0F8h
	var_36=	word ptr -36h
	var_34=	word ptr -34h
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 0F8h 
	call	someStackOperation
	lea	ax, [bp+var_34]
	push	ss
	push	ax
	lea	ax, [bp+var_F8]
	push	ss
	push	ax
	push	[bp+arg_0]
	call	sub_188E8
	add	sp, 0Ah
	mov	[bp+var_36], ax
	or	ax, ax
	jnz	short loc_1D570
	jmp	loc_1D643
loc_1D570:
	push	ax
	lea	ax, [bp+var_34]
	push	ss
	push	ax
	mov	ax, offset aWhichItem?
	push	ds
	push	ax
	call	printStringGetInput
	add	sp, 0Ah
	mov	[bp+var_4], ax
	or	ax, ax
	jge	short loc_1D58F
	sub	ax, ax
	jmp	loc_1D663
loc_1D58F:
	push	[bp+var_4]
	push	[bp+arg_0]
	call	item_canBeUsed
	add	sp, 4
	or	ax, ax
	jz	short loc_1D61F
	mov	al, byte ptr curSpellNo
	mov	bx, [bp+arg_0]
	mov	gs:byte_42244[bx], al
	mov	al, byte ptr [bp+var_4]
	mov	bx, [bp+arg_0]
	mov	gs:byte_42334[bx], al
	mov	bx, curSpellNo
	mov	al, byte_47F94[bx]
	sub	ah, ah
	and	ax, 7
	mov	[bp+var_2], ax
	cmp	ax, 4
	jge	short loc_1D609
	mov	ax, offset aUseOn_0
	push	ds
	push	ax
	push	[bp+var_2]
	push	cs
	call	near ptr getTarget
	add	sp, 6
	mov	bx, [bp+arg_0]
	mov	gs:byte_42276[bx], al
	mov	ax, 1
	jmp	short loc_1D605
	sub	ax, ax
loc_1D605:
	jmp	short loc_1D663
	jmp	short loc_1D618
loc_1D609:
	mov	al, byte ptr [bp+var_2]
	mov	bx, [bp+arg_0]
	mov	gs:byte_42276[bx], al
loc_1D618:
	mov	ax, 1
	jmp	short loc_1D663
	jmp	short loc_1D641
loc_1D61F:
	mov	ax, offset aYouCanTUseThatItem_
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
	call	clearTextWindow
	sub	ax, ax
	jmp	short loc_1D663
loc_1D641:
	jmp	short loc_1D663
loc_1D643:
	mov	ax, offset aYourPocketsAreEm
	mov	dx, seg	dseg
	push	dx
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
	sub	ax, ax
	jmp	short $+2
loc_1D663:
	mov	sp, bp
	pop	bp
	retf
bat_useItemOpt endp

; Attributes: bp-based frame

bat_hideOpt proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 1
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
bat_hideOpt endp

; Attributes: bp-based frame

bat_songOpt proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	call	clearTextWindow
	sub	ax, ax
	push	ax
	push	[bp+arg_0]
	call	song_getSong
	add	sp, 4
	mov	[bp+var_2], ax
	or	ax, ax
	jl	short loc_1D6AE
	mov	al, byte ptr [bp+var_2]
	mov	bx, [bp+arg_0]
	mov	gs:byte_42244[bx], al
loc_1D6AE:
	cmp	[bp+var_2], 0
	jl	short loc_1D6B9
	mov	ax, 1
	jmp	short loc_1D6BB
loc_1D6B9:
	sub	ax, ax
loc_1D6BB:
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
bat_songOpt endp

; Attributes: bp-based frame
bat_partyAttackOpt proc	far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, offset aAttack
	push	ds
	push	ax
	mov	ax, 1
	push	ax
	push	cs
	call	near ptr getTarget
	add	sp, 6
	mov	[bp+var_2], ax
	or	ax, ax
	jl	short loc_1D6F2
	mov	al, byte ptr [bp+var_2]
	mov	bx, [bp+arg_0]
	mov	gs:byte_42244[bx], al
loc_1D6F2:
	cmp	[bp+var_2], 0
	jl	short loc_1D6FD
	mov	ax, 1
	jmp	short loc_1D6FF
loc_1D6FD:
	sub	ax, ax
loc_1D6FF:
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
bat_partyAttackOpt endp

; Attributes: bp-based frame

bat_getPartyOptions proc far

	charNo=	word ptr -138h
	var_136= word ptr -136h
	var_36=	word ptr -36h
	var_22=	word ptr -22h
	var_20=	word ptr -20h
	var_16=	word ptr -16h
	var_14=	word ptr -14h
	var_12=	word ptr -12h
	var_10=	word ptr -10h
	var_6= word ptr	-6
	var_4= dword ptr -4

	push	bp
	mov	bp, sp
	mov	ax, 138h
	call	someStackOperation
	push	si
	cmp	partyAttackFlag, 0
	jz	short loc_1D720
	jmp	loc_1D7BE
loc_1D720:
	call	bat_isAMonGroupActive
	or	ax, ax
	jnz	short loc_1D72C
	jmp	loc_1D7BE
loc_1D72C:
	call	_return_zero
	or	ax, ax
	jz	short loc_1D738
	jmp	loc_1D7BE
loc_1D738:
	lea	ax, [bp+var_10]
	push	ss
	push	ax
	push	cs
	call	near ptr bat_getFightRunOpt
	add	sp, 4
	lea	ax, [bp+var_36]
	push	ss
	push	ax
	lea	ax, [bp+var_20]
	push	ss
	push	ax
	lea	ax, [bp+var_10]
	push	ss
	push	ax
	mov	ax, offset aWillYourGallantBand
	push	ds
	push	ax
	call	printVarString
	add	sp, 10h
	mov	[bp+var_14], ax
loc_1D763:
	mov	[bp+var_22], 1
	push	[bp+var_14]
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_6], ax
	mov	[bp+var_16], 0
loc_1D77B:
	mov	si, [bp+var_16]
	cmp	byte ptr [bp+si+var_20], 0
	jz	short loc_1D7B8
	mov	al, byte ptr [bp+si+var_20]
	cbw
	cmp	ax, [bp+var_6]
	jz	short loc_1D797
	shl	si, 1
	mov	ax, [bp+var_6]
	cmp	[bp+si+var_36],	ax
	jnz	short loc_1D7B3
loc_1D797:
	mov	bx, [bp+var_16]
	shl	bx, 1
	shl	bx, 1
	call	off_475D0[bx]
	mov	[bp+var_12], ax
	or	ax, ax
	jz	short loc_1D7AE
	jmp	loc_1D996
	jmp	short loc_1D7B3
loc_1D7AE:
	mov	[bp+var_22], 0
loc_1D7B3:
	inc	[bp+var_16]
	jmp	short loc_1D77B
loc_1D7B8:
	cmp	[bp+var_22], 0
	jnz	short loc_1D763
loc_1D7BE:
	mov	[bp+charNo], 0
	jmp	short loc_1D7CA
loc_1D7C6:
	inc	[bp+charNo]
loc_1D7CA:
	cmp	[bp+charNo], 7
	jl	short loc_1D7D4
	jmp	loc_1D97D
loc_1D7D4:
	getCharP	[bp+charNo], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jnz	short loc_1D7EC
	jmp	loc_1D97D
loc_1D7EC:
	call	clearTextWindow
	getCharP	[bp+charNo], si
	cmp	gs:roster.class[si], class_monster
	jb	short loc_1D809
	jmp	loc_1D97A
loc_1D809:
	test	gs:roster.status[si], stat_dead	or stat_stoned or stat_paralyzed
	jz	short loc_1D814
	jmp	loc_1D97A
loc_1D814:
	test	gs:roster.status[si], stat_possessed or	stat_nuts
	jnz	short loc_1D827
	cmp	gs:(roster.specAbil+3)[si], 0
	jz	short loc_1D827
	jmp	loc_1D96C
loc_1D827:
	call	clearTextWindow
	getCharP	[bp+charNo], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, [bp+var_136]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	mov	ax, offset aHasTheseOptionsThisBa
	push	ds
	push	ax
	push	dx
	push	word ptr [bp+var_4]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	mov	bx, [bp+charNo]
	cmp	gs:byte_42280[bx], 0
	jz	short loc_1D89A
	mov	al, gs:byte_42280[bx]
	add	al, 30h	
	mov	byte_4724A, al
	mov	ax, offset byte_4724A
	push	ds
	push	ax
	push	dx
	push	word ptr [bp+var_4]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
loc_1D89A:
	mov	ax, offset a@defend@partyAttack@c
	push	ds
	push	ax
	push	word ptr [bp+var_4+2]
	push	word ptr [bp+var_4]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	lfs	bx, [bp+var_4]
	inc	word ptr [bp+var_4]
	mov	byte ptr fs:[bx], 0
	push	[bp+charNo]
	lea	ax, [bp+var_10]
	push	ss
	push	ax
	push	cs
	call	near ptr bat_getCharOptions
	add	sp, 6
	lea	ax, [bp+var_36]
	push	ss
	push	ax
	lea	ax, [bp+var_20]
	push	ss
	push	ax
	lea	ax, [bp+var_10]
	push	ss
	push	ax
	lea	ax, [bp+var_136]
	push	ss
	push	ax
	call	printVarString
	add	sp, 10h
	mov	[bp+var_14], ax
	mov	ax, offset aSelectAnOption_
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	[bp+var_22], 1
	push	[bp+var_14]
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_6], ax
	mov	[bp+var_16], 0
loc_1D912:
	mov	si, [bp+var_16]
	cmp	byte ptr [bp+si+var_20], 0
	jz	short loc_1D961
	mov	al, byte ptr [bp+si+var_20]
	cbw
	cmp	ax, [bp+var_6]
	jz	short loc_1D92E
	shl	si, 1
	mov	ax, [bp+var_6]
	cmp	[bp+si+var_36],	ax
	jnz	short loc_1D95C
loc_1D92E:
	mov	al, byte ptr [bp+var_16]
	inc	al
	mov	bx, [bp+charNo]
	mov	gs:charActionList[bx], al
	push	[bp+charNo]
	mov	bx, [bp+var_16]
	shl	bx, 1
	shl	bx, 1
	call	off_475DC[bx]
	add	sp, 2
	cmp	ax, 1
	sbb	cx, cx
	neg	cx
	mov	[bp+var_22], cx
loc_1D95C:
	inc	[bp+var_16]
	jmp	short loc_1D912
loc_1D961:
	cmp	[bp+var_22], 0
	jz	short loc_1D96A
	jmp	loc_1D827
loc_1D96A:
	jmp	short loc_1D97A
loc_1D96C:
	mov	bx, [bp+charNo]
	mov	gs:charActionList[bx], 8
loc_1D97A:
	jmp	loc_1D7C6
loc_1D97D:
	mov	ax, offset aUseTheseCommands?
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getYesNo
	or	ax, ax
	jnz	short loc_1D996
	jmp	loc_1D7BE
loc_1D996:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_getPartyOptions endp

; Attributes: bp-based frame
bat_getFightRunOpt proc	far

	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	lfs	bx, [bp+arg_0]
	mov	byte ptr fs:[bx], 1
	push	cs
	call	near ptr bat_monInMeleeRange
	lfs	bx, [bp+arg_0]
	mov	fs:[bx+1], al
	lfs	bx, [bp+arg_0]
	mov	byte ptr fs:[bx+2], 1
	mov	sp, bp
	pop	bp
	retf
bat_getFightRunOpt endp

; This function	returns	0 if there is a	monster
; group	in melee range.	1 otherwise. This is used
; to determine whether the party should	be given
; the "Advance"	option in battle.
; Attributes: bp-based frame

bat_monInMeleeRange proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	[bp+var_2], 3
	jmp	short loc_1D9D9
loc_1D9D6:
	dec	[bp+var_2]
loc_1D9D9:
	cmp	[bp+var_2], 0
	jl	short loc_1DA04
	getMonP	[bp+var_2], si
	test	gs:monGroups.groupSize[si], 1Fh
	jz	short loc_1DA02
	mov	al, gs:monGroups.distance[si]
	and	al, 0Fh
	cmp	al, 2
	jnb	short loc_1DA02
	sub	ax, ax
	jmp	short loc_1DA09
loc_1DA02:
	jmp	short loc_1D9D6
loc_1DA04:
	mov	ax, 1
	jmp	short $+2
loc_1DA09:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_monInMeleeRange endp

; Attributes: bp-based frame
bat_getCharOptions proc	far

	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	partyAttackFlag, 0
	jnz	short loc_1DA49
	test	gs:monGroups.groupSize,	1Fh
	jz	short loc_1DA49
	cmp	[bp+arg_4], 4
	jl	short loc_1DA45
	mov	bx, [bp+arg_4]
	cmp	gs:byte_42280[bx], 0
	jz	short loc_1DA49
loc_1DA45:
	mov	al, 1
	jmp	short loc_1DA4B
loc_1DA49:
	sub	al, al
loc_1DA4B:
	lfs	bx, [bp+arg_0]
	mov	fs:[bx], al
	lfs	bx, [bp+arg_0]
	mov	byte ptr fs:[bx+1], 1
	mov	byte ptr fs:[bx+2], 1
	getCharP	[bp+arg_4], bx
	mov	al, byte ptr gs:roster.currentSppt[bx]
	lfs	bx, [bp+arg_0]
	mov	fs:[bx+3], al
	mov	byte ptr fs:[bx+4], 1
	mov	bx, [bp+arg_4]
	cmp	gs:byte_42280[bx], 9
	jnb	short loc_1DAA7
	getCharP	bx, bx
	cmp	gs:roster.class[bx], class_rogue
	jnz	short loc_1DAA7
	mov	al, 1
	jmp	short loc_1DAA9
loc_1DAA7:
	sub	al, al
loc_1DAA9:
	lfs	bx, [bp+arg_0]
	mov	fs:[bx+5], al
	getCharP	[bp+arg_4], bx
	cmp	gs:roster.class[bx], class_bard
	jnz	short loc_1DADB
	mov	ax, itType_instrument
	push	ax
	push	[bp+arg_4]
	call	inven_hasTypeEquipped
	add	sp, 4
	or	ax, ax
	jz	short loc_1DADB
	mov	al, 1
	jmp	short loc_1DADD
loc_1DADB:
	sub	al, al
loc_1DADD:
	lfs	bx, [bp+arg_0]
	mov	fs:[bx+6], al
	mov	sp, bp
	pop	bp
	retf
bat_getCharOptions endp

; Attributes: bp-based frame

getTarget proc far

	var_228= byte ptr -228h
	var_11E= byte ptr -11Eh
	var_11C= word ptr -11Ch
	var_11A= byte ptr -11Ah
	var_119= byte ptr -119h
	var_10E= word ptr -10Eh
	var_E= word ptr	-0Eh
	var_C= dword ptr -0Ch
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	stringOff= word	ptr  8
	stringSeg= word	ptr  0Ah

	push	bp
	mov	bp, sp
	mov	ax, 11Eh
	call	someStackOperation
	push	si
	mov	ax, 0FFFFh
	mov	[bp+var_8], ax
	mov	[bp+var_2], ax
	mov	[bp+var_6], 0
	mov	[bp+var_11C], 0
	jmp	short loc_1DB0E
loc_1DB0A:
	inc	[bp+var_11C]
loc_1DB0E:
	cmp	[bp+var_11C], 0Ch
	jge	short loc_1DB20
	mov	si, [bp+var_11C]
	mov	[bp+si+var_11A], 20h 
	jmp	short loc_1DB0A
loc_1DB20:
	push	[bp+stringSeg]
	push	[bp+stringOff]
	call	printStringWClear
	add	sp, 4
	mov	ax, [bp+arg_0]
	jmp	loc_1DD02
loc_1DB34:
	call	findEmptyRosterNum
	mov	[bp+var_8], ax
	cmp	ax, 1
	jg	short loc_1DB46
	sub	ax, ax
	jmp	loc_1DD93
loc_1DB46:
	mov	al, byte ptr [bp+var_8]
	add	al, monStruSize
	mov	byte ptr aMember17+0Bh,	al
	mov	ax, offset aMember17
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	[bp+var_4], 2000h
	jmp	loc_1DD20
loc_1DB63:
	push	cs
	call	near ptr bat_cntActiveMonGroups
	mov	[bp+var_2], ax
	cmp	ax, 1
	jg	short loc_1DB75
	mov	ax, 80h
	jmp	loc_1DD93
loc_1DB75:
	mov	[bp+var_4], 0
	mov	[bp+var_11C], 0
	jmp	short loc_1DB86
loc_1DB82:
	inc	[bp+var_11C]
loc_1DB86:
	mov	ax, [bp+var_2]
	cmp	[bp+var_11C], ax
	jge	short loc_1DC09
	lea	ax, [bp+var_10E]
	mov	word ptr [bp+var_C], ax
	mov	word ptr [bp+var_C+2], ss
	mov	al, gs:txt_numLines
	sub	ah, ah
	mov	si, ax
	mov	bx, si
	shl	bx, 1
	mov	ax, (bitMask16bit+2)[bx]
	or	[bp+var_4], ax
	mov	al, byte ptr [bp+var_11C]
	add	al, 41h	
	mov	[bp+var_11E], al
	mov	[bp+si+var_119], al
	lfs	bx, [bp+var_C]
	inc	word ptr [bp+var_C]
	mov	al, [bp+var_11E]
	mov	fs:[bx], al
	lfs	bx, [bp+var_C]
	inc	word ptr [bp+var_C]
	mov	byte ptr fs:[bx], 29h
	push	[bp+var_11C]
	push	word ptr [bp+var_C+2]
	push	word ptr [bp+var_C]
	push	cs
	call	near ptr bat_printOpponentGroup
	add	sp, 6
	mov	word ptr [bp+var_C], ax
	mov	word ptr [bp+var_C+2], dx
	lfs	bx, [bp+var_C]
	mov	byte ptr fs:[bx], 0
	lea	ax, [bp+var_10E]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	jmp	loc_1DB82
loc_1DC09:
	jmp	loc_1DD20
loc_1DC0C:
	call	findEmptyRosterNum
	mov	[bp+var_8], ax
	push	cs
	call	near ptr bat_cntActiveMonGroups
	mov	[bp+var_2], ax
	mov	[bp+var_4], 2000h
	mov	[bp+var_11C], 0
	jmp	short loc_1DC2C
loc_1DC28:
	inc	[bp+var_11C]
loc_1DC2C:
	mov	ax, [bp+var_2]
	cmp	[bp+var_11C], ax
	jge	short loc_1DCAF
	lea	ax, [bp+var_10E]
	mov	word ptr [bp+var_C], ax
	mov	word ptr [bp+var_C+2], ss
	mov	al, gs:txt_numLines
	sub	ah, ah
	mov	si, ax
	mov	bx, si
	shl	bx, 1
	mov	ax, (bitMask16bit+2)[bx]
	or	[bp+var_4], ax
	mov	al, byte ptr [bp+var_11C]
	add	al, 41h	
	mov	[bp+var_11E], al
	mov	[bp+si+var_119], al
	lfs	bx, [bp+var_C]
	inc	word ptr [bp+var_C]
	mov	al, [bp+var_11E]
	mov	fs:[bx], al
	lfs	bx, [bp+var_C]
	inc	word ptr [bp+var_C]
	mov	byte ptr fs:[bx], 29h
	push	[bp+var_11C]
	push	word ptr [bp+var_C+2]
	push	word ptr [bp+var_C]
	push	cs
	call	near ptr bat_printOpponentGroup
	add	sp, 6
	mov	word ptr [bp+var_C], ax
	mov	word ptr [bp+var_C+2], dx
	lfs	bx, [bp+var_C]
	mov	byte ptr fs:[bx], 0
	lea	ax, [bp+var_10E]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	jmp	loc_1DC28
loc_1DCAF:
	cmp	[bp+var_2], 0
	jz	short loc_1DCCE
	mov	ax, offset aOr
	push	ds
	push	ax
	push	word ptr [bp+var_C+2]
	push	word ptr [bp+var_C]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_C], ax
	mov	word ptr [bp+var_C+2], dx
loc_1DCCE:
	cmp	[bp+var_8], 1
	jle	short loc_1DCEB
	mov	al, byte ptr [bp+var_8]
	add	al, monStruSize
	mov	byte ptr aMember17+0Bh,	al
	mov	ax, offset aMember17
	push	ds
	push	ax
	call	printString
	add	sp, 4
	jmp	short loc_1DCF8
loc_1DCEB:
	mov	ax, offset aMember1
	push	ds
	push	ax
	call	printString
	add	sp, 4
loc_1DCF8:
	jmp	short loc_1DD20
loc_1DCFA:
	mov	ax, 80h
	jmp	loc_1DD93
	jmp	short loc_1DD20
loc_1DD02:
	or	ax, ax
	jl	short loc_1DCFA
	cmp	ax, target_partyMember
	jg	short loc_1DD0E
	jmp	loc_1DB34
loc_1DD0E:
	cmp	ax, 2
	jnz	short loc_1DD16
	jmp	loc_1DB63
loc_1DD16:
	cmp	ax, 3
	jnz	short loc_1DD1E
	jmp	loc_1DC0C
loc_1DD1E:
	jmp	short loc_1DCFA
loc_1DD20:
	push	[bp+var_4]
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_E], ax
	cmp	ax, 10Eh
	jl	short loc_1DD43
	cmp	ax, 119h
	jg	short loc_1DD43
	mov	si, ax
	mov	al, [bp+si+var_228]
	sub	ah, ah
	mov	[bp+var_E], ax
loc_1DD43:
	cmp	[bp+var_6], 0
	jz	short loc_1DD54
	cmp	[bp+var_E], 1Bh
	jnz	short loc_1DD54
	mov	ax, 0FFFFh
	jmp	short loc_1DD93
loc_1DD54:
	cmp	[bp+var_E], 30h	
	jle	short loc_1DD6D
	mov	ax, [bp+var_8]
	add	ax, 31h	
	cmp	ax, [bp+var_E]
	jle	short loc_1DD6D
	mov	ax, [bp+var_E]
	sub	ax, 31h	
	jmp	short loc_1DD93
loc_1DD6D:
	cmp	[bp+var_E], 41h	
	jl	short loc_1DD86
	mov	ax, [bp+var_2]
	add	ax, 41h	
	cmp	ax, [bp+var_E]
	jle	short loc_1DD86
	mov	ax, [bp+var_E]
	add	ax, 3Fh	
	jmp	short loc_1DD93
loc_1DD86:
	cmp	[bp+var_E], 1Bh
	jnz	short loc_1DD91
	mov	ax, 0FFFFh
	jmp	short loc_1DD93
loc_1DD91:
	jmp	short loc_1DD20
loc_1DD93:
	pop	si
	mov	sp, bp
	pop	bp
	retf
getTarget endp

; Attributes: bp-based frame

bat_cntActiveMonGroups proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 0
	jmp	short loc_1DDAD
loc_1DDAA:
	inc	[bp+var_2]
loc_1DDAD:
	cmp	[bp+var_2], 4
	jge	short loc_1DDCE
	getMonP	[bp+var_2], bx
	test	gs:monGroups.groupSize[bx], 1Fh
	jnz	short loc_1DDCC
	mov	ax, [bp+var_2]
	jmp	short loc_1DDD3
loc_1DDCC:
	jmp	short loc_1DDAA
loc_1DDCE:
	mov	ax, 4
	jmp	short $+2
loc_1DDD3:
	mov	sp, bp
	pop	bp
	retf
bat_cntActiveMonGroups endp

; Attributes: bp-based frame

; Attributes: bp-based frame

bat_getCharDamage proc far

	var_22=	word ptr -22h
	var_20=	word ptr -20h
	var_1E=	dword ptr -1Eh
	var_1A=	word ptr -1Ah
	var_18=	word ptr -18h
	var_16=	word ptr -16h
	var_14=	word ptr -14h
	var_12=	word ptr -12h
	var_10=	word ptr -10h
	var_E= word ptr	-0Eh
	var_C= word ptr	-0Ch
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 22h	
	call	someStackOperation
	push	si
	cmp	[bp+arg_2], 80h
	jge	short loc_1DED6
	getCharP	[bp+arg_2], bx
	mov	al, gs:roster.ac[bx]
	cbw
	mov	[bp+var_4], ax
	jmp	loc_1DF74
loc_1DED6:
	mov	ax, [bp+arg_2]
	and	ax, 3
	mov	[bp+var_E], ax
	getMonP	[bp+var_E], bx
	mov	al, gs:monGroups.distance[bx]
	sub	ah, ah
	and	ax, 0Fh
	mov	[bp+var_C], ax
	or	ax, ax
	jz	short loc_1DF17
	mov	bx, [bp+arg_0]
	mov	al, gs:byte_42280[bx]
	sub	ah, ah
	mov	cx, [bp+var_C]
	dec	cx
	cmp	ax, cx
	jnb	short loc_1DF17
	sub	ax, ax
	jmp	loc_1E277
loc_1DF17:
	getMonP	[bp+var_E], si
	mov	al, gs:monGroups.packedGenAc[si]
	sub	ah, ah
	and	ax, 3Fh
	mov	[bp+var_4], ax
	mov	al, gs:monGroups.flags[si]
	sub	ah, ah
	mov	cl, 6
	shr	ax, cl
	and	ax, 3
	mov	[bp+var_22], ax
	mov	bx, ax
	mov	al, byte_47606[bx]
	cbw
	add	[bp+var_4], ax
	mov	al, gs:monGroups.distance[si]
	sub	ah, ah
	mov	cl, 4
	shr	ax, cl
	mov	[bp+var_8], ax
	mov	bx, ax
	mov	al, byte_4760A[bx]
	cbw
	add	[bp+var_4], ax
	mov	bx, [bp+var_E]
	mov	al, gs:byte_42270[bx]
	sub	ah, ah
	sub	[bp+var_4], ax
loc_1DF74:
	mov	ax, itType_weapon
	push	ax
	push	[bp+arg_0]
	call	inven_getTypeEqSlot
	add	sp, 4
	mov	[bp+var_6], ax
	or	ax, ax
	jl	short loc_1DFB8
	mov	bx, ax
	mov	al, itemTypeList[bx]
	sub	ah, ah
	mov	cl, 4
	shr	ax, cl
	mov	gs:specialAttackVal, ax
	mov	al, item_acBonWeapDam[bx]
	sub	ah, ah
	shr	ax, cl
	mov	[bp+var_10], ax
	sub	[bp+var_4], ax
	jmp	short loc_1DFC8
loc_1DFB8:
	mov	[bp+var_10], 0
	mov	gs:specialAttackVal, 0
loc_1DFC8:
	mov	al, gs:byte_42567
	sub	ah, ah
	add	ax, [bp+var_4]
	mov	[bp+var_18], ax
	getCharP	[bp+arg_0], si
	cmp	gs:roster.class[si], class_monster
	jb	short loc_1E01B
	add	ax, offset roster
	mov	word ptr [bp+var_1E], ax
	mov	word ptr [bp+var_1E+2],	seg seg027
	lfs	bx, [bp+var_1E]
	mov	al, fs:[bx+summonStat_t.toHitHi]
	sub	ah, ah
	push	ax
	mov	al, fs:[bx+summonStat_t.toHitLo]
	push	ax
	push	cs
	call	near ptr randomBetweenXandY
	add	sp, 4
	mov	[bp+var_12], ax
	mov	ax, [bp+var_4]
	sub	ax, [bp+var_12]
	mov	[bp+var_A], ax
	jmp	short loc_1E059
loc_1E01B:
	getCharP	[bp+arg_0], bx
	mov	ax, gs:roster.level[bx]
	shr	ax, 1
	shr	ax, 1
	mov	[bp+var_12], ax
	cmp	ax, 0FFh
	jle	short loc_1E03D
	mov	[bp+var_12], 0FFh
loc_1E03D:
	getCharP	[bp+arg_0], bx
	mov	al, gs:roster.strength[bx]
	sub	ah, ah
	shr	ax, 1
	mov	cx, [bp+var_4]
	sub	cx, ax
	sub	cx, [bp+var_12]
	mov	[bp+var_A], cx
loc_1E059:
	call	rnd_2d8
	mov	cx, ax
	getCharP	[bp+arg_0], bx
	mov	bl, gs:roster.class[bx]
	sub	bh, bh
	mov	al, byte_475F8[bx]
	cbw
	mov	bx, [bp+arg_0]
	mov	dl, gs:strengthBonus[bx]
	sub	dh, dh
	add	ax, dx
	add	ax, cx
	mov	cl, gs:byte_41E70
	sub	ch, ch
	add	ax, cx
	sub	[bp+var_A], ax
	cmp	[bp+var_A], 0
	jle	short loc_1E0A5
	sub	ax, ax
	jmp	loc_1E277
loc_1E0A5:
	getCharP	bx, bx
	cmp	gs:roster.class[bx], class_monster
	jb	short loc_1E0D5
	mov	ax, gs:summonMeleeType
	mov	gs:specialAttackVal, ax
	mov	ax, gs:summonMeleeDamage
	mov	[bp+var_16], ax
	jmp	short loc_1E12B
loc_1E0D5:
	cmp	[bp+var_6], 0
	jl	short loc_1E0EE
	mov	bx, [bp+var_6]
	mov	al, itemDamageDice[bx]
	sub	ah, ah
	mov	[bp+var_16], ax
	jmp	short loc_1E12B
loc_1E0EE:
	getCharP	[bp+arg_0], si
	cmp	gs:roster.class[si], class_monk
	jnz	short loc_1E126
	mov	ax, gs:roster.level[si]
	shr	ax, 1
	shr	ax, 1
	mov	[bp+var_20], ax
	cmp	ax, 0Fh
	jle	short loc_1E118
	mov	[bp+var_20], 0Fh
loc_1E118:
	mov	bx, [bp+var_20]
	mov	al, byte_47412[bx]
	sub	ah, ah
	mov	[bp+var_16], ax
	jmp	short loc_1E12B
loc_1E126:
	mov	[bp+var_16], 20h 
loc_1E12B:
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.class[bx], class_rogue
	jnz	short loc_1E152
	mov	bx, [bp+arg_0]
	cmp	gs:byte_42280[bx], 0
	jnz	short loc_1E152
	sub	ax, ax
	jmp	short loc_1E165
loc_1E152:
	getCharP	[bp+arg_0], bx
	mov	al, gs:roster.numAttacks[bx]
	sub	ah, ah
loc_1E165:
	mov	[bp+var_2], ax
	mov	al, gs:songExtraAttack
	sub	ah, ah
	add	[bp+var_2], ax
	inc	[bp+var_2]
	mov	ax, [bp+var_2]
	mov	[bp+var_1A], ax
	mov	gs:damageAmount, 0
	jmp	short loc_1E18E
loc_1E18B:
	dec	[bp+var_2]
loc_1E18E:
	cmp	[bp+var_2], 0
	jle	short loc_1E1F8
	push	[bp+var_16]
	push	cs
	call	near ptr dice_doYDX
	add	sp, 2
	mov	bx, [bp+arg_0]
	mov	cl, gs:strengthBonus[bx]
	sub	ch, ch
	add	cx, ax
	mov	al, gs:byte_42440
	sub	ah, ah
	add	cx, ax
	add	cx, [bp+var_10]
	add	gs:damageAmount, cx
	mov	[bp+var_14], 0
	jmp	short loc_1E1D0
loc_1E1CD:
	inc	[bp+var_14]
loc_1E1D0:
	mov	bx, [bp+arg_0]
	mov	al, gs:vorpalPlateBonus[bx]
	sub	ah, ah
	cmp	ax, [bp+var_14]
	jbe	short loc_1E1F6
	call	_random
	and	ax, 4
	add	gs:damageAmount, ax
	jmp	short loc_1E1CD
loc_1E1F6:
	jmp	short loc_1E18B
loc_1E1F8:
	mov	bx, [bp+arg_0]
	cmp	gs:byte_42280[bx], 0
	jz	short loc_1E232
	call	_random
	mov	cx, ax
	getCharP	[bp+arg_0], bx
	cmp	gs:(roster.specAbil+2)[bx], cl
	jbe	short loc_1E226
	mov	ax, speAtt_criticalHit
	jmp	short loc_1E228
loc_1E226:
	sub	ax, ax
loc_1E228:
	mov	gs:specialAttackVal, ax
	jmp	short loc_1E272
loc_1E232:
	getCharP	[bp+arg_0], si
	cmp	gs:roster.class[si], class_hunter
	jnz	short loc_1E267
	call	_random
	cmp	gs:roster.specAbil[si],	al
	jbe	short loc_1E25B
	mov	ax, speAtt_criticalHit
	jmp	short loc_1E25D
loc_1E25B:
	sub	ax, ax
loc_1E25D:
	mov	gs:specialAttackVal, ax
	jmp	short loc_1E272
loc_1E267:
	mov	gs:specialAttackVal, 0
loc_1E272:
	mov	ax, [bp+var_1A]
	jmp	short $+2
loc_1E277:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_getCharDamage endp

; Attributes: bp-based frame
bat_printHitDamage proc	far

	dmgLo= word ptr	 6
	dmgHi= word ptr	 8
	multiAttackFlag= word ptr  0Ah

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	[bp+multiAttackFlag], 1
	jg	short loc_1E2A7
	mov	ax, offset aAndHitsFor
	push	ds
	push	ax
	push	[bp+dmgHi]
	push	[bp+dmgLo]
	call	_strcat
	add	sp, 8
	mov	[bp+dmgLo], ax
	mov	[bp+dmgHi], dx
	jmp	short loc_1E2F4
loc_1E2A7:
	mov	ax, offset aAndHits
	push	ds
	push	ax
	push	[bp+dmgHi]
	push	[bp+dmgLo]
	call	_strcat
	add	sp, 8
	mov	[bp+dmgLo], ax
	mov	[bp+dmgHi], dx
	sub	ax, ax
	push	ax
	mov	ax, [bp+multiAttackFlag]
	cwd
	push	dx
	push	ax
	push	[bp+dmgHi]
	push	[bp+dmgLo]
	call	_itoa
	add	sp, 0Ah
	mov	[bp+dmgLo], ax
	mov	[bp+dmgHi], dx
	mov	ax, offset aTimesFor
	push	ds
	push	ax
	push	dx
	push	[bp+dmgLo]
	call	_strcat
	add	sp, 8
	mov	[bp+dmgLo], ax
	mov	[bp+dmgHi], dx
loc_1E2F4:
	sub	ax, ax
	push	ax
	mov	ax, gs:damageAmount
	cwd
	push	dx
	push	ax
	push	[bp+dmgHi]
	push	[bp+dmgLo]
	call	_itoa
	add	sp, 0Ah
	mov	[bp+dmgLo], ax
	mov	[bp+dmgHi], dx
	mov	ax, gs:damageAmount
	dec	ax
	push	ax
	push	dx
	push	[bp+dmgLo]
	mov	ax, offset aPointSOfDamage
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+dmgLo], ax
	mov	[bp+dmgHi], dx
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
bat_printHitDamage endp

; Attributes: bp-based frame

bat_getKillString proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	bx, gs:specialAttackVal
	shl	bx, 1
	shl	bx, 1
	push	word ptr (specialAttString+2)[bx]
	push	word ptr specialAttString[bx]
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	_strcat
	add	sp, 8
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
bat_getKillString endp

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	sub	ax, ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
; Attributes: bp-based frame

bat_doHPDamage proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	[bp+arg_0], 80h
	jge	short loc_1E3A1
	push	[bp+arg_0]
	push	cs
	call	near ptr bat_charAfterDmgCheck
	add	sp, 2
	jmp	short loc_1E3B1
	jmp	short loc_1E3B1
loc_1E3A1:
	mov	ax, [bp+arg_0]
	and	ax, 7Fh
	push	ax
	push	cs
	call	near ptr bat_doMonHPDamage
	add	sp, 2
	jmp	short $+2
loc_1E3B1:
	mov	sp, bp
	pop	bp
	retf
bat_doHPDamage endp

; Attributes: bp-based frame

bat_doMonHPDamage proc far

	monNo= word ptr	-4
	groupSize= word	ptr -2
	groupNo= word ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	getMonP	[bp+groupNo], bx
	mov	al, gs:monGroups.groupSize[bx]
	sub	ah, ah
	and	ax, 1Fh
	mov	[bp+groupSize],	ax
	or	ax, ax
	jnz	short loc_1E3E1
	sub	ax, ax
	jmp	short loc_1E459
loc_1E3E1:
	mov	[bp+monNo], 0
	jmp	short loc_1E3EB
loc_1E3E8:
	inc	[bp+monNo]
loc_1E3EB:
	mov	ax, [bp+groupSize]
	cmp	[bp+monNo], ax
	jge	short loc_1E41E
	mov	bx, [bp+groupNo]
	mov	cl, 6
	shl	bx, cl
	mov	ax, [bp+monNo]
	shl	ax, 1
	add	bx, ax
	test	byte ptr gs:bat_monPriorityList[bx], 1
	jz	short loc_1E41C
	push	[bp+monNo]
	push	[bp+groupNo]
	push	cs
	call	near ptr bat_monAfterDmgCheck
	add	sp, 4
	jmp	short loc_1E459
loc_1E41C:
	jmp	short loc_1E3E8
loc_1E41E:
	mov	[bp+monNo], 0
	jmp	short loc_1E428
loc_1E425:
	inc	[bp+monNo]
loc_1E428:
	mov	ax, [bp+groupSize]
	cmp	[bp+monNo], ax
	jge	short loc_1E44A
	mov	bx, [bp+groupNo]
	mov	cl, 6
	shl	bx, cl
	mov	ax, [bp+monNo]
	shl	ax, 1
	add	bx, ax
	or	byte ptr gs:bat_monPriorityList[bx], 1
	jmp	short loc_1E425
loc_1E44A:
	sub	ax, ax
	push	ax
	push	[bp+groupNo]
	push	cs
	call	near ptr bat_monAfterDmgCheck
	add	sp, 4
	jmp	short $+2
loc_1E459:
	mov	sp, bp
	pop	bp
	retf
bat_doMonHPDamage endp

; Attributes: bp-based frame

bat_monAfterDmgCheck proc far

	var_4= dword ptr -4
	groupNo= word ptr  6
	monNo= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	bx, [bp+groupNo]
	mov	cl, 6
	shl	bx, cl
	mov	ax, [bp+monNo]
	shl	ax, 1
	add	bx, ax
	and	gs:bat_monPriorityList[bx], 0FEh
	cmp	gs:specialAttackVal, speAtt_stoning
	jz	short loc_1E495
	cmp	gs:specialAttackVal, speAtt_criticalHit
	jnz	short loc_1E4A7
loc_1E495:
	push	[bp+monNo]
	push	[bp+groupNo]
	push	cs
	call	near ptr bat_killMon
	add	sp, 4
	mov	ax, 1
	jmp	short loc_1E4ED
loc_1E4A7:
	mov	ax, [bp+groupNo]
	mov	cl, 6
	shl	ax, cl
	mov	cx, [bp+monNo]
	shl	cx, 1
	add	ax, cx
	add	ax, offset monHpList
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], seg seg027
	mov	ax, gs:damageAmount
	lfs	bx, [bp+var_4]
	sub	fs:[bx], ax
	lfs	bx, [bp+var_4]
	cmp	word ptr fs:[bx], 0
	jg	short loc_1E4E9
	push	[bp+monNo]
	push	[bp+groupNo]
	push	cs
	call	near ptr bat_killMon
	add	sp, 4
	mov	ax, 1
	jmp	short loc_1E4ED
loc_1E4E9:
	sub	ax, ax
	jmp	short $+2
loc_1E4ED:
	mov	sp, bp
	pop	bp
	retf
bat_monAfterDmgCheck endp

; Attributes: bp-based frame

bat_killMon proc far

	mon= word ptr -2
	groupNo= word ptr  6
	monNo= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	ax, [bp+monNo]
	mov	[bp+mon], ax
	jmp	short loc_1E508
loc_1E505:
	inc	[bp+mon]
loc_1E508:
	getMonP	[bp+groupNo], bx
	mov	al, gs:monGroups.groupSize[bx]
	sub	ah, ah
	and	ax, 1Fh
	cmp	ax, [bp+mon]
	jb	short loc_1E54F
	mov	si, [bp+groupNo]
	mov	cl, 6
	shl	si, cl
	mov	ax, [bp+mon]
	shl	ax, 1
	add	si, ax
	mov	ax, gs:(monHpList+2)[si]
	mov	gs:monHpList[si], ax
	mov	ax, gs:(bat_monPriorityList+2)[si]
	mov	gs:bat_monPriorityList[si], ax
	jmp	short loc_1E505
loc_1E54F:
	getMonP	[bp+groupNo], si
	dec	gs:monGroups.groupSize[si]
	test	gs:monGroups.groupSize[si], 1Fh
	jnz	short loc_1E56E
	and	gs:monGroups.flags[si],	0FEh
loc_1E56E:
	getMonP	[bp+groupNo], si
	mov	ah, gs:monGroups.rewardMid[si]
	sub	al, al
	mov	dl, gs:monGroups.rewardHi[si]
	sub	dh, dh
	mov	cl, 10h
	shl	dx, cl
	add	ax, dx
	mov	cl, gs:monGroups.rewardLo[si]
	sub	ch, ch
	add	ax, cx
	sub	dx, dx
	add	gs:batRewardLo,	ax
	adc	gs:batRewardHi,	dx
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_killMon endp

; Attributes: bp-based frame

bat_charAfterDmgCheck proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	getCharP	[bp+arg_0], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jnz	short loc_1E5CC
	sub	ax, ax
	jmp	loc_1E66E
loc_1E5CC:
	getCharP	[bp+arg_0], bx
	test	gs:roster.status[bx], stat_dead
	jz	short loc_1E5FA
	cmp	gs:specialAttackVal, speAtt_possess
	jnz	short loc_1E5F6
	push	[bp+arg_0]
	push	cs
	call	near ptr bat_inflictStatus
	add	sp, 2
	jmp	short loc_1E66E
	jmp	short loc_1E5FA
loc_1E5F6:
	sub	ax, ax
	jmp	short loc_1E66E
loc_1E5FA:
	getCharP	[bp+arg_0], bx
	test	gs:roster.status[bx], stat_stoned
	jz	short loc_1E612
	sub	ax, ax
	jmp	short loc_1E66E
loc_1E612:
	getCharP	[bp+arg_0], si
	mov	ax, gs:damageAmount
	cmp	gs:roster.currentHP[si], ax
	jnb	short loc_1E647
	or	gs:roster.status[si], stat_dead
	mov	gs:roster.currentHP[si], 0
	mov	gs:roster.hostileFlag[si], 0
	mov	ax, 1
	jmp	short loc_1E66E
	jmp	short loc_1E662
loc_1E647:
	mov	ax, gs:damageAmount
	mov	cx, ax
	getCharP	[bp+arg_0], bx
	sub	gs:roster.currentHP[bx], cx
loc_1E662:
	push	[bp+arg_0]
	push	cs
	call	near ptr bat_inflictStatus
	add	sp, 2
	jmp	short $+2
loc_1E66E:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_charAfterDmgCheck endp

; Attributes: bp-based frame

bat_inflictStatus proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	charNo=	word ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	ax, gs:specialAttackVal
	jmp	loc_1E869
loc_1E68A:
	sub	ax, ax
	jmp	loc_1E88A
poisonChar:
	getCharP	[bp+charNo], bx
	or	gs:roster.status[bx], stat_poisoned
	mov	ax, 1
	jmp	loc_1E88A
levelDrainChar:
	getCharP	[bp+charNo], bx
	cmp	gs:roster.class[bx], class_monster
	jb	short loc_1E6C2
	sub	ax, ax
	jmp	loc_1E88A
	jmp	short loc_1E70E
loc_1E6C2:
	getCharP	[bp+charNo], bx
	cmp	gs:roster.level[bx], 1
	jbe	short loc_1E6DF
	getCharP	[bp+charNo], bx
	dec	gs:roster.level[bx]
loc_1E6DF:
	getCharP	[bp+charNo], si
	mov	ax, gs:roster.level[si]
	dec	ax
	push	ax
	push	[bp+charNo]
	call	getXPForLevel
	add	sp, 4
	cwd
	mov	word ptr gs:roster.experience[si], ax
	mov	word ptr gs:(roster.experience+2)[si], dx
	mov	ax, 1
	jmp	loc_1E88A
loc_1E70E:
	sub	ax, ax
	jmp	loc_1E88A
nutsifyChar:
	getCharP	[bp+charNo], bx
	or	gs:roster.status[bx], stat_nuts
	mov	ax, 1
	jmp	loc_1E88A
oldifyChar:
	getCharP	[bp+charNo], bx
	cmp	gs:roster.class[bx], class_monster
	jb	short loc_1E744
	sub	ax, ax
	jmp	loc_1E88A
loc_1E744:
	getCharP	[bp+charNo], bx
	test	gs:roster.status[bx], stat_old
	jz	short loc_1E759
	sub	ax, ax
	jmp	loc_1E88A
loc_1E759:
	getCharP	[bp+charNo], si
	mov	ax, 5
	push	ax
	lea	ax, roster.savedST[si]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, roster.strength[si]
	push	dx
	push	ax
	push	cs
	call	near ptr _doAgeStatus
	add	sp, 0Ah
	getCharP	[bp+charNo], bx
	or	gs:roster.status[bx], stat_old
	mov	ax, 1
	jmp	loc_1E88A
possessChar:
	getCharP	[bp+charNo], si
	mov	gs:roster.currentHP[si], 64h 
	and	gs:roster.status[si], stat_poisoned or stat_old	or stat_stoned or stat_paralyzed or stat_possessed or stat_nuts	or stat_unknown
	or	gs:roster.status[si], stat_possessed
	mov	ax, 1
	jmp	loc_1E88A
stoneChar:
	getCharP	[bp+charNo], si
	mov	gs:roster.currentHP[si], 0
	mov	gs:roster.hostileFlag[si], 0
	or	gs:roster.status[si], stat_stoned
	mov	ax, 1
	jmp	loc_1E88A
killChar:
	getCharP	[bp+charNo], si
	or	gs:roster.status[si], stat_dead
	mov	gs:roster.currentHP[si], 0
	mov	gs:roster.hostileFlag[si], 0
	mov	ax, 1
	jmp	loc_1E88A
loc_1E802:
	mov	[bp+var_4], 0
	jmp	short loc_1E80D
loc_1E809:
	add	[bp+var_4], 3
loc_1E80D:
	cmp	[bp+var_4], 24h	
	jge	short loc_1E846
	getCharP	[bp+charNo], si
	add	si, [bp+var_4]
	mov	al, gs:roster.inventory.itemNo[si]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	bx, ax
	cmp	itemTypeList[bx], 1
	jnz	short loc_1E844
	and	gs:roster.inventory.itemFlags[si], 0FCh
loc_1E844:
	jmp	short loc_1E809
loc_1E846:
	mov	ax, 1
	jmp	short loc_1E88A
consumeSppt:
	getCharP	[bp+charNo], bx
	mov	gs:roster.currentSppt[bx], 0
	mov	ax, 1
	jmp	short loc_1E88A
loc_1E863:
	sub	ax, ax
	jmp	short loc_1E88A
	jmp	short loc_1E88A
loc_1E869:
	cmp	ax, 9
	ja	short loc_1E863
	add	ax, ax
	xchg	ax, bx
	jmp	cs:off_1E876[bx]
off_1E876 dw offset loc_1E68A
dw offset poisonChar
dw offset levelDrainChar
dw offset nutsifyChar
dw offset oldifyChar
dw offset possessChar
dw offset stoneChar
dw offset killChar
dw offset loc_1E802
dw offset consumeSppt
loc_1E88A:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_inflictStatus endp

; Attributes: bp-based frame

_doAgeStatus proc far

	arg_0= dword ptr  6
	arg_4= dword ptr  0Ah
	arg_8= word ptr	 0Eh

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	jmp	short loc_1E89E
loc_1E89B:
	dec	[bp+arg_8]
loc_1E89E:
	cmp	[bp+arg_8], 0
	jl	short loc_1E8BF
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx]
	lfs	bx, [bp+arg_4]
	inc	word ptr [bp+arg_4]
	mov	fs:[bx], al
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], 1
	jmp	short loc_1E89B
loc_1E8BF:
	mov	sp, bp
	pop	bp
	retf
_doAgeStatus endp

; Attributes: bp-based frame

partyDied proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	byte ptr word_44166,	0
	mov	gs:byte_42296, 0FFh
	mov	ax, 57
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
	mov	ax, offset aSorryBud
	push	ds
	push	ax
	call	setTitle
	add	sp, 4
	mov	ax, offset aAlasYourPartyHasExp
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
	sub	al, al
	mov	gs:byte_42458, al
	mov	partyAttackFlag, al
	sub	ah, ah
	mov	currentLocationMaybe, ax
	mov	sq_north, 0Bh
	mov	sq_east, 0Fh
	mov	dirFacing, 0
	mov	ax, 1
	jmp	short $+2
	mov	sp, bp
	pop	bp
locret_1E958:
	retf
partyDied endp

seg008 ends

; Segment type:	Pure code
seg009 segment word public 'CODE' use16
	assume cs:seg009
;org 9
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
algn_1E959:
align 2
; Attributes: bp-based frame

rnd_2d16 proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	call	_random
	and	ax, 15
	mov	si, ax
	call	_random
	and	ax, 15
	add	ax, si
	add	ax, 2
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
rnd_2d16 endp

; Attributes: bp-based frame

rnd_2d8	proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	call	_random
	and	ax, 7
	mov	si, ax
	call	_random
	and	ax, 7
	add	ax, si
	add	ax, 2
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
rnd_2d8	endp

; Attributes: bp-based frame

rnd_1d8	proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	call	_random
	and	ax, 7
	inc	ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
rnd_1d8	endp

; Attributes: bp-based frame
bat_giveExperience proc	far

	rostSize= word ptr -8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	call	rost_getLastActiveSlot
	inc	ax
	mov	[bp+rostSize], ax
	cmp	ax, 7
	jle	short loc_1E9E4
	sub	ax, ax
	cwd
	jmp	short loc_1EA3B
loc_1E9E4:
	mov	ax, [bp+rostSize]
	cwd
	push	dx
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	__32bitDivide
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	mov	[bp+var_6], 0
	jmp	short loc_1EA05
loc_1EA02:
	inc	[bp+var_6]
loc_1EA05:
	mov	ax, [bp+rostSize]
	cmp	[bp+var_6], ax
	jge	short loc_1EA33
	getCharP	[bp+var_6], si
	cmp	gs:roster.class[si], class_monster
	jnb	short loc_1EA31
	mov	ax, [bp+var_4]
	mov	dx, [bp+var_2]
	add	word ptr gs:roster.experience[si], ax
	adc	word ptr gs:(roster.experience+2)[si], dx
loc_1EA31:
	jmp	short loc_1EA02
loc_1EA33:
	mov	ax, [bp+var_4]
	mov	dx, [bp+var_2]
	jmp	short $+2
loc_1EA3B:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_giveExperience endp

; Attributes: bp-based frame

bat_giveGold proc far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	call	rost_getLastActiveSlot
	inc	ax
	mov	[bp+var_8], ax
	cmp	ax, 7
	jle	short loc_1EA5F
	sub	ax, ax
	cwd
	jmp	short loc_1EAB6
loc_1EA5F:
	mov	ax, [bp+var_8]
	cwd
	push	dx
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	__32bitDivide
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	mov	[bp+var_6], 0
	jmp	short loc_1EA80
loc_1EA7D:
	inc	[bp+var_6]
loc_1EA80:
	mov	ax, [bp+var_8]
	cmp	[bp+var_6], ax
	jge	short loc_1EAAE
	getCharP	[bp+var_6], si
	cmp	gs:roster.class[si], class_illusion
	jnb	short loc_1EAAC
	mov	ax, [bp+var_4]
	mov	dx, [bp+var_2]
	add	word ptr gs:roster.gold[si], ax
	adc	word ptr gs:(roster.gold+2)[si], dx
loc_1EAAC:
	jmp	short loc_1EA7D
loc_1EAAE:
	mov	ax, [bp+var_4]
	mov	dx, [bp+var_2]
	jmp	short $+2
loc_1EAB6:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_giveGold endp

; Attributes: bp-based frame

bat_partyDisbelieves proc far

	groupNo= word ptr -2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	[bp+groupNo], 3
	jmp	short loc_1EAD1
loc_1EACE:
	dec	[bp+groupNo]
loc_1EAD1:
	cmp	[bp+groupNo], 0
	jge	short loc_1EADA
	jmp	loc_1EB64
loc_1EADA:
	getMonP	[bp+groupNo], si
	test	gs:monGroups.groupSize[si], 1Fh
	jz	short loc_1EB61
	test	gs:monGroups.flags[si],	10h
	jz	short loc_1EB61
	mov	gs:bat_curTarget, 0
	test	gs:byte_4240E, 81h
	jnz	short loc_1EB20
	sub	ax, ax
	push	ax
	mov	ax, 80h
	push	ax
	call	savingThrowCheck
	add	sp, 4
	cmp	ax, 2
	jnz	short loc_1EB61
loc_1EB20:
	mov	gs:specialAttackVal, speAtt_stoning
	getMonP	[bp+groupNo], bx
	mov	gs:monGroups.groupSize[bx], 1
	push	[bp+groupNo]
	call	bat_doMonHPDamage
	add	sp, 2
	mov	ax, offset aThePartyDisbelieves_
	push	ds
	push	ax
	call	printString
	add	sp, 4
	delayWithTable
loc_1EB61:
	jmp	loc_1EACE
loc_1EB64:
	and	gs:byte_4240E, 0FEh
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_partyDisbelieves endp

; Attributes: bp-based frame

bat_monDisbelieve proc far

	charNo=	word ptr -2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	[bp+charNo], 0
	jmp	short loc_1EB89
loc_1EB86:
	inc	[bp+charNo]
loc_1EB89:
	cmp	[bp+charNo], 7
	jge	short loc_1EBEB
	getCharP	[bp+charNo], si
	cmp	byte ptr gs:roster._name[si], 0
	jz	short loc_1EBE9
	cmp	gs:roster.class[si], class_illusion
	jnz	short loc_1EBE9
	mov	gs:bat_curTarget, 80h
	sub	ax, ax
	push	ax
	push	ax
	call	savingThrowCheck
	add	sp, 4
	or	ax, ax
	jz	short loc_1EBE9
	inc	gs:monDisbelieveFlag
	mov	ax, offset aTheyDisbelieve
	push	ds
	push	ax
	call	printString
	add	sp, 4
	delayWithTable
	jmp	short loc_1EBEB
loc_1EBE9:
	jmp	short loc_1EB86
loc_1EBEB:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_monDisbelieve endp

; Attributes: bp-based frame
bat_doPoisonEffect proc	far

	charNo=	word ptr -4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	bl, levelNoMaybe
	sub	bh, bh
	mov	al, byte_479F0[bx]
	cbw
	mov	[bp+var_2], ax
	mov	[bp+charNo], 0
	jmp	short loc_1EC19
loc_1EC16:
	inc	[bp+charNo]
loc_1EC19:
	cmp	[bp+charNo], 7
	jge	short loc_1EC66
	getCharP	[bp+charNo], si
	test	gs:roster.status[si], stat_poisoned
	jz	short loc_1EC64
	mov	ax, [bp+var_2]
	cmp	gs:roster.currentHP[si], ax
	ja	short loc_1EC52
	and	gs:roster.status[si], 0FEh
	or	gs:roster.status[si], stat_dead
	mov	gs:roster.currentHP[si], 0
	jmp	short loc_1EC64
loc_1EC52:
	mov	ax, [bp+var_2]
	mov	cx, ax
	getCharP	[bp+charNo], bx
	sub	gs:roster.currentHP[bx], cx
loc_1EC64:
	jmp	short loc_1EC16
loc_1EC66:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_doPoisonEffect endp

; Attributes: bp-based frame

doEquipmentEffect proc far

	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	[bp+var_4], 0
	jmp	short loc_1EC81
loc_1EC7E:
	inc	[bp+var_4]
loc_1EC81:
	cmp	[bp+var_4], 7
	jl	short loc_1EC8A
	jmp	loc_1ED56
loc_1EC8A:
	getCharP	[bp+var_4], bx
	test	gs:roster.status[bx], 0Ch
	jz	short loc_1ECA1
	jmp	loc_1ED53
loc_1ECA1:
	mov	[bp+var_2], 0
	mov	ax, itemEff_anotherSpptRegen
	push	ax
	push	[bp+var_4]
	call	hasEffectEquipped
	add	sp, 4
	or	ax, ax
	jnz	short loc_1ECBC
	inc	[bp+var_2]
loc_1ECBC:
	mov	ax, itemEff_regenSppt
	push	ax
	push	[bp+var_4]
	call	hasEffectEquipped
	add	sp, 4
	or	ax, ax
	jnz	short loc_1ECD2
	inc	[bp+var_2]
loc_1ECD2:
	getCharP	[bp+var_4], si
	mov	ax, [bp+var_2]
	add	gs:roster.currentSppt[si], ax
	mov	ax, gs:roster.maxSppt[si]
	cmp	gs:roster.currentSppt[si], ax
	jbe	short loc_1ECF7
	mov	gs:roster.currentSppt[si], ax
loc_1ECF7:
	cmp	gs:byte_4266B, 0
	jz	short loc_1ED1E
	cmp	gs:byte_42420, 3
	jnz	short loc_1ED1E
	mov	al, gs:byte_41E62
	sub	ah, ah
	cmp	ax, [bp+var_4]
	jz	short loc_1ED31
loc_1ED1E:
	mov	ax, itemEff_regenHP
	push	ax
	push	[bp+var_4]
	call	hasEffectEquipped
	add	sp, 4
	or	ax, ax
	jnz	short loc_1ED53
loc_1ED31:
	getCharP	[bp+var_4], si
	inc	gs:roster.currentHP[si]
	mov	ax, gs:roster.maxHP[si]
	cmp	gs:roster.currentHP[si], ax
	jbe	short loc_1ED53
	mov	gs:roster.currentHP[si], ax
loc_1ED53:
	jmp	loc_1EC7E
loc_1ED56:
	mov	byte ptr word_44166,	0
	pop	si
	mov	sp, bp
	pop	bp
	retf
doEquipmentEffect endp

; Attributes: bp-based frame

bat_doHPRegen proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	cmp	[bp+arg_0], 0
	jz	short loc_1EDC8
	mov	[bp+var_2], 0
	jmp	short loc_1ED81
loc_1ED7E:
	inc	[bp+var_2]
loc_1ED81:
	cmp	[bp+var_2], 7
	jge	short loc_1EDBE
	getCharP	[bp+var_2], si
	test	gs:roster.status[si], stat_dead	or stat_stoned
	jnz	short loc_1EDA3
	mov	ax, [bp+arg_0]
	add	gs:roster.currentHP[si], ax
loc_1EDA3:
	getCharP	[bp+var_2], si
	mov	ax, gs:roster.maxHP[si]
	cmp	gs:roster.currentHP[si], ax
	jbe	short loc_1EDBC
	mov	gs:roster.currentHP[si], ax
loc_1EDBC:
	jmp	short loc_1ED7E
loc_1EDBE:
	mov	byte ptr word_44166,	0
loc_1EDC8:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_doHPRegen endp

; Attributes: bp-based frame

regenSppt proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	[bp+var_2], 0
	jmp	short loc_1EDE3
loc_1EDE0:
	inc	[bp+var_2]
loc_1EDE3:
	cmp	[bp+var_2], 7
	jge	short loc_1EE1A
	getCharP	[bp+var_2], si
	test	gs:roster.status[si], stat_dead	or stat_stoned
	jnz	short loc_1EE18
	mov	ax, gs:roster.maxSppt[si]
	cmp	gs:roster.currentSppt[si], ax
	jnb	short loc_1EE18
	inc	gs:roster.currentSppt[si]
	mov	byte ptr word_44166,	0
loc_1EE18:
	jmp	short loc_1EDE0
loc_1EE1A:
	pop	si
	mov	sp, bp
	pop	bp
	retf
regenSppt endp

; Attributes: bp-based frame

bat_updatePartyAndMonG proc far

	var_6= word ptr	-6
	counter= word ptr -4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	cmp	[bp+arg_0], 0
	jz	short loc_1EE5D
	mov	[bp+counter], 0
	jmp	short loc_1EE3B
loc_1EE38:
	inc	[bp+counter]
loc_1EE3B:
	cmp	[bp+counter], 7
	jge	short loc_1EE5D
	getCharP	[bp+counter], si
	cmp	gs:roster.class[si], class_illusion
	jnz	short loc_1EE5B
	or	gs:roster.status[si], stat_dead
loc_1EE5B:
	jmp	short loc_1EE38
loc_1EE5D:
	call	rost_getLastActiveSlot
	mov	[bp+var_2], ax
	cmp	ax, 7
	jl	short loc_1EE6D
	jmp	loc_1EF62
loc_1EE6D:
	mov	[bp+counter], 0
loc_1EE72:
	call	rost_getLastActiveSlot
	cmp	ax, [bp+counter]
	jge	short loc_1EE7F
	jmp	loc_1EF62
loc_1EE7F:
	getCharP	[bp+counter], bx
	test	gs:roster.status[bx], stat_dead	or stat_stoned or stat_paralyzed
	jnz	short loc_1EE96
	jmp	loc_1EF5C
loc_1EE96:
	mov	al, gs:byte_4255E
	sub	ah, ah
	cmp	ax, [bp+counter]
	jnz	short loc_1EEAE
	mov	gs:bat_curSong,	ah
loc_1EEAE:
	mov	al, gs:byte_4255E
	sub	ah, ah
	cmp	ax, [bp+counter]
	jbe	short loc_1EEC2
	dec	gs:byte_4255E
loc_1EEC2:
	mov	al, gs:byte_41E62
	sub	ah, ah
	cmp	ax, [bp+counter]
	jnz	short loc_1EED6
	call	bat_endCombatSong
loc_1EED6:
	mov	al, gs:byte_41E62
	sub	ah, ah
	cmp	ax, [bp+counter]
	jbe	short loc_1EEEA
	dec	gs:byte_41E62
loc_1EEEA:
	push	[bp+counter]
	push	cs
	call	near ptr rost_packBonusData
	add	sp, 2
	mov	ax, offset newCharBuffer
	mov	dx, seg	seg027
	push	dx
	push	ax
	getCharP	[bp+counter], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	copyCharacterBuf
	add	sp, 8
	push	[bp+counter]
	call	rost_removeMember
	add	sp, 2
	cmp	gs:newCharBuffer.class,	class_illusion
	jz	short loc_1EF5A
	cmp	gs:newCharBuffer.specAbil+3, 0
	jnz	short loc_1EF5A
	call	findEmptyRosterNum
	mov	[bp+var_6], ax
	getCharP	[bp+var_6], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	mov	ax, offset newCharBuffer
	push	dx
	push	ax
	call	copyCharacterBuf
	add	sp, 8
loc_1EF5A:
	jmp	short loc_1EF5F
loc_1EF5C:
	inc	[bp+counter]
loc_1EF5F:
	jmp	loc_1EE72
loc_1EF62:
	push	cs
	call	near ptr bat_getLastMonGroup
	or	ax, ax
	jle	short loc_1EF6F
	mov	[bp+counter], 0
loc_1EF6F:
	push	cs
	call	near ptr bat_getLastMonGroup
	cmp	ax, [bp+counter]
	jl	short loc_1EFB5
	getMonP	[bp+counter], bx
	test	gs:monGroups.groupSize[bx], 1Fh
	jnz	short loc_1EFB0
	mov	ax, [bp+counter]
	mov	[bp+var_2], ax
	jmp	short loc_1EF97
loc_1EF94:
	inc	[bp+var_2]
loc_1EF97:
	cmp	[bp+var_2], 3
	jge	short loc_1EFAE
	push	[bp+var_2]
	mov	ax, [bp+var_2]
	inc	ax
	push	ax
	push	cs
	call	near ptr bat_moveMonGroup
	add	sp, 4
	jmp	short loc_1EF94
loc_1EFAE:
	jmp	short loc_1EFB3
loc_1EFB0:
	inc	[bp+counter]
loc_1EFB3:
	jmp	short loc_1EF6F
loc_1EFB5:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_updatePartyAndMonG endp

; Attributes: bp-based frame

bat_getLastMonGroup proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 3
	jmp	short loc_1EFCF
loc_1EFCC:
	dec	[bp+var_2]
loc_1EFCF:
	cmp	[bp+var_2], 0
	jl	short loc_1EFF0
	getMonP	[bp+var_2], bx
	test	gs:monGroups.groupSize[bx], 1Fh
	jz	short loc_1EFEE
	mov	ax, [bp+var_2]
	jmp	short loc_1EFF5
loc_1EFEE:
	jmp	short loc_1EFCC
loc_1EFF0:
	mov	ax, 0FFFFh
	jmp	short $+2
loc_1EFF5:
	mov	sp, bp
	pop	bp
	retf
bat_getLastMonGroup endp

; This function	copies the monster group to a
; different slot and zeroes the	vacated	slot.
; Attributes: bp-based frame

bat_moveMonGroup proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	getMonP	[bp+arg_2], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	getMonP	[bp+arg_0], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	mon_copyBuffer
	add	sp, 8
	mov	ax, 40h	
	push	ax
	mov	bx, [bp+arg_0]
	mov	cl, 6
	shl	bx, cl
	lea	ax, monHpList[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	mov	bx, [bp+arg_2]
	shl	bx, cl
	lea	ax, monHpList[bx]
	push	dx
	push	ax
	call	_memcpy
	add	sp, 0Ah
	mov	ax, monStruSize
	push	ax
	sub	ax, ax
	push	ax
	getMonP	[bp+arg_0], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	_memset
	add	sp, 8
	mov	ax, 40h	
	push	ax
	sub	ax, ax
	push	ax
	mov	bx, [bp+arg_0]
	mov	cl, 6
	shl	bx, cl
	lea	ax, monHpList[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	_memset
	add	sp, 8
	mov	sp, bp
	pop	bp
	retf
bat_moveMonGroup endp

; Attributes: bp-based frame
rost_packBonusData proc	far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, [bp+arg_0]
	mov	[bp+var_2], ax
	jmp	short loc_1F0AD
loc_1F0AA:
	inc	[bp+var_2]
loc_1F0AD:
	cmp	[bp+var_2], 6
	jge	short loc_1F0F9
	mov	bx, [bp+var_2]
	mov	al, gs:(byte_42444+1)[bx]
	mov	gs:byte_42444[bx], al
	mov	bx, [bp+var_2]
	mov	al, gs:(strengthBonus+1)[bx]
	mov	gs:strengthBonus[bx], al
	mov	bx, [bp+var_2]
	mov	al, gs:(vorpalPlateBonus+1)[bx]
	mov	gs:vorpalPlateBonus[bx], al
	mov	bx, [bp+var_2]
	mov	al, gs:(byte_42280+1)[bx]
	mov	gs:byte_42280[bx], al
	jmp	short loc_1F0AA
loc_1F0F9:
	mov	gs:byte_42444+6, 0
	mov	gs:strengthBonus+6, 0
	mov	gs:vorpalPlateBonus+6, 0
	mov	gs:byte_42286, 0
	mov	sp, bp
	pop	bp
	retf
rost_packBonusData endp

; Attributes: bp-based frame

bat_isAMonGroupActive proc far

	groupNo= word ptr -2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+groupNo], 0
	jmp	short loc_1F13A
loc_1F137:
	inc	[bp+groupNo]
loc_1F13A:
	cmp	[bp+groupNo], 4
	jge	short loc_1F15B
	getMonP	[bp+groupNo], bx
	test	gs:monGroups.groupSize[bx], 1Fh
	jz	short loc_1F159
	mov	ax, 1
	jmp	short loc_1F15F
loc_1F159:
	jmp	short loc_1F137
loc_1F15B:
	sub	ax, ax
	jmp	short $+2
loc_1F15F:
	mov	sp, bp
	pop	bp
	retf
bat_isAMonGroupActive endp

; Attributes: bp-based frame

_return_zero proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	sub	ax, ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
_return_zero endp

; Attributes: bp-based frame

bat_end	proc far

	var_2= word ptr	-2
	song= word ptr	6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	sub	al, al
	mov	gs:byte_42458, al
	mov	byte_4EECC, al
	mov	partyAttackFlag, al
	mov	[bp+var_2], 0
	jmp	short loc_1F1A5
loc_1F1A2:
	inc	[bp+var_2]
loc_1F1A5:
	cmp	[bp+var_2], 4
	jge	short loc_1F1C5
	getMonP	[bp+var_2], si
	mov	byte ptr gs:monGroups._name[si], 0
	mov	gs:monGroups.groupSize[si], 0
	jmp	short loc_1F1A2
loc_1F1C5:
	cmp	[bp+song], 0
	jz	short loc_1F1EF
	push	[bp+arg_2]
	call	_charCanPlaySong
	add	sp, 2
	or	ax, ax
	jz	short loc_1F1EF
	push	[bp+arg_4]
	push	[bp+arg_2]
	call	sub_22CD5
	add	sp, 4
	call	song_doNoncombatEffect
	jmp	short loc_1F1F4
loc_1F1EF:
	call	song_endMusic
loc_1F1F4:
	call	bat_resetData
	pop	si
	mov	sp, bp
	pop	bp
	retf
bat_end	endp

; Attributes: bp-based frame

bat_getReward proc far

	var_114= word ptr -114h
	var_112= word ptr -112h
	var_110= word ptr -110h
	var_10E= word ptr -10Eh
	var_10C= word ptr -10Ch
	var_10A= word ptr -10Ah
	var_108= dword ptr -108h
	var_104= word ptr -104h
	var_102= word ptr -102h
	var_100= word ptr -100h

	func_enter
	_chkstk	114h
	delayNoTable	2
	call	clearTextWindow
	mov	gs:word_41E6E, 0
	mov	ax, gs:batRewardLo
	or	ax, gs:batRewardHi
	jnz	short loc_1F239
	sub	ax, ax
	jmp	loc_1F565
loc_1F239:
	cmp	inDungeonMaybe, 0
	jz	short loc_1F255
	cmp	byte_4EECC, 0
	jz	short loc_1F255
	push	cs
	call	near ptr bat_doChest
loc_1F255:
	call	rost_getLastActiveSlot
	cmp	ax, 7
	jle	short loc_1F265
	mov	ax, 1
	jmp	loc_1F565
loc_1F265:
	mov	ax, gs:batRewardLo
	or	ax, gs:batRewardHi
	jnz	short loc_1F279
	sub	ax, ax
	jmp	loc_1F565
loc_1F279:
	mov	ax, offset aEachCharacterReceive
	push	ds
	push	ax
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_108], ax
	mov	word ptr [bp+var_108+2], dx
	sub	ax, ax
	push	ax
	push	gs:batRewardHi
	push	gs:batRewardLo
	push	cs
	call	near ptr bat_giveExperience
	add	sp, 4
	push	dx
	push	ax
	push	word ptr [bp+var_108+2]
	push	word ptr [bp+var_108]
	call	_itoa
	add	sp, 0Ah
	mov	word ptr [bp+var_108], ax
	mov	word ptr [bp+var_108+2], dx
	mov	ax, offset aExperiencePointsForV
	push	ds
	push	ax
	push	dx
	push	word ptr [bp+var_108]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_108], ax
	mov	word ptr [bp+var_108+2], dx
	cmp	gs:word_41E6E, 0
	jz	short loc_1F2F1
	sub	ax, ax
	cwd
	jmp	short loc_1F30A
loc_1F2F1:
	mov	ax, 5
	cwd
	push	dx
	push	ax
	push	gs:batRewardHi
	push	gs:batRewardLo
	call	__32bitDivide
loc_1F30A:
	mov	[bp+var_10E], ax
	mov	[bp+var_10C], dx
loc_1F319:
	mov	ax, 34h	
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
	mov	ax, offset aTreasure
	push	ds
	push	ax
	call	setTitle
	add	sp, 4
	sub	ax, ax
	push	ax
	push	[bp+var_10C]
	push	[bp+var_10E]
	push	cs
	call	near ptr bat_giveGold
	add	sp, 4
	push	dx
	push	ax
	push	word ptr [bp+var_108+2]
	push	word ptr [bp+var_108]
	call	_itoa
	add	sp, 0Ah
	mov	word ptr [bp+var_108], ax
	mov	word ptr [bp+var_108+2], dx
	mov	ax, offset aInGold_
	push	ds
	push	ax
	push	dx
	push	word ptr [bp+var_108]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_108], ax
	mov	word ptr [bp+var_108+2], dx
	mov	[bp+var_112], 0
	jmp	short loc_1F384
loc_1F380:
	inc	[bp+var_112]
loc_1F384:
	cmp	[bp+var_112], 4
	jl	short loc_1F38E
	jmp	loc_1F547
loc_1F38E:
	mov	al, levelNoMaybe
	sub	ah, ah
	sub	ax, 9
	neg	ax
	push	ax
	sub	ax, ax
	push	ax
	call	randomBetweenXandY
	add	sp, 4
	or	ax, ax
	jz	short loc_1F3B0
	jmp	loc_1F544
loc_1F3B0:
	cmp	gs:word_41E6E, 0
	jnz	short loc_1F3C8
	delayNoTable	1
loc_1F3C8:
	call	_random
	sub	ah, ah
	mov	[bp+var_104], ax
	cmp	ax, 224
	jl	short loc_1F3E9
	cmp	ax, 240
	jge	short loc_1F3E9
	cmp	ax, 195
	jnz	short loc_1F3E7
	mov	ax, 1
	jmp	short loc_1F3E9
loc_1F3E7:
	sub	ax, ax
loc_1F3E9:
	mov	bl, levelNoMaybe
	sub	bh, bh
	mov	al, byteMaskList[bx]
	sub	ah, ah
	mov	bx, [bp+var_104]
	mov	cl, itemLevMask[bx]
	sub	ch, ch
	test	ax, cx
	jz	short loc_1F3C8
	mov	al, byte_464B8[bx]
	mov	[bp+var_10A], ax
	cmp	ax, 1
	jz	short loc_1F43A
	cmp	ax, 0FFh
	jz	short loc_1F43A
	push	ax
	mov	ax, 1
	push	ax
	call	randomBetweenXandY
	add	sp, 4
	mov	[bp+var_10A], ax
loc_1F43A:
	call	_random
	test	al, 7
	jnz	short loc_1F448
	mov	ax, 80h
	jmp	short loc_1F44A
loc_1F448:
	sub	ax, ax
loc_1F44A:
	mov	[bp+var_110], ax
	mov	ax, 7
	push	ax
	call	bat_getRandomChar
	add	sp, 2
	mov	[bp+var_102], ax
	mov	[bp+var_114], 0
	jmp	short loc_1F46A
loc_1F466:
	inc	[bp+var_114]
loc_1F46A:
	cmp	[bp+var_114], 7
	jl	short loc_1F474
	jmp	loc_1F544
loc_1F474:
	push	[bp+var_102]
	push	cs
	call	near ptr bat_canGetTreasure
	add	sp, 2
	or	ax, ax
	jnz	short loc_1F486
	jmp	loc_1F535
loc_1F486:
	push	[bp+var_10A]
	push	[bp+var_110]
	push	[bp+var_104]
	push	[bp+var_102]
	call	inven_addItem
	add	sp, 8
	or	ax, ax
	jnz	short loc_1F4A5
	jmp	loc_1F535
loc_1F4A5:
	getCharP	[bp+var_102], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	word ptr [bp+var_108+2]
	push	word ptr [bp+var_108]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_108], ax
	mov	word ptr [bp+var_108+2], dx
	mov	ax, offset aFoundA
	push	ds
	push	ax
	push	dx
	push	word ptr [bp+var_108]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_108], ax
	mov	word ptr [bp+var_108+2], dx
	push	[bp+var_110]
	push	[bp+var_104]
	push	dx
	push	ax
	call	item_getName
	add	sp, 8
	mov	word ptr [bp+var_108], ax
	mov	word ptr [bp+var_108+2], dx
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	lea	ax, [bp+var_100]
	mov	word ptr [bp+var_108], ax
	mov	word ptr [bp+var_108+2], ss
	lfs	bx, [bp+var_108]
	mov	byte ptr fs:[bx], 0
	delayNoTable	2
	jmp	short loc_1F544
	jmp	short loc_1F541
loc_1F535:
	dec	[bp+var_102]
	jns	short loc_1F541
	mov	[bp+var_102], 6
loc_1F541:
	jmp	loc_1F466
loc_1F544:
	jmp	loc_1F380
loc_1F547:
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	delayNoTable	8
	sub	ax, ax
	jmp	short $+2
loc_1F565:
	mov	sp, bp
	pop	bp
	retf
bat_getReward endp

; Attributes: bp-based frame
bat_canGetTreasure proc	far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	getCharP	[bp+arg_0], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jnz	short loc_1F58B
	sub	ax, ax
	jmp	short loc_1F5B9
loc_1F58B:
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.class[bx], class_monster
	jb	short loc_1F59F
	sub	ax, ax
	jmp	short loc_1F5B9
loc_1F59F:
	getCharP	[bp+arg_0], bx
	mov	al, gs:roster.status[bx]
	and	al, stat_dead or stat_stoned or	stat_paralyzed
	mov	cx, ax
	cmp	cl, 1
	sbb	ax, ax
	neg	ax
	jmp	short $+2
loc_1F5B9:
	mov	sp, bp
	pop	bp
	retf
bat_canGetTreasure endp

; Attributes: bp-based frame

chest_examine proc far

	var_106= word ptr -106h
	var_104= word ptr -104h
	var_102= word ptr -102h
	var_100= word ptr -100h

	push	bp
	mov	bp, sp
	mov	ax, 106h
	call	someStackOperation
	push	si
	mov	ax, offset aWhoWillExamineIt?
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_106], ax
	or	ax, ax
	jge	short loc_1F5E8
	sub	ax, ax
	jmp	loc_1F6EE
loc_1F5E8:
	getCharP	[bp+var_106], bx
	cmp	gs:roster.class[bx], class_monster
	jb	short loc_1F602
	sub	ax, ax
	jmp	loc_1F6EE
loc_1F602:
	mov	bx, [bp+var_106]
	mov	al, byteMaskList[bx]
	sub	ah, ah
	test	gs:word_42298, ax
	jz	short loc_1F62E
	mov	ax, offset aThatCharacterHasAlr
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	sub	ax, ax
	jmp	loc_1F6EE
loc_1F62E:
	mov	bx, [bp+var_106]
	mov	al, byteMaskList[bx]
	sub	ah, ah
	or	gs:word_42298, ax
	getCharP	bx, bx
	test	gs:roster.status[bx], 1Ch
	jz	short loc_1F65E
	sub	ax, ax
	jmp	loc_1F6EE
loc_1F65E:
	getCharP	[bp+var_106], si
	cmp	gs:roster.class[si], class_rogue
	jnz	short loc_1F67F
	call	_random
	cmp	gs:(roster.specAbil+1)[si], al
	jnb	short loc_1F690
loc_1F67F:
	mov	ax, offset aYouFoundNothing_
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	sub	ax, ax
	jmp	short loc_1F6EE
loc_1F690:
	mov	ax, offset aItLooksLikeA
	push	ds
	push	ax
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_104], ax
	mov	[bp+var_102], dx
	mov	bx, gs:word_41E6E
	mov	al, byte_47988[bx]
	cbw
	mov	bx, ax
	shl	bx, 1
	shl	bx, 1
	push	word ptr (trapName+2)[bx]
	push	word ptr trapName[bx]
	push	dx
	push	[bp+var_104]
	call	_strcat
	add	sp, 8
	mov	[bp+var_104], ax
	mov	[bp+var_102], dx
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printStringWClear
	add	sp, 4
	sub	ax, ax
	jmp	short $+2
loc_1F6EE:
	pop	si
	mov	sp, bp
	pop	bp
	retf
chest_examine endp

; Attributes: bp-based frame

chest_setOffTrap proc far

	var_108= word ptr -108h
	var_106= word ptr -106h
	var_104= word ptr -104h
	var_102= word ptr -102h
	var_100= word ptr -100h
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 108h
	call	someStackOperation
	push	si
	mov	ax, offset aYouSetOffA
	push	ds
	push	ax
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_106], ax
	mov	[bp+var_104], dx
	mov	bx, gs:word_41E6E
	mov	al, byte_47988[bx]
	cbw
	mov	bx, ax
	shl	bx, 1
	shl	bx, 1
	push	word ptr (trapName+2)[bx]
	push	word ptr trapName[bx]
	push	dx
	push	[bp+var_106]
	call	_strcat
	add	sp, 8
	mov	[bp+var_106], ax
	mov	[bp+var_104], dx
	mov	bx, gs:word_41E6E
	mov	al, trapDice[bx]
	sub	ah, ah
	push	ax
	call	dice_doYDX
	add	sp, 2
	mov	[bp+var_108], ax
	mov	si, gs:word_41E6E
	shl	si, 1
	mov	al, byte ptr stru_47938.lo[si]
	mov	gs:monGroups.breathSaveLo, al
	mov	al, stru_47938.hi[si]
	mov	gs:monGroups.breathSaveHi, al
	mov	bx, gs:word_41E6E
	test	trapFlags[bx], 80h
	jz	short loc_1F7A6
	push	[bp+var_108]
	push	[bp+arg_0]
	push	cs
	call	near ptr chest_doTrapAttack
	add	sp, 4
	jmp	short loc_1F7CA
loc_1F7A6:
	mov	[bp+var_102], 0
	jmp	short loc_1F7B2
loc_1F7AE:
	inc	[bp+var_102]
loc_1F7B2:
	cmp	[bp+var_102], 7
	jge	short loc_1F7CA
	push	[bp+var_108]
	push	[bp+var_102]
	push	cs
	call	near ptr chest_doTrapAttack
	add	sp, 4
	jmp	short loc_1F7AE
loc_1F7CA:
	mov	gs:word_41E6E, 0
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	byte ptr word_44166,	0
	wait4IO
	mov	ax, 1
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
chest_setOffTrap endp

; Attributes: bp-based frame
chest_doTrapAttack proc	far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	getCharP	[bp+arg_0], si
	cmp	byte ptr gs:roster._name[si], 0
	jz	short loc_1F88B
	test	gs:roster.status[si], stat_dead
	jnz	short loc_1F88B
	mov	al, byte ptr [bp+arg_0]
	mov	gs:bat_curTarget, al
	mov	bx, gs:word_41E6E
	mov	al, trapFlags[bx]
	sub	ah, ah
	and	ax, 7Fh
	mov	gs:specialAttackVal, ax
	mov	ax, [bp+arg_2]
	mov	gs:damageAmount, ax
	sub	ax, ax
	push	ax
	mov	ax, 80h
	push	ax
	call	savingThrowCheck
	add	sp, 4
	mov	[bp+var_2], ax
	or	ax, ax
	jz	short loc_1F88B
	mov	ax, 1
	mov	[bp+var_2], ax
	sar	gs:damageAmount, 1
	push	[bp+arg_0]
	call	bat_doHPDamage
	add	sp, 2
loc_1F88B:
	pop	si
	mov	sp, bp
	pop	bp
	retf
chest_doTrapAttack endp

; Attributes: bp-based frame
chest_open proc	far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, offset aWhoWillOpenIt?
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_2], ax
	or	ax, ax
	jge	short loc_1F8B8
	sub	ax, ax
	jmp	short loc_1F920
loc_1F8B8:
	getCharP	[bp+var_2], bx
	test	gs:roster.status[bx], 7Ch
	jz	short loc_1F8D0
	sub	ax, ax
	jmp	short loc_1F920
loc_1F8D0:
	getCharP	[bp+var_2], bx
	cmp	gs:roster.class[bx], class_monster
	jb	short loc_1F8E4
	sub	ax, ax
	jmp	short loc_1F920
loc_1F8E4:
	call	_random
	test	al, 80h
	jz	short loc_1F8F9
	push	[bp+var_2]
	push	cs
	call	near ptr chest_setOffTrap
	add	sp, 2
	jmp	short loc_1F90F
loc_1F8F9:
	mov	gs:word_41E6E, 0
	mov	gs:word_42560, 1
loc_1F90F:
	delayNoTable	5
	mov	ax, 1
	jmp	short $+2
loc_1F920:
	mov	sp, bp
	pop	bp
	retf
chest_open endp

; Attributes: bp-based frame

chest_disarm proc far

	var_2A=	word ptr -2Ah
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2Ah	
	call	someStackOperation
	push	si
	mov	ax, offset aWhoWillDisarmIt?
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_2], ax
	or	ax, ax
	jge	short loc_1F94E
	sub	ax, ax
	jmp	loc_1FA16
loc_1F94E:
	getCharP	[bp+var_2], bx
	test	gs:roster.status[bx], 1Ch
	jz	short loc_1F967
	sub	ax, ax
	jmp	loc_1FA16
loc_1F967:
	mov	ax, offset aEnterTrapName
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	ax, 28h	
	push	ax
	lea	ax, [bp+var_2A]
	push	ss
	push	ax
	call	_readString
	add	sp, 6
	mov	bx, gs:word_41E6E
	mov	al, byte_47988[bx]
	cbw
	mov	bx, ax
	shl	bx, 1
	shl	bx, 1
	push	word ptr (trapName+2)[bx]
	push	word ptr trapName[bx]
	lea	ax, [bp+var_2A]
	push	ss
	push	ax
	push	cs
	call	near ptr chest_trapStrcmp
	add	sp, 8
	or	ax, ax
	jz	short loc_1FA07
	getCharP	[bp+var_2], si
	cmp	gs:roster.class[si], class_rogue
	jnz	short loc_1F9F4
	call	_random
	cmp	gs:roster.specAbil[si],	al
	jb	short loc_1F9F4
	mov	ax, offset aYouDisarmedIt
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	gs:word_41E6E, 0
	mov	ax, 1
	jmp	short loc_1FA16
	jmp	short loc_1FA05
loc_1F9F4:
	mov	ax, offset aDisarmFailed
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	sub	ax, ax
	jmp	short loc_1FA16
loc_1FA05:
	jmp	short loc_1FA11
loc_1FA07:
	push	[bp+var_2]
	push	cs
	call	near ptr chest_setOffTrap
	add	sp, 2
loc_1FA11:
	mov	ax, 1
	jmp	short $+2
loc_1FA16:
	pop	si
	mov	sp, bp
	pop	bp
	retf
chest_disarm endp

; Attributes: bp-based frame

chest_trapZap proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	ax, offset aWhoWillCastATrzp?
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_2], ax
	or	ax, ax
	jge	short loc_1FA44
	sub	ax, ax
	jmp	loc_1FB00
loc_1FA44:
	getCharP	[bp+var_2], bx
	test	gs:roster.status[bx], 7Ch
	jz	short loc_1FA5D
	sub	ax, ax
	jmp	loc_1FB00
loc_1FA5D:
	getCharP	[bp+var_2], bx
	cmp	gs:roster.class[bx], class_monster
	jb	short loc_1FA72
	sub	ax, ax
	jmp	loc_1FB00
loc_1FA72:
	mov	ax, 2
	push	ax
	push	[bp+var_2]
	call	mage_hasLearnedSpell
	add	sp, 4
	or	ax, ax
	jz	short loc_1FAEF
	getCharP	[bp+var_2], bx
	cmp	gs:roster.currentSppt[bx], 2
	jnb	short loc_1FAAA
	mov	ax, offset aYouNeedAtLeast2SpellP
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	sub	ax, ax
	jmp	short loc_1FB00
loc_1FAAA:
	getCharP	[bp+var_2], bx
	sub	gs:roster.currentSppt[bx], 2
	mov	gs:word_41E6E, 0
	mov	byte ptr word_44166,	0
	mov	ax, offset aYouDisarmedIt
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
	mov	ax, 1
	jmp	short loc_1FB00
loc_1FAEF:
	mov	ax, offset aYouDonTKnowThatSpell_
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	sub	ax, ax
	jmp	short $+2
loc_1FB00:
	mov	sp, bp
	pop	bp
	retf
chest_trapZap endp

; Attributes: bp-based frame

chest_returnOne	proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 1
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
chest_returnOne	endp

; Attributes: bp-based frame

chest_trapStrcmp proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6
	arg_4= dword ptr  0Ah

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	[bp+var_2], 0
	jmp	short loc_1FB2D
loc_1FB2A:
	inc	[bp+var_2]
loc_1FB2D:
	cmp	[bp+var_2], 28h	
	jge	short loc_1FB80
	mov	bx, [bp+var_2]
	lfs	si, [bp+arg_4]
	mov	al, fs:[bx+si]
	cbw
	lfs	si, [bp+arg_0]
	mov	cx, ax
	mov	al, fs:[bx+si]
	cbw
	or	ax, cx
	jnz	short loc_1FB4F
	mov	ax, 1
	jmp	short loc_1FB85
loc_1FB4F:
	lfs	si, [bp+arg_4]
	mov	al, fs:[bx+si]
	cbw
	push	ax
	call	_str_capitalize
	add	sp, 2
	mov	bx, [bp+var_2]
	lfs	si, [bp+arg_0]
	mov	cx, ax
	mov	al, fs:[bx+si]
	cbw
	push	ax
	mov	si, cx
	call	_str_capitalize
	add	sp, 2
	cmp	ax, si
	jz	short loc_1FB7E
	sub	ax, ax
	jmp	short loc_1FB85
loc_1FB7E:
	jmp	short loc_1FB2A
loc_1FB80:
	mov	ax, 1
	jmp	short $+2
loc_1FB85:
	pop	si
	mov	sp, bp
	pop	bp
	retf
chest_trapStrcmp endp

; Attributes: bp-based frame

bat_doChest proc far

	var_30=	word ptr -30h
	var_1C=	word ptr -1Ch
	var_1A=	word ptr -1Ah
	var_18=	word ptr -18h
	var_16=	word ptr -16h
	var_C= word ptr	-0Ch
	var_A= word ptr	-0Ah

	push	bp
	mov	bp, sp
	mov	ax, 30h	
	call	someStackOperation
	push	si
	mov	ax, 35h	
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
	mov	ax, offset aChest
	push	ds
	push	ax
	call	setTitle
	add	sp, 4
	call	_random
	mov	cl, levelNoMaybe
	sub	ch, ch
	shl	cx, 1
	shl	cx, 1
	add	cx, ax
	and	cx, 3
	mov	gs:word_41E6E, cx
	mov	gs:word_42298, 0
	mov	[bp+var_1A], 0
	jmp	short loc_1FBE6
loc_1FBE3:
	inc	[bp+var_1A]
loc_1FBE6:
	cmp	[bp+var_1A], 0Ah
	jge	short loc_1FBF5
	mov	si, [bp+var_1A]
	mov	byte ptr [bp+si+var_A],	1
	jmp	short loc_1FBE3
loc_1FBF5:
	call	clearTextWindow
	lea	ax, [bp+var_30]
	push	ss
	push	ax
	lea	ax, [bp+var_16]
	push	ss
	push	ax
	lea	ax, [bp+var_A]
	push	ss
	push	ax
	mov	ax, offset aThereIsAChestHere_Wil
	push	ds
	push	ax
	call	printVarString
	add	sp, 10h
	mov	[bp+var_18], ax
loc_1FC19:
	mov	[bp+var_1C], 1
	push	[bp+var_18]
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_C], ax
	mov	[bp+var_1A], 0
loc_1FC31:
	mov	si, [bp+var_1A]
	cmp	byte ptr [bp+si+var_16], 0
	jz	short loc_1FC7B
	mov	al, byte ptr [bp+si+var_16]
	cbw
	cmp	ax, [bp+var_C]
	jz	short loc_1FC4D
	shl	si, 1
	mov	ax, [bp+var_C]
	cmp	[bp+si+var_30],	ax
	jnz	short loc_1FC76
loc_1FC4D:
	mov	bx, [bp+var_1A]
	shl	bx, 1
	shl	bx, 1
	call	off_47A00[bx]
	or	ax, ax
	jz	short loc_1FC65
	call	clearTextWindow
	jmp	short loc_1FC84
	jmp	short loc_1FC6A
loc_1FC65:
	mov	[bp+var_1C], 0
loc_1FC6A:
	delayNoTable	2
loc_1FC76:
	inc	[bp+var_1A]
	jmp	short loc_1FC31
loc_1FC7B:
	cmp	[bp+var_1C], 0
	jnz	short loc_1FC19
	jmp	loc_1FBF5
loc_1FC84:
	pop	si
	mov	sp, bp
	pop	bp
locret_1FC88:
	retf
bat_doChest endp
align 2

seg009 ends

; Segment type:	Pure code
seg010 segment word public 'CODE' use16
	assume cs:seg010
;org 9
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
algn_1FC89:
align 2
; Attributes: bp-based frame

castSpell proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	cmp	[bp+arg_0], 0
	jz	short loc_1FCAA
	mov	ax, [bp+arg_0]
	sub	ax, 3B00h
	mov	cl, 8
	sar	ax, cl
	mov	[bp+var_6], ax
	jmp	short loc_1FCBF
loc_1FCAA:
	mov	ax, offset aWhoWillCastASp
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_6], ax
loc_1FCBF:
	cmp	[bp+var_6], 0
	jge	short loc_1FCC8
	jmp	loc_1FD85
loc_1FCC8:
	getCharP	[bp+var_6], bx
	test	gs:roster.status[bx], stat_dead	or stat_stoned or stat_paralyzed
	jz	short loc_1FCE1
	sub	ax, ax
	jmp	loc_1FD8A
loc_1FCE1:
	getCharP	[bp+var_6], bx
	mov	bl, gs:roster.class[bx]
	sub	bh, bh
	cmp	mageSpellIndex[bx], 0FFh
	jnz	short loc_1FD14
	mov	ax, offset aThouArtNotAS_0
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
	sub	ax, ax
	jmp	short loc_1FD8A
loc_1FD14:
	sub	ax, ax
	push	ax
	push	[bp+var_6]
	push	cs
	call	near ptr anotherCastSpell
	add	sp, 4
	mov	[bp+var_4], ax
	or	ax, ax
	jge	short loc_1FD2C
	sub	ax, ax
	jmp	short loc_1FD8A
loc_1FD2C:
	cmp	[bp+var_4], 4
	jge	short loc_1FD5A
	mov	ax, offset aCastAt
	push	ds
	push	ax
	push	[bp+var_4]
	call	getTarget
	add	sp, 6
	mov	[bp+var_2], ax
	or	ax, ax
	jge	short loc_1FD4F
	sub	ax, ax
	jmp	short loc_1FD8A
loc_1FD4F:
	mov	al, byte ptr [bp+var_2]
	mov	gs:bat_curTarget, al
loc_1FD5A:
	call	clearTextWindow
	mov	ax, 1
	push	ax
	sub	ax, ax
	push	ax
	push	curSpellNo
	push	[bp+var_6]
	push	cs
	call	near ptr doCastSpell
	add	sp, 8
	delayNoTable	2
loc_1FD85:
	mov	ax, 1
	jmp	short $+2
loc_1FD8A:
	mov	sp, bp
	pop	bp
	retf
castSpell endp

; Attributes: bp-based frame

anotherCastSpell proc far

	var_306= word ptr -306h
	var_304= word ptr -304h
	var_106= word ptr -106h
	var_104= word ptr -104h
	var_102= word ptr -102h
	var_100= word ptr -100h
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 306h
	call	someStackOperation
	push	si
	getCharP	[bp+arg_0], bx
	test	gs:roster.status[bx], stat_dead	or stat_stoned or stat_paralyzed
	jz	short loc_1FDB4
	mov	ax, 0FFFFh
	jmp	loc_1FECF
loc_1FDB4:
	mov	al, spell_mouseClicked
	sub	ah, ah
	or	ax, ax
	jnz	loc_mouse_spell_select

	push	[bp+arg_0]
	call	txt_castSpell
	add	sp, 2
	cmp	ax, 0FFFFh
	je	loc_1FECF
	jmp	loc_anotherCastSpell_spellFound

loc_mouse_spell_select:
	mov	[bp+var_106], 0
	mov	[bp+var_104], 0
	jmp	short loc_1FDC6
loc_1FDC2:
	inc	[bp+var_104]
loc_1FDC6:
	cmp	[bp+var_104], 7Eh
	jge	short loc_1FE1A
	push	[bp+var_104]
	push	[bp+arg_0]
	call	mage_hasLearnedSpell
	add	sp, 4
	or	ax, ax
	jz	short loc_1FE18
	mov	si, [bp+var_106]
	shl	si, 1
	mov	ax, [bp+var_104]
	mov	[bp+si+var_100], ax
	mov	bx, [bp+var_104]
	mov	cl, 3
	shl	bx, cl
	mov	ax, word ptr spellString.fullName[bx]
	mov	dx, word ptr (spellString.fullName+2)[bx]
	mov	si, [bp+var_106]
	inc	[bp+var_106]
	shl	si, 1
	shl	si, 1
	mov	[bp+si+var_306], ax
	mov	[bp+si+var_304], dx
loc_1FE18:
	jmp	short loc_1FDC2
loc_1FE1A:
	cmp	[bp+var_106], 0
	jz	short loc_1FE3E
	push	[bp+var_106]
	lea	ax, [bp+var_306]
	push	ss
	push	ax
	mov	ax, offset aSpellToCast
	push	ds
	push	ax
	call	printStringGetInput
	add	sp, 0Ah
	mov	[bp+var_102], ax
	jmp	short loc_1FE5F
loc_1FE3E:
	mov	ax, offset aYouDonTKnowAny
	mov	dx, seg	dseg
	push	dx
	push	ax
	call	printString
	add	sp, 4
	wait4IO
	mov	ax, 0FFFFh
	jmp	short loc_1FECF
loc_1FE5F:
	cmp	[bp+var_102], 0
	jge	short loc_1FE6B
	mov	ax, 0FFFFh
	jmp	short loc_1FECF
loc_1FE6B:
	mov	si, [bp+var_102]
	shl	si, 1
	mov	ax, [bp+si+var_100]

loc_anotherCastSpell_spellFound:
	mov	curSpellNo, ax
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr getSpptRequired
	add	sp, 4
	mov	cx, ax
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.currentSppt[bx], cx
	jnb	short loc_1FEBB
	mov	ax, offset aNotEnoughSpellPoint
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
	mov	ax, 0FFFFh
	jmp	short loc_1FECF
loc_1FEBB:
	mov	bx, curSpellNo
	mov	al, byte_47F94[bx]
	sub	ah, ah
	and	ax, 7
	jmp	short $+2
loc_1FECF:
	pop	si
	mov	sp, bp
	pop	bp
	retf
anotherCastSpell endp

; This function	gets the spell points required for
; a particular spell. It takes into account equipment
; that the player has equipped.
; If the player	has 0xc	effect equipped, the required
; spell	points are divided by 4.
; If the player	has 0x4	effect equipped, the required
; spell	points are halved.
; Attributes: bp-based frame

getSpptRequired	proc far

	var_2= word ptr	-2
	playerNo= word ptr  6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	bx, [bp+arg_2]
	mov	al, spptRequired[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	ax, itemEff_quaterSpptUse
	push	ax
	push	[bp+playerNo]
	call	hasEffectEquipped
	add	sp, 4
	or	ax, ax
	jnz	short loc_1FF07
	mov	ax, [bp+var_2]
	sar	ax, 1
	sar	ax, 1
	jmp	short loc_1FF26
loc_1FF07:
	mov	ax, itemEff_halfSpptUsage
	push	ax
	push	[bp+playerNo]
	call	hasEffectEquipped
	add	sp, 4
	or	ax, ax
	jnz	short loc_1FF21
	mov	ax, [bp+var_2]
	sar	ax, 1
	jmp	short loc_1FF26
loc_1FF21:
	mov	ax, [bp+var_2]
	jmp	short $+2
loc_1FF26:
	mov	sp, bp
	pop	bp
	retf
getSpptRequired	endp

; Attributes: bp-based frame

doCastSpell proc far

	var_108= word ptr -108h
	var_8= dword ptr -8
	charNo=	word ptr  6
	spellNo= word ptr  8
	arg_4= word ptr	 0Ah
	arg_6= word ptr	 0Ch

	push	bp
	mov	bp, sp
	mov	ax, 108h
	call	someStackOperation
	push	[bp+charNo]
	lea	ax, [bp+var_108]
	push	ss
	push	ax
	call	bat_getAttackerName
	add	sp, 6
	mov	word ptr [bp+var_8], ax
	mov	word ptr [bp+var_8+2], dx
	lfs	bx, [bp+var_8]
	inc	word ptr [bp+var_8]
	mov	byte ptr fs:[bx], ' '
	cmp	[bp+spellNo], 7Eh 
	jge	short loc_1FFA8
	mov	ax, offset aCastsASpell
	push	ds
	push	ax
	push	word ptr [bp+var_8+2]
	push	word ptr [bp+var_8]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_8], ax
	mov	word ptr [bp+var_8+2], dx
	lfs	bx, [bp+var_8]
	inc	word ptr [bp+var_8]
	mov	byte ptr fs:[bx], 20h ;	' '
	mov	bx, [bp+spellNo]
	mov	cl, 3
	shl	bx, cl
	push	word ptr (spellString.fullName+2)[bx]
	push	word ptr spellString.fullName[bx]
	push	word ptr [bp+var_8+2]
	push	word ptr [bp+var_8]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_8], ax
	mov	word ptr [bp+var_8+2], dx
loc_1FFA8:
	cmp	[bp+arg_6], 0
	jz	short loc_20000
	push	[bp+spellNo]
	push	[bp+charNo]
	push	cs
	call	near ptr _sp_checkSPPT
	add	sp, 4
	or	ax, ax
	jz	short loc_doCastSpell_fizzled
	mov	al, gs:sq_antiMagicFlag
	sub	ah, ah
	or	ax, ax
	jz	short loc_20000

loc_doCastSpell_fizzled:
;	mov	ax, offset aButItFizzled
;	push	ds
;	push	ax
;	push	word ptr [bp+var_8+2]
;	push	word ptr [bp+var_8]
;	call	_strcat
;	add	sp, 8
;	mov	word ptr [bp+var_8], ax
;	mov	word ptr [bp+var_8+2], dx
	lfs	bx, [bp+var_8]
	inc	word ptr [bp+var_8]
	mov	byte ptr fs:[bx], 0
	lea	ax, [bp+var_108]
	push	ss
	push	ax
	call	printString
	add	sp, 4

	call	printSpellFizzled

	sub	ax, ax
	jmp	short loc_20023
loc_20000:
	lea	ax, [bp+var_108]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	push	[bp+arg_4]
	push	[bp+spellNo]
	push	[bp+charNo]
	push	cs
	call	near ptr spell_cast
	add	sp, 6
	mov	ax, 1
	jmp	short $+2
loc_20023:
	mov	sp, bp
	pop	bp
	retf
doCastSpell endp

; Attributes: bp-based frame

sp_lightSpell proc far

	var_2= word ptr	-2
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	bx, ax
	mov	al, lightDistList[bx]
	mov	lightDistance, al
	mov	al, lightDurList[bx]
	mov	lightDuration, al
	sub	ax, ax
	push	ax
	call	icon_activate
	add	sp, 2
	mov	bx, [bp+var_2]
	mov	al, byte_484B2[bx]
	mov	gs:byte_41E61, al
	mov	ax, offset aElipsisNLNL
	push	ds
	push	ax
	call	printString
	add	sp, 4
	delayNoTable	2
	mov	sp, bp
	pop	bp
	retf
sp_lightSpell endp

; Attributes: bp-based frame

sp_possessChar proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	al, gs:bat_curTarget
	sub	ah, ah
	mov	[bp+var_2], ax
	getCharP	[bp+var_2], si
	test	gs:roster.status[si], stat_dead
	jz	short loc_200CF
	and	gs:roster.status[si], stat_poisoned or stat_old	or stat_stoned or stat_paralyzed or stat_possessed or stat_nuts	or stat_unknown
	or	gs:roster.status[si], stat_possessed
	mov	gs:roster.currentHP[si], 100
loc_200CF:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sp_possessChar endp

; Attributes: bp-based frame

sp_damageSpell proc far

	attP= word ptr -10h
	var_E= word ptr	-0Eh
	var_C= word ptr	-0Ch
	counter= word ptr -0Ah
	attStru= byte ptr -8
	charNo=	word ptr  6
	spellNo= word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 10h
	call	someStackOperation
	push	di
	push	si
	mov	bx, [bp+spellNo]
	mov	al, spellEffectFlags[bx]
	sub	ah, ah
	mov	[bp+var_C], ax
	lea	ax, [bp+attStru]
	mov	[bp+attP], ax
	mov	[bp+var_E], ss
	mov	[bp+counter], 0
	jmp	short loc_20100
loc_200FD:
	inc	[bp+counter]
loc_20100:
	cmp	[bp+counter], 7
	jge	short loc_20118
	mov	si, [bp+var_C]
	mov	bx, [bp+counter]
	mov	al, byte ptr damageSpellData.effectStrIndex[bx+si]
	lfs	si, dword ptr [bp+attP]
	mov	fs:[bx+si], al
	jmp	short loc_200FD
loc_20118:
	mov	bx, [bp+spellNo]
	mov	al, byte_480A4[bx]
	sub	ah, ah
	push	ax
	sub	sp, 8
	lea	si, [bp+attStru]
	mov	di, sp
	push	ss
	pop	es
	movsw
	movsw
	movsw
	movsb
	push	[bp+charNo]
	push	cs
	call	near ptr bat_doBreathAttack
	add	sp, 0Ch
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
sp_damageSpell endp

; Attributes: bp-based frame
bat_doBreathAttack proc	far

	var_11A= word ptr -11Ah
	var_118= word ptr -118h
	var_116= dword ptr -116h
	counter= word ptr -112h
	var_110= word ptr -110h
	target=	word ptr -10Eh
	var_10C= word ptr -10Ch
	var_10A= word ptr -10Ah
	var_108= word ptr -108h
	var_106= word ptr -106h
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	charNo=	word ptr  6
	arg_2= byte ptr	 8
	arg_3= byte ptr	 9
	arg_4= byte ptr	 0Ah
	arg_5= byte ptr	 0Bh
	arg_6= byte ptr	 0Ch
	arg_7= byte ptr	 0Dh
	arg_8= byte ptr	 0Eh
	arg_A= word ptr	 10h

	push	bp
	mov	bp, sp
	mov	ax, 11Ah
	call	someStackOperation
	cmp	[bp+arg_8], 0
	jnz	short loc_20179
	cmp	[bp+charNo], 80h 
	jl	short loc_2015E
	mov	[bp+arg_8], 1
	jmp	short loc_20179
loc_2015E:
	getCharP	[bp+charNo], bx
	push	gs:roster.level[bx]
	push	cs
	call	near ptr _returnXor255
	add	sp, 2
	mov	[bp+arg_8], al
loc_20179:
	mov	[bp+var_10A], 0
	test	[bp+arg_7], breath_allFoes
	jz	short loc_2019C
	cmp	[bp+charNo], 80h 
	jge	short loc_20198
	mov	gs:bat_curTarget, 80h
	jmp	short loc_2019C
loc_20198:
	and	[bp+arg_7], 7Fh
loc_2019C:
	mov	al, gs:bat_curTarget
	sub	ah, ah
	or	ax, [bp+charNo]
	cmp	ax, 80h
	jnb	short loc_201B9
	test	[bp+arg_7], breath_oneGroup
	jz	short loc_201B9
	mov	ax, [bp+charNo]
	jmp	short loc_201BC
loc_201B9:
	mov	ax, 0FFh
loc_201BC:
	mov	[bp+var_11A], ax
	mov	[bp+var_110], 0
loc_201C6:
	cmp	gs:bat_curTarget, 80h
	jb	short loc_201D5
	jmp	loc_20266
loc_201D5:
	test	[bp+arg_7], breath_oneGroup
	jz	short loc_201E0
	mov	ax, 6
	jmp	short loc_201E6
loc_201E0:
	mov	al, gs:bat_curTarget
	sub	ah, ah
loc_201E6:
	mov	[bp+target], ax
	mov	ax, offset aAtTheParty___
	push	ds
	push	ax
	lea	ax, [bp+var_106]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	inc	[bp+var_10A]
	push	[bp+arg_A]
	push	[bp+charNo]
	push	cs
	call	near ptr bat_isPartyInRange
	add	sp, 4
	or	ax, ax
	jnz	short loc_20263
	mov	ax, offset aButThePartyWas
	push	ds
	push	ax
	push	word ptr [bp+var_116+2]
	push	word ptr [bp+var_116]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	lea	ax, [bp+var_106]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	byte ptr word_44166,	0
	delayWithTable
	mov	ax, [bp+var_10A]
	dec	ax
	jmp	bat_doBreathAttack_exit
loc_20263:
	jmp	loc_20324
loc_20266:
	mov	al, gs:bat_curTarget
	sub	ah, ah
	and	ax, 3
	mov	cx, monStruSize
	mul	cx
	mov	bx, ax
	test	gs:monGroups.groupSize[bx], 1Fh
	jnz	short loc_20289
	jmp	loc_20311
loc_20289:
	test	[bp+arg_7], breath_oneGroup
	jz	short loc_202B1
	mov	al, gs:bat_curTarget
	sub	ah, ah
	and	ax, 3
	mul	cx
	mov	bx, ax
	mov	al, gs:monGroups.groupSize[bx]
	sub	ah, ah
	and	ax, 1Fh
	dec	ax
	jmp	short loc_202B3
loc_202B1:
	sub	ax, ax
loc_202B3:
	mov	[bp+target], ax
	mov	ax, offset aAt
	push	ds
	push	ax
	lea	ax, [bp+var_106]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	push	[bp+target]
	mov	al, gs:bat_curTarget
	sub	ah, ah
	push	ax
	push	dx
	push	word ptr [bp+var_116]
	push	cs
	call	near ptr bat_getTargetName
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	mov	ax, offset aElipsisNLNL
	push	ds
	push	ax
	push	dx
	push	word ptr [bp+var_116]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	jmp	short loc_20324
loc_20311:
	mov	[bp+target], 0FFFFh
	cmp	[bp+arg_7], breath_allFoes
	jnb	short loc_20324
	mov	ax, [bp+var_10A]
	jmp	bat_doBreathAttack_exit
loc_20324:
	cmp	[bp+target], 0
	jge	short loc_2032E
	jmp	loc_2086F
loc_2032E:
	mov	gs:damageAmount, 0
	mov	[bp+counter], 0
	jmp	short loc_20345
loc_20341:
	inc	[bp+counter]
loc_20345:
	mov	al, [bp+arg_8]
	sub	ah, ah
	cmp	ax, [bp+counter]
	jbe	short loc_20379
	mov	al, [bp+arg_6]
	push	ax
	call	dice_doYDX
	add	sp, 2
	add	gs:damageAmount, ax
	cmp	gs:damageAmount, 20000
	jle	short loc_20377
	mov	gs:damageAmount, 20000
	jmp	short loc_20379
loc_20377:
	jmp	short loc_20341
loc_20379:
	cmp	gs:bat_curTarget, 80h
	jb	short loc_203AA
	mov	ax, offset aOne
	push	ds
	push	ax
	push	word ptr [bp+var_116+2]
	push	word ptr [bp+var_116]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	mov	[bp+var_2], 1
	jmp	loc_2047F
loc_203AA:
	mov	ax, [bp+target]
	cmp	[bp+var_11A], ax
	jnz	short loc_203B7
	jmp	loc_2047A
loc_203B7:
	mov	bx, ax
	cmp	gs:byte_42280[bx], 0
	jz	short loc_203C8
	jmp	loc_2047A
loc_203C8:
	mov	al, [bp+arg_2]
	sub	ah, ah
	push	ax
	push	bx
	push	cs
	call	near ptr sub_208AA
	add	sp, 4
	or	ax, ax
	jnz	short loc_203DD
	jmp	loc_2047A
loc_203DD:
	getCharP	[bp+target], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	word ptr [bp+var_116+2]
	push	word ptr [bp+var_116]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	lfs	bx, [bp+var_116]
	inc	word ptr [bp+var_116]
	mov	byte ptr fs:[bx], ' '
	mov	ax, itemEff_breathDefense
	push	ax
	push	[bp+target]
	call	hasEffectEquipped
	add	sp, 4
	or	ax, ax
	jl	short loc_20467
	test	[bp+arg_7], breath_isBreath
	jz	short loc_20467
	mov	ax, offset aRepelledTheAtt
	push	ds
	push	ax
	push	word ptr [bp+var_116+2]
	push	word ptr [bp+var_116]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	mov	byte ptr word_44166,	0
	mov	[bp+var_2], 0
	jmp	short loc_20478
loc_20467:
	mov	al, byte ptr [bp+target]
	mov	gs:bat_curTarget, al
	mov	[bp+var_2], 1
loc_20478:
	jmp	short loc_2047F
loc_2047A:
	mov	[bp+var_2], 0
loc_2047F:
	cmp	[bp+var_2], 0
	jnz	short loc_20488
	jmp	loc_2050C
loc_20488:
	cmp	[bp+arg_5], 0
	jz	short loc_2050C
	cmp	gs:bat_curTarget, 80h
	jnb	short loc_204B0
	mov	al, charSize
	mul	gs:bat_curTarget
	mov	bx, ax
	mov	al, gs:roster.repelFlags[bx]
	sub	ah, ah
	jmp	short loc_204CF
loc_204B0:
	mov	al, gs:bat_curTarget
	sub	ah, ah
	and	ax, 7Fh
	mov	cx, monStruSize
	mul	cx
	mov	bx, ax
	mov	al, gs:monGroups.repelFlags[bx]
	sub	ah, ah
loc_204CF:
	mov	[bp+var_10C], ax
	mov	al, [bp+arg_5]
	sub	ah, ah
	test	[bp+var_10C], ax
	jnz	short loc_2050C
	mov	ax, offset aRepelledTheAtt
	push	ds
	push	ax
	push	word ptr [bp+var_116+2]
	push	word ptr [bp+var_116]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	mov	[bp+var_2], 0
loc_2050C:
	cmp	[bp+var_2], 0
	jnz	short loc_20515
	jmp	loc_20810
loc_20515:
	push	[bp+arg_A]
	push	[bp+charNo]
	push	cs
	call	near ptr bat_isPartyInRange
	add	sp, 4
	mov	[bp+var_4], ax
	or	ax, ax
	jnz	short loc_2052C
	jmp	loc_207F3
loc_2052C:
	cmp	ax, 2
	jnz	short loc_2053B
	mov	gs:byte_41E63, 4
loc_2053B:
	mov	al, [bp+arg_7]
	sub	ah, ah
	and	ax, 2
	push	ax
	push	[bp+charNo]
	push	cs
	call	near ptr savingThrowCheck
	add	sp, 4
	mov	[bp+var_118], ax
	or	ax, ax
	jnz	short loc_20559
	jmp	loc_207D4
loc_20559:
	cmp	ax, 1
	jnz	short loc_20567
	sar	gs:damageAmount, 1
loc_20567:
	test	[bp+arg_7], 3
	jz	short loc_2058E
	cmp	gs:bat_curTarget, 80h
	jnb	short loc_2058E
	cmp	gs:songHalfDamage, 0
	jz	short loc_2058E
	sar	gs:damageAmount, 1
loc_2058E:
	cmp	gs:bat_curTarget, 80h
	jnb	short loc_205B0
	mov	al, charSize
	mul	gs:bat_curTarget
	mov	bx, ax
	mov	al, gs:roster.strongElement[bx]
	sub	ah, ah
	jmp	short loc_205CF
loc_205B0:
	mov	al, gs:bat_curTarget
	sub	ah, ah
	and	ax, 3
	mov	cx, monStruSize
	mul	cx
	mov	bx, ax
	mov	al, gs:monGroups.strongElement[bx]
	sub	ah, ah
loc_205CF:
	mov	[bp+var_108], ax
	mov	al, [bp+arg_3]
	sub	ah, ah
	and	[bp+var_108], ax
	mov	[bp+counter], 0
	jmp	short loc_205E8
loc_205E4:
	inc	[bp+counter]
loc_205E8:
	cmp	[bp+counter], 7
	jge	short loc_2060F
	mov	bx, [bp+counter]
	mov	al, byteMaskList[bx]
	sub	ah, ah
	test	[bp+var_108], ax
	jz	short loc_2060D
	sar	gs:damageAmount, 1
loc_2060D:
	jmp	short loc_205E4
loc_2060F:
	cmp	gs:bat_curTarget, 80h
	jnb	short loc_20631
	mov	al, charSize
	mul	gs:bat_curTarget
	mov	bx, ax
	mov	al, gs:roster.weakElement[bx]
	sub	ah, ah
	jmp	short loc_20650
loc_20631:
	mov	al, gs:bat_curTarget
	sub	ah, ah
	and	ax, 3
	mov	cx, monStruSize
	mul	cx
	mov	bx, ax
	mov	al, gs:monGroups.weakElement[bx]
	sub	ah, ah
loc_20650:
	mov	[bp+var_6], ax
	mov	al, [bp+arg_3]
	sub	ah, ah
	and	[bp+var_6], ax
	mov	[bp+counter], 0
	jmp	short loc_20667
loc_20663:
	inc	[bp+counter]
loc_20667:
	cmp	[bp+counter], 7
	jge	short loc_2068D
	mov	bx, [bp+counter]
	mov	al, byteMaskList[bx]
	sub	ah, ah
	test	[bp+var_6], ax
	jz	short loc_2068B
	shl	gs:damageAmount, 1
loc_2068B:
	jmp	short loc_20663
loc_2068D:
	mov	ax, gs:damageAmount
	mov	cl, [bp+arg_2]
	sub	ch, ch
	or	ax, cx
	jnz	short loc_206A1
	jmp	loc_207B5
loc_206A1:
	mov	ax, offset aIs
	push	ds
	push	ax
	push	word ptr [bp+var_116+2]
	push	word ptr [bp+var_116]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	mov	bl, [bp+arg_4]
	sub	bh, bh
	and	bl, 0FEh
	shl	bx, 1
	push	word ptr (breathEffectStr+2)[bx]
	push	word ptr breathEffectStr[bx]
	push	dx
	push	ax
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	mov	ax, offset aFor
	push	ds
	push	ax
	push	dx
	push	word ptr [bp+var_116]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	mov	ax, 4
	push	ax
	mov	ax, gs:damageAmount
	cwd
	push	dx
	push	ax
	push	word ptr [bp+var_116+2]
	push	word ptr [bp+var_116]
	call	_itoa
	add	sp, 0Ah
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	mov	ax, gs:damageAmount
	dec	ax
	push	ax
	push	dx
	push	word ptr [bp+var_116]
	mov	ax, offset aPointSOfDamage
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	mov	al, [bp+arg_2]
	sub	ah, ah
	mov	gs:specialAttackVal, ax
	mov	al, gs:bat_curTarget
	push	ax
	call	bat_doHPDamage
	add	sp, 2
	or	ax, ax
	jz	short loc_207A7
	push	word ptr [bp+var_116+2]
	push	word ptr [bp+var_116]
	call	bat_getKillString
	add	sp, 4
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	mov	ax, 1
	push	ax
	mov	ax, 3
	push	ax
	mov	al, gs:bat_curTarget
	sub	ah, ah
	push	ax
	push	dx
	push	word ptr [bp+var_116]
	call	printCharPronoun
	add	sp, 0Ah
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
	jmp	short loc_207D2
loc_207A7:
	strcat_offset	aPeriodBlankLine, var_116
	jmp	short loc_207D2
loc_207B5:
	mov	ax, offset aRepelledTheAtt
	push	ds
	push	ax
	push	word ptr [bp+var_116+2]
	push	word ptr [bp+var_116]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
loc_207D2:
	jmp	short loc_207F1
loc_207D4:
	mov	ax, offset aRepelledTheAtt
	push	ds
	push	ax
	push	word ptr [bp+var_116+2]
	push	word ptr [bp+var_116]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
loc_207F1:
	jmp	short loc_20810
loc_207F3:
	mov	ax, offset aWasTooFarAway
	push	ds
	push	ax
	push	word ptr [bp+var_116+2]
	push	word ptr [bp+var_116]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], dx
loc_20810:
	lfs	bx, [bp+var_116]
	mov	byte ptr fs:[bx], 0
	lea	ax, [bp+var_106]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	byte ptr word_44166,	0
	delayWithTable
	lea	ax, [bp+var_106]
	mov	word ptr [bp+var_116], ax
	mov	word ptr [bp+var_116+2], ss
	lfs	bx, [bp+var_116]
	mov	byte ptr fs:[bx], 0
	cmp	gs:bat_curTarget, 80h
	jnb	short loc_20868
	test	[bp+arg_7], 40h
	jnz	short loc_20868
	mov	[bp+target], 0FFFFh
loc_20868:
	dec	[bp+target]
	jmp	loc_20324
loc_2086F:
	test	[bp+arg_7], breath_allFoes
	jz	short loc_20896
	test	gs:bat_curTarget, 80h
	jz	short loc_20896
	cmp	gs:bat_curTarget, 83h
	jz	short loc_20896
	mov	[bp+var_110], 1
	inc	gs:bat_curTarget
	jmp	short loc_2089C
loc_20896:
	mov	[bp+var_110], 0
loc_2089C:
	cmp	[bp+var_110], 0
	jz	short bat_doBreathAttack_exit
	jmp	loc_201C6
bat_doBreathAttack_exit:
	mov	sp, bp
	pop	bp
	retf
bat_doBreathAttack endp

; Attributes: bp-based frame

sub_208AA proc far

	charNo=	word ptr  6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	getCharP	[bp+charNo], bx
	cmp	byte ptr gs:roster._name[bx], 0
	jnz	short loc_208CC
	sub	ax, ax
	jmp	short loc_20904
loc_208CC:
	getCharP	[bp+charNo], bx
	test	gs:roster.status[bx], stat_dead	or stat_stoned
	jnz	short loc_208E1
	mov	ax, 1
	jmp	short loc_20904
loc_208E1:
	getCharP	[bp+charNo], bx
	test	gs:roster.status[bx], stat_stoned
	jz	short loc_208F5
	sub	ax, ax
	jmp	short loc_20904
loc_208F5:
	cmp	[bp+arg_2], 5
	jnz	short loc_20900
	mov	ax, 1
	jmp	short loc_20902
loc_20900:
	sub	ax, ax
loc_20902:
	jmp	short $+2
loc_20904:
	mov	sp, bp
	pop	bp
	retf
sub_208AA endp

; Attributes: bp-based frame
sp_trapZap proc	far

	_sq_east= word ptr -0Ah
	var_8= word ptr	-8
	_sq_north= word	ptr -6
	var_4= dword ptr -4

	push	bp
	mov	bp, sp
	mov	ax, 0Ah
	call	someStackOperation
	mov	ax, sq_north
	mov	[bp+_sq_north],	ax
	mov	ax, sq_east
	mov	[bp+_sq_east], ax
	cmp	inDungeonMaybe, 0
	jnz	short loc_20938
	jmp	loc_209DC
loc_20938:
	mov	[bp+var_8], 4
	jmp	short loc_20942
loc_2093F:
	dec	[bp+var_8]
loc_20942:
	cmp	[bp+var_8], 0
	jg	short loc_2094B
	jmp	loc_209DC
loc_2094B:
	mov	al, dunHeight
	sub	ah, ah
	push	ax
	mov	ax, [bp+_sq_north]
	mov	bx, dirFacing
	shl	bx, 1
	sub	ax, dirDeltaN[bx]
	push	ax
	call	wrapNumber
	add	sp, 4
	mov	[bp+_sq_north],	ax
	mov	al, dunWidth
	sub	ah, ah
	push	ax
	mov	bx, dirFacing
	shl	bx, 1
	mov	ax, dirDeltaE[bx]
	add	ax, [bp+_sq_east]
	push	ax
	call	wrapNumber
	add	sp, 4
	mov	[bp+_sq_east], ax
	mov	bx, [bp+_sq_north]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr gs:rowOffset[bx]
	mov	dx, word ptr gs:(rowOffset+2)[bx]
	mov	cx, [bp+_sq_east]
	mov	bx, cx
	shl	cx, 1
	shl	cx, 1
	add	cx, bx
	add	ax, cx
	add	ax, 2
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	lfs	bx, [bp+var_4]
	and	byte ptr fs:[bx], 0EFh
	jmp	loc_2093F
loc_209DC:
	mov	sp, bp
	pop	bp
	retf
sp_trapZap endp

; Attributes: bp-based frame

sp_freezeFoes proc far

	charNo=	word ptr  6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	[bp+charNo]
	push	cs
	call	near ptr sub_20A3B
	add	sp, 2
	or	ax, ax
	jz	short loc_20A37
	cmp	[bp+charNo], 80h
	jge	short loc_20A27
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	mov	bl, gs:bat_curTarget
	and	bx, 3
	add	gs:byte_42270[bx], al
	add	gs:byte_41E70, 2
	jmp	short loc_20A37
loc_20A27:
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	add	gs:byte_42274, al
loc_20A37:
	mov	sp, bp
	pop	bp
	retf
sp_freezeFoes endp

; Attributes: bp-based frame

sub_20A3B proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	[bp+arg_0], 80h
	jl	short loc_20A86
	mov	gs:bat_curTarget, 0
	sub	ax, ax
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr savingThrowCheck
	add	sp, 4
	or	ax, ax
	jnz	short loc_20A6B
	sub	ax, ax
	jmp	short loc_20A95
loc_20A6B:
	cmp	gs:stru_41EFA._name, 0
	jnz	short loc_20A7C
	mov	ax, 1
	jmp	short loc_20A95
loc_20A7C:
	mov	gs:bat_curTarget, 1
loc_20A86:
	sub	ax, ax
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr savingThrowCheck
	add	sp, 4
	jmp	short $+2
loc_20A95:
	mov	sp, bp
	pop	bp
	retf
sub_20A3B endp

; Attributes: bp-based frame

savingThrowCheck proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	sub	ax, ax
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr _savingThrowCheck
	add	sp, 4
	mov	[bp+var_4], ax
	mov	gs:byte_4228E, 0
	push	[bp+arg_2]
	mov	al, gs:bat_curTarget
	sub	ah, ah
	push	ax
	push	cs
	call	near ptr _savingThrowCheck
	add	sp, 4
	mov	[bp+var_6], ax
	mov	al, gs:byte_41E63
	sub	ah, ah
	add	ax, [bp+var_6]
	push	ax
	push	cs
	call	near ptr _returnXor255
	add	sp, 2
	mov	[bp+var_6], ax
	mov	gs:byte_41E63, 0
	mov	ax, [bp+var_4]
	sub	ax, [bp+var_6]
	mov	[bp+var_2], ax
	or	ax, ax
	jge	short loc_20B09
	sub	ax, ax
	jmp	short loc_20B19
loc_20B09:
	cmp	[bp+var_2], 4
	jle	short loc_20B14
	mov	ax, 2
	jmp	short loc_20B17
loc_20B14:
	mov	ax, 1
loc_20B17:
	jmp	short $+2
loc_20B19:
	mov	sp, bp
	pop	bp
	retf
savingThrowCheck endp

; Attributes: bp-based frame

_savingThrowCheck proc far

	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	charP= dword ptr -4
	indexNo= word ptr  6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 0Ah
	call	someStackOperation
	push	si
	cmp	[bp+indexNo], 80h
	jl	short loc_20BA1
	and	[bp+indexNo], 7Fh
	cmp	gs:byte_4228E, 0
	jz	short loc_20B49
	mov	al, gs:byte_4228E
	sub	ah, ah
	jmp	loc_20C78
loc_20B49:
	cmp	[bp+arg_2], 0

	; FIXED - This was "jz short loc_20B6F". This matches behavior on the
	; Apple II. The function was using the wrong hi/lo values for spells.
	; This pretty much made the final battles with Rock Demons impossible.
	;
	jnz	short loc_20B6F
	getMonP	[bp+indexNo], si
	mov	al, gs:monGroups.breathSaveLo[si]
	sub	ah, ah
	mov	[bp+var_6], ax
	mov	al, gs:monGroups.breathSaveHi[si]
	mov	[bp+var_A], ax
	jmp	short loc_20B8D
loc_20B6F:
	getMonP	[bp+indexNo], si
	mov	al, gs:monGroups.spellSaveLo[si]
	sub	ah, ah
	mov	[bp+var_6], ax
	mov	al, gs:monGroups.spellSaveHi[si]
	mov	[bp+var_A], ax
loc_20B8D:
	push	[bp+var_A]
	push	[bp+var_6]
	call	randomBetweenXandY
	add	sp, 4
	jmp	loc_20C78
	jmp	loc_20C61
loc_20BA1:
	getCharP	[bp+indexNo], si
	cmp	gs:roster.class[si], class_monster
	jb	short loc_20C01
	add	ax, offset roster
	mov	word ptr [bp+charP], ax
	mov	word ptr [bp+charP+2], seg seg027
	cmp	[bp+arg_2], 0
	jnz	short loc_20BDB
	lfs	bx, [bp+charP]
	mov	al, fs:[bx+summonStat_t.breathSaveLo]
	sub	ah, ah
	mov	[bp+var_6], ax
	mov	al, fs:[bx+summonStat_t.breathSaveHi]
	mov	[bp+var_A], ax
	jmp	short loc_20BEE
loc_20BDB:
	lfs	bx, [bp+charP]
	mov	al, fs:[bx+summonStat_t.spellSaveLo]
	sub	ah, ah
	mov	[bp+var_6], ax
	mov	al, fs:[bx+summonStat_t.spellSaveHi]
	mov	[bp+var_A], ax
loc_20BEE:
	push	[bp+var_A]
	push	[bp+var_6]
	call	randomBetweenXandY
	add	sp, 4
	mov	[bp+var_8], ax
	jmp	short loc_20C61
loc_20C01:
	getCharP	[bp+indexNo], bx
	mov	ax, gs:roster.level[bx]
	shr	ax, 1
	mov	[bp+var_8], ax
	mov	ax, itemEff_alwaysHide
	push	ax
	push	[bp+indexNo]
	call	hasEffectEquipped
	add	sp, 4
	or	ax, ax
	jnz	short loc_20C2E
	add	[bp+var_8], 2
loc_20C2E:
	getCharP	[bp+indexNo], si
	mov	ax, 41h	
	push	ax
	call	dice_doYDX
	add	sp, 2
	mov	bl, gs:roster.class[si]
	sub	bh, bh
	mov	cl, byte_484BE[bx]
	sub	ch, ch
	mov	dl, gs:roster.luck[si]
	sub	dh, dh
	add	cx, dx
	add	cx, ax
	add	[bp+var_8], cx
loc_20C61:
	mov	al, gs:antiMagicFlag
	sub	ah, ah
	add	ax, [bp+var_8]
	push	ax
	push	cs
	call	near ptr _returnXor255
	add	sp, 2
	jmp	short $+2
loc_20C78:
	pop	si
	mov	sp, bp
	pop	bp
	retf
_savingThrowCheck endp

; This function	returns	the passed value or 255
; depending on which is	lower. This is equivalent
; to the C statement:
; (val)	<= 255 ? (val) : 255
; Attributes: bp-based frame

_returnXor255 proc far

	val= word ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, [bp+val]
	cmp	ax, 255
	jle	short loc_20C92
	mov	ax, 255
loc_20C92:
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
_returnXor255 endp

; Attributes: bp-based frame

sp_compassSpell	proc far

	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	mov	compassDuration, al
	mov	ax, icon_compass
	push	ax
	call	icon_activate
	add	sp, 2
	mov	sp, bp
	pop	bp
	retf
sp_compassSpell	endp

; Attributes: bp-based frame

sp_healSpell proc far

	var_2= word ptr	-2
	charNo=	word ptr  6
	spellNo= word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	cmp	[bp+charNo], 80h
	jge	short loc_20D2D
	mov	bx, [bp+spellNo]
	mov	al, byte_480A4[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	cmp	ax, 80h		; 0x80 here means to heal all party members
	jge	short loc_20CFA
	push	bx
	mov	al, gs:bat_curTarget
	push	ax
	push	[bp+charNo]
	push	cs
	call	near ptr _doHeal
	add	sp, 6
	jmp	short loc_20D2D
loc_20CFA:
	mov	gs:bat_curTarget, 0
	jmp	short loc_20D0F
loc_20D06:
	inc	gs:bat_curTarget
loc_20D0F:
	cmp	gs:bat_curTarget, 7
	jnb	short loc_20D2D
	push	[bp+spellNo]
	mov	al, gs:bat_curTarget
	sub	ah, ah
	push	ax
	push	[bp+charNo]
	push	cs
	call	near ptr _doHeal
	add	sp, 6
	jmp	short loc_20D06
loc_20D2D:
	mov	sp, bp
	pop	bp
	retf
sp_healSpell endp

; Attributes: bp-based frame

_doHeal	proc far

	hpToHeal= word ptr -6
	effectFlag= word ptr -4
	var_2= word ptr	-2
	charNo=	word ptr  6
	target=	word ptr  8
	spellNo= word ptr  0Ah

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	mov	bx, [bp+spellNo]
	mov	al, spellEffectFlags[bx]
	sub	ah, ah
	mov	[bp+effectFlag], ax
	mov	[bp+hpToHeal], 0
	cmp	ax, 0FDh	; effectFlag < 0xfd means to heal effectFlagd4
			; hit points.
	jge	short loc_20D60
	push	ax
	push	cs
	call	near ptr rnd_Xd4
	add	sp, 2
	mov	[bp+hpToHeal], ax
	jmp	short loc_20D97
loc_20D60:
	cmp	[bp+effectFlag], 0FEh ;	points of damage. This is the magaician	spell
			; Quick	fix
	jnz	short loc_20D6E
	mov	[bp+hpToHeal], 8
	jmp	short loc_20D97
loc_20D6E:
	getCharP	[bp+charNo], bx
	mov	ax, gs:roster.level[bx]
	sub	ax, 0FFh
	sbb	cx, cx
	and	ax, cx
	add	ax, 0FFh
	mov	[bp+var_2], ax
	push	ax
	push	cs
	call	near ptr rnd_Xd4
	add	sp, 2
	mov	[bp+hpToHeal], ax
loc_20D97:
	getCharP	[bp+target], si
	mov	ax, [bp+hpToHeal]
	add	gs:roster.currentHP[si], ax
	mov	ax, gs:roster.maxHP[si]
	cmp	gs:roster.currentHP[si], ax
	ja	short loc_20DBE
	cmp	[bp+effectFlag], 0FDh
	jnz	short loc_20DD0
loc_20DBE:
	getCharP	[bp+target], si
	mov	ax, gs:roster.maxHP[si]
	mov	gs:roster.currentHP[si], ax
loc_20DD0:
	mov	bx, [bp+spellNo]
	mov	al, byte_480A4[bx]
	sub	ah, ah
	and	ax, 7Fh
	jmp	loc_20EE0
	jmp	loc_20EFB
restoration:
	getCharP	[bp+target], bx
	and	gs:roster.status[bx], 0AEh
	jmp	loc_20EFB
cureStoned:
	getCharP	[bp+target], bx
	test	gs:roster.status[bx], stat_stoned
	jz	short loc_20E23
	getCharP	[bp+target], bx
	and	gs:roster.status[bx], 0F3h
	push	[bp+target]
	push	cs
	call	near ptr _sp_postHeal
	add	sp, 2
loc_20E23:
	jmp	loc_20EFB
curePossession:
	getCharP	[bp+target], bx
	test	gs:roster.status[bx], stat_possessed
	jz	short loc_20E52
	getCharP	[bp+target], bx
	and	gs:roster.status[bx], 0DFh
	push	[bp+target]
	push	cs
	call	near ptr _sp_postHeal
	add	sp, 2
loc_20E52:
	jmp	loc_20EFB
cureDeath:
	getCharP	[bp+target], bx
	test	gs:roster.status[bx], stat_dead
	jz	short loc_20E81
	getCharP	[bp+target], bx
	and	gs:roster.status[bx], 0FBh
	push	[bp+target]
	push	cs
	call	near ptr _sp_postHeal
	add	sp, 2
loc_20E81:
	jmp	short loc_20EFB
cureOld:
	getCharP	[bp+target], si
	test	gs:roster.status[si], stat_old
	jz	short loc_20EB8
	and	gs:roster.status[si], 0FDh
	mov	ax, 5
	push	ax
	lea	ax, roster.strength[si]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, roster.savedST[si]
	push	dx
	push	ax
	call	_doAgeStatus
	add	sp, 0Ah
loc_20EB8:
	jmp	short loc_20EFB
loc_20EBA:
	getCharP	[bp+target], si
	and	gs:roster.status[si], 0AAh
	mov	gs:roster.hostileFlag[si], 0
loc_20ED2:
	jmp	short loc_20EFB
	mov	byte ptr word_44166,	0
	jmp	short loc_20EFB
loc_20EE0:
	cmp	ax, 6
	ja	short loc_20ED2
	add	ax, ax
	xchg	ax, bx
	jmp	cs:off_20EED[bx]
off_20EED dw offset loc_20EFB
off_20EEF dw offset restoration
dw offset cureStoned
dw offset curePossession
dw offset cureDeath
dw offset cureOld
dw offset loc_20EBA
loc_20EFB:
	pop	si
	mov	sp, bp
	pop	bp
	retf
_doHeal	endp

; This function	does some standard cleanup after
; healing. If currentHP	is zero	then it	sets it
; to one like after a Beyond Death spell. It
; calms	summoned members and sets the attack priority
; for the round	to zero.
; Attributes: bp-based frame

_sp_postHeal proc far

	charNo=	word ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	getCharP	[bp+charNo], bx
	cmp	gs:roster.currentHP[bx], 0
	jnz	short loc_20F2D
	getCharP	[bp+charNo], bx
	mov	gs:roster.currentHP[bx], 1
loc_20F2D:
	getCharP	[bp+charNo], bx
	mov	gs:roster.hostileFlag[bx], 0
	mov	bx, [bp+charNo]
	mov	gs:charActionList[bx], 0
	mov	sp, bp
	pop	bp
	retf
_sp_postHeal endp

; Attributes: bp-based frame

sp_levitation proc far

	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	mov	levitationDuration, al
	mov	ax, icon_levitation
	push	ax
	call	icon_activate
	add	sp, 2
	mov	sp, bp
	pop	bp
	retf
sp_levitation endp

; Attributes: bp-based frame

sp_summonSpell proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	sub	ah, ah
	push	ax
	push	[bp+arg_0]
	call	doSummon
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
sp_summonSpell endp

; Attributes: bp-based frame

sp_teleport proc far

	var_116= word ptr -116h
	var_16=	dword ptr -16h
	counter= word ptr -12h
	var_10=	dword ptr -10h
	var_C= word ptr	-0Ch
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	teleDeltaList= word ptr	-6
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 116h
	call	someStackOperation
	push	di
	push	si
	mov	word ptr [bp+var_16], offset characterIOBuf
	mov	word ptr [bp+var_16+2],	seg seg022
	cmp	inDungeonMaybe, 0
	jnz	short loc_20FCB
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr printSpellFizzled
	add	sp, 4
	jmp	loc_21200
loc_20FCB:
	mov	word_4EE66, 0
	mov	[bp+var_A], 0
	mov	[bp+counter], 0
	jmp	short loc_20FE5
loc_20FE2:
	inc	[bp+counter]
loc_20FE5:
	cmp	[bp+counter], 3
	jge	short loc_20FF7
	mov	si, [bp+counter]
	shl	si, 1
	mov	[bp+si+teleDeltaList], 0
	jmp	short loc_20FE2
loc_20FF7:
	call	clearTextWindow
	mov	ax, offset aTeleportUseArr
	push	ds
	push	ax
	lea	ax, [bp+var_116]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_10], ax
	mov	word ptr [bp+var_10+2],	dx
	mov	al, gs:txt_numLines
	sub	ah, ah
	mov	[bp+var_C], ax
	mov	al, levFlags
	and	ax, 10h
	push	ax
	push	dx
	push	word ptr [bp+var_10]
	mov	ax, offset aDownUp
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	word ptr [bp+var_10], ax
	mov	word ptr [bp+var_10+2],	dx
	lfs	bx, [bp+var_10]
	mov	byte ptr fs:[bx], 0
	lea	ax, [bp+var_116]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	al, byte ptr [bp+var_C]
	add	al, 3
	mov	gs:txt_numLines, al
	mov	[bp+counter], 0
	jmp	short loc_21071
loc_2106E:
	inc	[bp+counter]
loc_21071:
	cmp	[bp+counter], 3
	jge	short loc_210A1
	mov	ax, [bp+counter]
	cmp	[bp+var_A], ax
	jnz	short loc_21084
	mov	ax, 1
	jmp	short loc_21086
loc_21084:
	sub	ax, ax
loc_21086:
	push	ax
	mov	si, [bp+counter]
	shl	si, 1
	push	[bp+si+teleDeltaList]
	push	cs
	call	near ptr _sp_teleportPrintNum
	add	sp, 4
	inc	gs:txt_numLines
	jmp	short loc_2106E
loc_210A1:
	sub	ax, ax
	push	ax
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_8], ax
	jmp	short loc_210E5
loc_210B1:
	inc	[bp+var_A]
	jmp	short loc_210FB
loc_210B6:
	mov	si, [bp+var_A]
	shl	si, 1
	mov	ax, word_484CC[si]
	cmp	[bp+si+teleDeltaList], ax
	jge	short loc_210C7
	inc	[bp+si+teleDeltaList]
loc_210C7:
	jmp	short loc_210FB
loc_210C9:
	mov	si, [bp+var_A]
	shl	si, 1
	mov	ax, word_484CC[si]
	neg	ax
	cmp	[bp+si+teleDeltaList], ax
	jle	short loc_210DC
	dec	[bp+si+teleDeltaList]
loc_210DC:
	jmp	short loc_210FB
loc_210DE:
	jmp	loc_21200
loc_210E1:
	jmp	short loc_210FB
	jmp	short loc_210FB
loc_210E5:
	cmp	ax, dosKeys_ESC
	jz	short loc_210DE
	cmp	ax, ' '
	jz	short loc_210B1
	cmp	ax, dosKeys_upArrow
	jz	short loc_210B6
	cmp	ax, dosKeys_downArrow
	jz	short loc_210C9
	jmp	short loc_210E1
loc_210FB:
	cmp	[bp+var_A], 3
	jge	short loc_21104
	jmp	loc_20FF7
loc_21104:
	mov	ax, offset aTeleport?
	push	ds
	push	ax
	call	printString
	add	sp, 4
	call	getYesNo
	or	ax, ax
	jnz	short loc_21136
	mov	ax, offset aTeleportCancel
	push	ds
	push	ax
	call	printString
	add	sp, 4
	wait4IO
	jmp	loc_21200
loc_21136:
	mov	ax, dunLevelNum
	add	ax, [bp+teleDeltaList+4]
	push	ax
	mov	ax, sq_east
	add	ax, [bp+teleDeltaList+2]
	push	ax
	mov	ax, sq_north
	add	ax, [bp+teleDeltaList]
	push	ax
	push	cs
	call	near ptr _sp_doTeleport
	add	sp, 6
	or	ax, ax
	jnz	short loc_21168
	jmp	loc_211F3
loc_21168:
	mov	ax, offset aTeleportSucces
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	ax, [bp+teleDeltaList]
	add	sq_north, ax
	mov	ax, [bp+teleDeltaList+2]
	add	sq_east, ax
	mov	ax, [bp+teleDeltaList+4]
	add	dunLevelNum,	ax
	mov	di, dunLevelNum
	lfs	bx, [bp+var_16]
	mov	al, fs:[bx+di+12h]
	sub	ah, ah
	mov	si, ax
	cmp	dunLevelIndex, si
	jz	short loc_211F1
	mov	dunLevelIndex, si
	mov	buildingRvalMaybe, 4
	mov	al, fs:[bx+dun_t.deltaSqN]
	cbw
	add	sq_north, ax
	mov	al, fs:[bx+dun_t.deltaSqE]
	cbw
	add	sq_east, ax
	mov	gs:levelChangedFlag, 1
loc_211F1:
	jmp	short loc_21200
loc_211F3:
	mov	ax, offset aTeleportFailed
	push	ds
	push	ax
	call	printString
	add	sp, 4
loc_21200:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
sp_teleport endp

; Attributes: bp-based frame

_sp_doTeleport proc far

	var_1A=	dword ptr -1Ah
	var_16=	word ptr -16h
	var_14=	dword ptr -14h
	var_10=	word ptr -10h
	var_E= dword ptr -0Eh
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= dword ptr -4
	sqN= word ptr  6
	sqE= word ptr  8
	level= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 1Ah
	call	someStackOperation
	push	si
	cmp	[bp+level], 0
	jl	short loc_2121E
	cmp	[bp+level], 7
	jle	short loc_21223
loc_2121E:
	sub	ax, ax
	jmp	loc_2136C
loc_21223:
	mov	word ptr [bp+var_E], offset characterIOBuf
	mov	word ptr [bp+var_E+2], seg seg022
	lfs	bx, [bp+var_E]
	mov	al, fs:[bx+dun_t.deltaSqN]
	cbw
	add	ax, [bp+sqN]
	mov	[bp+var_16], ax
	mov	al, fs:[bx+dun_t.deltaSqE]
	cbw
	add	ax, [bp+sqE]
	mov	[bp+var_A], ax
	mov	si, [bp+level]
	test	fs:[bx+si+dun_t.dunLevel], 80h
	jz	short loc_21255
	sub	ax, ax
	jmp	loc_2136C
loc_21255:
	mov	si, [bp+level]
	mov	al, fs:[bx+si+dun_t.dunLevel]
	sub	ah, ah
	cmp	ax, dunLevelIndex
	jnz	short loc_21276
	mov	ax, bx
	mov	dx, word ptr [bp+var_E+2]
	mov	word ptr [bp+var_14], ax
	mov	word ptr [bp+var_14+2],	dx
	jmp	short loc_212A2
loc_21276:
	mov	ax, 0FA0h
	push	ax
	call	_mallocMaybe
	add	sp, 2
	mov	word ptr [bp+var_14], ax
	mov	word ptr [bp+var_14+2],	dx
	push	dx
	push	ax
	mov	si, [bp+level]
	lfs	bx, [bp+var_E]
	mov	al, fs:[bx+si+dun_t.dunLevel]
	sub	ah, ah
	add	ax, 0Ah
	push	ax
	call	readLevelData
	add	sp, 6
loc_212A2:
	lfs	bx, [bp+var_14]
	mov	al, fs:[bx+dun_t.deltaSqN]
	cbw
	sub	[bp+var_16], ax
	mov	al, fs:[bx+dun_t.deltaSqE]
	cbw
	sub	[bp+var_A], ax
	cmp	[bp+var_16], 0
	jl	short loc_212D5
	mov	al, fs:[bx+dun_t._height]
	sub	ah, ah
	cmp	ax, [bp+var_16]
	jbe	short loc_212D5
	cmp	[bp+var_A], 0
	jl	short loc_212D5
	mov	al, fs:[bx+dun_t._width]
	cmp	ax, [bp+var_A]
	ja	short loc_212F6
loc_212D5:
	mov	ax, word ptr [bp+var_E]
	mov	dx, word ptr [bp+var_E+2]
	cmp	bx, ax
	jnz	short loc_212E4
	cmp	word ptr [bp+var_14+2],	dx
	jz	short loc_212F2
loc_212E4:
	push	word ptr [bp+var_14+2]
	push	word ptr [bp+var_14]
	call	_freeMaybe
	add	sp, 4
loc_212F2:
	sub	ax, ax
	jmp	short loc_2136C
loc_212F6:
	mov	ax, word ptr [bp+var_14]
	mov	dx, word ptr [bp+var_14+2]
	add	ax, 24h	
	mov	[bp+var_8], ax
	mov	[bp+var_6], dx
	mov	ax, [bp+var_16]
	shl	ax, 1
	add	ax, [bp+var_8]
	mov	word ptr [bp+var_1A], ax
	mov	word ptr [bp+var_1A+2],	dx
	lfs	bx, [bp+var_1A]
	mov	ah, fs:[bx+1]
	sub	al, al
	mov	cl, fs:[bx]
	sub	ch, ch
	add	ax, cx
	add	ax, word ptr [bp+var_14]
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	mov	si, [bp+var_A]
	mov	ax, si
	shl	si, 1
	shl	si, 1
	add	si, ax
	lfs	bx, [bp+var_4]
	mov	al, fs:[bx+si+4]
	and	al, 20h
	cmp	al, 1
	sbb	cx, cx
	neg	cx
	mov	[bp+var_10], cx
	mov	ax, word ptr [bp+var_E]
	mov	dx, word ptr [bp+var_E+2]
	cmp	word ptr [bp+var_14], ax
	jnz	short loc_21359
	cmp	word ptr [bp+var_14+2],	dx
	jz	short loc_21367
loc_21359:
	push	word ptr [bp+var_14+2]
	push	word ptr [bp+var_14]
	call	_freeMaybe
	add	sp, 4
loc_21367:
	mov	ax, [bp+var_10]
	jmp	short $+2
loc_2136C:
	pop	si
	mov	sp, bp
	pop	bp
	retf
_sp_doTeleport endp

; Attributes: bp-based frame

_sp_teleportPrintNum proc far

	var_24=	dword ptr -24h
	var_20=	word ptr -20h
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 24h	
	call	someStackOperation
	sub	ax, ax
	push	ax
	mov	ax, [bp+arg_0]
	cwd
	push	dx
	push	ax
	lea	ax, [bp+var_20]
	push	ss
	push	ax
	call	_itoa
	add	sp, 0Ah
	mov	word ptr [bp+var_24], ax
	mov	word ptr [bp+var_24+2],	dx
	cmp	[bp+arg_2], 0
	jz	short loc_213A8
	lfs	bx, [bp+var_24]
	inc	word ptr [bp+var_24]
	mov	byte ptr fs:[bx], '<'
loc_213A8:
	lfs	bx, [bp+var_24]
	mov	byte ptr fs:[bx], 0
	mov	fs:byte_42419, 30h 
	lea	ax, [bp+var_20]
	push	ss
	push	ax
	call	sub_16595
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
_sp_teleportPrintNum endp

; Attributes: bp-based frame
sp_farFoes proc	far

	var_5A=	word ptr -5Ah
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 5Ah	
	call	someStackOperation
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_20A3B
	add	sp, 2
	or	ax, ax
	jnz	short loc_213E6
	jmp	loc_214C2
loc_213E6:
	test	byte ptr [bp+arg_0], 80h
	jz	short loc_2143B
	mov	[bp+var_A], 0
	jmp	short loc_213F6
loc_213F3:
	inc	[bp+var_A]
loc_213F6:
	cmp	[bp+var_A], 4
	jge	short loc_21439
	getMonP	[bp+var_A], bx
	mov	al, gs:monGroups.distance[bx]
	sub	ah, ah
	and	ax, 0Fh
	mov	bx, [bp+arg_2]
	mov	cl, spellEffectFlags[bx]
	sub	ch, ch
	add	ax, cx
	mov	[bp+var_2], ax
	cmp	ax, 9
	jle	short loc_2142A
	mov	[bp+var_2], 9
loc_2142A:
	push	[bp+var_2]
	push	[bp+var_A]
	push	cs
	call	near ptr _sp_setMonDistance
	add	sp, 4
	jmp	short loc_213F3
loc_21439:
	jmp	short loc_21486
loc_2143B:
	mov	al, gs:bat_curTarget
	sub	ah, ah
	and	ax, 3
	mov	[bp+var_A], ax
	getMonP	[bp+var_A], bx
	mov	al, gs:monGroups.distance[bx]
	sub	ah, ah
	and	ax, 0Fh
	mov	bx, [bp+arg_2]
	mov	cl, spellEffectFlags[bx]
	sub	ch, ch
	add	ax, cx
	mov	[bp+var_2], ax
	cmp	ax, 9
	jle	short loc_21479
	mov	[bp+var_2], 9
loc_21479:
	push	[bp+var_2]
	push	[bp+var_A]
	push	cs
	call	near ptr _sp_setMonDistance
	add	sp, 4
loc_21486:
	mov	ax, offset aAndTheFoesAre
	push	ds
	push	ax
	lea	ax, [bp+var_5A]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_8], ax
	mov	[bp+var_6], dx
	mov	ax, offset aFartherAway
	push	ds
	push	ax
	push	dx
	push	[bp+var_8]
	call	_strcat
	add	sp, 8
	mov	[bp+var_8], ax
	mov	[bp+var_6], dx
	lea	ax, [bp+var_5A]
	push	ss
	push	ax
	call	printString
	add	sp, 4
loc_214C2:
	delayWithTable
	mov	sp, bp
	pop	bp
	retf
sp_farFoes endp

; Attributes: bp-based frame
_sp_setMonDistance proc	far

	arg_0= word ptr	 6
	arg_2= byte ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	getMonP	[bp+arg_0], si
	cmp	byte ptr gs:monGroups._name[si], 0
	jz	short loc_21500
	mov	al, gs:monGroups.distance[si]
	and	al, 0F0h
	or	al, [bp+arg_2]
	mov	gs:monGroups.distance[si], al
loc_21500:
	pop	si
	mov	sp, bp
	pop	bp
	retf
_sp_setMonDistance endp

; Attributes: bp-based frame

sp_vorpalPlating proc far

	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	mov	bl, gs:bat_curTarget
	and	bx, 7Fh
	add	gs:vorpalPlateBonus[bx], al
	mov	sp, bp
	pop	bp
	retf
sp_vorpalPlating endp

; Attributes: bp-based frame

sp_areaEnchant proc far

	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	mov	detectDuration, al
	mov	al, byte_480A4[bx]
	mov	detectType, al
	mov	ax, icon_areaEnchant
	push	ax
	call	icon_activate
	add	sp, 2
	mov	sp, bp
	pop	bp
	retf
sp_areaEnchant endp

; Attributes: bp-based frame

sp_shieldSpell proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	[bp+arg_0], 80h
	jl	short loc_2158D
	mov	bx, [bp+arg_2]
	mov	al, byte_480A4[bx]
	mov	bx, [bp+arg_0]
	and	bx, 3
	sub	gs:byte_42270[bx], al
	jmp	short loc_215BE
loc_2158D:
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	mov	shieldDuration, al
	mov	al, byte_480A4[bx]
	mov	byte_4EECB, al
	mov	ax, icon_shield
	push	ax
	call	icon_activate
	add	sp, 2
	mov	byte ptr word_44166,	0
loc_215BE:
	mov	sp, bp
	pop	bp
	retf
sp_shieldSpell endp

; Attributes: bp-based frame

sp_strengthBonus proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	test	byte ptr [bp+arg_0], 80h
	jz	short loc_215EA
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	mov	bx, [bp+arg_0]
	and	bx, 3
	mov	gs:byte_42422[bx], al
	jmp	short loc_21606
loc_215EA:
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	mov	bl, gs:bat_curTarget
	and	bx, 7
	mov	gs:strengthBonus[bx], al
loc_21606:
	mov	sp, bp
	pop	bp
	retf
sp_strengthBonus endp

; Attributes: bp-based frame

sp_phaseDoor proc far

	var_8= word ptr	-8
	var_6= dword ptr -6
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 0Ah
	call	someStackOperation
	cmp	inDungeonMaybe, 0
	jnz	short loc_21624
	jmp	loc_216E2
loc_21624:
	push	sq_north
	push	sq_east
	call	dun_getWalls
	add	sp, 4
	mov	[bp+var_2], ax
	mov	ax, dirFacing
	dec	ax
	push	ax
	push	[bp+var_2]
	call	sub_27E13
	add	sp, 4
	mov	[bp+var_8], ax
	mov	al, byte ptr [bp+var_8]
	and	al, 0Fh
	cmp	al, 9
	jb	short loc_21671
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr printSpellFizzled
	add	sp, 4
	jmp	short loc_216EF
loc_21671:
	mov	gs:wallIsPhased, 1
	mov	bx, [bp+arg_2]
	cmp	spellEffectFlags[bx], 80h
	jb	short loc_216E0
	mov	bx, sq_north
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr gs:rowOffset[bx]
	mov	dx, word ptr gs:(rowOffset+2)[bx]
	mov	cx, sq_east
	mov	bx, cx
	shl	cx, 1
	shl	cx, 1
	add	cx, bx
	add	ax, cx
	mov	word ptr [bp+var_6], ax
	mov	word ptr [bp+var_6+2], dx
	test	byte ptr dirFacing, 2
	jz	short loc_216C8
	inc	word ptr [bp+var_6]
loc_216C8:
	test	byte ptr dirFacing, 1
	jz	short loc_216D9
	lfs	bx, [bp+var_6]
	and	byte ptr fs:[bx], 0F0h
	jmp	short loc_216E0
loc_216D9:
	lfs	bx, [bp+var_6]
	and	byte ptr fs:[bx], 0Fh
loc_216E0:
	jmp	short loc_216EF
loc_216E2:
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr printSpellFizzled
	add	sp, 4
loc_216EF:
	mov	sp, bp
	pop	bp
	retf
sp_phaseDoor endp

; Attributes: bp-based frame
sp_acBonus proc	far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	[bp+arg_0], 80h
	jge	short loc_21716
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	add	gs:byte_4244E, al
	jmp	short loc_2172C
loc_21716:
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	mov	bx, [bp+arg_0]
	and	bx, 3
	sub	gs:byte_42270[bx], al
loc_2172C:
	mov	sp, bp
	pop	bp
	retf
sp_acBonus endp

; Attributes: bp-based frame

sp_disbelieve proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	cmp	[bp+arg_0], 80h
	jge	short loc_2179D
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	or	gs:byte_4240E, al
	cmp	gs:byte_4240E, 80h
	jb	short loc_2179B
	mov	[bp+var_2], 0
	jmp	short loc_21765
loc_21762:
	inc	[bp+var_2]
loc_21765:
	cmp	[bp+var_2], 7
	jge	short loc_2179B
	getCharP	[bp+arg_0], si
	cmp	gs:(roster.specAbil+3)[si], 0
	jz	short loc_21799
	mov	ax, 0Ch
	push	ax
	mov	ax, offset aDopplganger
	push	ds
	push	ax
	lea	ax, roster._name[si]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	_memcpy
	add	sp, 0Ah
loc_21799:
	jmp	short loc_21762
loc_2179B:
	jmp	short loc_217BE
loc_2179D:
	mov	bx, [bp+arg_2]
	test	spellEffectFlags[bx], 40h
	jz	short loc_217B3
	or	gs:byte_4240E, 40h
	jmp	short loc_217BE
loc_217B3:
	mov	al, byte ptr [bp+arg_0]
	mov	gs:monDisbelieveFlag, al
loc_217BE:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sp_disbelieve endp

; Attributes: bp-based frame

sp_scrySight proc far

	var_11A= word ptr -11Ah
	var_118= word ptr -118h
	var_116= word ptr -116h
	var_114= word ptr -114h
	var_112= word ptr -112h
	var_110= dword ptr -110h
	var_10C= word ptr -10Ch
	var_C= word ptr	-0Ch
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 11Ah
	call	someStackOperation
	push	si
	mov	[bp+var_6], 0
	mov	word ptr [bp+var_110], offset characterIOBuf
	mov	word ptr [bp+var_110+2], seg seg022
	lfs	bx, [bp+var_110]
	mov	al, fs:(characterIOBuf+11h)[bx]
	sub	ah, ah
	mov	[bp+var_118], ax
	mov	ax, offset aYouFace
	push	ds
	push	ax
	lea	ax, [bp+var_10C]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
	mov	bx, dirFacing
	shl	bx, 1
	shl	bx, 1
	push	word ptr (dirStringList+2)[bx]
	push	word ptr dirStringList[bx]
	push	dx
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
	cmp	[bp+var_118], 0
	jnz	short loc_21840
	jmp	loc_218D5
loc_21840:
	mov	ax, [bp+var_6]
	inc	[bp+var_6]
	cmp	ax, 1
	sbb	cx, cx
	neg	cx
	push	cx
	push	dx
	push	[bp+var_116]
	mov	ax, offset aAndAre
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
	sub	ax, ax
	push	ax
	mov	ax, [bp+var_118]
	cwd
	push	dx
	push	ax
	push	[bp+var_114]
	push	[bp+var_116]
	call	_itoa
	add	sp, 0Ah
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
	mov	ax, [bp+var_118]
	dec	ax
	push	ax
	push	dx
	push	[bp+var_116]
	mov	ax, offset aLevelS
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
	mov	al, levFlags
	and	al, 10h
	cmp	al, 1
	sbb	cx, cx
	neg	cx
	push	cx
	push	dx
	push	[bp+var_116]
	mov	ax, offset aAboveBelow
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
loc_218D5:
	lfs	bx, [bp+var_110]
	mov	al, fs:[bx+dun_t.deltaSqN]
	cbw
	add	ax, sq_north
	mov	[bp+var_2], ax
	mov	si, [bp+var_118]
	mov	bl, fs:[bx+si+12h]
	sub	bh, bh
	mov	al, byte_47EDC[bx]
	cbw
	mov	cx, [bp+var_2]
	sub	cx, ax
	mov	[bp+var_11A], cx
	or	cx, cx
	jnz	short loc_2190D
	jmp	loc_219BD
loc_2190D:
	mov	ax, [bp+var_6]
	inc	[bp+var_6]
	cmp	ax, 1
	sbb	cx, cx
	neg	cx
	push	cx
	push	[bp+var_114]
	push	[bp+var_116]
	mov	ax, offset aAndAre
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
	cmp	[bp+var_11A], 0
	jl	short loc_21945
	mov	ax, [bp+var_11A]
	jmp	short loc_2194B
loc_21945:
	mov	ax, [bp+var_11A]
	neg	ax
loc_2194B:
	mov	[bp+var_112], ax
	sub	ax, ax
	push	ax
	mov	ax, [bp+var_112]
	cwd
	push	dx
	push	ax
	push	[bp+var_114]
	push	[bp+var_116]
	call	_itoa
	add	sp, 0Ah
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
	mov	ax, [bp+var_112]
	dec	ax
	push	ax
	push	dx
	push	[bp+var_116]
	mov	ax, offset aPaceS
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
	cmp	[bp+var_11A], 0
	jge	short loc_2199D
	mov	ax, 1
	jmp	short loc_2199F
loc_2199D:
	sub	ax, ax
loc_2199F:
	push	ax
	push	[bp+var_114]
	push	[bp+var_116]
	mov	ax, offset aNorthSouth
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
loc_219BD:
	lfs	bx, [bp+var_110]
	mov	al, fs:[bx+dun_t.deltaSqE]
	cbw
	add	ax, sq_east
	mov	[bp+var_8], ax
	mov	si, [bp+var_118]
	mov	bl, fs:[bx+si+12h]
	sub	bh, bh
	mov	al, byte_47F1A[bx]
	cbw
	mov	cx, [bp+var_8]
	sub	cx, ax
	mov	[bp+var_4], cx
	or	cx, cx
	jnz	short loc_219F4
	jmp	loc_21AA0
loc_219F4:
	mov	ax, [bp+var_6]
	inc	[bp+var_6]
	cmp	ax, 1
	sbb	cx, cx
	neg	cx
	push	cx
	push	[bp+var_114]
	push	[bp+var_116]
	mov	ax, offset aAndAre
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
	cmp	[bp+var_4], 0
	jl	short loc_21A2A
	mov	ax, [bp+var_4]
	jmp	short loc_21A2F
loc_21A2A:
	mov	ax, [bp+var_4]
	neg	ax
loc_21A2F:
	mov	[bp+var_112], ax
	sub	ax, ax
	push	ax
	mov	ax, [bp+var_112]
	cwd
	push	dx
	push	ax
	push	[bp+var_114]
	push	[bp+var_116]
	call	_itoa
	add	sp, 0Ah
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
	mov	ax, [bp+var_112]
	dec	ax
	push	ax
	push	dx
	push	[bp+var_116]
	mov	ax, offset aPaceS
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
	cmp	[bp+var_4], 0
	jge	short loc_21A80
	mov	ax, 1
	jmp	short loc_21A82
loc_21A80:
	sub	ax, ax
loc_21A82:
	push	ax
	push	[bp+var_114]
	push	[bp+var_116]
	mov	ax, offset aEastWest
	push	ds
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
loc_21AA0:
	cmp	[bp+var_6], 0
	jz	short loc_21AAB
	mov	ax, offset aOf
	jmp	short loc_21AAE
loc_21AAB:
	mov	ax, offset aAndAreAt
loc_21AAE:
	mov	[bp+var_C], ax
	mov	[bp+var_A], ds
	push	ds
	push	ax
	push	[bp+var_114]
	push	[bp+var_116]
	call	_strcat
	add	sp, 8
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
	mov	si, [bp+var_118]
	lfs	bx, [bp+var_110]
	mov	al, fs:[bx+si+12h]
	sub	ah, ah
	mov	[bp+var_112], ax
	mov	bx, ax
	mov	al, byte_47F58[bx]
	cbw
	mov	bx, ax
	shl	bx, 1
	shl	bx, 1
	push	word ptr (scryBaseStringList+2)[bx]
	push	word ptr scryBaseStringList[bx]
	push	dx
	push	[bp+var_116]
	call	_strcat
	add	sp, 8
	mov	[bp+var_116], ax
	mov	[bp+var_114], dx
	lea	ax, [bp+var_10C]
	push	ss
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
	pop	si
	mov	sp, bp
	pop	bp
	retf
sp_scrySight endp

; Attributes: bp-based frame

sp_antiMagic proc far

	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	add	gs:antiMagicFlag, al
	mov	sp, bp
	pop	bp
	retf
sp_antiMagic endp

; Attributes: bp-based frame

sp_wordOfFear proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_20A3B
	add	sp, 2
	or	ax, ax
	jz	short loc_21BA8
	cmp	[bp+arg_0], 80h
	jge	short loc_21B98
	mov	al, gs:bat_curTarget
	sub	ah, ah
	mov	si, ax
	and	si, 3
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	add	gs:byte_4229C[si], al
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	add	gs:byte_41E50[si], al
	jmp	short loc_21BA8
loc_21B98:
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	add	gs:byte_42567, al
loc_21BA8:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sp_wordOfFear endp

; Attributes: bp-based frame

sp_spellbind proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	sub	ax, ax
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr savingThrowCheck
	add	sp, 4
	or	ax, ax
	jnz	short loc_21BCD
	jmp	loc_21C63
loc_21BCD:
	cmp	gs:bat_curTarget, 80h
	jnb	short loc_21BFB
	cmp	[bp+arg_0], 80h
	jge	short loc_21BE4
	sub	al, al
	jmp	short loc_21BE6
loc_21BE4:
	mov	al, 1
loc_21BE6:
	mov	cx, ax
	getCharP	[bp+arg_0], bx
	mov	gs:roster.hostileFlag[bx], cl
	jmp	short loc_21C61
loc_21BFB:
	call	findEmptyRosterNum
	mov	[bp+var_2], ax
	cmp	ax, 7
	jge	short loc_21C54
	mov	al, gs:bat_curTarget
	sub	ah, ah
	and	ax, 3
	mov	cx, 30h	
	mul	cx
	mov	si, ax
	test	gs:monGroups.groupSize[si], 1Fh
	jz	short loc_21C54
	test	gs:monGroups.flags[si],	10h
	jz	short loc_21C54
	dec	gs:monGroups.groupSize[si]
	lea	ax, monGroups._name[si]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	[bp+var_2]
	push	cs
	call	near ptr _sp_convertMonToSummon
	add	sp, 6
	mov	byte ptr word_44166,	0
	jmp	short loc_21C61
loc_21C54:
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr printNoEffect
	add	sp, 4
loc_21C61:
	jmp	short loc_21C70
loc_21C63:
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr printNoEffect
	add	sp, 4
loc_21C70:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sp_spellbind endp

; This function	takes the data from the	mon_t data
; type and converts it to the summonStat_t data	type.
; Attributes: bp-based frame

_sp_convertMonToSummon proc far

	var_56=	word ptr -56h
	var_1A=	dword ptr -1Ah
	counter= word ptr -16h
	var_14=	word ptr -14h
	var_4= dword ptr -4
	arg_0= word ptr	 6
	arg_2= dword ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 1Ah
	call	someStackOperation
	push	si
	getCharIndex	ax, [bp+arg_0]
	add	ax, offset roster
	mov	word ptr [bp+var_1A], ax
	mov	word ptr [bp+var_1A+2],	seg seg027
	mov	ax, charSize
	push	ax
	sub	ax, ax
	push	ax
	push	word ptr [bp+var_1A+2]
	push	word ptr [bp+var_1A]
	call	_memset
	add	sp, 8
	lea	ax, [bp+var_14]
	push	ss
	push	ax
	push	word ptr [bp+arg_2+2]
	push	word ptr [bp+arg_2]
	call	decryptName
	add	sp, 8
	sub	ax, ax
	push	ax
	getCharP	[bp+arg_0], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, [bp+var_14]
	push	ss
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	lfs	bx, [bp+var_4]
	mov	byte ptr fs:[bx], 0
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.breathSaveLo]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.breathSaveLo], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.breathSaveHi]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.breathSaveHi], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.oppPriorityLo]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.priorityLo], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.oppPriorityHi]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.priorityHi], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.picIndex]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.picIndex], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.breathFlag]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.breathFlag], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.breathRange]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.breathRange], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.toHitLo]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.toHitLo], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.toHitHi]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.toHitHi], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.spellSaveLo]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.spellSaveLo], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.spellSaveHi]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.spellSaveHi], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.strongElement]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.strongElement], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.weakElement]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.weakElement], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.repelFlags]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.repelFlags], al
	mov	[bp+counter], 0
	jmp	short loc_21DB6
loc_21DB3:
	inc	[bp+counter]
loc_21DB6:
	cmp	[bp+counter], 8
	jge	short loc_21DCF
	mov	si, [bp+counter]
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+si+mon_t.attackType._type]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+si+summonStat_t.attacks._type], al
	jmp	short loc_21DB3
loc_21DCF:
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.packedGenAc]
	and	al, 3Fh
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.acBase], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.packedGenAc]
	sub	ah, ah
	mov	cl, 6
	shr	ax, cl
	and	al, 3
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.pronoun], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.groupSize]
	sub	ah, ah
	mov	cl, 5
	shr	ax, cl
	and	al, 7
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.numAttacks], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.flags]
	and	al, 0Fh
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.field_5E], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.flags]
	sub	ah, ah
	mov	cl, 6
	shr	ax, cl
	and	al, 3
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.field_5F], al
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.flags]
	and	al, 10h
	cmp	al, 1
	sbb	cx, cx
	inc	cx
	add	cl, 0Dh
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.class], cl
	lfs	bx, [bp+arg_2]
	mov	al, fs:[bx+mon_t.hpDice]
	sub	ah, ah
	push	ax
	call	dice_doYDX
	add	sp, 2
	lfs	bx, [bp+arg_2]
	mov	cx, fs:[bx+mon_t.hpBase]
	add	cx, ax
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+summonStat_t.curHP], cx
	lfs	bx, [bp+var_1A]
	mov	ax, fs:[bx+summonStat_t.curHP]
	mov	fs:[bx+summonStat_t.maxHP], ax
	mov	[bp+counter], 0
	jmp	short loc_21E80
loc_21E7D:
	inc	[bp+counter]
loc_21E80:
	cmp	[bp+counter], 6
	jge	short loc_21E93
	mov	si, [bp+counter]
	lfs	bx, [bp+var_1A]
	mov	fs:[bx+si+summonStat_t.chronoQuest], 0FFh
	jmp	short loc_21E7D
loc_21E93:
	pop	si
	mov	sp, bp
	pop	bp
	retf
_sp_convertMonToSummon endp

; Attributes: bp-based frame
sp_haltFoe proc	far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_20A3B
	add	sp, 2
	or	ax, ax
	jz	short loc_21ED8
	cmp	[bp+arg_0], 80h
	jge	short loc_21EC2
	inc	gs:monFrozenFlag
	jmp	short loc_21ED8
loc_21EC2:
	inc	gs:partyFrozenFlag
	mov	ax, offset aAndThePartyFre
	push	ds
	push	ax
	call	printString
	add	sp, 4
loc_21ED8:
	mov	sp, bp
	pop	bp
	retf
sp_haltFoe endp

; Attributes: bp-based frame

sp_meleeMen proc far

	var_56=	word ptr -56h
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 56h	
	call	someStackOperation
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_20A3B
	add	sp, 2
	or	ax, ax
	jz	short loc_21F64
	test	byte ptr [bp+arg_0], 80h
	jz	short loc_21F0F
	mov	ax, 1
	push	ax
	mov	ax, [bp+arg_0]
	and	ax, 3
	push	ax
	push	cs
	call	near ptr _sp_setMonDistance
	add	sp, 4
	jmp	short loc_21F28
loc_21F0F:
	mov	ax, 1
	push	ax
	mov	al, gs:bat_curTarget
	sub	ah, ah
	and	ax, 3
	push	ax
	push	cs
	call	near ptr _sp_setMonDistance
	add	sp, 4
loc_21F28:
	mov	ax, offset aAndTheFoesAre
	push	ds
	push	ax
	lea	ax, [bp+var_56]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	mov	ax, offset aCloser
	push	ds
	push	ax
	push	dx
	push	[bp+var_4]
	call	_strcat
	add	sp, 8
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	lea	ax, [bp+var_56]
	push	ss
	push	ax
	call	printString
	add	sp, 4
loc_21F64:
	mov	sp, bp
	pop	bp
	retf
sp_meleeMen endp

; Attributes: bp-based frame

sp_batchspell proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	sub	ah, ah
	mov	[bp+var_4], ax
loc_21F7F:
	mov	bx, [bp+var_4]
	inc	[bp+var_4]
	mov	al, byte_484D2[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	or	ax, ax
	jz	short loc_21F9F
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_22821
	add	sp, 4
	jmp	short loc_21F7F
loc_21F9F:
	mov	sp, bp
	pop	bp
	retf
sp_batchspell endp

; Attributes: bp-based frame

sp_camaraderie proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 0
	jmp	short loc_21FB8
loc_21FB5:
	inc	[bp+var_2]
loc_21FB8:
	cmp	[bp+var_2], 7
	jge	short loc_21FEE
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.hostileFlag[bx], 0
	jz	short loc_21FEC
	call	_random
	and	al, 1
	mov	cx, ax
	getCharP	[bp+arg_0], bx
	mov	gs:roster.hostileFlag[bx], cl
loc_21FEC:
	jmp	short loc_21FB5
loc_21FEE:
	mov	sp, bp
	pop	bp
	retf
sp_camaraderie endp

; Attributes: bp-based frame

printSpellFizzled proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, offset aButItFizzled
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
printSpellFizzled endp

; Attributes: bp-based frame

sp_luckSpell proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	add	gs:byte_41E70, al
	push	bx
	push	[bp+arg_0]
	push	cs
	call	near ptr sp_antiMagic
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
sp_luckSpell endp

; Attributes: bp-based frame

sp_identifySpell proc far

	var_F4=	word ptr -0F4h
	var_34=	word ptr -34h
	var_32=	word ptr -32h
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 0F4h
	call	someStackOperation
	call	clearTextWindow
	and	[bp+arg_0], 7Fh
	lea	ax, [bp+var_32]
	push	ss
	push	ax
	lea	ax, [bp+var_F4]
	push	ss
	push	ax
	push	[bp+arg_0]
	call	sub_188E8
	add	sp, 0Ah
	mov	[bp+var_34], ax
	or	ax, ax
	jnz	short loc_22080
	mov	al, byte ptr aYourPocketsAreEm
	cbw
	push	ax
	call	printString
	add	sp, 2
	mov	[bp+var_2], 0FFFFh
	jmp	short loc_22098
loc_22080:
	push	[bp+var_34]
	lea	ax, [bp+var_32]
	push	ss
	push	ax
	mov	ax, offset aWhichItem?
	push	ds
	push	ax
	call	printStringGetInput
	add	sp, 0Ah
	mov	[bp+var_2], ax
loc_22098:
	cmp	[bp+var_2], 0
	jge	short loc_220AD
	mov	ax, offset aSpellAborted_
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	jmp	short loc_220D5
loc_220AD:
	getCharIndex	ax, [bp+arg_0]
	mov	bx, [bp+var_2]
	mov	cx, bx
	shl	bx, 1
	add	bx, cx
	add	bx, ax
	and	byte ptr gs:[bx+62h], 3Fh
	mov	ax, offset aItemHasBeenIde
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
loc_220D5:
	mov	sp, bp
	pop	bp
	retf
sp_identifySpell endp

; Attributes: bp-based frame

sp_earthMaw proc far

	var_108= word ptr -108h
	var_106= word ptr -106h
	var_104= word ptr -104h
	var_102= word ptr -102h
	var_100= word ptr -100h

	push	bp
	mov	bp, sp
	mov	ax, 108h
	call	someStackOperation
	push	si
	mov	ax, offset aAndTheEarthSwa
	push	ds
	push	ax
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_106], ax
	mov	[bp+var_104], dx
	cmp	gs:bat_curTarget, 80h
	jnb	short loc_2215E
	mov	[bp+var_108], 0
	jmp	short loc_22118
loc_22114:
	inc	[bp+var_108]
loc_22118:
	cmp	[bp+var_108], 7
	jge	short loc_2213B
	getCharP	[bp+var_108], si
	or	gs:roster.status[si], stat_dead
	mov	gs:roster.currentHP[si], 0
	jmp	short loc_22114
loc_2213B:
	call	sub_22DA1
	mov	ax, offset aTheParty
	push	ds
	push	ax
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_106], ax
	mov	[bp+var_104], dx
	jmp	loc_221F0
loc_2215E:
	mov	al, gs:bat_curTarget
	sub	ah, ah
	mov	si, ax
	and	ax, 3
	mov	cx, monStruSize
	mul	cx
	mov	bx, ax
	mov	al, gs:monGroups.groupSize[bx]
	sub	ah, ah
	and	ax, 1Eh
	dec	ax
	push	ax
	push	si
	push	[bp+var_104]
	push	[bp+var_106]
	push	cs
	call	near ptr bat_getTargetName
	add	sp, 8
	mov	[bp+var_106], ax
	mov	[bp+var_104], dx
	mov	al, gs:bat_curTarget
	sub	ah, ah
	and	ax, 3
	mov	[bp+var_102], ax
	getMonP	[bp+var_102], bx
	and	gs:monGroups.groupSize[bx], 0E0h
	mov	[bp+var_108], 0
	jmp	short loc_221CC
loc_221C8:
	inc	[bp+var_108]
loc_221CC:
	cmp	[bp+var_108], 32
	jge	short loc_221F0
	mov	bx, [bp+var_102]
	mov	cl, 6
	shl	bx, cl
	mov	ax, [bp+var_108]
	shl	ax, 1
	add	bx, ax
	mov	gs:bat_monPriorityList[bx], 0
	jmp	short loc_221C8
loc_221F0:
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	pop	si
	mov	sp, bp
	pop	bp
	retf
sp_earthMaw endp

; Attributes: bp-based frame

printNoEffect proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, offset aButItHadNoEffe
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
printNoEffect endp

; Attributes: bp-based frame

sp_divineIntervention proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 0
	jmp	short loc_22233
loc_22230:
	inc	[bp+var_2]
loc_22233:
	cmp	[bp+var_2], 7
	jge	short loc_2226B
	getCharP	[bp+var_2], bx
	cmp	gs:roster.class[bx], class_illusion
	jnz	short loc_2225B
	getCharP	[bp+var_2], bx
	mov	gs:roster.class[bx], class_monster
loc_2225B:
	getCharP	[bp+var_2], bx
	and	gs:roster.status[bx], stat_old or stat_unknown
	jmp	short loc_22230
loc_2226B:
	cmp	gs:byte_422A4, 0
	jz	short loc_222BB
	mov	al, 14h
	mov	gs:byte_42440, al
	mov	gs:byte_41E70, al
	mov	gs:antiMagicFlag, al
	mov	gs:byte_4244E, al
	mov	gs:songExtraAttack, 8
	mov	gs:bat_curTarget, 80h
	mov	ax, 0CEh 
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_22821
	add	sp, 4
loc_222BB:
	mov	sp, bp
	pop	bp
	retf
sp_divineIntervention endp

; Attributes: bp-based frame

dun_removeTrap proc far

	var_4= dword ptr -4
	row= word ptr  6
	column=	word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	bx, [bp+row]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr gs:rowOffset[bx]
	mov	dx, word ptr gs:(rowOffset+2)[bx]
	mov	cx, [bp+column]
	mov	bx, cx
	shl	cx, 1
	shl	cx, 1
	add	cx, bx
	add	ax, cx
	add	ax, 2
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	lfs	bx, [bp+var_4]
	and	byte ptr fs:[bx], 0EFh
	mov	sp, bp
	pop	bp
	retf
dun_removeTrap endp

dun_maskSquare proc far

	var_4=	dword ptr -4
	row=	word ptr 6
	column=	word ptr 8
	_byte=	word ptr 0Ah
	_mask=  byte ptr 0Ch

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	bx, [bp+row]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr gs:rowOffset[bx]
	mov	dx, word ptr gs:(rowOffset+2)[bx]
	mov	cx, [bp+column]
	mov	bx, cx
	shl	cx, 1
	shl	cx, 1
	add	cx, bx
	add	ax, cx
	add	ax, [bp+_byte]
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	mov	al, [bp+_mask]
	lfs	bx, [bp+var_4]
	and	byte ptr fs:[bx], al
	mov	sp, bp
	pop	bp
	retf
dun_maskSquare endp
	

; Attributes: bp-based frame

sub_22300 proc far

	sqP= dword ptr -4
	row= word ptr  6
	column=	word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	bx, [bp+row]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr gs:rowOffset[bx]
	mov	dx, word ptr gs:(rowOffset+2)[bx]
	mov	cx, [bp+column]
	mov	bx, cx
	shl	cx, 1
	shl	cx, 1
	add	cx, bx
	add	ax, cx
	add	ax, 4
	mov	word ptr [bp+sqP], ax
	mov	word ptr [bp+sqP+2], dx
	lfs	bx, [bp+sqP]
	or	byte ptr fs:[bx], 1
	mov	sp, bp
	pop	bp
	retf
sub_22300 endp

; Attributes: bp-based frame
dun_revealSpSquare proc	far

	sqP= dword ptr -4
	row= word ptr  6
	column=	word ptr  8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	bx, [bp+row]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr gs:rowOffset[bx]
	mov	dx, word ptr gs:(rowOffset+2)[bx]
	mov	cx, [bp+column]
	mov	bx, cx
	shl	cx, 1
	shl	cx, 1
	add	cx, bx
	add	ax, cx
	mov	word ptr [bp+sqP], ax
	mov	word ptr [bp+sqP+2], dx
	mov	bx, [bp+arg_4]
	mov	bl, geoSpMasks[bx-2]._byte
	sub	bh, bh
	lfs	si, [bp+sqP]
	mov	al, fs:[bx+si]
	sub	ah, ah
	mov	bx, [bp+arg_4]
	mov	cl, geoSpMasks[bx-2].bitmask
	sub	ch, ch
	test	ax, cx
	jz	short loc_2239C
	mov	bx, si
	or	byte ptr fs:[bx+4], 4
	jmp	short loc_223A4
loc_2239C:
	lfs	bx, [bp+sqP]
	and	byte ptr fs:[bx+4], 0FBh
loc_223A4:
	pop	si
	mov	sp, bp
	pop	bp
	retf
dun_revealSpSquare endp

; Attributes: bp-based frame

sp_geomancerSpell proc far

	row= word ptr -8
	var_6= word ptr	-6
	var_4= word ptr	-4
	column=	word ptr -2
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	cmp	inDungeonMaybe, 0
	jz	short loc_2241E
	mov	bx, [bp+arg_2]
	mov	al, spellEffectFlags[bx]
	sub	ah, ah
	mov	[bp+var_6], ax
	sar	ax, 1
	mov	[bp+var_4], ax
	mov	[bp+row], 0
	jmp	short loc_223DB
loc_223D8:
	inc	[bp+row]
loc_223DB:
	mov	al, dunHeight
	sub	ah, ah
	cmp	ax, [bp+row]
	jbe	short loc_2241E
	mov	[bp+column], 0
	jmp	short loc_223F4
loc_223F1:
	inc	[bp+column]
loc_223F4:
	mov	al, dunWidth
	sub	ah, ah
	cmp	ax, [bp+column]
	jbe	short loc_2241C
	push	[bp+var_6]
	push	[bp+column]
	push	[bp+row]
	mov	bx, [bp+var_4]
	shl	bx, 1
	shl	bx, 1
	call	geoSpList[bx]
	add	sp, 6
	jmp	short loc_223F1
loc_2241C:
	jmp	short loc_223D8
loc_2241E:
	mov	sp, bp
	pop	bp
	retf
sp_geomancerSpell endp

; Attributes: bp-based frame

_sp_useLightObj	proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, offset aMakesALight
	push	ds
	push	ax
	call	printString
	add	sp, 4
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr sp_lightSpell
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
_sp_useLightObj	endp

; Attributes: bp-based frame

_sp_useAcorn proc far

	arg_0= byte ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, offset aAteIt_
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	al, [bp+arg_0]
	mov	gs:bat_curTarget, al
	mov	ax, 94h	
	push	ax
	push	word ptr [bp+arg_0]
	push	cs
	call	near ptr sub_22821
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
_sp_useAcorn endp

; Attributes: bp-based frame

_sp_useWineskin	proc far

	var_106= word ptr -106h
	var_104= word ptr -104h
	var_102= word ptr -102h
	var_100= word ptr -100h
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 106h
	call	someStackOperation
	push	si
	getCharP	[bp+arg_0], bx
	mov	al, gs:byte_4227E
	sub	ah, ah
	add	bx, ax
	mov	al, gs:roster.inventory.itemFlags[bx]
	shr	ax, 1
	shr	ax, 1
	and	ax, 7
	mov	[bp+var_106], ax
	mov	ax, offset aDrinksAndFeels
	push	ds
	push	ax
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_104], ax
	mov	[bp+var_102], dx
	mov	bx, [bp+var_106]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (off_47D32+2)[bx]
	push	word ptr off_47D32[bx]
	push	dx
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_104], ax
	mov	[bp+var_102], dx
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	cmp	[bp+var_106], 1
	jnz	short loc_2252F
	getCharP	[bp+arg_0], si
	cmp	gs:roster.class[si], class_bard
	jnz	short loc_2252F
	push	gs:roster.level[si]
	push	cs
	call	near ptr _returnXor255
	add	sp, 2
	mov	gs:roster.specAbil[si],	al
	jmp	short loc_22548
loc_2252F:
	mov	al, byte ptr [bp+arg_0]
	mov	gs:bat_curTarget, al
	mov	ax, 94h	
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr sub_22821
	add	sp, 4
loc_22548:
	pop	si
	mov	sp, bp
	pop	bp
	retf
_sp_useWineskin	endp

; Attributes: bp-based frame

printCantFindUse proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, offset aCanTSeemToFind
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
printCantFindUse endp

; Attributes: bp-based frame

_sp_useWeapon proc far

	var_10=	word ptr -10h
	var_E= byte ptr	-0Eh
	var_D= byte ptr	-0Dh
	var_C= byte ptr	-0Ch
	var_B= byte ptr	-0Bh
	var_A= byte ptr	-0Ah
	var_9= byte ptr	-9
	var_8= byte ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	charNo=	word ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 10h
	call	someStackOperation
	push	di
	push	si
	getCharP	[bp+charNo], bx
	mov	al, gs:byte_4227E
	sub	ah, ah
	add	bx, ax
	mov	al, gs:roster.inventory.itemNo[bx]
	mov	[bp+var_6], ax
	mov	[bp+var_10], 31
	jmp	short loc_2259F
loc_2259C:
	dec	[bp+var_10]
loc_2259F:
	cmp	[bp+var_10], 0
	jge	short loc_225A8
	jmp	loc_22632
loc_225A8:
	mov	bx, [bp+var_10]
	mov	al, byte_48382[bx]
	sub	ah, ah
	cmp	ax, [bp+var_6]
	jnz	short loc_2262F
	cmp	bx, 17h
	jge	short loc_225C0
	mov	ax, offset aCastsAWeapon
	jmp	short loc_225C3
loc_225C0:
	mov	ax, offset aBreathes
loc_225C3:
	mov	[bp+var_4], ax
	mov	[bp+var_2], ds
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	ax, [bp+var_10]
	mov	cx, ax
	shl	ax, 1
	add	ax, cx
	shl	ax, 1
	mov	si, ax
	mov	al, byte ptr weaponDamageList.effectStrIndex[si]
	mov	[bp+var_E], al
	mov	al, weaponDamageList.elements[si]
	mov	[bp+var_D], al
	mov	[bp+var_C], 10h
	mov	[bp+var_B], 0
	mov	al, weaponDamageList.repelFlags[si]
	mov	[bp+var_A], al
	mov	al, weaponDamageList.damage[si]
	mov	[bp+var_9], al
	mov	al, weaponDamageList.targetFlags[si]
	mov	[bp+var_8], al
	mov	al, weaponDamageList.levelMult[si]
	sub	ah, ah
	push	ax
	sub	sp, 8
	push	si
	lea	si, [bp+var_E]
	mov	di, sp
	add	di, 2
	push	ss
	pop	es
	assume es:nothing
	movsw
	movsw
	movsw
	movsb
	pop	si
	push	[bp+charNo]
	push	cs
	call	near ptr bat_doBreathAttack
	add	sp, 0Ch
loc_2262F:
	jmp	loc_2259C
loc_22632:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
_sp_useWeapon endp

; Attributes: bp-based frame
_sp_reenergizeMage proc	far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	getCharP	[bp+arg_0], si
	mov	ax, gs:roster.maxSppt[si]
	mov	gs:roster.currentSppt[si], ax
	mov	ax, offset aIsReEnergized
	push	ds
	push	ax
	call	printString
	add	sp, 4
	pop	si
	mov	sp, bp
	pop	bp
	retf
_sp_reenergizeMage endp

; Attributes: bp-based frame

_sp_useFigurine	proc far

	counter= word ptr -4
	itemNo=	word ptr -2
	charNo=	word ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	ax, offset aInvokesAFiguri
	push	ds
	push	ax
	call	printString
	add	sp, 4
	getCharP	[bp+charNo], bx
	mov	al, gs:byte_4227E
	sub	ah, ah
	add	bx, ax
	mov	al, gs:roster.inventory.itemNo[bx]
	mov	[bp+itemNo], ax
	mov	[bp+counter], 8
	jmp	short loc_226AD
loc_226AA:
	dec	[bp+counter]
loc_226AD:
	cmp	[bp+counter], 0
	jle	short loc_226D5
	mov	bx, [bp+counter]
	mov	al, figurineItemNo[bx]
	sub	ah, ah
	cmp	ax, [bp+itemNo]
	jnz	short loc_226D3
	mov	al, byte_483AC[bx]
	push	ax
	push	[bp+charNo]
	call	doSummon
	add	sp, 4
	jmp	short loc_226D5
loc_226D3:
	jmp	short loc_226AA
loc_226D5:
	mov	sp, bp
	pop	bp
	retf
_sp_useFigurine	endp

; Attributes: bp-based frame

rnd_Xd4	proc far

	rval= word ptr -2
	numOfDice= word	ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+rval], 0
	jmp	short loc_226EE
loc_226EB:
	dec	[bp+numOfDice]
loc_226EE:
	cmp	[bp+numOfDice],	0
	jle	short loc_22702
	call	_random
	and	ax, 3
	inc	ax
	add	[bp+rval], ax
	jmp	short loc_226EB
loc_22702:
	mov	ax, [bp+rval]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
rnd_Xd4	endp

; Attributes: bp-based frame
bat_isPartyInRange proc	far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	charNo=	word ptr  6
	rangeMaybe= word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	cmp	gs:bat_curTarget, 80h
	jnb	short loc_2272E
	cmp	[bp+charNo], 80h
	jge	short loc_2272E
	mov	ax, 1
	jmp	short loc_227A2
loc_2272E:
	test	byte ptr [bp+rangeMaybe], 80h
	jz	short loc_22744
	mov	ax, [bp+rangeMaybe]
	and	ax, 7Fh
	mov	[bp+var_8], ax
	shl	ax, 1
	mov	[bp+var_2], ax
	jmp	short loc_2274F
loc_22744:
	mov	ax, [bp+rangeMaybe]
	mov	[bp+var_8], ax
	mov	[bp+var_2], 0
loc_2274F:
	cmp	gs:bat_curTarget, 80h
	jb	short loc_22763
	mov	al, gs:bat_curTarget
	sub	ah, ah
	jmp	short loc_22766
loc_22763:
	mov	ax, [bp+charNo]
loc_22766:
	mov	[bp+var_6], ax
	and	ax, 3
	getMonIndex	cx, cx
	mov	bx, ax
	mov	al, gs:monGroups.distance[bx]
	sub	ah, ah
	and	ax, 0Fh
	mov	[bp+var_4], ax
	mov	ax, [bp+var_8]
	cmp	[bp+var_4], ax
	jg	short loc_22791
	mov	ax, 1
	jmp	short loc_227A2
loc_22791:
	mov	ax, [bp+var_2]
	cmp	[bp+var_4], ax
	jg	short loc_2279E
	mov	ax, 2
	jmp	short loc_227A0
loc_2279E:
	sub	ax, ax
loc_227A0:
	jmp	short $+2
loc_227A2:
	mov	sp, bp
	pop	bp
	retf
bat_isPartyInRange endp

; Attributes: bp-based frame
spell_cast proc	far

	var_2= word ptr	-2
	charNo=	word ptr  6
	spellNo= word ptr  8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	cmp	[bp+arg_4], 0
	jnz	short loc_227E2
	mov	ax, [bp+spellNo]
	mov	curSpellNo, ax
	mov	ax, 1
	push	ax
	push	gs:mapDataSeg
	push	gs:mapDataOff
	call	map_execute
	add	sp, 6
	or	ax, ax
	jz	short loc_227E2
	jmp	short loc_2281D
loc_227E2:
	cmp	[bp+arg_4], 0
	jz	short loc_227F8
	mov	bx, [bp+spellNo]
	test	byte_47F94[bx],	8
	jnz	short loc_227F6
	sub	ax, ax
	jmp	short loc_2281D
loc_227F6:
	jmp	short loc_22806
loc_227F8:
	mov	bx, [bp+spellNo]
	test	byte_47F94[bx],	10h
	jnz	short loc_22806
	sub	ax, ax
	jmp	short loc_2281D
loc_22806:
	push	[bp+spellNo]
	push	[bp+charNo]
	mov	bx, [bp+spellNo]
	shl	bx, 1
	shl	bx, 1
	call	spellFuncList[bx]
	add	sp, 4
	mov	[bp+var_2], ax
loc_2281D:
	mov	sp, bp
	pop	bp
	retf
spell_cast endp

; Attributes: bp-based frame

sub_22821 proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	mov	al, byte_4EEC3
	sub	ah, ah
	mov	[bp+var_4], ax
	mov	al, byte_4EEC4
	mov	[bp+var_6], ax
	cmp	[bp+arg_2], 80h
	jge	short loc_2285D
	mov	byte_4EEC3, ah
	mov	byte_4EEC4, ah
loc_2285D:
	and	[bp+arg_2], 7Fh
	push	[bp+arg_2]
	push	[bp+arg_0]
	mov	bx, [bp+arg_2]
	shl	bx, 1
	shl	bx, 1
	call	spellFuncList[bx]
	add	sp, 4
	mov	[bp+var_2], ax
	mov	al, byte ptr [bp+var_4]
	mov	byte_4EEC3, al
	mov	al, byte ptr [bp+var_6]
	mov	byte_4EEC4, al
	mov	sp, bp
	pop	bp
	retf
sub_22821 endp

; Attributes: bp-based frame

_sp_checkSPPT proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	cmp	[bp+arg_0], 80h
	jl	short loc_228A9
	mov	ax, 1
	jmp	short loc_228E9
loc_228A9:
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	cs
	call	near ptr getSpptRequired
	add	sp, 4
	mov	[bp+var_2], ax
	mov	cx, ax
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.currentSppt[bx], cx
	jnb	short loc_228D2
	sub	ax, ax
	jmp	short loc_228E9
loc_228D2:
	mov	ax, [bp+var_2]
	mov	cx, ax
	getCharP	[bp+arg_0], bx
	sub	gs:roster.currentSppt[bx], cx
	mov	ax, 1
	jmp	short $+2
loc_228E9:
	mov	sp, bp
	pop	bp
	retf
_sp_checkSPPT endp

; Attributes: bp-based frame

bat_getTargetName proc far

	var_10=	word ptr -10h
	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah
	arg_6= word ptr	 0Ch

	push	bp
	mov	bp, sp
	mov	ax, 10h
	call	someStackOperation
	cmp	[bp+arg_4], 80h
	jge	short loc_22927
	getCharP	[bp+arg_4], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+arg_0], ax
	mov	word ptr [bp+arg_0+2], dx
	jmp	loc_229B5
loc_22927:
	and	[bp+arg_4], 3
	lea	ax, [bp+var_10]
	push	ss
	push	ax
	getMonP	[bp+arg_4], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	decryptName
	add	sp, 8
	cmp	[bp+arg_6], 0
	jz	short loc_2296A
	mov	ax, offset aSome
	push	ds
	push	ax
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+arg_0], ax
	mov	word ptr [bp+arg_0+2], dx
	jmp	short loc_22999
loc_2296A:
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], 'a'
	mov	al, byte ptr [bp+var_10]
	cbw
	push	ax
	call	str_startsWithVowel
	add	sp, 2
	or	ax, ax
	jz	short loc_2298F
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], 'n'
loc_2298F:
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	byte ptr fs:[bx], ' '
loc_22999:
	push	[bp+arg_6]
	push	word ptr [bp+arg_0+2]
	push	word ptr [bp+arg_0]
	lea	ax, [bp+var_10]
	push	ss
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	word ptr [bp+arg_0], ax
	mov	word ptr [bp+arg_0+2], dx
loc_229B5:
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
locret_229C0:
	retf
bat_getTargetName endp

seg010 ends

; Segment type:	Pure code
seg011 segment word public 'CODE' use16
	assume cs:seg011
;org 1
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
algn_229C1:
align 2
; Attributes: bp-based frame

song_getNonCombatSinger	proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	call	clearTextWindow
	mov	ax, offset aWhoWillPlay?
	push	ds
	push	ax
	call	printString
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_6], ax
	or	ax, ax
	jl	short loc_22A5A
	push	ax
	push	cs
	call	near ptr sing_getSongSubtractor
	add	sp, 2
	mov	[bp+var_4], ax
	push	[bp+var_6]
	push	cs
	call	near ptr _canSingSong
	add	sp, 2
	or	ax, ax
	jz	short loc_22A4E
	cmp	[bp+var_4], 0
	jl	short loc_22A4E
	call	clearTextWindow
	sub	ax, ax
	push	ax
	push	[bp+var_6]
	push	cs
	call	near ptr song_getSong
	add	sp, 4
	mov	[bp+var_2], ax
	or	ax, ax
	jl	short loc_22A4E
	push	cs
	call	near ptr sub_22DA1
	push	[bp+var_2]
	push	[bp+var_6]
	push	cs
	call	near ptr sub_22CD5
	add	sp, 4
	push	cs
	call	near ptr song_doNoncombatEffect
	mov	al, byte ptr [bp+var_4]
	mov	cx, ax
	getCharP	[bp+var_6], bx
	sub	gs:roster.specAbil[bx],	cl
loc_22A4E:
	wait4IO
loc_22A5A:
	call	clearTextWindow
	mov	sp, bp
	pop	bp
	retf
song_getNonCombatSinger	endp

; Attributes: bp-based frame

_canSingSong proc far

	charNo=	word ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	getCharP	[bp+charNo], bx
	test	gs:roster.status[bx], stat_dead	or stat_stoned or stat_paralyzed
	jz	short loc_22A85
	sub	ax, ax
	jmp	short loc_22AF4
loc_22A85:
	getCharP	[bp+charNo], bx
	cmp	gs:roster.class[bx], class_bard
	jz	short loc_22AA6
	mov	ax, offset aNotABard
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	sub	ax, ax
	jmp	short loc_22AF4
loc_22AA6:
	mov	ax, itType_instrument
	push	ax
	push	[bp+charNo]
	call	inven_hasTypeEquipped
	add	sp, 4
	or	ax, ax
	jz	short loc_22AE3
	getCharP	[bp+charNo], bx
	cmp	gs:roster.specAbil[bx],	0
	jz	short loc_22AD2
	mov	ax, 1
	jmp	short loc_22AF4
loc_22AD2:
	mov	ax, offset aYourThroatIsDr
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	sub	ax, ax
	jmp	short loc_22AF4
loc_22AE3:
	mov	ax, offset aYouArenTUsingA
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	sub	ax, ax
	jmp	short $+2
loc_22AF4:
	mov	sp, bp
	pop	bp
	retf
_canSingSong endp

; This function	returns	1 if the character is active,
; a bard and has an instrument equipped. 0 otherwise.
; Attributes: bp-based frame

_charCanPlaySong proc far

	charNo=	word ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	getCharP	[bp+charNo], si
	test	gs:roster.status[si], stat_dead	or stat_stoned or stat_paralyzed
	jnz	short loc_22B1F
	cmp	gs:roster.class[si], class_bard
	jz	short loc_22B23
loc_22B1F:
	sub	ax, ax
	jmp	short loc_22B34
loc_22B23:
	mov	ax, itType_instrument
	push	ax
	push	[bp+charNo]
	call	inven_hasTypeEquipped
	add	sp, 4
	jmp	short $+2
loc_22B34:
	pop	si
	mov	sp, bp
	pop	bp
	retf
_charCanPlaySong endp

; This function	returns	the amount of songs that
; should be subtracted from the	bards' songsLeft
; field. If an item with itemEff_freeSinging is
; equipped, return 0. If the bard has songs left,
; return 1. Otherwise return -1.
; Attributes: bp-based frame

sing_getSongSubtractor proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, itemEff_freeSinging
	push	ax
	push	[bp+arg_0]
	call	hasEffectEquipped
	add	sp, 4
	or	ax, ax
	jnz	short loc_22B5A
	sub	ax, ax
	jmp	short loc_22B78
loc_22B5A:
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.specAbil[bx],	0
	jz	short loc_22B73
	mov	ax, 1
	jmp	short loc_22B76
loc_22B73:
	mov	ax, 0FFFFh
loc_22B76:
	jmp	short $+2
loc_22B78:
	mov	sp, bp
	pop	bp
	retf
sing_getSongSubtractor endp

; Attributes: bp-based frame

song_getSong proc far

	var_22C= word ptr -22Ch
	var_72=	word ptr -72h
	string=	word ptr -34h
	counter= word ptr -1Ch
	stringP= dword ptr -1Ah
	var_16=	word ptr -16h
	var_14=	word ptr -14h
	var_12=	word ptr -12h
	var_10=	word ptr -10h
	charNo=	word ptr  6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 34h	
	call	someStackOperation
	push	si
	sub	ax, ax
	mov	[bp+var_12], ax
	mov	[bp+var_16], ax
	mov	[bp+counter], ax
	jmp	short loc_22B98
loc_22B95:
	inc	[bp+counter]
loc_22B98:
	cmp	[bp+counter], 8
	jl	short loc_22BA1
	jmp	loc_22C40
loc_22BA1:
	getCharP	[bp+charNo], bx
	mov	al, gs:(roster.specAbil+1)[bx]
	sub	ah, ah
	mov	bx, [bp+counter]
	mov	cl, byteMaskList[bx]
	sub	ch, ch
	test	ax, cx
	jz	short loc_22C3D
	lea	ax, [bp+string]
	mov	word ptr [bp+stringP], ax
	mov	word ptr [bp+stringP+2], ss
	mov	si, [bp+var_16]
	shl	si, 1
	mov	ax, bx
	mov	[bp+si+var_10],	ax
	lfs	bx, [bp+stringP]
	inc	word ptr [bp+stringP]
	mov	ax, [bp+var_16]
	inc	[bp+var_16]
	add	al, '1'
	mov	fs:[bx], al
	lfs	bx, [bp+stringP]
	inc	word ptr [bp+stringP]
	mov	byte ptr fs:[bx], ')'
	mov	bx, [bp+counter]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (songNames+2)[bx]
	push	word ptr songNames[bx]
	push	word ptr [bp+stringP+2]
	push	word ptr [bp+stringP]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+stringP], ax
	mov	word ptr [bp+stringP+2], dx
	lea	ax, [bp+string]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	bl, gs:txt_numLines
	sub	bh, bh
	shl	bx, 1
	mov	ax, bitMask16bit[bx]
	or	[bp+var_12], ax
loc_22C3D:
	jmp	loc_22B95
loc_22C40:
	mov	ax, bitMask16bit+16h
	or	[bp+var_12], ax
	cmp	[bp+arg_2], 0
	jz	short loc_22C5E
	mov	ax, offset aStopPlayingASo
	push	ds
	push	ax
	call	printString
	add	sp, 4
loc_22C5E:
	push	[bp+var_12]
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_14], ax
	cmp	ax, 1Bh
	jz	short loc_22C76
	cmp	ax, 119h
	jnz	short loc_22C7B
loc_22C76:
	mov	ax, 0FFFFh
	jmp	short loc_22CD0
loc_22C7B:
	cmp	[bp+arg_2], 0
	jz	short loc_22C96
	cmp	[bp+var_14], 'S'
	jnz	short loc_22C96
	push	[bp+charNo]
	push	cs
	call	near ptr song_stopPlaying
	add	sp, 2
	mov	ax, 0FFFFh
	jmp	short loc_22CD0
loc_22C96:
	cmp	[bp+var_14], 10Eh
	jl	short loc_22CB3
	mov	ax, [bp+var_16]
	add	ax, 10Eh
	cmp	ax, [bp+var_14]
	jl	short loc_22CB3
	mov	si, [bp+var_14]
	shl	si, 1
	mov	ax, [bp+si+var_22C]
	jmp	short loc_22CD0
loc_22CB3:
	cmp	[bp+var_14], '0'
	jle	short loc_22CCE
	mov	ax, [bp+var_16]
	add	ax, '0'
	cmp	ax, [bp+var_14]
	jl	short loc_22CCE
	mov	si, [bp+var_14]
	shl	si, 1
	mov	ax, [bp+si+var_72]
	jmp	short loc_22CD0
loc_22CCE:
	jmp	short loc_22C5E
loc_22CD0:
	pop	si
	mov	sp, bp
	pop	bp
	retf
song_getSong endp

; Attributes: bp-based frame

sub_22CD5 proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= byte ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	al, byte ptr [bp+arg_0]
	mov	gs:byte_41E62, al
	mov	byte_4EEBC, 5
	mov	al, [bp+arg_2]
	inc	al
	mov	gs:byte_4266B, al
	mov	al, [bp+arg_2]
	mov	gs:byte_42420, al
	call	song_endMusic
	mov	ax, offset byte_40420
	mov	dx, seg	seg026
	push	dx
	push	ax
	mov	bx, word ptr [bp+arg_2]
	shl	bx, 1
	shl	bx, 1
	push	gs:musicBufs._segment[bx]
	push	word ptr gs:musicBufs._offset[bx]
	call	d3comp
	add	sp, 8
	mov	ax, itType_instrument
	push	ax
	push	[bp+arg_0]
	call	inven_getTypeEqSlot
	add	sp, 4
	mov	[bp+var_4], ax
	inc	ax
	jz	short loc_22D59
	mov	bx, [bp+var_4]
	mov	al, byte_48820[bx]
	cbw
	mov	[bp+var_2], ax
	jmp	short loc_22D5E
loc_22D59:
	mov	[bp+var_2], 0
loc_22D5E:
	push	[bp+var_2]
	mov	ax, offset byte_40420
	mov	dx, seg	seg026
	push	dx
	push	ax
	call	song_initSound
	add	sp, 6
	mov	sp, bp
	pop	bp
	retf
sub_22CD5 endp

; Attributes: bp-based frame

song_stopPlaying proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	al, gs:byte_41E62
	sub	ah, ah
	cmp	ax, [bp+arg_0]
	jnz	short loc_22D9D
	cmp	gs:byte_4266B, ah
	jz	short loc_22D9D
	push	cs
	call	near ptr sub_22DA1
loc_22D9D:
	mov	sp, bp
	pop	bp
	retf
song_stopPlaying endp

; Attributes: bp-based frame

sub_22DA1 proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	cs
	call	near ptr song_endNoncombatEffect
	call	song_endMusic
	mov	sp, bp
	pop	bp
	retf
sub_22DA1 endp

; Attributes: bp-based frame

song_doNoncombatEffect proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	al, gs:byte_42420
	sub	ah, ah
	jmp	loc_22EA5
loc_22DCF:
	mov	gs:songAntiMonster, 1
	jmp	loc_22ED1
loc_22DDC:
	mov	al, charSize
	mul	gs:byte_41E62
	mov	bx, ax
	cmp	gs:roster.level[bx], 60
	jnb	short loc_22E11
	mov	al, charSize
	mul	gs:byte_41E62
	mov	bx, ax
	mov	ax, gs:roster.level[bx]
	shr	ax, 1
	shr	ax, 1
	jmp	short loc_22E13
loc_22E11:
	mov	al, 15
loc_22E13:
	mov	gs:songACBonus,	al
	or	al, al
	jnz	short loc_22E24
	inc	gs:songACBonus
loc_22E24:
	mov	byte ptr word_44166,	0
	jmp	loc_22ED1
loc_22E31:
	mov	gs:songRegenSppt, 1
	jmp	loc_22ED1
loc_22E3E:
	mov	lightDistance, 5
	mov	lightDuration, 0FFh
	mov	gs:byte_41E61, 0FFh
	sub	ax, ax
	push	ax
	call	icon_activate
	add	sp, 2
	jmp	short loc_22ED1
loc_22E69:
	mov	compassDuration, 0FFh
	mov	ax, 1
	push	ax
	call	icon_activate
	add	sp, 2
	jmp	short loc_22ED1
loc_22E81:
	mov	gs:songHalfDamage, 1
	mov	shieldDuration, 0FFh
	mov	ax, 3
	push	ax
	call	icon_activate
	add	sp, 2
loc_22EA1:
	jmp	short loc_22ED1
	jmp	short loc_22ED1
loc_22EA5:
	cmp	ax, song_safety
	jnz	short loc_22EAD
	jmp	loc_22DCF
loc_22EAD:
	cmp	ax, song_sanctuary
	jnz	short loc_22EB5
	jmp	loc_22DDC
loc_22EB5:
	cmp	ax, song_duotime
	jnz	short loc_22EBD
	jmp	loc_22E31
loc_22EBD:
	cmp	ax, song_watchwood
	jnz	short loc_22EC5
	jmp	loc_22E3E
loc_22EC5:
	cmp	ax, song_overture
	jz	short loc_22E69
	cmp	ax, song_shield
	jz	short loc_22E81
	jmp	short loc_22EA1
loc_22ED1:
	mov	sp, bp
	pop	bp
	retf
song_doNoncombatEffect endp

; Attributes: bp-based frame

song_endNoncombatEffect	proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	gs:byte_4266B, 0
	jnz	short loc_22EEE
	jmp	loc_22F9A
loc_22EEE:
	mov	gs:byte_4266B, 0
	cmp	gs:byte_41E62, 7
	jb	short loc_22F03
	jmp	loc_22F9A
loc_22F03:
	mov	al, gs:byte_42420
	sub	ah, ah
	jmp	short loc_22F7A
loc_22F0F:
	mov	gs:songAntiMonster, 0
	jmp	short loc_22F9A
loc_22F1B:
	mov	gs:songACBonus,	0
	mov	byte ptr word_44166,	0
	jmp	short loc_22F9A
loc_22F31:
	mov	gs:songRegenSppt, 0
	jmp	short loc_22F9A
loc_22F3D:
	mov	lightDistance, 0
	sub	ax, ax
	push	ax
	call	sub_17920
	add	sp, 2
	mov	gs:byte_41E61, 0
	jmp	short loc_22F9A
loc_22F5E:
	mov	ax, 1
	push	ax
	call	sub_17920
	add	sp, 2
	jmp	short loc_22F9A
loc_22F6C:
	mov	gs:songHalfDamage, 0
loc_22F76:
	jmp	short loc_22F9A
	jmp	short loc_22F9A
loc_22F7A:
	cmp	ax, song_safety
	jz	short loc_22F0F
	cmp	ax, song_sanctuary
	jz	short loc_22F1B
	cmp	ax, song_duotime
	jz	short loc_22F31
	cmp	ax, song_watchwood
	jz	short loc_22F3D
	cmp	ax, song_overture
	jz	short loc_22F5E
	cmp	ax, song_shield
	jz	short loc_22F6C
	jmp	short loc_22F76
loc_22F9A:
	mov	sp, bp
	pop	bp
locret_22F9D:
	retf
song_endNoncombatEffect	endp

seg011 ends

; Segment type:	Pure code
seg012 segment byte public 'CODE' use16
	assume cs:seg012
;org 0Eh
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
; This function	is useless....
; Attributes: bp-based frame
_returnValueOrFFFF proc	far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	[bp+arg_2], 0
	jnz	short loc_22FB4
	cmp	[bp+arg_0], 0FFFFh
	jbe	short loc_22FBE
loc_22FB4:
	mov	[bp+arg_0], 0FFFFh
	mov	[bp+arg_2], 0
loc_22FBE:
	mov	ax, [bp+arg_0]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
_returnValueOrFFFF endp

; Attributes: bp-based frame

sub_22FC7 proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	[bp+arg_2], 0FFh
	jb	short loc_22FEA
	ja	short loc_22FE0
	cmp	[bp+arg_0], 0FFFFh
	jbe	short loc_22FEA
loc_22FE0:
	mov	[bp+arg_0], 0FFFFh
	mov	[bp+arg_2], 0FFh
loc_22FEA:
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
locret_22FF5:
	retf
sub_22FC7 endp

; Attributes: bp-based frame

rev_enter proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
loc_23001:
	and	byte_4EE71, 0FDh
	push	cs
	call	near ptr sub_24126
	test	byte_4EE71, 2
	jz	short loc_23020
	sub	ax, ax
	jmp	loc_23119
loc_23020:
	push	cs
	call	near ptr rev_doQuest
	test	byte_4EE71, 2
	jnz	short loc_23001
loc_23030:
	mov	ax, offset aTheLastOfTheGu
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	[bp+var_2], 0
	mov	[bp+var_6], 0
	jmp	short loc_2304C
loc_23049:
	inc	[bp+var_6]
loc_2304C:
	cmp	[bp+var_6], 5
	jge	short loc_23070
	mov	bl, gs:txt_numLines
	sub	bh, bh
	sub	bx, [bp+var_6]
	shl	bx, 1
	mov	ax, bitMask16bit[bx]
	or	[bp+var_2], ax
	jmp	short loc_23049
loc_23070:
	push	[bp+var_2]
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_4], ax
	cmp	ax, 10Eh
	jl	short loc_23098
	cmp	ax, 119h
	jg	short loc_23098
	mov	al, gs:txt_numLines
	sub	ah, ah
	sub	ax, 4
	sub	[bp+var_4], ax
loc_23098:
	mov	ax, [bp+var_4]
	jmp	short loc_230D7
loc_2309D:
	sub	ax, ax
	push	ax
	push	cs
	call	near ptr rev_checkXP
	add	sp, 2
	jmp	short loc_23105
loc_230A9:
	sub	ax, ax
	push	ax
	push	cs
	call	near ptr rev_learnSpells
	add	sp, 2
	mov	byte ptr word_44166,	0
	jmp	short loc_23105
loc_230BF:
	push	cs
	call	near ptr rev_changeMageClass
	jmp	short loc_23105
loc_230C5:
	push	cs
	call	near ptr rev_speakToElder
	mov	byte ptr word_44166,	0
loc_230D3:
	jmp	short loc_23105
	jmp	short loc_23105
loc_230D7:
	cmp	ax, 'T'
	jz	short loc_230C5
	jg	short loc_230EF
	cmp	ax, 'A'
	jz	short loc_2309D
	cmp	ax, 'C'
	jz	short loc_230BF
	cmp	ax, 'S'
	jz	short loc_230A9
	jmp	short loc_230D3
loc_230EF:
	cmp	ax, 10Eh
	jz	short loc_2309D
	cmp	ax, 10Fh
	jz	short loc_230A9
	cmp	ax, 110h
	jz	short loc_230BF
	cmp	ax, 111h
	jz	short loc_230C5
	jmp	short loc_230D3
loc_23105:
	cmp	[bp+var_4], 'E'
	jz	short loc_23115
	cmp	[bp+var_4], 112h
	jz	short loc_23115
	jmp	loc_23030
loc_23115:
	sub	ax, ax
	jmp	short $+2
loc_23119:
	mov	sp, bp
	pop	bp
	retf
rev_enter endp

; Attributes: bp-based frame

rev_checkXP proc far

	var_10A= word ptr -10Ah
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 10Ah
	call	someStackOperation
loc_23128:
	mov	ax, offset aTheGuildElderP
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_6], ax
	or	ax, ax
	jge	short loc_23144
	jmp	loc_2329B
loc_23144:
	getCharP	[bp+var_6], bx
	test	gs:roster.status[bx], 0Ch
	jz	short loc_23174
	mov	ax, offset aHmmm___ShouldI
	push	ds
	push	ax
	lea	ax, [bp+var_10A]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	jmp	loc_23274
loc_23174:
	mov	ax, offset aTheGuildElderD
	push	ds
	push	ax
	lea	ax, [bp+var_10A]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	getCharP	[bp+var_6], bx
	lea	ax, roster._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	[bp+var_2]
	push	[bp+var_4]
	call	_strcat
	add	sp, 8
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	getCharP	[bp+var_6], bx
	cmp	gs:roster.class[bx], class_monster
	jnz	short loc_231E2
	mov	ax, offset aCannotBeRaised
	push	ds
	push	ax
	push	[bp+var_2]
	push	[bp+var_4]
	call	_strcat
	add	sp, 8
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	jmp	loc_23274
loc_231E2:
	push	[bp+var_6]
	push	cs
	call	near ptr rev_getXPDelta
	add	sp, 2
	mov	[bp+var_A], ax
	mov	[bp+var_8], dx
	or	dx, dx
	jg	short loc_23229
	jl	short loc_231FC
	or	ax, ax
	jnz	short loc_23229
loc_231FC:
	mov	ax, offset aHathEarnedALev
	push	ds
	push	ax
	push	[bp+var_2]
	push	[bp+var_4]
	call	_strcat
	add	sp, 8
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	push	dx
	push	ax
	push	[bp+var_6]
	push	cs
	call	near ptr rev_doAdvance
	add	sp, 6
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	jmp	short loc_23274
loc_23229:
	mov	ax, offset aStillNeedeth
	push	ds
	push	ax
	push	[bp+var_2]
	push	[bp+var_4]
	call	_strcat
	add	sp, 8
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	sub	ax, ax
	push	ax
	push	[bp+var_8]
	push	[bp+var_A]
	push	dx
	push	[bp+var_4]
	call	_itoa
	add	sp, 0Ah
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	mov	ax, offset aExperiencePoin
	push	ds
	push	ax
	push	dx
	push	[bp+var_4]
	call	_strcat
	add	sp, 8
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
loc_23274:
	lea	ax, [bp+var_10A]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	byte ptr word_44166,	0
	wait4IO
	jmp	loc_23128
loc_2329B:
	mov	sp, bp
	pop	bp
	retf
rev_checkXP endp

; Attributes: bp-based frame

rev_doAdvance proc far

	var_C= dword ptr -0Ch
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	charNo=	word ptr  6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 0Ch
	call	someStackOperation
	push	si
	getCharP	[bp+charNo], si
	inc	gs:roster.maxLevel[si]
	mov	ax, gs:roster.maxLevel[si]
	mov	gs:roster.level[si], ax
	push	[bp+charNo]
	push	cs
	call	near ptr _rev_removeAgeStatus
	add	sp, 2
	mov	[bp+var_8], ax
	getCharP	[bp+charNo], si
	call	_random
	mov	cx, ax
	getCharP	[bp+charNo], bx
	mov	bl, gs:roster.class[bx]
	sub	bh, bh
	mov	al, hpLevelBonusMask[bx]
	sub	ah, ah
	and	ax, cx
	mov	cl, gs:roster.constitution[si]
	sub	ch, ch
	shr	cx, 1
	shr	cx, 1
	add	ax, cx
	mov	[bp+var_4], ax
	mov	ax, gs:roster.currentHP[si]
	add	ax, [bp+var_4]
	sub	cx, cx
	push	cx
	push	ax
	push	cs
	call	near ptr _returnValueOrFFFF
	add	sp, 4
	mov	gs:roster.currentHP[si], ax
	getCharP	[bp+charNo], bx
	mov	ax, gs:roster.maxHP[bx]
	add	ax, [bp+var_4]
	sub	cx, cx
	push	cx
	push	ax
	push	cs
	call	near ptr _returnValueOrFFFF
	add	sp, 4
	mov	cx, ax
	getCharP	[bp+charNo], bx
	mov	gs:roster.maxHP[bx], cx
	getCharP	[bp+charNo], bx
	mov	al, gs:roster.class[bx]
	sub	ah, ah
	jmp	loc_23562
fighterLevelUp:
	getCharP	[bp+charNo], si
	mov	ax, gs:roster.level[si]
	dec	ax
	shr	ax, 1
	shr	ax, 1
	mov	[bp+var_2], ax
	cmp	ax, 8
	jge	short loc_2338C
	mov	al, byte ptr [bp+var_2]
	jmp	short loc_2338E
loc_2338C:
	mov	al, 7
loc_2338E:
	mov	gs:roster.numAttacks[si], al
	jmp	loc_23594
rogueLevelUp:
	call	rnd_1d8
	mov	cx, ax
	getCharP	[bp+charNo], bx
	mov	al, gs:roster.dexterity[bx]
	sub	ah, ah
	mov	dx, cx
	mov	cl, 3
	shr	ax, cl
	add	ax, dx
	mov	[bp+var_2], ax
	getCharP	[bp+charNo], bx
	mov	al, gs:roster.specAbil[bx]
	sub	ah, ah
	add	ax, [bp+var_2]
	push	ax
	call	_returnXor255
	add	sp, 2
	mov	cx, ax
	getCharP	[bp+charNo], bx
	mov	gs:roster.specAbil[bx],	cl
	call	rnd_1d8
	add	[bp+var_2], ax
	getCharP	[bp+charNo], bx
	mov	al, gs:(roster.specAbil+1)[bx]
	sub	ah, ah
	add	ax, [bp+var_2]
	push	ax
	call	_returnXor255
	add	sp, 2
	mov	cx, ax
	getCharP	[bp+charNo], bx
	mov	gs:(roster.specAbil+1)[bx], cl
	call	rnd_1d8
	add	[bp+var_2], ax
	getCharP	[bp+charNo], bx
	mov	al, gs:(roster.specAbil+2)[bx]
	sub	ah, ah
	add	ax, [bp+var_2]
	push	ax
	call	_returnXor255
	add	sp, 2
	mov	cx, ax
	getCharP	[bp+charNo], bx
	mov	gs:(roster.specAbil+2)[bx], cl
	jmp	loc_23594
bardLevelUp:
	getCharP	[bp+charNo], si
	push	gs:roster.level[si]
	call	_returnXor255
	add	sp, 2
	mov	gs:roster.specAbil[si],	al
	jmp	loc_23594
hunterLevelUp:
	call	rnd_1d8
	mov	cx, ax
	getCharP	[bp+charNo], bx
	mov	al, gs:roster.dexterity[bx]
	sub	ah, ah
	mov	dx, cx
	mov	cl, 3
	shr	ax, cl
	add	ax, dx
	mov	[bp+var_2], ax
	getCharP	[bp+charNo], bx
	mov	al, gs:roster.specAbil[bx]
	sub	ah, ah
	add	ax, [bp+var_2]
	push	ax
	call	_returnXor255
	add	sp, 2
	mov	cx, ax
	getCharP	[bp+charNo], bx
	mov	gs:roster.specAbil[bx],	cl
	jmp	loc_23594
mageLevelUp:
	call	_random
	and	ax, 3
	mov	cx, ax
	getCharP	[bp+charNo], bx
	mov	al, gs:roster.intelligence[bx]
	sub	ah, ah
	shr	ax, 1
	shr	ax, 1
	add	ax, cx
	inc	ax
	mov	[bp+var_2], ax
	getCharP	[bp+charNo], bx
	mov	ax, gs:roster.currentSppt[bx]
	add	ax, [bp+var_2]
	sub	cx, cx
	push	cx
	push	ax
	push	cs
	call	near ptr _returnValueOrFFFF
	add	sp, 4
	mov	cx, ax
	getCharP	[bp+charNo], bx
	mov	gs:roster.currentSppt[bx], cx
	getCharP	[bp+charNo], bx
	mov	ax, gs:roster.maxSppt[bx]
	add	ax, [bp+var_2]
	sub	cx, cx
	push	cx
	push	ax
	push	cs
	call	near ptr _returnValueOrFFFF
	add	sp, 4
	mov	cx, ax
	getCharP	[bp+charNo], bx
	mov	gs:roster.maxSppt[bx], cx
	jmp	short loc_23594
	jmp	short loc_23594
loc_23562:
	or	ax, ax
	jnz	short loc_23569
	jmp	fighterLevelUp
loc_23569:
	cmp	ax, class_rogue
	jnz	short loc_23571
	jmp	rogueLevelUp
loc_23571:
	cmp	ax, class_bard
	jnz	short loc_23579
	jmp	bardLevelUp
loc_23579:
	cmp	ax, class_paladin
	jnz	short loc_23581
	jmp	fighterLevelUp
loc_23581:
	cmp	ax, class_hunter
	jnz	short loc_23589
	jmp	hunterLevelUp
loc_23589:
	cmp	ax, class_monk
	jnz	short loc_23591
	jmp	fighterLevelUp
loc_23591:
	jmp	mageLevelUp
loc_23594:
	mov	ax, 4
	push	ax
	sub	ax, ax
	push	ax
	call	randomBetweenXandY
	add	sp, 4
	mov	[bp+var_6], ax
	getCharIndex	ax, [bp+charNo]
	add	ax, offset roster.strength
	mov	word ptr [bp+var_C], ax
	mov	word ptr [bp+var_C+2], seg seg027
	jmp	short loc_235BC
loc_235B9:
	inc	[bp+var_6]
loc_235BC:
	cmp	[bp+var_6], 5
	jge	short loc_23619
	mov	bx, [bp+var_6]
	lfs	si, [bp+var_C]
	cmp	byte ptr fs:[bx+si], 30
	jl	short loc_235D4
	mov	byte ptr fs:[bx+si], 30
	jmp	short loc_23617
loc_235D4:
	mov	bx, [bp+var_6]
	lfs	si, [bp+var_C]
	inc	byte ptr fs:[bx+si]
	mov	ax, offset a1To
	push	ds
	push	ax
	push	[bp+arg_4]
	push	[bp+arg_2]
	call	_strcat
	add	sp, 8
	mov	[bp+arg_2], ax
	mov	[bp+arg_4], dx
	mov	bx, [bp+var_6]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (fullAttributeString+2)[bx]
	push	word ptr fullAttributeString[bx]
	push	dx
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+arg_2], ax
	mov	[bp+arg_4], dx
	jmp	short loc_23619
loc_23617:
	jmp	short loc_235B9
loc_23619:
	cmp	[bp+var_8], 0
	jz	short loc_23629
	push	[bp+charNo]
	push	cs
	call	near ptr _rev_resetAgeStatus
	add	sp, 2
loc_23629:
	mov	ax, [bp+arg_2]
	mov	dx, [bp+arg_4]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
rev_doAdvance endp

; This function	returns	the difference between the
; player's experience points and the requirements
; for the next level.
; Attributes: bp-based frame

rev_getXPDelta proc far

	var_2= word ptr	-2
	playerNo= word ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	getCharP	[bp+playerNo], bx
	mov	ax, gs:roster.maxLevel[bx]
	mov	[bp+var_2], ax
	or	ax, ax
	jz	short loc_23689
	dec	ax
	push	ax
	push	[bp+playerNo]
	call	getXPForLevel
	add	sp, 4
	mov	cx, ax
	mov	bx, dx
	getCharP	[bp+playerNo], si
	mov	ax, cx
	mov	dx, bx
	sub	ax, word ptr gs:roster.experience[si]
	sbb	dx, word ptr gs:(roster.experience+2)[si]
	jmp	short loc_236A4
	jmp	short loc_236A4
loc_23689:
	getCharP	[bp+playerNo], bx
	mov	ax, word ptr gs:roster.experience[bx]
	mov	dx, word ptr gs:(roster.experience+2)[bx]
	neg	ax
	adc	dx, 0
	neg	dx
	jmp	short $+2
loc_236A4:
	pop	si
	mov	sp, bp
	pop	bp
	retf
rev_getXPDelta endp

; Attributes: bp-based frame

rev_learnSpells	proc far

	var_10E= word ptr -10Eh
	var_E= word ptr	-0Eh
	spellBase= word	ptr -0Ch
	counter= word ptr -0Ah
	var_8= word ptr	-8
	var_6= dword ptr -6
	charNo=	word ptr -2

	push	bp
	mov	bp, sp
	mov	ax, 10Eh
	call	someStackOperation
	push	si
	mov	ax, offset aWhoSeeksKnowle
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getCharNumber
	mov	[bp+charNo], ax
	or	ax, ax
	jge	short loc_236D1
	jmp	loc_238B7
loc_236D1:
	getCharP	[bp+charNo], bx
	mov	bl, gs:roster.class[bx]
	sub	bh, bh
	mov	al, mageSpellIndex[bx]
	sub	ah, ah
	mov	[bp+spellBase],	ax
	cmp	ax, 0FFh
	jnz	short loc_23707
	mov	ax, offset aThouArtNotASpe
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	jmp	loc_238B7
loc_23707:
	mov	[bp+counter], 0
	jmp	short loc_23711
loc_2370E:
	inc	[bp+counter]
loc_23711:
	cmp	[bp+counter], 7
	jge	short loc_2372F
	push	[bp+spellBase]
	push	[bp+counter]
	push	[bp+charNo]
	push	cs
	call	near ptr mage_hasLearnedSpLevel
	add	sp, 6
	or	ax, ax
	jnz	short loc_2372D
	jmp	short loc_2372F
loc_2372D:
	jmp	short loc_2370E
loc_2372F:
	cmp	[bp+counter], 6
	jle	short loc_23745
	mov	ax, offset aThouHathLearne
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	jmp	loc_238B7
loc_23745:
	getCharP	[bp+charNo], bx
	mov	ax, gs:roster.level[bx]
	inc	ax
	shr	ax, 1
	mov	cx, [bp+counter]
	inc	cx
	cmp	ax, cx
	jnb	short loc_23771
	mov	ax, offset aThouCannotAcqu
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	jmp	loc_238B7
loc_23771:
	getCharP	[bp+charNo], bx
	mov	bl, gs:roster.class[bx]
	sub	bh, bh
	shl	bx, 1
	shl	bx, 1
	push	word ptr (classString+2)[bx]
	push	word ptr classString[bx]
	lea	ax, [bp+var_10E]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_6], ax
	mov	word ptr [bp+var_6+2], dx
	mov	ax, offset aSpellLevel
	push	ds
	push	ax
	push	dx
	push	word ptr [bp+var_6]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_6], ax
	mov	word ptr [bp+var_6+2], dx
	lfs	bx, [bp+var_6]
	inc	word ptr [bp+var_6]
	mov	al, byte ptr [bp+counter]
	add	al, '1'
	mov	fs:[bx], al
	mov	ax, offset aWillCost
	push	ds
	push	ax
	push	word ptr [bp+var_6+2]
	push	word ptr [bp+var_6]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_6], ax
	mov	word ptr [bp+var_6+2], dx
	mov	bx, [bp+counter]
	shl	bx, 1
	mov	ax, spellLevelCost[bx]
	mov	[bp+var_8], ax
	sub	ax, ax
	push	ax
	mov	ax, [bp+var_8]
	cwd
	push	dx
	push	ax
	push	word ptr [bp+var_6+2]
	push	word ptr [bp+var_6]
	call	_itoa
	add	sp, 0Ah
	mov	word ptr [bp+var_6], ax
	mov	word ptr [bp+var_6+2], dx
	mov	ax, offset aInGold_WhoWill
	push	ds
	push	ax
	push	dx
	push	word ptr [bp+var_6]
	call	_strcat
	add	sp, 8
	mov	word ptr [bp+var_6], ax
	mov	word ptr [bp+var_6+2], dx
	lea	ax, [bp+var_10E]
	push	ss
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_E], ax
	or	ax, ax
	jge	short loc_23844
	jmp	short loc_238B7
loc_23844:
	mov	ax, [bp+var_8]
	cwd
	mov	cx, ax
	mov	bx, dx
	getCharP	[bp+var_E], si
	cmp	word ptr gs:(roster.gold+2)[si], bx
	ja	short loc_23877
	jb	short loc_23868
	cmp	word ptr gs:roster.gold[si], cx
	jnb	short loc_23877
loc_23868:
	mov	ax, offset aNotEnoughGoldNL
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	jmp	short loc_238B4
loc_23877:
	mov	ax, [bp+var_8]
	cwd
	mov	cx, ax
	mov	bx, dx
	getCharP	[bp+var_E], si
	sub	word ptr gs:roster.gold[si], cx
	sbb	word ptr gs:(roster.gold+2)[si], bx
	mov	ax, offset aTheElderTeache
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	push	[bp+spellBase]
	push	[bp+counter]
	push	[bp+charNo]
	push	cs
	call	near ptr mage_learnSpellLevel
	add	sp, 6
	jmp	short loc_238B7
loc_238B4:
	jmp	loc_23771
loc_238B7:
	pop	si
	mov	sp, bp
	pop	bp
	retf
rev_learnSpells	endp

; Attributes: bp-based frame

mage_conjurorReqCheck proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	sub	ax, ax
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr mage_learnedClassSpLevel
	add	sp, 4
	mov	cx, ax
	cmp	cx, 1
	sbb	ax, ax
	neg	ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mage_conjurorReqCheck endp

; Attributes: bp-based frame

mage_magicianReqCheck proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 0Eh
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr mage_learnedClassSpLevel
	add	sp, 4
	mov	cx, ax
	cmp	cx, 1
	sbb	ax, ax
	neg	ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mage_magicianReqCheck endp

; Attributes: bp-based frame

mage_sorcererReqCheck proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 1Ch
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr mage_learnedClassSpLevel
	add	sp, 4
	or	ax, ax
	jz	short loc_23929
	sub	ax, ax
	jmp	short loc_23941
loc_23929:
	push	[bp+arg_0]
	push	cs
	call	near ptr mage_countClassesGained
	add	sp, 2
	cmp	ax, 1
	jl	short loc_2393D
	mov	ax, 1
	jmp	short loc_2393F
loc_2393D:
	sub	ax, ax
loc_2393F:
	jmp	short $+2
loc_23941:
	mov	sp, bp
	pop	bp
	retf
mage_sorcererReqCheck endp

; Attributes: bp-based frame

mage_wizardReqCheck proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 2Ah
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr mage_learnedClassSpLevel
	add	sp, 4
	or	ax, ax
	jz	short loc_23965
	sub	ax, ax
	jmp	short loc_2397D
loc_23965:
	push	[bp+arg_0]
	push	cs
	call	near ptr mage_countClassesGained
	add	sp, 2
	cmp	ax, 2
	jl	short loc_23979
	mov	ax, 1
	jmp	short loc_2397B
loc_23979:
	sub	ax, ax
loc_2397B:
	jmp	short $+2
loc_2397D:
	mov	sp, bp
	pop	bp
	retf
mage_wizardReqCheck endp

; Attributes: bp-based frame

mage_archmageReqCheck proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 38h	
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr mage_learnedClassSpLevel
	add	sp, 4
	or	ax, ax
	jz	short loc_239A1
	sub	ax, ax
	jmp	short loc_239B9
loc_239A1:
	push	[bp+arg_0]
	push	cs
	call	near ptr mage_countClassesGained
	add	sp, 2
	cmp	ax, 3
	jl	short loc_239B5
	mov	ax, 1
	jmp	short loc_239B7
loc_239B5:
	sub	ax, ax
loc_239B7:
	jmp	short $+2
loc_239B9:
	mov	sp, bp
	pop	bp
	retf
mage_archmageReqCheck endp

; Attributes: bp-based frame

mage_chronoReqCheck proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 46h	
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr mage_learnedClassSpLevel
	add	sp, 4
	or	ax, ax
	jz	short loc_239DD
	sub	ax, ax
	jmp	short loc_239F5
loc_239DD:
	push	[bp+arg_0]
	push	cs
	call	near ptr mage_countClassesGained
	add	sp, 2
	cmp	ax, 2
	jl	short loc_239F1
	mov	ax, 1
	jmp	short loc_239F3
loc_239F1:
	sub	ax, ax
loc_239F3:
	jmp	short $+2
loc_239F5:
	mov	sp, bp
	pop	bp
	retf
mage_chronoReqCheck endp

; Attributes: bp-based frame

rev_changeMageClass proc far

	var_78=	word ptr -78h
	var_24=	byte ptr -24h
	var_22=	word ptr -22h
	var_20=	word ptr -20h
	counter= word ptr -1Eh
	charNo=	word ptr -1Ch
	var_1A=	word ptr -1Ah
	var_18=	word ptr -18h
	var_16=	word ptr -16h
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 24h	
	call	someStackOperation
	push	si
	mov	ax, offset aWhichMageSeeks
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getCharNumber
	mov	[bp+charNo], ax
	or	ax, ax
	jge	short loc_23A21
	jmp	loc_23C5A
loc_23A21:
	getCharP	[bp+charNo], bx
	mov	al, gs:roster.class[bx]
	mov	[bp+var_24], al
	cmp	al, class_chronomancer
	jz	short loc_23A3D
	cmp	al, class_geomancer
	jnz	short loc_23A4D
loc_23A3D:
	mov	ax, offset aThouCannotChan
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	jmp	loc_23C5A
loc_23A4D:
	getCharP	[bp+charNo], bx
	mov	bl, gs:roster.class[bx]
	sub	bh, bh
	mov	al, mageSpellIndex[bx]
	sub	ah, ah
	mov	[bp+var_20], ax
	cmp	ax, 0FFh
	jnz	short loc_23A83
	mov	ax, offset aThouArtNotASpe
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	jmp	loc_23C5A
loc_23A83:
	mov	[bp+counter], 0
	jmp	short loc_23A8D
loc_23A8A:
	inc	[bp+counter]
loc_23A8D:
	cmp	[bp+counter], 3
	jge	short loc_23AB9
	push	[bp+var_20]
	push	[bp+counter]
	push	[bp+charNo]
	push	cs
	call	near ptr mage_hasLearnedSpLevel
	add	sp, 6
	or	ax, ax
	jnz	short loc_23AB7
	mov	ax, offset aYouMustKnowAtL
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	jmp	loc_23C5A
loc_23AB7:
	jmp	short loc_23A8A
loc_23AB9:
	mov	[bp+var_22], 0
	mov	[bp+var_2], 0
	mov	[bp+counter], 0
	jmp	short loc_23ACD
loc_23ACA:
	inc	[bp+counter]
loc_23ACD:
	cmp	[bp+counter], 6
	jge	short loc_23B2B
	push	[bp+charNo]
	mov	bx, [bp+counter]
	shl	bx, 1
	shl	bx, 1
	call	off_4A6A4[bx]
	add	sp, 2
	or	ax, ax
	jz	short loc_23B29
	mov	bx, [bp+counter]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (magicUserString+2)[bx]
	push	word ptr magicUserString[bx]
	push	[bp+var_22]
	call	printOrderedList
	add	sp, 6
	mov	si, [bp+var_22]
	inc	[bp+var_22]
	shl	si, 1
	mov	ax, [bp+counter]
	mov	[bp+si+var_16],	ax
	mov	bl, gs:txt_numLines
	sub	bh, bh
	shl	bx, 1
	mov	ax, bitMask16bit[bx]
	or	[bp+var_2], ax
loc_23B29:
	jmp	short loc_23ACA
loc_23B2B:
	cmp	[bp+var_22], 0
	jnz	short loc_23B41
	mov	ax, offset aTheeDoesnTQual
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	jmp	loc_23C5A
loc_23B41:
	mov	ax, offset aWhichClassShal
	push	ds
	push	ax
	call	printString
	add	sp, 4
loc_23B4E:
	push	[bp+var_2]
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_1A], ax
	cmp	ax, 1Bh
	jnz	short loc_23B64
	jmp	loc_23C5A
loc_23B64:
	cmp	[bp+var_1A], 10Eh
	jl	short loc_23B77
	cmp	[bp+var_1A], 119h
	jg	short loc_23B77
	sub	[bp+var_1A], 0DEh 
loc_23B77:
	cmp	[bp+var_1A], 31h 
	jl	short loc_23B4E
	mov	ax, [bp+var_22]
	add	ax, 31h	
	cmp	ax, [bp+var_1A]
	jl	short loc_23B4E
	mov	si, [bp+var_1A]
	shl	si, 1
	mov	ax, [bp+si+var_78]
	mov	[bp+counter], ax
	cmp	ax, 5
	jnz	short loc_23BE2
	mov	ax, offset aTheeUnderstand
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aDostThouAccept
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getYesNo
	or	ax, ax
	jnz	short loc_23BBE
	jmp	loc_23C5A
loc_23BBE:
	mov	ax, offset aKnowThisTheSpe
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aThereIsALargeG
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	push	[bp+charNo]
	push	cs
	call	near ptr mage_removeAllSpells
	add	sp, 2
loc_23BE2:
	getCharP	[bp+charNo], si
	mov	bx, [bp+counter]
	mov	al, byte_4A6BC[bx]
	sub	ah, ah
	mov	[bp+var_18], ax
	mov	cl, gs:roster.class[si]
	sub	ch, ch
	cmp	ax, cx
	jz	short loc_23C5A
	sub	ax, ax
	mov	word ptr gs:(roster.experience+2)[si], ax
	mov	word ptr gs:roster.experience[si], ax
	mov	gs:roster.maxLevel[si],	1
	mov	gs:roster.level[si], 1
	mov	al, byte ptr [bp+var_18]
	mov	gs:roster.class[si], al
	mov	bx, [bp+var_18]
	mov	al, mageSpellIndex[bx]
	sub	ah, ah
	push	ax
	sub	ax, ax
	push	ax
	push	[bp+charNo]
	push	cs
	call	near ptr mage_learnSpellLevel
	add	sp, 6
	mov	byte ptr word_44166,	0
	mov	ax, offset aNowThouBeginsT
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
loc_23C5A:
	pop	si
	mov	sp, bp
	pop	bp
	retf
rev_changeMageClass endp

; Attributes: bp-based frame

mage_learnSpellLevel proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	charNo=	word ptr  6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	mov	ax, [bp+arg_2]
	shl	ax, 1
	add	ax, [bp+arg_4]
	mov	[bp+var_4], ax
	mov	bx, ax
	mov	al, byte ptr stru_489E2.levelBase[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	al, stru_489E2.numSpells[bx]
	mov	[bp+var_6], ax
loc_23C87:
	mov	ax, [bp+var_6]
	dec	[bp+var_6]
	or	ax, ax
	jz	short loc_23CA4
	push	[bp+var_2]
	inc	[bp+var_2]
	push	[bp+charNo]
	call	mage_learnSpell
	add	sp, 4
	jmp	short loc_23C87
loc_23CA4:
	mov	sp, bp
	pop	bp
	retf
mage_learnSpellLevel endp

; Attributes: bp-based frame

mage_hasLearnedSpLevel proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	charNo=	word ptr  6
	_offset= word ptr  8
	base= word ptr	0Ah

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	mov	ax, [bp+_offset]
	shl	ax, 1
	add	ax, [bp+base]
	mov	[bp+var_4], ax
	mov	bx, ax
	mov	al, byte ptr stru_489E2.levelBase[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	al, stru_489E2.numSpells[bx]
	mov	[bp+var_6], ax
loc_23CD0:
	mov	ax, [bp+var_6]
	dec	[bp+var_6]
	or	ax, ax
	jz	short loc_23CF5
	push	[bp+var_2]
	inc	[bp+var_2]
	push	[bp+charNo]
	call	mage_hasLearnedSpell
	add	sp, 4
	or	ax, ax
	jnz	short loc_23CF3
	sub	ax, ax
	jmp	short loc_23CFA
loc_23CF3:
	jmp	short loc_23CD0
loc_23CF5:
	mov	ax, 1
	jmp	short $+2
loc_23CFA:
	mov	sp, bp
	pop	bp
	retf
mage_hasLearnedSpLevel endp

; This function	returns	0 if the mage has learned
; at least one level of	a certain mage class
; Attributes: bp-based frame

mage_learnedClassSpLevel proc far

	spellLevel= word ptr -2
	charNo=	word ptr  6
	spellBase= word	ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+spellLevel], 6
	jmp	short loc_23D13
loc_23D10:
	dec	[bp+spellLevel]
loc_23D13:
	cmp	[bp+spellLevel], 0
	jl	short loc_23D33
	push	[bp+spellBase]
	push	[bp+spellLevel]
	push	[bp+charNo]
	push	cs
	call	near ptr mage_hasLearnedSpLevel
	add	sp, 6
	or	ax, ax
	jnz	short loc_23D31
	sub	ax, ax
	jmp	short loc_23D38
loc_23D31:
	jmp	short loc_23D10
loc_23D33:
	mov	ax, 1
	jmp	short $+2
loc_23D38:
	mov	sp, bp
	pop	bp
	retf
mage_learnedClassSpLevel endp

; This function	returns	the number of classes that
; a mage has learned a spell level as. This is used,
; for example, to ensure that a	mage has learned two
; classes before changing to a wizard.
; Attributes: bp-based frame

mage_countClassesGained	proc far

	rval= word ptr -4
	counter= word ptr -2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	[bp+rval], 0
	mov	[bp+counter], 0
	jmp	short loc_23D56
loc_23D53:
	inc	[bp+counter]
loc_23D56:
	cmp	[bp+counter], 6
	jge	short loc_23D7F
	mov	ax, [bp+counter]
	mov	cx, ax
	shl	ax, 1
	add	ax, cx
	shl	ax, 1
	add	ax, cx
	shl	ax, 1
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr mage_learnedClassSpLevel
	add	sp, 4
	or	ax, ax
	jz	short loc_23D7D
	inc	[bp+rval]
loc_23D7D:
	jmp	short loc_23D53
loc_23D7F:
	mov	ax, [bp+rval]
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
mage_countClassesGained	endp

; Attributes: bp-based frame

mage_removeAllSpells proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 0
	jmp	short loc_23D9D
loc_23D9A:
	inc	[bp+var_2]
loc_23D9D:
	cmp	[bp+var_2], 0Eh
	jge	short loc_23DBA
	getCharP	[bp+arg_0], bx
	add	bx, [bp+var_2]
	mov	gs:roster.spells[bx], 0
	jmp	short loc_23D9A
loc_23DBA:
	mov	sp, bp
	pop	bp
	retf
mage_removeAllSpells endp

; Attributes: bp-based frame

rev_speakToElder proc far

	charNo=	word ptr -2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
loc_23DC9:
	mov	ax, offset aWhoWishsToSpea
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getCharNumber
	mov	[bp+charNo], ax
	or	ax, ax
	jge	short loc_23DE5
	jmp	loc_23E8B
loc_23DE5:
	sub	ax, ax
	push	ax
	push	[bp+charNo]
	push	cs
	call	near ptr chrono_isQuestComplete
	add	sp, 4
	or	ax, ax
	jnz	short loc_23E06
	mov	ax, offset aSeekOutBrilhas
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	jmp	loc_23E88
loc_23E06:
	getCharP	[bp+charNo], bx
	cmp	gs:roster.class[bx], class_chronomancer
	jz	short loc_23E29
	mov	ax, offset aILlTeachOnlyAC
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	jmp	short loc_23E88
loc_23E29:
	push	[bp+charNo]
	push	cs
	call	near ptr rev_chronGelidia
	add	sp, 2
	or	ax, ax
	jnz	short loc_23E7C
	push	[bp+charNo]
	push	cs
	call	near ptr rev_chronLucencia
	add	sp, 2
	or	ax, ax
	jnz	short loc_23E7C
	push	[bp+charNo]
	push	cs
	call	near ptr rev_chronKinestia
	add	sp, 2
	or	ax, ax
	jnz	short loc_23E7C
	push	[bp+charNo]
	push	cs
	call	near ptr rev_chronTenebrosia
	add	sp, 2
	or	ax, ax
	jnz	short loc_23E7C
	push	[bp+charNo]
	push	cs
	call	near ptr rev_chronTarmitia
	add	sp, 2
	or	ax, ax
	jnz	short loc_23E7C
	mov	ax, offset aHurryTimeIsRun
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
loc_23E7C:
	wait4IO
loc_23E88:
	jmp	loc_23DC9
loc_23E8B:
	mov	sp, bp
	pop	bp
	retf
rev_speakToElder endp

; Attributes: bp-based frame

rev_chronGelidia proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 2
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr chrono_isQuestComplete
	add	sp, 4
	or	ax, ax
	jnz	short loc_23EAF
	sub	ax, ax
	jmp	short loc_23F03
loc_23EAF:
	mov	ax, 54h	
	push	ax
	push	[bp+arg_0]
	call	mage_hasLearnedSpell
	add	sp, 4
	or	ax, ax
	jz	short loc_23EC6
	sub	ax, ax
	jmp	short loc_23F03
loc_23EC6:
	mov	ax, offset aGelidiaTheLand
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aToTheNorthIsCo
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, 54h	
	push	ax
	push	[bp+arg_0]
	call	mage_learnSpell
	add	sp, 4
	mov	ax, 55h	
	push	ax
	push	[bp+arg_0]
	call	mage_learnSpell
	add	sp, 4
	mov	ax, 1
	jmp	short $+2
loc_23F03:
	mov	sp, bp
	pop	bp
	retf
rev_chronGelidia endp

; Attributes: bp-based frame

rev_chronLucencia proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 4
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr chrono_isQuestComplete
	add	sp, 4
	or	ax, ax
	jnz	short loc_23F27
	sub	ax, ax
	jmp	short loc_23F7B
loc_23F27:
	mov	ax, 58h	
	push	ax
	push	[bp+arg_0]
	call	mage_hasLearnedSpell
	add	sp, 4
	or	ax, ax
	jz	short loc_23F3E
	sub	ax, ax
	jmp	short loc_23F7B
loc_23F3E:
	mov	ax, offset aLucenciaIsEnte
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aToTheEastIsACr
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, 58h	
	push	ax
	push	[bp+arg_0]
	call	mage_learnSpell
	add	sp, 4
	mov	ax, 59h	
	push	ax
	push	[bp+arg_0]
	call	mage_learnSpell
	add	sp, 4
	mov	ax, 1
	jmp	short $+2
loc_23F7B:
	mov	sp, bp
	pop	bp
	retf
rev_chronLucencia endp

; Attributes: bp-based frame

rev_chronKinestia proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 6
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr chrono_isQuestComplete
	add	sp, 4
	or	ax, ax
	jnz	short loc_23F9F
	sub	ax, ax
	jmp	short loc_23FF3
loc_23F9F:
	mov	ax, 5Ch	
	push	ax
	push	[bp+arg_0]
	call	mage_hasLearnedSpell
	add	sp, 4
	or	ax, ax
	jz	short loc_23FB6
	sub	ax, ax
	jmp	short loc_23FF3
loc_23FB6:
	mov	ax, offset aKinestiaTheDim
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aToTheSouthWest
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, 5Ch	
	push	ax
	push	[bp+arg_0]
	call	mage_learnSpell
	add	sp, 4
	mov	ax, 5Dh	
	push	ax
	push	[bp+arg_0]
	call	mage_learnSpell
	add	sp, 4
	mov	ax, 1
	jmp	short $+2
loc_23FF3:
	mov	sp, bp
	pop	bp
	retf
rev_chronKinestia endp

; Attributes: bp-based frame

rev_chronTenebrosia proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 8
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr chrono_isQuestComplete
	add	sp, 4
	or	ax, ax
	jnz	short loc_24017
	sub	ax, ax
	jmp	short loc_2406B
loc_24017:
	mov	ax, 60h	
	push	ax
	push	[bp+arg_0]
	call	mage_hasLearnedSpell
	add	sp, 4
	or	ax, ax
	jz	short loc_2402E
	sub	ax, ax
	jmp	short loc_2406B
loc_2402E:
	mov	ax, offset aTenebrosiaCanB
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aToTheSoutheast
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, 60h	
	push	ax
	push	[bp+arg_0]
	call	mage_learnSpell
	add	sp, 4
	mov	ax, 61h	
	push	ax
	push	[bp+arg_0]
	call	mage_learnSpell
	add	sp, 4
	mov	ax, 1
	jmp	short $+2
loc_2406B:
	mov	sp, bp
	pop	bp
	retf
rev_chronTenebrosia endp

; Attributes: bp-based frame

rev_chronTarmitia proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 0Ah
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr chrono_isQuestComplete
	add	sp, 4
	or	ax, ax
	jnz	short loc_2408F
	sub	ax, ax
	jmp	short loc_240E3
loc_2408F:
	mov	ax, 64h	
	push	ax
	push	[bp+arg_0]
	call	mage_hasLearnedSpell
	add	sp, 4
	or	ax, ax
	jz	short loc_240A6
	sub	ax, ax
	jmp	short loc_240E3
loc_240A6:
	mov	ax, offset aTarmitiaIsEnte
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aToTheSouthIsAV
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, 64h	
	push	ax
	push	[bp+arg_0]
	call	mage_learnSpell
	add	sp, 4
	mov	ax, 65h	
	push	ax
	push	[bp+arg_0]
	call	mage_learnSpell
	add	sp, 4
	mov	ax, 1
	jmp	short $+2
loc_240E3:
	mov	sp, bp
	pop	bp
	retf
rev_chronTarmitia endp

; This function	returns	non-zero if the	chronomancer
; quest	flag has been set in charNo
; Attributes: bp-based frame

chrono_isQuestComplete proc far

	charNo=	word ptr  6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	getCharP	[bp+charNo], bx
	mov	ax, [bp+arg_2]
	mov	cl, 3
	sar	ax, cl
	add	bx, ax
	mov	al, gs:roster.chronoQuest[bx]
	sub	ah, ah
	mov	bx, [bp+arg_2]
	and	bx, 7
	mov	cl, byteMaskList[bx]
	sub	ch, ch
	and	ax, cx
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
chrono_isQuestComplete endp

; Attributes: bp-based frame

sub_24126 proc far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	mov	ax, 0Ch
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	cmp	ax, 1
	sbb	cx, cx
	neg	cx
	mov	[bp+var_6], cx
	or	cx, cx
	jz	short loc_24150
	mov	ax, 32h	
	jmp	short loc_24153
loc_24150:
	mov	ax, 2Fh	
loc_24153:
	mov	[bp+var_8], ax
	cmp	[bp+var_6], 0
	jz	short loc_24161
	mov	ax, offset aBuilding
	jmp	short loc_24164
loc_24161:
	mov	ax, offset aReviewBoard
loc_24164:
	mov	[bp+var_4], ax
	mov	[bp+var_2], ds
	push	[bp+var_8]
	call	bigpic_drawPicNumber
	add	sp, 2
	push	[bp+var_2]
	push	[bp+var_4]
	call	setTitle
	add	sp, 4
	cmp	[bp+var_6], 0
	jz	short loc_241B7
	call	clearTextWindow
	mov	ax, offset aTheOldReviewBo
	push	ds
	push	ax
	call	printString
	add	sp, 4
	mov	ax, 0FFh
	push	ax
	mov	ax, 3Eh	
	push	ax
	call	_updateFlags
	add	sp, 4
	wait4IO
loc_241B7:
	mov	sp, bp
	pop	bp
	retf
sub_24126 endp

; Attributes: bp-based frame

chron_questBrilhasti proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 35
	push	ax
	call	_partyCharUnderLevel
	add	sp, 2
	or	ax, ax
	jnz	short loc_24250
	mov	ax, quest_brilhastDone
	push	ax
	call	chron_questFlagSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_24250
	mov	ax, quest_brilhastActive
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_241F9
	sub	ax, ax
	jmp	short loc_2426C
loc_241F9:
	mov	ax, offset aTheOldManInThe
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aBeneathSkaraBr
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aYouMayEnterThe
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aDestroyBrilhas
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, 0FFh
	push	ax
	mov	ax, 3Fh	
	push	ax
	call	_updateFlags
	add	sp, 4
	mov	ax, quest_brilhastActive
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, 1
	jmp	short loc_2426C
	jmp	short loc_2426C
loc_24250:
	mov	ax, quest_brilhastActive
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, quest_brilhastDone
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	sub	ax, ax
	jmp	short $+2
loc_2426C:
	mov	sp, bp
	pop	bp
	retf
chron_questBrilhasti endp

; Attributes: bp-based frame

chron_questValarian proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	sub	ax, ax
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_2428C
	jmp	loc_24347
loc_2428C:
	mov	ax, quest_valarianDone
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_2429F
	jmp	loc_24347
loc_2429F:
	mov	ax, quest_brilhastDone
	push	ax
	call	chron_questFlagSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_242B2
	jmp	loc_24347
loc_242B2:
	mov	ax, offset aWelcomeYeChild
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aThatWhichHasLa
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aIfYouCannotSto
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aPrepareThyselv
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aAboriaTheHomeO
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aBringToMeValar
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aYesAndBeOnTheL
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, 0FFh
	push	ax
	mov	ax, 3Fh	
	push	ax
	call	_updateFlags
	add	sp, 4
	mov	ax, quest_brilhastActive
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, quest_brilhastDone
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	sub	ax, ax
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, 1
	jmp	short loc_2434B
	jmp	short loc_2434B
loc_24347:
	sub	ax, ax
	jmp	short $+2
loc_2434B:
	mov	sp, bp
	pop	bp
	retf
chron_questValarian endp

; Attributes: bp-based frame
chron_questLanatir proc	far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 2
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_2436C
	jmp	loc_2441C
loc_2436C:
	mov	ax, quest_lanatirDone
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_2437F
	jmp	loc_2441C
loc_2437F:
	mov	ax, 7Bh	
	push	ax
	call	sub_19D2A
	add	sp, 2
	or	ax, ax
	jnz	short loc_24392
	jmp	loc_2441C
loc_24392:
	mov	ax, 7Ch	
	push	ax
	call	sub_19D2A
	add	sp, 2
	or	ax, ax
	jz	short loc_2441C
	mov	ax, 7Bh	
	push	ax
	call	_removeItem
	add	sp, 2
	mov	ax, 7Ch	
	push	ax
	call	_removeItem
	add	sp, 2
	mov	ax, offset aTheOldManTakes
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aYouHaveDoneWel
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aItIsTheDimensi
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aBringLanatirWi
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, 0FFh
	push	ax
	mov	ax, 3Fh	
	push	ax
	call	_updateFlags
	add	sp, 4
	mov	ax, quest_lanatirActive
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	sub	ax, ax
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, 1
	jmp	short loc_24420
	jmp	short loc_24420
loc_2441C:
	sub	ax, ax
	jmp	short $+2
loc_24420:
	mov	sp, bp
	pop	bp
	retf
chron_questLanatir endp

; Attributes: bp-based frame
chron_questAlliria proc	far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, quest_alliriaDone
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_24441
	jmp	loc_244E2
loc_24441:
	mov	ax, quest_alliriaActive
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_24454
	jmp	loc_244E2
loc_24454:
	mov	ax, 73h	
	push	ax
	call	sub_19D2A
	add	sp, 2
	or	ax, ax
	jz	short loc_244E2
	mov	ax, 74h	
	push	ax
	call	sub_19D2A
	add	sp, 2
	or	ax, ax
	jz	short loc_244E2
	mov	ax, 73h	
	push	ax
	call	_removeItem
	add	sp, 2
	mov	ax, 74h	
	push	ax
	call	_removeItem
	add	sp, 2
	mov	ax, offset aTheOldManAppea
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aHisEyesFocusUp
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aIDareNotHopeAl
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, 0FFh
	push	ax
	mov	ax, 3Fh	
	push	ax
	call	_updateFlags
	add	sp, 4
	mov	ax, quest_lanatirActive
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, quest_alliriaActive
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, 1
	jmp	short loc_244E6
	jmp	short loc_244E6
loc_244E2:
	sub	ax, ax
	jmp	short $+2
loc_244E6:
	mov	sp, bp
	pop	bp
	retf
chron_questAlliria endp

; Attributes: bp-based frame

chron_questFerofist proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, quest_ferofistDone
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_24507
	jmp	loc_245B8
loc_24507:
	mov	ax, quest_ferofistActive
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_2451A
	jmp	loc_245B8
loc_2451A:
	mov	ax, 87h	
	push	ax
	call	sub_19D2A
	add	sp, 2
	or	ax, ax
	jnz	short loc_2452D
	jmp	loc_245B8
loc_2452D:
	mov	ax, 88h	
	push	ax
	call	sub_19D2A
	add	sp, 2
	or	ax, ax
	jz	short loc_245B8
	mov	ax, 87h	
	push	ax
	call	_removeItem
	add	sp, 2
	mov	ax, 88h	
	push	ax
	call	_removeItem
	add	sp, 2
	mov	ax, offset aTheOldManSLook
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aQuicklyThenMyC
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aYouMustReturnH
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aHurryThePaceQu
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, 0FFh
	push	ax
	mov	ax, 3Fh	
	push	ax
	call	_updateFlags
	add	sp, 4
	mov	ax, quest_ferofistActive
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, quest_alliriaActive
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, 1
	jmp	short loc_245BC
	jmp	short loc_245BC
loc_245B8:
	sub	ax, ax
	jmp	short $+2
loc_245BC:
	mov	sp, bp
	pop	bp
	retf
chron_questFerofist endp

; Attributes: bp-based frame

chron_questSceadu proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, quest_sceaduActive
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_245DD
	jmp	loc_2468E
loc_245DD:
	mov	ax, quest_sceaduDone
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_245F0
	jmp	loc_2468E
loc_245F0:
	mov	ax, 98h	
	push	ax
	call	sub_19D2A
	add	sp, 2
	or	ax, ax
	jnz	short loc_24603
	jmp	loc_2468E
loc_24603:
	mov	ax, 99h	
	push	ax
	call	sub_19D2A
	add	sp, 2
	or	ax, ax
	jz	short loc_2468E
	mov	ax, 98h	
	push	ax
	call	_removeItem
	add	sp, 2
	mov	ax, 99h	
	push	ax
	call	_removeItem
	add	sp, 2
	mov	ax, offset aTheOldManSEyes
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aHePausesASecon
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aRememberInTheL
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aFromThereIRequ
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, 0FFh
	push	ax
	mov	ax, 3Fh	
	push	ax
	call	_updateFlags
	add	sp, 4
	mov	ax, quest_ferofistActive
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, quest_sceaduActive
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, 1
	jmp	short loc_24692
	jmp	short loc_24692
loc_2468E:
	sub	ax, ax
	jmp	short $+2
loc_24692:
	mov	sp, bp
	pop	bp
	retf
chron_questSceadu endp

; Attributes: bp-based frame

chron_questWerra proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, quest_werraDone
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_246B3
	jmp	loc_24764
loc_246B3:
	mov	ax, quest_werraActive
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_246C6
	jmp	loc_24764
loc_246C6:
	mov	ax, 9Ch	
	push	ax
	call	sub_19D2A
	add	sp, 2
	or	ax, ax
	jnz	short loc_246D9
	jmp	loc_24764
loc_246D9:
	mov	ax, 9Dh	
	push	ax
	call	sub_19D2A
	add	sp, 2
	or	ax, ax
	jz	short loc_24764
	mov	ax, 9Ch	
	push	ax
	call	_removeItem
	add	sp, 2
	mov	ax, 9Dh	
	push	ax
	call	_removeItem
	add	sp, 2
	mov	ax, offset aNoTheOldManCri
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aOffWithYouToTa
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aBringMeWerraSS
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aHisEyesLoseThe
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, 0FFh
	push	ax
	mov	ax, 3Fh	
	push	ax
	call	_updateFlags
	add	sp, 4
	mov	ax, quest_werraActive
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, quest_sceaduActive
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, 1
	jmp	short loc_24768
	jmp	short loc_24768
loc_24764:
	sub	ax, ax
	jmp	short $+2
loc_24768:
	mov	sp, bp
	pop	bp
	retf
chron_questWerra endp

; Attributes: bp-based frame

chron_questTarjan proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	ax, 0FFh
	push	ax
	mov	ax, 3Eh	
	push	ax
	call	_updateFlags
	add	sp, 4
	mov	ax, quest_tarjanDone
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jz	short loc_247A8
	mov	ax, quest_tarjanActive
	push	ax
	call	chron_questFlagNotSet
	add	sp, 2
	or	ax, ax
	jnz	short loc_247AD
loc_247A8:
	sub	ax, ax
	jmp	loc_248A7
loc_247AD:
	sub	ax, ax
	push	ax
	mov	ax, 3Eh	
	push	ax
	call	_updateFlags
	add	sp, 4
	mov	ax, 0A0h 
	push	ax
	call	sub_19D2A
	add	sp, 2
	or	ax, ax
	jnz	short loc_247D1
	sub	ax, ax
	jmp	loc_248A7
loc_247D1:
	mov	ax, 0FFh
	push	ax
	mov	ax, 3Eh	
	push	ax
	call	_updateFlags
	add	sp, 4
	mov	ax, offset aIKnowTheOldMan
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aGatherUpThePri
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aIHavePlacedThe
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aGetYourselvesH
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, 4Ah	
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
	mov	ax, offset aWithThoseFinal
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, quest_werraActive
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, quest_tarjanActive
	push	ax
	call	chron_setQuestFlag
	add	sp, 2
	mov	ax, 0FFh
	push	ax
	mov	ax, 46h	
	push	ax
	call	_updateFlags
	add	sp, 4
	mov	[bp+var_2], 0
	jmp	short loc_24860
loc_2485D:
	inc	[bp+var_2]
loc_24860:
	cmp	[bp+var_2], 7
	jge	short loc_248A2
	getCharP	[bp+var_2], si
	cmp	byte ptr gs:roster._name[si], 0
	jz	short loc_248A0
	cmp	gs:roster.class[si], class_chronomancer
	jnz	short loc_248A0
	mov	ax, 68h	
	push	ax
	push	[bp+var_2]
	call	mage_learnSpell
	add	sp, 4
	mov	ax, 69h	
	push	ax
	push	[bp+var_2]
	call	mage_learnSpell
	add	sp, 4
loc_248A0:
	jmp	short loc_2485D
loc_248A2:
	mov	ax, 1
	jmp	short $+2
loc_248A7:
	pop	si
	mov	sp, bp
	pop	bp
	retf
chron_questTarjan endp

; Attributes: bp-based frame

rev_doQuest proc far

	counter= word ptr -2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+counter], 0
	jmp	short loc_248C1
loc_248BE:
	inc	[bp+counter]
loc_248C1:
	cmp	[bp+counter], 8
	jge	short loc_248F2
	mov	bx, [bp+counter]
	shl	bx, 1
	shl	bx, 1
	call	questFuncs[bx]
	or	ax, ax
	jz	short loc_248F0
	push	[bp+counter]
	push	cs
	call	near ptr sub_248F6
	add	sp, 2
	cmp	[bp+counter], 2
	jl	short loc_248F0
	cmp	[bp+counter], 7
	jge	short loc_248F0
	push	cs
	call	near ptr sub_24961
loc_248F0:
	jmp	short loc_248BE
loc_248F2:
	mov	sp, bp
	pop	bp
	retf
rev_doQuest endp

; Attributes: bp-based frame

sub_248F6 proc far

	var_6= dword ptr -6
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	di
	push	si
	mov	[bp+var_2], 0
	jmp	short loc_2490D
loc_2490A:
	inc	[bp+var_2]
loc_2490D:
	cmp	[bp+var_2], 7
	jge	short loc_2495B
	getCharP	[bp+var_2], si
	cmp	gs:roster.class[si], class_monster
	jz	short loc_24959
	mov	bx, [bp+arg_0]
	mov	al, byte_4A702[bx]
	sub	ah, ah
	add	ax, si
	add	ax, offset roster.chronoQuest
	mov	word ptr [bp+var_6], ax
	mov	word ptr [bp+var_6+2], seg seg027
	mov	al, byte_4A6FA[bx]
	sub	ah, ah
	lfs	bx, [bp+var_6]
	mov	cl, fs:[bx]
	sub	ch, ch
	test	ax, cx
	jnz	short loc_24959
	mov	di, [bp+arg_0]
	mov	al, byte_4A6FA[di]
	or	fs:[bx], al
loc_24959:
	jmp	short loc_2490A
loc_2495B:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
sub_248F6 endp

; Attributes: bp-based frame

sub_24961 proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	ax, offset aTheOldManAward
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	ax, offset aWithAWaveOfHis
	push	ds
	push	ax
	call	anotherPrintString
	add	sp, 4
	mov	[bp+var_2], 0
	jmp	short loc_24991
loc_2498E:
	inc	[bp+var_2]
loc_24991:
	cmp	[bp+var_2], 7
	jge	short loc_249EE
	getCharP	[bp+var_2], si
	cmp	gs:roster.class[si], class_monster
	jnb	short loc_249EC
	test	gs:roster.status[si], 4
	jnz	short loc_249EC
	mov	ax, word ptr gs:roster.experience[si]
	mov	dx, word ptr gs:(roster.experience+2)[si]
	add	ax, 27C0h
	adc	dx, 9
	push	dx
	push	ax
	push	cs
	call	near ptr sub_22FC7
	add	sp, 4
	mov	word ptr gs:roster.experience[si], ax
	mov	word ptr gs:(roster.experience+2)[si], dx
	getCharP	[bp+var_2], si
	mov	ax, gs:roster.maxSppt[si]
	mov	gs:roster.currentSppt[si], ax
loc_249EC:
	jmp	short loc_2498E
loc_249EE:
	mov	byte ptr word_44166,	0
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_24961 endp

; Attributes: bp-based frame

_rev_removeAgeStatus proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	getCharP	[bp+arg_0], si
	mov	al, gs:roster.status[si]
	sub	ah, ah
	and	ax, 2
	mov	[bp+var_2], ax
	or	ax, ax
	jz	short loc_24A53
	mov	ax, 5
	push	ax
	lea	ax, roster.strength[si]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, roster.savedST[si]
	push	dx
	push	ax
	call	_doAgeStatus
	add	sp, 0Ah
	getCharP	[bp+arg_0], bx
	and	gs:roster.status[bx], 0FDh
loc_24A53:
	mov	ax, [bp+var_2]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
_rev_removeAgeStatus endp

; Attributes: bp-based frame

_rev_resetAgeStatus proc far

	charNo=	word ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	getCharP	[bp+charNo], si
	mov	ax, 5
	push	ax
	lea	ax, roster.savedST[si]
	mov	dx, seg	seg027
	push	dx
	push	ax
	lea	ax, roster.strength[si]
	push	dx
	push	ax
	call	_doAgeStatus
	add	sp, 0Ah
	getCharP	[bp+charNo], bx
	or	gs:roster.status[bx], stat_old
	pop	si
	mov	sp, bp
	pop	bp
	retf
_rev_resetAgeStatus endp

; Attributes: bp-based frame
enterHallOfWizards proc	far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	mov	ax, offset aGuild
	push	ds
	push	ax
	call	setTitle
	add	sp, 4
	mov	ax, 36h	
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
loc_24AC6:
	mov	ax, offset aThouArtInTheHallOfW
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	[bp+var_2], 0
	mov	[bp+var_6], 0
	jmp	short loc_24AE2
loc_24ADF:
	inc	[bp+var_6]
loc_24AE2:
	cmp	[bp+var_6], 4
	jge	short loc_24B06
	mov	bl, gs:txt_numLines
	sub	bh, bh
	sub	bx, [bp+var_6]
	shl	bx, 1
	mov	ax, bitMask16bit[bx]
	or	[bp+var_2], ax
	jmp	short loc_24ADF
loc_24B06:
	push	[bp+var_2]
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_4], ax
	cmp	ax, 10Eh
	jl	short loc_24B2E
	cmp	ax, 119h
	jg	short loc_24B2E
	mov	al, gs:txt_numLines
	sub	ah, ah
	sub	ax, 3
	sub	[bp+var_4], ax
loc_24B2E:
	mov	ax, [bp+var_4]
	jmp	short loc_24B73
loc_24B33:
	mov	ax, 1
	push	ax
	push	cs
	call	near ptr rev_checkXP
	add	sp, 2
	mov	byte ptr word_44166,	0
	jmp	short loc_24B93
loc_24B4A:
	mov	ax, 1
	push	ax
	push	cs
	call	near ptr rev_learnSpells
	add	sp, 2
	mov	byte ptr word_44166,	0
	jmp	short loc_24B93
loc_24B61:
	push	cs
	call	near ptr nonClassSpellGain
	mov	byte ptr word_44166,	0
loc_24B6F:
	jmp	short loc_24B93
	jmp	short loc_24B93
loc_24B73:
	cmp	ax, 41h	
	jz	short loc_24B33
	cmp	ax, 42h	
	jz	short loc_24B61
	cmp	ax, 53h	
	jz	short loc_24B4A
	cmp	ax, 10Eh
	jz	short loc_24B33
	cmp	ax, 10Fh
	jz	short loc_24B4A
	cmp	ax, 110h
	jz	short loc_24B61
	jmp	short loc_24B6F
loc_24B93:
	cmp	[bp+var_4], 45h	
	jz	short loc_24BA3
	cmp	[bp+var_4], 111h
	jz	short loc_24BA3
	jmp	loc_24AC6
loc_24BA3:
	sub	ax, ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
enterHallOfWizards endp

; Attributes: bp-based frame

nonClassSpellGain proc far

	var_10A= word ptr -10Ah
	var_108= word ptr -108h
	var_106= word ptr -106h
	var_104= word ptr -104h
	var_102= word ptr -102h
	var_100= word ptr -100h

	push	bp
	mov	bp, sp
	mov	ax, 10Ah
	call	someStackOperation
	push	si
	mov	ax, offset aWhoSeeksTheSpecialK
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_102], ax
	or	ax, ax
	jge	short loc_24BD4
	jmp	loc_24D7F
loc_24BD4:
	getCharP	[bp+var_102], bx
	mov	bl, gs:roster.class[bx]
	sub	bh, bh
	cmp	mageSpellIndex[bx], 0FFh
	jnz	short loc_24C10
	mov	ax, offset aThouArtNotASpe
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
	jmp	loc_24D7F
loc_24C10:
	mov	ax, currentLocationMaybe
	jmp	short loc_24C32
loc_24C1A:
	mov	[bp+var_10A], 0
	jmp	short loc_24C3E
loc_24C22:
	mov	[bp+var_10A], 1
	jmp	short loc_24C3E
loc_24C2A:
	mov	[bp+var_10A], 2
	jmp	short loc_24C3E
loc_24C32:
	cmp	ax, 3
	jz	short loc_24C1A
	cmp	ax, 6
	jz	short loc_24C22
	jmp	short loc_24C2A
loc_24C3E:
	mov	ax, offset aThouMayLearn
	push	ds
	push	ax
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_106], ax
	mov	[bp+var_104], dx
	mov	bx, [bp+var_10A]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (nonClassSpellList+2)[bx]
	push	word ptr nonClassSpellList[bx]
	push	dx
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_106], ax
	mov	[bp+var_104], dx
	sub	ax, ax
	push	ax
	mov	bx, [bp+var_10A]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (specialSpellCost+2)[bx]
	push	word ptr specialSpellCost[bx]
	push	dx
	push	[bp+var_106]
	call	_itoa
	add	sp, 0Ah
	mov	[bp+var_106], ax
	mov	[bp+var_104], dx
	mov	ax, offset aInGold_WhoWill
	push	ds
	push	ax
	push	dx
	push	[bp+var_106]
	call	_strcat
	add	sp, 8
	mov	[bp+var_106], ax
	mov	[bp+var_104], dx
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printStringWClear
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_108], ax
	or	ax, ax
	jge	short loc_24CDB
	jmp	loc_24D7F
loc_24CDB:
	mov	bx, [bp+var_10A]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr specialSpellCost[bx]
	mov	dx, word ptr (specialSpellCost+2)[bx]
	mov	cx, ax
	mov	bx, dx
	getCharP	[bp+var_108], si
	cmp	word ptr gs:(roster.gold+2)[si], bx
	ja	short loc_24D27
	jb	short loc_24D0C
	cmp	word ptr gs:roster.gold[si], cx
	jnb	short loc_24D27
loc_24D0C:
	mov	ax, offset aNotEnoughGoldNL
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
	jmp	short loc_24D7F
loc_24D27:
	mov	bx, [bp+var_10A]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr specialSpellCost[bx]
	mov	dx, word ptr (specialSpellCost+2)[bx]
	mov	cx, ax
	mov	bx, dx
	getCharP	[bp+var_108], si
	sub	word ptr gs:roster.gold[si], cx
	sbb	word ptr gs:(roster.gold+2)[si], bx
	mov	ax, [bp+var_10A]
	add	ax, 7Ah	
	push	ax
	push	[bp+var_102]
	call	mage_learnSpell
	add	sp, 4
	mov	ax, offset aTheEldersTeachYouTh
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	delayNoTable	5
loc_24D7F:
	pop	si
	mov	sp, bp
	pop	bp
locret_24D83:
	retf
nonClassSpellGain endp

seg012 ends

; Segment type:	Pure code
seg013 segment byte public 'CODE' use16
	assume cs:seg013
;org 4
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
; Attributes: bp-based frame

dunsq_battleCheck proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	call	_random
	and	ax, 80h
	mov	[bp+var_2], ax
	or	ax, ax
	jz	short loc_24DA7
	inc	byte_4EECC

	; Add code to mask the encounter out
	push_imm	7Fh
	push_imm	2
	push	sq_east
	push	sq_north
	func_dun_maskSquare

loc_24DA7:
	mov	ax, [bp+var_2]
	jmp	short $+2
	mov	sp, bp
	pop	bp
locret_24DAF:
	retf
dunsq_battleCheck endp

; Attributes: bp-based frame

dunsq_doTrap proc far

	var_10C= word ptr -10Ch
	var_10A= word ptr -10Ah
	var_108= word ptr -108h
	var_106= word ptr -106h
	var_104= word ptr -104h
	var_102= word ptr -102h
	var_100= word ptr -100h

	push	bp
	mov	bp, sp
	mov	ax, 10Ch
	call	someStackOperation
	push	si
	push	cs
	call	near ptr trap_levitationCheck
	mov	[bp+var_102], ax
	or	ax, ax
	jnz	short loc_24DCB
	jmp	loc_24EB3
loc_24DCB:
	call	_random
	and	ax, 3
	mov	[bp+var_10A], ax
	cmp	ax, 3
	jnz	short loc_24DDE
	jmp	short loc_24DCB
loc_24DDE:
	mov	al, levelNoMaybe
	sub	ah, ah
	and	ax, 7
	shl	ax, 1
	shl	ax, 1
	or	ax, [bp+var_10A]
	mov	gs:word_41E6E, ax
	mov	ax, offset aTrapYouVeHitA
	push	ds
	push	ax
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_106], ax
	mov	[bp+var_104], dx
	mov	bx, gs:word_41E6E
	mov	al, byte_4B278[bx]
	cbw
	mov	bx, ax
	shl	bx, 1
	shl	bx, 1
	push	word ptr (trapTypeString+2)[bx]
	push	word ptr trapTypeString[bx]
	push	dx
	push	[bp+var_106]
	call	_strcat
	add	sp, 8
	mov	[bp+var_106], ax
	mov	[bp+var_104], dx
	lea	ax, [bp+var_100]
	push	ss
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	bx, gs:word_41E6E
	mov	al, byte_4B258[bx]
	cbw
	push	ax
	call	dice_doYDX
	add	sp, 2
	mov	[bp+var_10C], ax
	mov	si, gs:word_41E6E
	shl	si, 1
	mov	al, trapSaveList._low[si]
	mov	gs:monGroups.breathSaveLo, al
	mov	al, trapSaveList._high[si]
	mov	gs:monGroups.breathSaveHi, al
	mov	[bp+var_108], 0
	jmp	short loc_24E9B
loc_24E97:
	inc	[bp+var_108]
loc_24E9B:
	cmp	[bp+var_108], 7
	jge	short loc_24EB3
	push	[bp+var_10C]
	push	[bp+var_108]
	push	cs
	call	near ptr trap_doDamage
	add	sp, 4
	jmp	short loc_24E97
loc_24EB3:
	mov	byte ptr word_44166,	0
	;delayNoTable	2
	sub	ax, ax
	push	ax
	push	sq_east
	push	sq_north
	call	dun_removeTrap
	add	sp, 6
	mov	ax, [bp+var_102]
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
dunsq_doTrap endp

; Attributes: bp-based frame

trap_doDamage proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	getCharP	[bp+arg_0], si
	cmp	byte ptr gs:roster._name[si], 0
	jz	short loc_24F77
	test	gs:roster.status[si], stat_dead
	jnz	short loc_24F77
	mov	al, byte ptr [bp+arg_0]
	mov	gs:bat_curTarget, al
	mov	bx, gs:word_41E6E
	mov	al, byte_4B238[bx]
	and	ax, 7Fh
	mov	gs:specialAttackVal, ax
	mov	ax, [bp+arg_2]
	mov	gs:damageAmount, ax
	sub	ax, ax
	push	ax
	mov	ax, 80h
	push	ax
	call	savingThrowCheck
	add	sp, 4
	mov	[bp+var_2], ax
	or	ax, ax
	jz	short loc_24F77
	mov	ax, 1
	mov	[bp+var_2], ax
	sar	gs:damageAmount, 1
	push	[bp+arg_0]
	call	bat_doHPDamage
	add	sp, 2
loc_24F77:
	pop	si
	mov	sp, bp
	pop	bp
	retf
trap_doDamage endp

; Attributes: bp-based frame

trap_levitationCheck proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	levitationDuration, 0
	jnz	short loc_24F97
	mov	ax, 1
	jmp	short loc_24FA9
loc_24F97:
	call	_random
	and	al, 3
	mov	cx, ax
	cmp	cl, 1
	sbb	ax, ax
	neg	ax
	jmp	short $+2
loc_24FA9:
	mov	sp, bp
	pop	bp
	retf
trap_levitationCheck endp

; Attributes: bp-based frame

dunsq_doDarkness proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	lightDuration, 0
	jz	short loc_24FCE
	sub	ax, ax
	push	ax
	call	sub_17920
	add	sp, 2
loc_24FCE:
	mov	lightDistance, 0
	cmp	gs:byte_4266B, 0
	jz	short loc_24FF5
	cmp	gs:byte_42420, 5
	jnz	short loc_24FF5
	call	sub_22DA1
loc_24FF5:
	mov	ax, offset aDarkness
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	sub	ax, ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
dunsq_doDarkness endp

; Attributes: bp-based frame

dunsq_doSpinner	proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 0
	jmp	short loc_2501F
loc_2501C:
	inc	[bp+var_2]
loc_2501F:
	cmp	[bp+var_2], 7
	jge	short loc_2503F
	mov	ax, itemEff_noSpin
	push	ax
	push	[bp+var_2]
	call	hasEffectEquipped
	add	sp, 4
	or	ax, ax
	jnz	short loc_2503D
	mov	ax, 1
	jmp	short loc_25053
loc_2503D:
	jmp	short loc_2501C
loc_2503F:
	call	_random
	and	ax, 3
	mov	dirFacing, ax
	sub	ax, ax
	jmp	short $+2
loc_25053:
	mov	sp, bp
	pop	bp
	retf
dunsq_doSpinner	endp

; Attributes: bp-based frame

dunsq_antiMagic	proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	inc	gs:sq_antiMagicFlag

	; Change to 1 to skip over lightDuration
	mov	[bp+var_2], 1
	jmp	short loc_25075
loc_25072:
	inc	[bp+var_2]
loc_25075:
	cmp	[bp+var_2], 5
	jge	short loc_25095
	mov	bx, [bp+var_2]

	cmp	lightDuration[bx], 0
	jz	short loc_25093
	push	[bp+var_2]
	call	sub_17920
	add	sp, 2
loc_25093:
	jmp	short loc_25072
loc_25095:
	mov	byte ptr word_44166, 0
	sub	ax, ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
dunsq_antiMagic	endp

; Attributes: bp-based frame

dunsq_drainHP proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	di
	push	si
	mov	[bp+var_2], 0
	jmp	short loc_250B4
loc_250B1:
	inc	[bp+var_2]
loc_250B4:
	cmp	[bp+var_2], 7
	jge	short loc_25103
	getCharP	[bp+var_2], si
	test	gs:roster.status[si], stat_dead	or stat_stoned
	jnz	short loc_25101
	mov	al, levelNoMaybe
	sub	ah, ah
	mov	di, ax
	cmp	gs:roster.currentHP[si], di
	jbe	short loc_250EC
	sub	gs:roster.currentHP[si], di
	jmp	short loc_25101
loc_250EC:
	getCharP	[bp+var_2], si
	mov	gs:roster.currentHP[si], 0
	or	gs:roster.status[si], stat_dead
loc_25101:
	jmp	short loc_250B1
loc_25103:
	call	rost_getLastActiveSlot
	cmp	ax, 7
	jle	short loc_25118
	mov	buildingRvalMaybe, 5
loc_25118:
	mov	byte ptr word_44166, 0
	sub	ax, ax
	jmp	short $+2
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
dunsq_drainHP endp

; Attributes: bp-based frame
dunsq_somethingOdd proc	far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	sub	al, al
	mov	detectType, al
	mov	gs:byte_41E61, al
	sub	ax, ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
dunsq_somethingOdd endp

; Attributes: bp-based frame

dunsq_doSilence	proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	gs:byte_4266B, 0
	jz	short loc_2516E
	mov	ax, offset aTheSoundOfSile
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	call	sub_22DA1
loc_2516E:
	sub	ax, ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
dunsq_doSilence	endp

; Attributes: bp-based frame

dunsq_regenSppt	proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	inc	gs:regenSpptSq
	sub	ax, ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
dunsq_regenSppt	endp

; Attributes: bp-based frame

dunsq_drainSppt	proc far

	var_4= word ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	[bp+var_4], 0
	jmp	short loc_251A6
loc_251A3:
	inc	[bp+var_4]
loc_251A6:
	cmp	[bp+var_4], 7
	jge	short loc_251F9
	call	_random
	and	ax, 3
	mov	cl, levelNoMaybe
	sub	ch, ch
	add	ax, cx
	mov	[bp+var_2], ax
	mov	cx, ax
	getCharP	[bp+var_4], bx
	cmp	gs:roster.currentSppt[bx], cx
	jbe	short loc_251E8
	getCharP	[bp+var_4], bx
	sub	gs:roster.currentSppt[bx], cx
	jmp	short loc_251F7
loc_251E8:
	getCharP	[bp+var_4], bx
	mov	gs:roster.currentSppt[bx], 0
loc_251F7:
	jmp	short loc_251A3
loc_251F9:
	mov	byte ptr word_44166,	0
	sub	ax, ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
dunsq_drainSppt	endp

; Attributes: bp-based frame

dunsq_monHostile proc far

	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 0
	jmp	short loc_25220
loc_2521D:
	inc	[bp+var_2]
loc_25220:
	cmp	[bp+var_2], 7
	jge	short loc_25240
	mov	ax, itemEff_calmMonster
	push	ax
	push	[bp+var_2]
	call	hasEffectEquipped
	add	sp, 4
	or	ax, ax
	jnz	short loc_2523E
	mov	ax, 1
	jmp	short loc_25290
loc_2523E:
	jmp	short loc_2521D
loc_25240:
	mov	[bp+var_2], 0
	jmp	short loc_2524A
loc_25247:
	inc	[bp+var_2]
loc_2524A:
	cmp	[bp+var_2], 7
	jge	short loc_2528B
	getCharP	[bp+var_2], bx
	cmp	gs:roster.class[bx], class_monster

	; FIXED - Was jz. This activated the square when there were no monsters
	; in the party.
	jnz	short loc_25289
	call	_random
	test	al, 3
	jnz	short loc_25289
	getCharP	[bp+var_2], bx
	mov	gs:roster.hostileFlag[bx], 1
	mov	byte_4EECC, 1
loc_25289:
	jmp	short loc_25247
loc_2528B:
	mov	ax, 1
	jmp	short $+2
loc_25290:
	push_imm	7Fh
	push_imm	3
	push	sq_east
	push	sq_north
	func_dun_maskSquare

	mov	sp, bp
	pop	bp
	retf
dunsq_monHostile endp

; Attributes: bp-based frame

dunsq_doStuck proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	call	_random
	and	al, 3
	mov	gs:stuckFlag, al
	sub	ax, ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
dunsq_doStuck endp

; Attributes: bp-based frame

dunsq_unknown3 proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	inc	gs:byte_4229B
	sub	ax, ax
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
dunsq_unknown3 endp

; Attributes: bp-based frame

dunsq_doExplosion proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	lightDuration, 0
	jz	short loc_252F7
	mov	ax, offset aAnExplosion
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	push	cs
	call	near ptr dunsq_drainHP
loc_252F7:
	mov	ax, 1
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
dunsq_doExplosion endp

; Attributes: bp-based frame

dunsq_portalAbove proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, offset aThereIsAPortAbove
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
dunsq_portalAbove endp

; Attributes: bp-based frame

dunsq_portalBelow proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, offset aThereIsAPortBelow
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	sp, bp
	pop	bp
	retf
dunsq_portalBelow endp

; Attributes: bp-based frame

dun_doSpecialSquare proc far

	counter= word ptr -6
	var_4= dword ptr -4
	rowBuf=	dword ptr  6
	sqEast=	word ptr  0Ah
	sqNorth= word ptr  0Ch

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	sub	al, al
	mov	gs:byte_4229B, al
	mov	gs:stuckFlag, al
	mov	gs:sq_antiMagicFlag, al
	mov	gs:regenSpptSq,	al
	mov	byte_4EECC, al
	mov	bx, [bp+sqNorth]
	shl	bx, 1
	shl	bx, 1
	lfs	si, [bp+rowBuf]
	mov	ax, fs:[bx+si]
	mov	dx, fs:[bx+si+2]
	mov	cx, [bp+sqEast]
	mov	bx, cx
	shl	cx, 1
	shl	cx, 1
	add	cx, bx
	add	ax, cx
	add	ax, 2
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	mov	[bp+counter], 0
	jmp	short loc_2539D
loc_2539A:
	inc	[bp+counter]
loc_2539D:
	cmp	[bp+counter], 10h
	jge	short loc_253CB
	mov	bx, [bp+counter]
	mov	bl, byte_4B326[bx]
	sub	bh, bh
	lfs	si, [bp+var_4]
	mov	al, fs:[bx+si]
	sub	ah, ah
	mov	bx, [bp+counter]
	mov	cl, byte_4B336[bx]
	sub	ch, ch
	test	ax, cx
	jz	short loc_253C9
	shl	bx, 1
	shl	bx, 1
	call	off_4B2E6[bx]
loc_253C9:
	jmp	short loc_2539A
loc_253CB:
	pop	si
	mov	sp, bp
	pop	bp
	retf
dun_doSpecialSquare endp

; Attributes: bp-based frame

sub_253D0 proc far

	var_4= byte ptr	-4
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	[bp+var_2], 0
	jmp	short loc_253E6
loc_253E3:
	inc	[bp+var_2]
loc_253E6:
	cmp	[bp+var_2], 7
	jge	short loc_2544D
	push	[bp+var_2]
	push	cs
	call	near ptr sub_25452
	add	sp, 2
	or	ax, ax
	jz	short loc_2544B
	getCharP	[bp+var_2], bx
	mov	al, gs:roster.class[bx]
	mov	[bp+var_4], al
	or	al, al
	jz	short loc_25422
	cmp	al, 5
	jnb	short loc_25422
	push	[bp+var_2]
	push	cs
	call	near ptr sub_2549D
	add	sp, 2
	jmp	short loc_2544B
loc_25422:
	mov	ax, 34
	push	ax
	push	[bp+var_2]
	call	getXPForLevel
	add	sp, 4
	mov	cx, ax
	mov	bx, dx
	getCharP	[bp+var_2], si
	mov	word ptr gs:roster.experience[si], cx
	mov	word ptr gs:(roster.experience+2)[si], bx
loc_2544B:
	jmp	short loc_253E3
loc_2544D:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_253D0 endp

; Attributes: bp-based frame

sub_25452 proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	getCharP	[bp+arg_0], bx
	test	gs:(roster.chronoQuest+1)[bx], 1
	jnz	short loc_25495
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.class[bx], class_monster
	jnb	short loc_25495
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.level[bx], 35
	jnb	short loc_25495
	mov	ax, 1
	jmp	short loc_25497
loc_25495:
	sub	ax, ax
loc_25497:
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_25452 endp

; Attributes: bp-based frame

sub_2549D proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	[bp+var_2], 0
	jmp	short loc_254B3
loc_254B0:
	inc	[bp+var_2]
loc_254B3:
	cmp	[bp+var_2], 74
	jge	short loc_254C9
	push	[bp+var_2]
	push	[bp+arg_0]
	call	mage_learnSpell
	add	sp, 4
	jmp	short loc_254B0
loc_254C9:
	getCharP	[bp+arg_0], si
	mov	gs:roster.class[si], class_archmage
	sub	ax, ax
	mov	word ptr gs:(roster.experience+2)[si], ax
	mov	word ptr gs:roster.experience[si], ax
	mov	ax, 14h
	push	ax
	lea	ax, roster.strength[si]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	cs
	call	near ptr sub_25544
	add	sp, 6
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.maxHP[bx], 375
	jnb	short loc_2551F
	getCharP	[bp+arg_0], bx
	mov	gs:roster.maxHP[bx], 375
loc_2551F:
	getCharP	[bp+arg_0], bx
	cmp	gs:roster.maxSppt[bx], 350
	jnb	short loc_2553F
	getCharP	[bp+arg_0], bx
	mov	gs:roster.maxSppt[bx], 350
loc_2553F:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_2549D endp

; Attributes: bp-based frame

sub_25544 proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	[bp+var_2], 0
	jmp	short loc_2555A
loc_25557:
	inc	[bp+var_2]
loc_2555A:
	cmp	[bp+var_2], 5
	jge	short loc_25577
	mov	bx, [bp+var_2]
	lfs	si, [bp+arg_0]
	mov	al, fs:[bx+si]
	cbw
	cmp	ax, [bp+arg_4]
	jge	short loc_25575
	mov	al, byte ptr [bp+arg_4]
	mov	fs:[bx+si], al
loc_25575:
	jmp	short loc_25557
loc_25577:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_25544 endp

; Attributes: bp-based frame
convertToGeomancer proc	far

	charNo=	word ptr  6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	push	si
	getCharP	[bp+charNo], si
	mov	gs:roster.class[si], class_geomancer
	sub	ax, ax
	mov	word ptr gs:(roster.experience+2)[si], ax
	mov	word ptr gs:roster.experience[si], ax
	mov	gs:roster.level[si], 1
	mov	gs:roster.maxLevel[si],	1
	mov	gs:roster.currentSppt[si], 25
	mov	gs:roster.maxSppt[si], 25
	mov	ax, 0Ch
	push	ax
	push	[bp+charNo]
	push	cs
	call	near ptr sub_2561D
	add	sp, 4
	getCharP	[bp+charNo], bx
	mov	gs:roster.numAttacks[bx], 0
	mov	ax, 106
	push	ax
	push	[bp+charNo]
	call	mage_learnSpell
	add	sp, 4
	mov	ax, 107
	push	ax
	push	[bp+charNo]
	call	mage_learnSpell
	add	sp, 4
	mov	ax, 108
	push	ax
	push	[bp+charNo]
	call	mage_learnSpell
	add	sp, 4
	mov	byte ptr word_44166,	0
	pop	si
	mov	sp, bp
	pop	bp
	retf
convertToGeomancer endp

; Attributes: bp-based frame

sub_2561D proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	si
	mov	[bp+var_4], 0
	jmp	short loc_25634
loc_25630:
	add	[bp+var_4], 3
loc_25634:
	cmp	[bp+var_4], 24h	
	jge	short loc_2568F
	getCharP	[bp+arg_0], si
	add	si, [bp+var_4]
	mov	al, gs:roster.inventory.itemNo[si]
	sub	ah, ah
	mov	[bp+var_6], ax
	mov	bx, ax
	mov	al, itemEquipMask[bx]
	mov	bx, [bp+arg_2]
	mov	cl, classEquipMask[bx]
	sub	ch, ch
	test	ax, cx
	jz	short loc_25674
	sub	ax, ax
	jmp	short loc_25677
loc_25674:
	mov	ax, 2
loc_25677:
	mov	[bp+var_2], ax
	mov	al, gs:roster.inventory.itemFlags[si]
	and	al, 0FCh
	or	al, byte ptr [bp+var_2]
	mov	gs:roster.inventory.itemFlags[si], al
	jmp	short loc_25630
loc_2568F:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_2561D endp

; Attributes: bp-based frame

dun_detectSquares proc far

	aheadFlags= word ptr -8
	var_4= word ptr	-4
	var_2= word ptr	-2
	sqE= word ptr  6
	sqN= word ptr  8
	_dirFacing= word ptr  0Ah

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	cmp	detectDuration, 0
	jnz	short loc_256AF
	jmp	loc_25768
loc_256AF:
	mov	al, gs:byte_4255D
	sub	ah, ah
	cmp	ax, [bp+sqE]
	jnz	short loc_256DB
	mov	al, gs:byte_42242
	cmp	ax, [bp+sqN]
	jnz	short loc_256DB
	mov	al, gs:byte_42566
	cmp	ax, [bp+_dirFacing]
	jnz	short loc_256DB
	jmp	loc_25768
loc_256DB:
	mov	al, byte ptr [bp+sqE]
	mov	gs:byte_4255D, al
	mov	al, byte ptr [bp+sqN]
	mov	gs:byte_42242, al
	mov	al, byte ptr [bp+_dirFacing]
	mov	gs:byte_42566, al
	lea	ax, [bp+aheadFlags]
	push	ss
	push	ax
	push	[bp+sqN]
	push	[bp+sqE]
	push	cs
	call	near ptr dun_getSqFlagAhead3
	add	sp, 8
	mov	bl, detectType
	sub	bh, bh
	mov	al, byte_4B2B8[bx]
	cbw
	mov	[bp+var_4], ax
loc_25721:
	mov	bx, [bp+var_4]
	mov	al, detectByte[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	cmp	ax, 0FFh
	jge	short loc_25768
	mov	si, ax
	mov	al, byte ptr [bp+si+aheadFlags]
	cbw
	mov	cl, detectMask[bx]
	sub	ch, ch
	test	ax, cx
	jz	short loc_25763

	;mov	bx, si
	mov	bx, [bp+var_4]
	mov	al, detectMsgIndex[bx]
	cbw
	mov	bx, ax
	shl	bx, 1
	shl	bx, 1
	push	word ptr (detectMessages+2)[bx]
	push	word ptr detectMessages[bx]
	call	printString
	add	sp, 4
loc_25763:
	inc	[bp+var_4]
loc_25766:
	jmp	short loc_25721
loc_25768:
	pop	si
	mov	sp, bp
	pop	bp
	retf
dun_detectSquares endp

; This function	returns	a list of the square flags
; for the three	squares	ahead.
; Attributes: bp-based frame

dun_getSqFlagAhead3 proc far

	sqFlagP= dword ptr -8
	counter= word ptr -4
	deltaSq= word ptr -2
	sqE= word ptr  6
	sqN= word ptr  8
	rSqList= dword ptr  0Ah

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	mov	[bp+deltaSq], 0
	jmp	short loc_25783
loc_25780:
	inc	[bp+deltaSq]
loc_25783:
	cmp	[bp+deltaSq], 3
	jge	short loc_25795
	mov	bx, [bp+deltaSq]
	lfs	si, [bp+rSqList]
	mov	byte ptr fs:[bx+si], 0
	jmp	short loc_25780
loc_25795:
	mov	[bp+deltaSq], 0
	jmp	short loc_2579F
loc_2579C:
	inc	[bp+deltaSq]
loc_2579F:
	cmp	[bp+deltaSq], 3
	jge	loc_25816
	mov	si, dirFacing
	shl	si, 1
	mov	ax, dirDeltaE[si]
	add	[bp+sqE], ax
	mov	al, dunWidth
	sub	ah, ah
	push_reg	ax
	push_var_stack	sqE
	std_call	wrapNumber, 4
	mov	[bp+sqE], ax
	mov	ax, dirDeltaN[si]
	sub	[bp+sqN], ax
	mov	al, dunHeight
	sub	ah, ah
	push_reg	ax
	push_var_stack	sqN
	std_call	wrapNumber, 4
	mov	[bp+sqN], ax
	mov	bx, [bp+sqN]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr gs:rowOffset[bx]
	mov	dx, word ptr gs:(rowOffset+2)[bx]
	mov	cx, [bp+sqE]
	mov	bx, cx
	shl	cx, 1
	shl	cx, 1
	add	cx, bx
	add	ax, cx
	add	ax, 2
	mov	word ptr [bp+sqFlagP], ax
	mov	word ptr [bp+sqFlagP+2], dx
	mov	[bp+counter], 0
	jmp	short loc_257DA
loc_257D7:
	inc	[bp+counter]
loc_257DA:
	cmp	[bp+counter], 3
	jge	short loc_2579C
	mov	bx, [bp+counter]
	lfs	si, [bp+sqFlagP]
	mov	al, fs:[bx+si]
	lfs	si, [bp+rSqList]
	or	fs:[bx+si], al
	jmp	short loc_257D7
loc_25816:
	pop	si
	mov	sp, bp
	pop	bp
	retf
dun_getSqFlagAhead3 endp

; Attributes: bp-based frame

dun_ascendPortal proc far

	var_4= dword ptr -4
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	bx, [bp+arg_2]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr gs:rowOffset[bx]
	mov	dx, word ptr gs:(rowOffset+2)[bx]
	mov	cx, [bp+arg_0]
	mov	bx, cx
	shl	cx, 1
	shl	cx, 1
	add	cx, bx
	add	ax, cx
	add	ax, 2
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	lfs	bx, [bp+var_4]
	test	byte ptr fs:[bx], 40h
	jz	short loc_2587C
	cmp	levitationDuration, 0
	jz	short loc_2587C
	test	levFlags, 10h
	jz	short loc_25878
	push	cs
	call	near ptr sub_2590E
	jmp	short loc_2587C
loc_25878:
	push	cs
	call	near ptr sub_258E9
loc_2587C:
	mov	sp, bp
	pop	bp
	retf
dun_ascendPortal endp

; Attributes: bp-based frame

dun_descendPortal proc far

	var_4= dword ptr -4
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	bx, [bp+arg_2]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr gs:rowOffset[bx]
	mov	dx, word ptr gs:(rowOffset+2)[bx]
	mov	cx, [bp+arg_0]
	mov	bx, cx
	shl	cx, 1
	shl	cx, 1
	add	cx, bx
	add	ax, cx
	add	ax, 2
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	lfs	bx, [bp+var_4]
	test	byte ptr fs:[bx], 20h
	jz	short loc_258E5
	cmp	levitationDuration, 0
	jnz	short loc_258CF
	push	cs
	call	near ptr dunsq_drainHP
loc_258CF:
	test	levFlags, 10h
	jz	short loc_258E1
	push	cs
	call	near ptr sub_258E9
	jmp	short loc_258E5
loc_258E1:
	push	cs
	call	near ptr sub_2590E
loc_258E5:
	mov	sp, bp
	pop	bp
	retf
dun_descendPortal endp

; Attributes: bp-based frame

sub_258E9 proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	dec	dunLevelNum
	jns	short loc_25905
	call	dun_setExitLocation
	jmp	short loc_2590A
loc_25905:
	call	dun_changeLevels
loc_2590A:
	mov	sp, bp
	pop	bp
	retf
sub_258E9 endp

; Attributes: bp-based frame

sub_2590E proc far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	inc	dunLevelNum
	call	dun_changeLevels
	mov	sp, bp
	pop	bp
	retf
sub_2590E endp

; Attributes: bp-based frame

dun_randomMonJoin proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	call	findEmptyRosterNum
	mov	[bp+var_2], ax
	cmp	ax, 7
	jl	short loc_25963
	call	dropPartyMember
	or	ax, ax
	jnz	short loc_25951
	sub	ax, ax
	jmp	short loc_25983
	jmp	short loc_25963
loc_25951:
	call	findEmptyRosterNum
	mov	[bp+var_2], ax
	mov	byte ptr word_44166,	0
loc_25963:
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	[bp+var_2]
	call	_sp_convertMonToSummon
	add	sp, 6
	mov	byte ptr word_44166,	0
	mov	ax, 1
	jmp	short $+2
loc_25983:
	mov	sp, bp
	pop	bp
	retf
dun_randomMonJoin endp

; Attributes: bp-based frame
dun_randomMonFight proc	far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	byte_4EEC9, 1
	mov	gs:byte_42458, 1
	mov	byte_4EECC, 1
	mov	ax, 1
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
dun_randomMonFight endp

; Attributes: bp-based frame
dun_randomMonLeave proc	far
	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, 1
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
dun_randomMonLeave endp

; Attributes: bp-based frame

dun_wanderingCreature proc far

	var_48=	dword ptr -48h
	var_44=	word ptr -44h
	var_42=	word ptr -42h
	var_40=	word ptr -40h
	var_30=	dword ptr -30h
	var_2C=	word ptr -2Ch
	var_1C=	word ptr -1Ch
	var_16=	word ptr -16h
	var_14=	word ptr -14h
	var_8= word ptr	-8
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 48h	
	call	someStackOperation
	push	si
loc_259D7:
	mov	ax, 17h
	push	ax
	sub	ax, ax
	push	ax
	call	randomBetweenXandY
	add	sp, 4
	mov	[bp+var_2], ax
	getMonIndex	ax, [bp+var_2]
	add	ax, offset monsterBuf
	mov	word ptr [bp+var_30], ax
	mov	word ptr [bp+var_30+2],	seg seg023
	lfs	bx, [bp+var_30]
	test	fs:[bx+mon_t.flags], mon_noSummon
	jnz	short loc_259D7
	cmp	byte ptr fs:[bx], 0
	jz	short loc_259D7
	mov	al, fs:[bx+mon_t.picIndex]
	sub	ah, ah
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
	lea	ax, [bp+var_2C]
	push	ss
	push	ax
	push	word ptr [bp+var_30+2]
	push	word ptr [bp+var_30]
	call	decryptName
	add	sp, 8
	sub	ax, ax
	push	ax
	lea	ax, [bp+var_40]
	push	ss
	push	ax
	lea	ax, [bp+var_2C]
	push	ss
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	word ptr [bp+var_48], ax
	mov	word ptr [bp+var_48+2],	dx
	lfs	bx, [bp+var_48]
	mov	byte ptr fs:[bx], 0
	lea	ax, [bp+var_40]
	push	ss
	push	ax
	call	setTitle
	add	sp, 4
	mov	gs:monGroups.groupSize,	1
	mov	al, byte ptr [bp+var_2]
	mov	byte ptr gs:monGroups._name, al
	mov	[bp+var_44], 0
	jmp	short loc_25A76
loc_25A73:
	inc	[bp+var_44]
loc_25A76:
	cmp	[bp+var_44], 5
	jge	short loc_25A85
	mov	si, [bp+var_44]
	mov	byte ptr [bp+si+var_8],	1
	jmp	short loc_25A73
loc_25A85:
	call	clearTextWindow
	lea	ax, [bp+var_14]
	push	ss
	push	ax
	lea	ax, [bp+var_1C]
	push	ss
	push	ax
	lea	ax, [bp+var_8]
	push	ss
	push	ax
	mov	ax, offset aAWanderingCreatureOff
	push	ds
	push	ax
	call	printVarString
	add	sp, 10h
	mov	[bp+var_42], ax
	mov	[bp+var_44], 0
	push	ax
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_16], ax
	cmp	ax, 1Bh
	jnz	short loc_25AC1
	jmp	short loc_25B03
loc_25AC1:
	mov	si, [bp+var_44]
	cmp	byte ptr [bp+si+var_1C], 0
	jz	short loc_25B01
	mov	al, byte ptr [bp+si+var_1C]
	cbw
	cmp	ax, [bp+var_16]
	jz	short loc_25ADD
	shl	si, 1
	mov	ax, [bp+var_16]
	cmp	[bp+si+var_14],	ax
	jnz	short loc_25AFC
loc_25ADD:
	push	word ptr [bp+var_30+2]
	push	word ptr [bp+var_30]
	mov	bx, [bp+var_44]
	shl	bx, 1
	shl	bx, 1
	call	off_4B346[bx]
	add	sp, 4
	or	ax, ax
	jz	short loc_25AFA
	call	clearTextWindow
loc_25AFA:
	jmp	short loc_25B03
loc_25AFC:
	inc	[bp+var_44]
	jmp	short loc_25AC1
loc_25B01:
	jmp	short loc_25A85
loc_25B03:
	pop	si
	mov	sp, bp
	pop	bp
locret_25B07:
	retf
dun_wanderingCreature endp

seg013 ends

; Segment type:	Pure code
seg014 segment byte public 'CODE' use16
	assume cs:seg014
;org 8
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
; Attributes: bp-based frame

bards_enter proc far
var_4= word ptr	-4
var_2= word ptr	-2
	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	si
	mov	ax, offset aBardSHall
	push	ds
	push	ax
	call	setTitle
	add	sp, 4
	mov	ax, 53h	
	push	ax
	call	bigpic_drawPicNumber
	add	sp, 2
loc_25B2D:
	mov	ax, offset aWelcomeAndBeHa
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	al, gs:txt_numLines
	sub	ah, ah
	mov	si, ax
	shl	si, 1
	mov	ax, word_44166[si]
	or	ax, bitMask16bit[si]
	mov	[bp+var_2], ax
	push	ax
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_4], ax
	cmp	ax, 10Eh
	jl	short loc_25B7D
	cmp	ax, 119h
	jg	short loc_25B7D
	mov	al, gs:txt_numLines
	sub	ah, ah
	dec	ax
	sub	[bp+var_4], ax
loc_25B7D:
	cmp	[bp+var_4], 'L'
	jz	short loc_25B8A
	cmp	[bp+var_4], 10Eh
	jnz	short loc_25B8E
loc_25B8A:
	push	cs
	call	near ptr bards_listen
loc_25B8E:
	cmp	[bp+var_4], 1Bh
	jz	short loc_25BA1
	cmp	[bp+var_4], 'E'
	jz	short loc_25BA1
	cmp	[bp+var_4], 10Fh
	jnz	short loc_25B2D
loc_25BA1:
	sub	ax, ax
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
bards_enter endp

; Attributes: bp-based frame

bards_listen proc far

	var_2E=	word ptr -2Eh
	var_1A=	word ptr -1Ah
	var_10=	word ptr -10h
	var_E= word ptr	-0Eh
	var_C= word ptr	-0Ch
	var_2= word ptr	-2

	push	bp
	mov	bp, sp
	mov	ax, 2Eh	
	call	someStackOperation
	push	si
	lea	ax, [bp+var_C]
	push	ss
	push	ax
	cmp	currentLocationMaybe, 9
	jnz	short loc_25BCC
	mov	ax, 1
	jmp	short loc_25BCE
loc_25BCC:
	sub	ax, ax
loc_25BCE:
	push	ax
	push	cs
	call	near ptr sub_25E1B
	add	sp, 6
	call	clearTextWindow
	lea	ax, [bp+var_2E]
	push	ss
	push	ax
	lea	ax, [bp+var_1A]
	push	ss
	push	ax
	lea	ax, [bp+var_C]
	push	ss
	push	ax
	mov	ax, offset aTheseAreTheSon
	push	ds
	push	ax
	call	printVarString
	add	sp, 10h
	mov	[bp+var_E], ax
loc_25BFA:
	push	[bp+var_E]
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_2], ax
	cmp	ax, 1Bh
	jnz	short loc_25C0F
	jmp	short loc_25C6D
loc_25C0F:
	mov	[bp+var_10], 0
	jmp	short loc_25C19
loc_25C16:
	inc	[bp+var_10]
loc_25C19:
	cmp	[bp+var_10], 6
	jge	short loc_25C6B
	mov	si, [bp+var_10]
	mov	al, byte ptr [bp+si+var_1A]
	cbw
	cmp	ax, [bp+var_2]
	jz	short loc_25C35
	shl	si, 1
	mov	ax, [bp+var_2]
	cmp	[bp+si+var_2E],	ax
	jnz	short loc_25C69
loc_25C35:
	mov	bx, [bp+var_10]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr bardSongLyrics[bx]
	or	ax, word ptr (bardSongLyrics+2)[bx]
	jnz	short loc_25C5D
	cmp	[bp+var_10], 2
	jnz	short loc_25C51
	mov	ax, 1
	jmp	short loc_25C53
loc_25C51:
	sub	ax, ax
loc_25C53:
	push	ax
	push	cs
	call	near ptr bards_learnSong
	add	sp, 2
	jmp	short loc_25C67
loc_25C5D:
	push	[bp+var_10]
	push	cs
	call	near ptr sub_25C72
	add	sp, 2
loc_25C67:
	jmp	short loc_25C6D
loc_25C69:
	jmp	short loc_25C16
loc_25C6B:
	jmp	short loc_25BFA
loc_25C6D:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bards_listen endp

; Attributes: bp-based frame

sub_25C72 proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	call	clearTextWindow
	mov	[bp+var_2], 0
	jmp	short loc_25C8D
loc_25C8A:
	inc	[bp+var_2]
loc_25C8D:
	mov	bx, [bp+arg_0]
	shl	bx, 1
	mov	ax, [bp+var_2]
	cmp	word_4BDC4[bx],	ax
	jle	short loc_25CC9
	mov	si, ax
	shl	si, 1
	shl	si, 1
	mov	bx, [bp+arg_0]
	shl	bx, 1
	shl	bx, 1
	lfs	bx, bardSongLyrics[bx]
	push	word ptr fs:[bx+si+2]
	push	word ptr fs:[bx+si]
	call	printString
	add	sp, 4
	wait4IO
	jmp	short loc_25C8A
loc_25CC9:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_25C72 endp

; Attributes: bp-based frame

bards_learnSong	proc far

	var_108= word ptr -108h
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 108h
	call	someStackOperation
	push	si
	mov	ax, offset aTheBardSmilesA
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
	mov	ax, offset aItWillCostYou
	push	ds
	push	ax
	lea	ax, [bp+var_108]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	sub	ax, ax
	push	ax
	mov	bx, [bp+arg_0]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (bardSongPrice+2)[bx]
	push	word ptr bardSongPrice[bx]
	push	dx
	push	[bp+var_4]
	call	_itoa
	add	sp, 0Ah
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	mov	ax, offset aInGold_WhoWill
	push	ds
	push	ax
	push	dx
	push	[bp+var_4]
	call	_strcat
	add	sp, 8
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	lea	ax, [bp+var_108]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	call	getCharNumber
	mov	[bp+var_8], ax
	or	ax, ax
	jge	short loc_25D64
	jmp	loc_25E16
loc_25D64:
	mov	bx, [bp+arg_0]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr bardSongPrice[bx]
	mov	dx, word ptr (bardSongPrice+2)[bx]
	mov	cx, ax
	mov	bx, dx
	getCharP	[bp+var_8], si
	cmp	word ptr gs:(roster.gold+2)[si], bx
	ja	short loc_25DA2
	jb	short loc_25D93
	cmp	word ptr gs:roster.gold[si], cx
	jnb	short loc_25DA2
loc_25D93:
	mov	ax, offset aNotEnoughGoldNL
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	jmp	short loc_25E0A
loc_25DA2:
	mov	bx, [bp+arg_0]
	shl	bx, 1
	shl	bx, 1
	mov	ax, word ptr bardSongPrice[bx]
	mov	dx, word ptr (bardSongPrice+2)[bx]
	mov	cx, ax
	mov	bx, dx
	getCharP	[bp+var_8], si
	sub	word ptr gs:roster.gold[si], cx
	sbb	word ptr gs:(roster.gold+2)[si], bx
	mov	[bp+var_6], 0
	jmp	short loc_25DD5
loc_25DD2:
	inc	[bp+var_6]
loc_25DD5:
	cmp	[bp+var_6], 7
	jge	short loc_25DFD
	getCharP	[bp+var_6], si
	cmp	gs:roster.class[si], class_bard
	jnz	short loc_25DFB
	mov	bx, [bp+arg_0]
	mov	al, byte_4BDF0[bx]
	or	gs:(roster.specAbil+1)[si], al
loc_25DFB:
	jmp	short loc_25DD2
loc_25DFD:
	mov	ax, offset aTheBardPlaysTh
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
loc_25E0A:
	wait4IO
loc_25E16:
	pop	si
	mov	sp, bp
	pop	bp
	retf
bards_learnSong	endp

; Attributes: bp-based frame

sub_25E1B proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= dword ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	[bp+var_2], 0
	jmp	short loc_25E31
loc_25E2E:
	inc	[bp+var_2]
loc_25E31:
	cmp	[bp+var_2], 3
	jge	short loc_25E4A
	mov	bx, [bp+var_2]
	lfs	si, [bp+arg_2]
	cmp	[bp+arg_0], 1
	sbb	ax, ax
	neg	ax
	mov	fs:[bx+si], al
	jmp	short loc_25E2E
loc_25E4A:
	mov	[bp+var_2], 3
	jmp	short loc_25E54
loc_25E51:
	inc	[bp+var_2]
loc_25E54:
	cmp	[bp+var_2], 6
	jge	short loc_25E68
	mov	bx, [bp+var_2]
	lfs	si, [bp+arg_2]
	mov	al, byte ptr [bp+arg_0]
	mov	fs:[bx+si], al
	jmp	short loc_25E51
loc_25E68:
	pop	si
	mov	sp, bp
	pop	bp
locret_25E6C:
	retf
sub_25E1B endp

seg014 ends

; Segment type:	Pure code
seg015 segment word public 'CODE' use16
	assume cs:seg015
;org 0Dh
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
algn_25E6D:
align 2
; Attributes: bp-based frame

doSummon proc far

	arg_0= byte ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	test	gs:byte_4240E, 40h
	jz	short loc_25E96
	mov	ax, offset aButItFizzledNL
	mov	dx, seg	dseg
	push	dx
	push	ax
	call	printString
	add	sp, 4
	jmp	short loc_25EB2
loc_25E96:
	test	[bp+arg_0], 80h
	jz	short loc_25EA8
	push	[bp+arg_2]
	push	cs
	call	near ptr sum_monSummon
	add	sp, 2
	jmp	short loc_25EB2
loc_25EA8:
	push	[bp+arg_2]
	push	cs
	call	near ptr sum_partySummonSpell
	add	sp, 2
loc_25EB2:
	mov	sp, bp
	pop	bp
locret_25EB5:
	retf
doSummon endp

; Attributes: bp-based frame

sum_partySummonSpell proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	mov	[bp+var_4], 0
loc_25EC6:
	call	findEmptyRosterNum
	mov	[bp+var_2], ax
	cmp	ax, 7
	jge	short loc_25F1E
	mov	ax, [bp+arg_0]
	and	ax, 1Fh
	getMonIndex	cx, cx
	add	ax, offset summonData
	push	ds
	push	ax
	push	[bp+var_2]
	call	_sp_convertMonToSummon
	add	sp, 6
	test	byte ptr [bp+arg_0], 80h
	jz	short loc_25EF8
	mov	al, class_illusion
	jmp	short loc_25EFA
loc_25EF8:
	mov	al, class_monster
loc_25EFA:
	mov	cx, ax
	getCharP	[bp+var_2], bx
	mov	gs:roster.class[bx], cl
	mov	byte ptr word_44166,	0
	mov	[bp+var_4], 1
	jmp	short loc_25F2A
loc_25F1E:
	push	[bp+var_4]
	push	cs
	call	near ptr sum_printNoRoom
	add	sp, 2
	jmp	short loc_25F36
loc_25F2A:
	cmp	curSpellNo, 4Dh 
	jz	short loc_25EC6
loc_25F36:
	mov	sp, bp
	pop	bp
	retf
sum_partySummonSpell endp

; Attributes: bp-based frame

sum_monSummon proc far

	groupNo= word ptr -6
	var_4= word ptr	-4
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	mov	[bp+var_4], 0
loc_25F4A:
	mov	[bp+groupNo], 0
	jmp	short loc_25F54
loc_25F51:
	inc	[bp+groupNo]
loc_25F54:
	cmp	[bp+groupNo], 4
	jge	short loc_25F72
	getMonP	[bp+groupNo], bx
	test	gs:monGroups.groupSize[bx], 1Fh
	jnz	short loc_25F70
	jmp	short loc_25F72
loc_25F70:
	jmp	short loc_25F51
loc_25F72:
	cmp	[bp+groupNo], 4
	jge	short loc_25F97
	push	[bp+groupNo]
	push	[bp+arg_0]
	push	cs
	call	near ptr sum_newMonGroup
	add	sp, 4
	push	[bp+groupNo]
	push	[bp+arg_0]
	push	cs
	call	near ptr sum_addMonToGroup
	add	sp, 4
	or	[bp+var_4], ax
	jmp	short loc_25FDA
loc_25F97:
	cmp	curSpellNo, 4Dh 
	jnz	short loc_25FAF
	push	[bp+var_4]
	push	cs
	call	near ptr sum_printNoRoom
	add	sp, 2
	jmp	short loc_25FF5
loc_25FAF:
	push	[bp+arg_0]
	push	cs
	call	near ptr sum_getMatchMonGroup
	add	sp, 2
	mov	[bp+groupNo], ax
	or	ax, ax
	jl	short loc_25FDA
	push	ax
	push	[bp+arg_0]
	push	cs
	call	near ptr sum_addMonToGroup
	add	sp, 4
	or	[bp+var_4], ax
	push	[bp+var_4]
	push	cs
	call	near ptr sum_printNoRoom
	add	sp, 2
	jmp	short loc_25FF5
loc_25FDA:
	cmp	curSpellNo, 4Dh 
	jz	short loc_25FF2
	push	[bp+var_4]
	push	cs
	call	near ptr sum_printNoRoom
	add	sp, 2
	jmp	short loc_25FF5
loc_25FF2:
	jmp	loc_25F4A
loc_25FF5:
	mov	sp, bp
	pop	bp
	retf
sum_monSummon endp

; This function	looks for a monster group that matches
; the summonData.name given by summonNo. It returns
; the matching group number. If	not found, it returns
; 0xffff
; Attributes: bp-based frame

sum_getMatchMonGroup proc far

	var_2= word ptr	-2
	summonNo= word ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 0
	jmp	short loc_2600E
loc_2600B:
	inc	[bp+var_2]
loc_2600E:
	cmp	[bp+var_2], 4
	jge	short loc_26043
	getMonIndex	ax, [bp+summonNo]
	add	ax, offset summonData
	push	ds
	push	ax
	getMonP	[bp+var_2], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	map_strcmp
	add	sp, 8
	or	ax, ax
	jz	short loc_26041
	mov	ax, [bp+var_2]
	jmp	short loc_26048
loc_26041:
	jmp	short loc_2600B
loc_26043:
	mov	ax, 0FFFFh
	jmp	short $+2
loc_26048:
	mov	sp, bp
	pop	bp
	retf
sum_getMatchMonGroup endp

; Attributes: bp-based frame

sum_addMonToGroup proc far

	var_116= word ptr -116h
	var_106= word ptr -106h
	var_104= word ptr -104h
	var_102= word ptr -102h
	groupSize= word	ptr -2
	arg_0= byte ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 116h
	call	someStackOperation
	push	si
	getMonP	[bp+arg_2], bx
	mov	al, gs:monGroups.groupSize[bx]
	sub	ah, ah
	and	ax, 1Fh
	mov	[bp+groupSize],	ax
	cmp	ax, 1Fh
	jnz	short loc_2607B
	sub	ax, ax
	jmp	loc_26186
loc_2607B:
	getMonP	[bp+arg_2], si
	inc	gs:monGroups.groupSize[si]
	mov	al, gs:monGroups.hpDice[si]
	sub	ah, ah
	push	ax
	call	dice_doYDX
	add	sp, 2
	mov	cx, gs:monGroups.hpBase[si]
	add	cx, ax
	mov	bx, [bp+arg_2]
	mov	ax, cx
	mov	cl, 6
	shl	bx, cl
	mov	cx, [bp+groupSize]
	shl	cx, 1
	add	bx, cx
	mov	gs:monHpList[bx], ax
	mov	bx, [bp+arg_2]
	mov	cl, 6
	shl	bx, cl
	mov	ax, [bp+groupSize]
	shl	ax, 1
	add	bx, ax
	mov	gs:bat_monPriorityList[bx], 0
	test	[bp+arg_0], 80h
	jz	short loc_260EF
	getMonP	[bp+arg_2], bx
	or	gs:monGroups.flags[bx],	10h
	jmp	short loc_26101
loc_260EF:
	getMonP	[bp+arg_2], bx
	and	gs:monGroups.flags[bx],	0EFh
loc_26101:
	lea	ax, [bp+var_116]
	push	ss
	push	ax
	getMonP	[bp+arg_2], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	decryptName
	add	sp, 8
	mov	ax, offset aAndA
	push	ds
	push	ax
	lea	ax, [bp+var_102]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_106], ax
	mov	[bp+var_104], dx
	sub	ax, ax
	push	ax
	push	dx
	push	[bp+var_106]
	lea	ax, [bp+var_116]
	push	ss
	push	ax
	call	str_pluralize
	add	sp, 0Ah
	mov	[bp+var_106], ax
	mov	[bp+var_104], dx
	mov	ax, offset aAppears
	push	ds
	push	ax
	push	dx
	push	[bp+var_106]
	call	_strcat
	add	sp, 8
	mov	[bp+var_106], ax
	mov	[bp+var_104], dx
	lea	ax, [bp+var_102]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	ax, 1
	jmp	short $+2
loc_26186:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sum_addMonToGroup endp

; Attributes: bp-based frame

sum_newMonGroup proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	and	[bp+arg_0], 1Fh
	getMonIndex	ax, [bp+arg_0]
	add	ax, offset summonData
	push	ds
	push	ax
	getMonP	[bp+arg_2], bx
	lea	ax, monGroups._name[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	cs
	call	near ptr sub_261E8
	add	sp, 8
	mov	ax, 20h
	push	ax
	getMonIndex	ax, [bp+arg_0]
	add	ax, offset summonHpDice
	push	ds
	push	ax
	getMonP	[bp+arg_2], bx
	lea	ax, monGroups.hpDice[bx]
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	_memcpy

	; FIXED: Set the group size to 0. 
	getMonP	[bp+arg_2], bx
	mov	monGroups.groupSize[bx], 0

	add	sp, 0Ah
	mov	sp, bp
	pop	bp
	retf
sum_newMonGroup endp

; Attributes: bp-based frame

sub_261E8 proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6
	arg_4= dword ptr  0Ah

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	[bp+var_2], 0
	jmp	short loc_261FE
loc_261FB:
	inc	[bp+var_2]
loc_261FE:
	cmp	[bp+var_2], 10h
	jge	short loc_26210
	mov	bx, [bp+var_2]
	lfs	si, [bp+arg_0]
	mov	byte ptr fs:[bx+si], 0FFh
	jmp	short loc_261FB
loc_26210:
	lfs	bx, [bp+arg_4]
	cmp	byte ptr fs:[bx], 0
	jz	short loc_2622C
	inc	word ptr [bp+arg_4]
	mov	al, fs:[bx]
	or	al, 80h
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	fs:[bx], al
	jmp	short loc_26210
loc_2622C:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_261E8 endp

; Attributes: bp-based frame

sum_printNoRoom	proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	cmp	[bp+arg_0], 0
	jnz	short loc_2625A
	mov	ax, offset aButNoRoomForASummoni
	push	ds
	push	ax
	call	printString
	add	sp, 4
	delayWithTable
loc_2625A:
	mov	sp, bp
	pop	bp
	retf
sum_printNoRoom	endp

seg015 ends

; Segment type:	Pure code
seg016 segment byte public 'CODE' use16
	assume cs:seg016
;org 0Eh
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
; Attributes: bp-based frame

sub_2625E proc far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= dword ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	cmp	[bp+arg_0], 1
	jle	short loc_2627C
	lfs	bx, [bp+arg_2]
	lfs	bx, fs:[bx+4]
	mov	al, fs:[bx]
	cbw
	jmp	short loc_2627F
loc_2627C:
	mov	ax, 0FFh
loc_2627F:
	mov	[bp+var_4], ax
	cmp	ax, 31h	
	jl	short loc_2628C
	cmp	ax, 34h	
	jle	short loc_2630B
loc_2628C:
	mov	[bp+var_8], 0
	jmp	short loc_26296
loc_26293:
	inc	[bp+var_8]
loc_26296:
	cmp	[bp+var_8], 19h
	jge	short loc_262AB
	mov	ax, offset unk_4C246
	push	ds
	push	ax
	call	printf
	add	sp, 4
	jmp	short loc_26293
loc_262AB:
	mov	ax, offset aWhatTypeOfDisp
	push	ds
	push	ax
	call	printf
	add	sp, 4
	mov	ax, offset a1CompositeOrTv
	push	ds
	push	ax
	call	printf
	add	sp, 4
	mov	ax, offset a2RgbMonitor_
	push	ds
	push	ax
	call	printf
	add	sp, 4
	mov	ax, offset a3EgaMonitor_
	push	ds
	push	ax
	call	printf
	add	sp, 4
	mov	ax, offset a4TandyComputer
	push	ds
	push	ax
	call	printf
	add	sp, 4
	mov	ax, offset aPleaseEnterThe
	push	ds
	push	ax
	call	printf
	add	sp, 4
	call	sub_2A9D4
	mov	[bp+var_4], ax
	cmp	ax, 31h	
	jl	short loc_2628C
	cmp	ax, 34h	
	jg	short loc_2628C
loc_2630B:
	mov	ax, [bp+var_4]
	sub	ax, 31h	
	mov	[bp+var_6], ax
	cmp	[bp+arg_0], 2
	jle	short loc_26327
	lfs	bx, [bp+arg_2]
	lfs	bx, fs:[bx+8]
	mov	al, fs:[bx]
	cbw
	jmp	short loc_2632A
loc_26327:
	mov	ax, 0FFh
loc_2632A:
	mov	[bp+var_4], ax
	cmp	ax, 31h	
	jl	short loc_2633A
	cmp	ax, 34h	
	jg	short loc_2633A
	jmp	loc_263CC
loc_2633A:
	mov	[bp+var_8], 0
	jmp	short loc_26344
loc_26341:
	inc	[bp+var_8]
loc_26344:
	cmp	[bp+var_8], 19h
	jge	short loc_26359
	mov	ax, offset asc_4C312
	push	ds
	push	ax
	call	printf
	add	sp, 4
	jmp	short loc_26341
loc_26359:
	mov	ax, offset aWhatTypeOfSoundOutput
	push	ds
	push	ax
	call	printf
	add	sp, 4
	mov	ax, offset a1Mt32_
	push	ds
	push	ax
	call	printf
	add	sp, 4
	mov	ax, offset a2AdLib_
	push	ds
	push	ax
	call	printf
	add	sp, 4
	mov	ax, offset a3InternalIbmSpeaker_
	push	ds
	push	ax
	call	printf
	add	sp, 4
	mov	ax, offset a4Tandy_
	push	ds
	push	ax
	call	printf
	add	sp, 4
	mov	ax, offset a5Ps1
	push	ds
	push	ax
	call	printf
	add	sp, 4
	mov	ax, offset aPleaseEnterTheAppropr
	push	ds
	push	ax
	call	printf
	add	sp, 4
	call	sub_2A9D4
	mov	[bp+var_4], ax
	cmp	ax, 31h	
	jge	short loc_263C4
	jmp	loc_2633A
loc_263C4:
	cmp	ax, 35h	
	jle	short loc_263CC
	jmp	loc_2633A
loc_263CC:
	mov	ax, [bp+var_4]
	sub	ax, 31h	
	mov	[bp+var_2], ax
	mov	ah, byte ptr [bp+var_2]
	sub	al, al
	or	ax, [bp+var_6]
	jmp	short $+2
	mov	sp, bp
	pop	bp
locret_263E2:
	retf
sub_2625E endp

seg016 ends

; Segment type:	Pure code
seg017 segment word public 'CODE' use16
	assume cs:seg017
;org 3
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
algn_263E3:
align 2
; Attributes: bp-based frame

transferCharacter proc far

	var_4= word ptr	-4

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
loc_263EF:
	mov	ax, offset aTransferCharac
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	mov	ax, 3Ch	
	push	ax
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_4], ax
	cmp	ax, 110h
	jl	short loc_2641A
	cmp	ax, 112h
	jg	short loc_2641A
	sub	[bp+var_4], 0DFh 
loc_2641A:
	mov	ax, [bp+var_4]
	jmp	short loc_26442
loc_2641F:
	jmp	short loc_26464
loc_26421:
	push	cs
	call	near ptr getTransferCharacters
	jmp	short loc_26462
loc_26427:
	mov	ax, 1
	push	ax
	push	cs
	call	near ptr importCharacter
	add	sp, 2
	jmp	short loc_26462
loc_26434:
	sub	ax, ax
	push	ax
	push	cs
	call	near ptr importCharacter
	add	sp, 2
loc_2643E:
	jmp	short loc_26462
	jmp	short loc_26462
loc_26442:
	cmp	ax, 1Bh
	jz	short loc_2641F
	cmp	ax, 31h	
	jz	short loc_26434
	cmp	ax, 32h	
	jz	short loc_26427
	cmp	ax, 33h	
	jz	short loc_26421
	cmp	ax, 45h	
	jz	short loc_2641F
	cmp	ax, 113h
	jz	short loc_2641F
	jmp	short loc_2643E
loc_26462:
	jmp	short loc_263EF
loc_26464:
	mov	sp, bp
	pop	bp
	retf
transferCharacter endp

; Attributes: bp-based frame

getTransferCharacters proc far

	var_1CA= dword ptr -1CAh
	var_1C6= word ptr -1C6h
	var_1C4= word ptr -1C4h
	var_1C2= word ptr -1C2h
	var_1C0= word ptr -1C0h
	var_1BC= word ptr -1BCh
	var_1BA= dword ptr -1BAh
	var_1B6= word ptr -1B6h
	var_1B4= word ptr -1B4h
	var_182= word ptr -182h
	var_180= word ptr -180h
	var_17E= word ptr -17Eh
	var_17C= word ptr -17Ch
	var_17A= dword ptr -17Ah
	var_26=	word ptr -26h
	var_24=	word ptr -24h
	var_22=	word ptr -22h
	var_20=	word ptr -20h
	var_1E=	word ptr -1Eh

	push	bp
	mov	bp, sp
	mov	ax, 1CAh
	call	someStackOperation
	push	si
	mov	ax, offset aDest
	push	ax
	call	_mallocMaybe
	add	sp, 2
	mov	[bp+var_1C6], ax
	mov	[bp+var_1C4], dx
	mov	ax, 500h
	push	ax
	call	_mallocMaybe
	add	sp, 2
	mov	[bp+var_180], ax
	mov	[bp+var_17E], dx
loc_2649C:
	mov	ax, offset aDiskToTransfer
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	lea	ax, [bp+var_1B4]
	mov	[bp+var_26], ax
	mov	[bp+var_24], ss
	mov	ax, 18h
	push	ax
	lea	ax, [bp+var_1E]
	push	ss
	push	ax
	call	_readString
	add	sp, 6
	or	ax, ax
	jz	short loc_264E1
	lea	ax, [bp+var_1E]
	push	ss
	push	ax
	push	[bp+var_24]
	push	[bp+var_26]
	call	_strcat
	add	sp, 8
	mov	[bp+var_26], ax
	mov	[bp+var_24], dx
loc_264E1:
	mov	ax, offset aThieves_inf
	push	ds
	push	ax
	push	[bp+var_24]
	push	[bp+var_26]
	call	_strcat
	add	sp, 8
	mov	[bp+var_26], ax
	mov	[bp+var_24], dx
	sub	ax, ax
	push	ax
	lea	ax, [bp+var_1B4]
	push	ss
	push	ax
	call	openFile
	add	sp, 6
	mov	[bp+var_182], ax
	inc	ax
	jnz	short loc_2653C
	mov	ax, offset aNoCharactersFoundOn
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	lea	ax, [bp+var_1B4]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	wait4IO
	jmp	loc_267CC
loc_2653C:
	mov	ax, [bp+var_1C6]
	mov	dx, [bp+var_1C4]
	mov	word ptr [bp+var_1BA], ax
	mov	word ptr [bp+var_1BA+2], dx
	mov	[bp+var_1C2], 0
	jmp	short loc_26558
loc_26554:
	inc	[bp+var_1C2]
loc_26558:
	cmp	[bp+var_1C2], 4Bh 
	jge	short loc_26572
	getCharP	[bp+var_1C2], bx
	lfs	si, [bp+var_1BA]
	mov	byte ptr fs:[bx+si], 0
	jmp	short loc_26554
loc_26572:
	mov	ax, 9000
	push	ax
	push	[bp+var_1C4]
	push	[bp+var_1C6]
	push	[bp+var_182]
	call	_read
	add	sp, 8
	push	[bp+var_182]
	call	_close
	add	sp, 2
	lea	ax, [bp+var_1E]
	push	ss
	push	ax
	lea	ax, [bp+var_1B4]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_26], ax
	mov	[bp+var_24], dx
	mov	ax, offset aParties_inf
	push	ds
	push	ax
	push	dx
	push	[bp+var_26]
	call	_strcat
	add	sp, 8
	mov	[bp+var_26], ax
	mov	[bp+var_24], dx
	mov	ax, [bp+var_180]
	mov	dx, [bp+var_17E]
	mov	word ptr [bp+var_1BA], ax
	mov	word ptr [bp+var_1BA+2], dx
	mov	[bp+var_1C2], 0
	jmp	short loc_265E2
loc_265DE:
	inc	[bp+var_1C2]
loc_265E2:
	cmp	[bp+var_1C2], 0Ah
	jge	short loc_265FB
	mov	bx, [bp+var_1C2]
	mov	cl, 7
	shl	bx, cl
	lfs	si, [bp+var_1BA]
	mov	byte ptr fs:[bx+si], 0
	jmp	short loc_265DE
loc_265FB:
	sub	ax, ax
	push	ax
	lea	ax, [bp+var_1B4]
	push	ss
	push	ax
	call	openFile
	add	sp, 6
	mov	[bp+var_182], ax
	inc	ax
	jnz	short loc_2663C
	mov	ax, offset aNoPartiesFoundOn
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	lea	ax, [bp+var_1B4]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	wait4IO
	jmp	short loc_26654
loc_2663C:
	mov	ax, 500h
	push	ax
	push	[bp+var_17E]
	push	[bp+var_180]
	push	[bp+var_182]
	call	_read
	add	sp, 8
loc_26654:
	mov	[bp+var_1C2], 0
loc_2665A:
	mov	si, [bp+var_1C2]
	shl	si, 1
	shl	si, 1
	mov	ax, [bp+var_1C2]
	mov	cl, 7
	shl	ax, cl
	add	ax, [bp+var_180]
	mov	dx, [bp+var_17E]
	mov	word ptr [bp+si+var_17A], ax
	mov	word ptr [bp+si+var_17A+2], dx
	mov	si, [bp+var_1C2]
	inc	[bp+var_1C2]
	shl	si, 1
	shl	si, 1
	lfs	bx, [bp+si+var_17A]
	cmp	byte ptr fs:[bx], 0
	jnz	short loc_2665A
	dec	[bp+var_1C2]
	mov	ax, [bp+var_1C2]
	mov	[bp+var_1BC], ax
loc_2669C:
	mov	ax, [bp+var_1C2]
	sub	ax, [bp+var_1BC]
	getCharIndex	cx, cx
	add	ax, [bp+var_1C6]
	mov	dx, [bp+var_1C4]
	mov	si, [bp+var_1C2]
	shl	si, 1
	shl	si, 1
	mov	word ptr [bp+si+var_17A], ax
	mov	word ptr [bp+si+var_17A+2], dx
	mov	si, [bp+var_1C2]
	inc	[bp+var_1C2]
	shl	si, 1
	shl	si, 1
	lfs	bx, [bp+si+var_17A]
	cmp	byte ptr fs:[bx], 0
	jnz	short loc_2669C
	dec	[bp+var_1C2]
loc_266DB:
	push	[bp+var_1C2]
	lea	ax, [bp+var_17A]
	push	ss
	push	ax
	mov	ax, offset aWhoShallTransfer?
	push	ds
	push	ax
	call	printStringGetInput
	add	sp, 0Ah
	mov	[bp+var_1C0], ax
	or	ax, ax
	jge	short loc_2671D
	push	[bp+var_1C4]
	push	[bp+var_1C6]
	call	_freeMaybe
	add	sp, 4
	push	[bp+var_17E]
	push	[bp+var_180]
	call	_freeMaybe
	add	sp, 4
	jmp	loc_267CF
loc_2671D:
	mov	ax, [bp+var_1BC]
	cmp	[bp+var_1C0], ax
	jl	short loc_2672A
	jmp	loc_267B2
loc_2672A:
	mov	si, [bp+var_1C0]
	shl	si, 1
	shl	si, 1
	mov	ax, word ptr [bp+si+var_17A]
	mov	dx, word ptr [bp+si+var_17A+2]
	mov	[bp+var_22], ax
	mov	[bp+var_20], dx
	mov	[bp+var_17C], 0
	jmp	short loc_2674C
loc_26748:
	inc	[bp+var_17C]
loc_2674C:
	cmp	[bp+var_17C], 7
	jge	short loc_267B0
	mov	ax, [bp+var_17C]
	mov	cl, 4
	shl	ax, cl
	add	ax, [bp+var_22]
	mov	dx, [bp+var_20]
	add	ax, 10h
	mov	word ptr [bp+var_1CA], ax
	mov	word ptr [bp+var_1CA+2], dx
	lfs	bx, [bp+var_1CA]
	cmp	byte ptr fs:[bx], 0
	jz	short loc_2678D
	push	[bp+var_1C4]
	push	[bp+var_1C6]
	push	dx
	push	ax
	push	cs
	call	near ptr sub_267D4
	add	sp, 8
	mov	[bp+var_1B6], ax
	jmp	short loc_2678F
loc_2678D:
	jmp	short loc_267B0
loc_2678F:
	cmp	[bp+var_1B6], 0
	jl	short loc_267AE
	getCharIndex	ax, [bp+var_1B6]
	add	ax, [bp+var_1C6]
	mov	dx, [bp+var_1C4]
	push	dx
	push	ax
	push	cs
	call	near ptr sub_2681F
	add	sp, 4
loc_267AE:
	jmp	short loc_26748
loc_267B0:
	jmp	short loc_267C9
loc_267B2:
	mov	si, [bp+var_1C0]
	shl	si, 1
	shl	si, 1
	push	word ptr [bp+si+var_17A+2]
	push	word ptr [bp+si+var_17A]
	push	cs
	call	near ptr sub_2681F
	add	sp, 4
loc_267C9:
	jmp	loc_266DB
loc_267CC:
	jmp	loc_2649C
loc_267CF:
	pop	si
	mov	sp, bp
	pop	bp
	retf
getTransferCharacters endp

; Attributes: bp-based frame

sub_267D4 proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah
	arg_6= word ptr	 0Ch

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	mov	[bp+var_2], 0
	jmp	short loc_267E9
loc_267E6:
	inc	[bp+var_2]
loc_267E9:
	cmp	[bp+var_2], 75
	jge	short loc_26816
	getCharIndex	ax, [bp+var_2]
	add	ax, [bp+arg_4]
	mov	dx, [bp+arg_6]
	push	dx
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	_strcmp
	add	sp, 8
	or	ax, ax
	jnz	short loc_26814
	mov	ax, [bp+var_2]
	jmp	short loc_2681B
loc_26814:
	jmp	short loc_267E6
loc_26816:
	mov	ax, 0FFFFh
	jmp	short $+2
loc_2681B:
	mov	sp, bp
	pop	bp
	retf
sub_267D4 endp

; Attributes: bp-based frame

sub_2681F proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	arg_2= word ptr	 8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	rost_charNameExists
	add	sp, 4
	mov	[bp+var_4], ax
	or	ax, ax
	jge	short loc_26868
	call	countSavedChars
	mov	[bp+var_2], ax
	getCharP	[bp+var_2], bx
	lea	ax, characterIOBuf[bx]
	mov	dx, seg	seg022
	push	dx
	push	ax
	push	[bp+arg_2]
	push	[bp+arg_0]
	call	copyCharacterBuf
	add	sp, 8
	jmp	short loc_26881
loc_26868:
	mov	ax, offset aThisCharacterAlready
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	wait4IO
loc_26881:
	mov	sp, bp
	pop	bp
	retf
sub_2681F endp

; Attributes: bp-based frame

importCharacter	proc far

	var_1F0= dword ptr -1F0h
	var_1EC= word ptr -1ECh
	var_1EA= word ptr -1EAh
	var_1E8= word ptr -1E8h
	var_1E6= word ptr -1E6h
	var_1E0= word ptr -1E0h
	var_1C2= word ptr -1C2h
	var_1AE= word ptr -1AEh
	var_17C= word ptr -17Ch
	var_178= word ptr -178h
	var_176= word ptr -176h
	var_24=	word ptr -24h
	var_22=	word ptr -22h
	var_20=	word ptr -20h
	var_1E=	word ptr -1Eh
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	ax, 1F0h
	call	someStackOperation
	push	si
	mov	ax, 2BF2h
	push	ax
	call	_mallocMaybe
	add	sp, 2
	mov	[bp+var_1EC], ax
	mov	[bp+var_1EA], dx
	mov	word ptr [bp+var_1F0], ax
	mov	word ptr [bp+var_1F0+2], dx
loc_268AD:
	mov	ax, offset aDiskToTransfer
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	lea	ax, [bp+var_1AE]
	mov	[bp+var_24], ax
	mov	[bp+var_22], ss
	mov	ax, 18h
	push	ax
	lea	ax, [bp+var_1E]
	push	ss
	push	ax
	call	_readString
	add	sp, 6
	or	ax, ax
	jz	short loc_268F2
	lea	ax, [bp+var_1E]
	push	ss
	push	ax
	push	[bp+var_22]
	push	[bp+var_24]
	call	_strcat
	add	sp, 8
	mov	[bp+var_24], ax
	mov	[bp+var_22], dx
loc_268F2:
	mov	bx, [bp+arg_0]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (oldCharFilters+2)[bx]
	push	word ptr oldCharFilters[bx]
	push	[bp+var_22]
	push	[bp+var_24]
	call	_strcat
	add	sp, 8
	mov	[bp+var_24], ax
	mov	[bp+var_22], dx
	lea	ax, [bp+var_1E0]
	push	ss
	push	ax
	lea	ax, [bp+var_1AE]
	push	ss
	push	ax
	call	findFirstFile
	add	sp, 8
	or	ax, ax
	jz	short loc_26931
	jmp	short loc_26965
	jmp	short loc_26962
loc_26931:
	mov	ax, offset aNoCharactersFoundOn
	push	ds
	push	ax
	call	printStringWClear
	add	sp, 4
	lea	ax, [bp+var_1AE]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	sub	ax, ax
	push	ax
	call	sub_14E41
	add	sp, 2
	mov	[bp+var_20], ax
	cmp	ax, 1Bh
	jnz	short loc_26962
	jmp	loc_26A85
loc_26962:
	jmp	loc_268AD
loc_26965:
	mov	[bp+var_1E8], 0
loc_2696B:
	lea	ax, [bp+var_1E]
	push	ss
	push	ax
	lea	ax, [bp+var_1AE]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_24], ax
	mov	[bp+var_22], dx
	lea	ax, [bp+var_1C2]
	push	ss
	push	ax
	push	dx
	push	[bp+var_24]
	call	_strcat
	add	sp, 8
	mov	[bp+var_24], ax
	mov	[bp+var_22], dx
	sub	ax, ax
	push	ax
	lea	ax, [bp+var_1AE]
	push	ss
	push	ax
	call	openFile
	add	sp, 6
	mov	[bp+var_17C], ax
	inc	ax
	jz	short loc_26A01
	mov	ax, 81h	
	push	ax
	push	word ptr [bp+var_1F0+2]
	push	word ptr [bp+var_1F0]
	push	[bp+var_17C]
	call	_read
	add	sp, 8
	lfs	bx, [bp+var_1F0]
	cmp	byte ptr fs:[bx+10h], 1
	jnz	short loc_269F5
	mov	si, [bp+var_1E8]
	inc	[bp+var_1E8]
	shl	si, 1
	shl	si, 1
	mov	ax, bx
	mov	dx, fs
	mov	[bp+si+var_178], ax
	mov	[bp+si+var_176], dx
	add	word ptr [bp+var_1F0], 96h 
loc_269F5:
	push	[bp+var_17C]
	call	_close
	add	sp, 2
loc_26A01:
	call	sub_27C4A
	or	ax, ax
	jz	short loc_26A0D
	jmp	loc_2696B
loc_26A0D:
	push	[bp+var_1E8]
	lea	ax, [bp+var_178]
	push	ss
	push	ax
	mov	ax, offset aWhoShallTransfer?
	push	ds
	push	ax
	call	printStringGetInput
	add	sp, 0Ah
	mov	[bp+var_1E6], ax
	or	ax, ax
	jge	short loc_26A3E
	push	[bp+var_1EA]
	push	[bp+var_1EC]
	call	_freeMaybe
	add	sp, 4
	jmp	short loc_26A85
loc_26A3E:
	cmp	[bp+arg_0], 0
	jz	short loc_26A5D
	mov	si, [bp+var_1E6]
	shl	si, 1
	shl	si, 1
	push	[bp+si+var_176]
	push	[bp+si+var_178]
	push	cs
	call	near ptr importBIIChar
	add	sp, 4
	jmp	short loc_26A74
loc_26A5D:
	mov	si, [bp+var_1E6]
	shl	si, 1
	shl	si, 1
	push	[bp+si+var_176]
	push	[bp+si+var_178]
	push	cs
	call	near ptr importBICharacter
	add	sp, 4
loc_26A74:
	mov	ax, offset newCharBuffer
	mov	dx, seg	seg027
	push	dx
	push	ax
	push	cs
	call	near ptr sub_2681F
	add	sp, 4
	jmp	short loc_26A0D
loc_26A85:
	pop	si
	mov	sp, bp
	pop	bp
	retf
importCharacter	endp

; Attributes: bp-based frame

convertSpellLevel proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6
	spLevel= word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, 4
	call	someStackOperation
	cmp	[bp+spLevel], 0
	jz	short loc_26AD7
	mov	bx, [bp+arg_0]
	mov	al, mageSpellIndex[bx]
	sub	ah, ah
	mov	[bp+var_2], ax
	cmp	ax, 0FFh
	jz	short loc_26AD7
	mov	[bp+var_4], 0
	jmp	short loc_26ABB
loc_26AB8:
	inc	[bp+var_4]
loc_26ABB:
	mov	ax, [bp+spLevel]
	cmp	[bp+var_4], ax
	jge	short loc_26AD7
	push	[bp+var_2]
	push	[bp+var_4]
	mov	ax, 7
	push	ax
	call	mage_learnSpellLevel
	add	sp, 6
	jmp	short loc_26AB8
loc_26AD7:
	mov	sp, bp
	pop	bp
	retf
convertSpellLevel endp

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	sp, bp
	pop	bp
	retf
; Attributes: bp-based frame

importBIIChar proc far

	var_8= byte ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	mov	ax, 78h	
	push	ax
	sub	ax, ax
	push	ax
	mov	ax, offset newCharBuffer
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	_memset
	add	sp, 8
	mov	[bp+var_4], 0
	jmp	short loc_26B16
loc_26B13:
	inc	[bp+var_4]
loc_26B16:
	mov	bx, [bp+var_4]
	lfs	si, [bp+arg_0]
	mov	al, fs:[bx+si]
	mov	[bp+var_8], al
	or	al, al
	jz	short loc_26B31
	mov	byte ptr gs:newCharBuffer._name[bx], al
	jmp	short loc_26B13
loc_26B31:
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bii_char_t.strength]
	mov	gs:newCharBuffer.strength, al
	mov	al, fs:[bx+bii_char_t.intelligence]
	mov	gs:newCharBuffer.intelligence, al
	mov	al, fs:[bx+bii_char_t.dexterity]
	mov	gs:newCharBuffer.dexterity, al
	mov	al, fs:[bx+bii_char_t.constitution]
	mov	gs:newCharBuffer.constitution, al
	mov	al, fs:[bx+bii_char_t.luck]
	mov	gs:newCharBuffer.luck, al
	mov	ax, word ptr fs:[bx+bii_char_t.experience]
	mov	dx, fs:[bx+45h]
	mov	word ptr gs:newCharBuffer.experience, ax
	mov	word ptr gs:newCharBuffer.experience+2,	dx
	mov	ax, word ptr fs:[bx+bii_char_t.gold]
	mov	dx, fs:[bx+49h]
	mov	word ptr gs:newCharBuffer.gold,	ax
	mov	word ptr gs:newCharBuffer.gold+2, dx
	mov	al, fs:[bx+bii_char_t.level]
	sub	al, 35
	sbb	cl, cl
	and	al, cl
	add	al, 35
	sub	ah, ah
	mov	gs:newCharBuffer.level,	ax
	mov	gs:newCharBuffer.maxLevel, ax
	mov	ax, fs:[bx+bii_char_t.maxHp]
	mov	gs:newCharBuffer.currentHP, ax
	mov	ax, fs:[bx+bii_char_t.maxHp]
	mov	gs:newCharBuffer.maxHP,	ax
	mov	ax, fs:[bx+bii_char_t.maxSppt]
	mov	gs:newCharBuffer.currentSppt, ax
	mov	ax, fs:[bx+bii_char_t.currentSppt]
	mov	gs:newCharBuffer.maxSppt, ax
	mov	bl, fs:[bx+bii_char_t.class]
	sub	bh, bh
	mov	al, bii_classMap[bx]
	mov	gs:newCharBuffer.class,	al
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bii_char_t.race]
	mov	gs:newCharBuffer.race, al
	call	getCharacterGender
	and	al, 1
	mov	gs:newCharBuffer.gender, al
	mov	bl, gs:newCharBuffer.class
	sub	bh, bh
	shl	bx, 1
	sub	ah, ah
	add	bx, ax
	mov	al, byte_42F8C[bx]
	mov	gs:newCharBuffer.picIndex, al
	mov	gs:newCharBuffer.status, ah
	mov	[bp+var_6], 0
	mov	[bp+var_4], 0
	jmp	short loc_26C6A
loc_26C67:
	inc	[bp+var_4]
loc_26C6A:
	cmp	[bp+var_4], 8
	jge	short loc_26CE9
	mov	si, [bp+var_4]
	shl	si, 1
	lfs	bx, [bp+arg_0]
	mov	bl, byte ptr fs:[bx+si+bii_char_t.inventory]
	sub	bh, bh
	mov	al, bii_inventoryMap[bx]
	cbw
	mov	[bp+var_2], ax
	or	ax, ax
	jz	short loc_26CE6
	mov	al, byte ptr [bp+var_2]
	mov	bx, [bp+var_6]
	mov	gs:newCharBuffer.inventory.itemNo[bx], al
	mov	bx, [bp+var_2]
	mov	al, byte_464B8[bx]
	mov	bx, [bp+var_6]
	mov	gs:newCharBuffer.inventory.itemCount[bx], al
	mov	bl, gs:newCharBuffer.class
	sub	bh, bh
	mov	al, classEquipMask[bx]
	sub	ah, ah
	mov	bx, [bp+var_2]
	mov	cl, itemEquipMask[bx]
	sub	ch, ch
	test	ax, cx
	jnz	short loc_26CE2
	mov	bx, [bp+var_6]
	mov	gs:newCharBuffer.inventory.itemFlags[bx], 2
loc_26CE2:
	add	[bp+var_6], 3
loc_26CE6:
	jmp	loc_26C67
loc_26CE9:
	mov	al, gs:newCharBuffer.class
	sub	ah, ah
	jmp	short loc_26D49
loc_26CF5:
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bii_char_t.field_52]
	mov	gs:newCharBuffer.specAbil, al
	mov	gs:newCharBuffer.specAbil+1, al
	mov	gs:newCharBuffer.specAbil+2, al
	jmp	short loc_26D68
loc_26D0E:
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bii_char_t.songsLeft]
	mov	gs:newCharBuffer.specAbil, al
	mov	gs:newCharBuffer.specAbil+1, 0FCh 
	jmp	short loc_26D68
loc_26D25:
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bii_char_t.numAttacks]
	mov	gs:newCharBuffer.numAttacks, al
	jmp	short loc_26D68
loc_26D36:
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bii_char_t.field_55]
	mov	gs:newCharBuffer.specAbil, al
loc_26D45:
	jmp	short loc_26D68
	jmp	short loc_26D68
loc_26D49:
	or	ax, ax
	jz	short loc_26D25
	cmp	ax, class_rogue
	jz	short loc_26CF5
	cmp	ax, class_bard
	jz	short loc_26D0E
	cmp	ax, class_paladin
	jz	short loc_26D25
	cmp	ax, class_hunter
	jz	short loc_26D36
	cmp	ax, class_monk
	jz	short loc_26D25
	jmp	short loc_26D45
loc_26D68:
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bii_char_t.wizdLevel]
	sub	ah, ah
	push	ax
	mov	ax, 1
	push	ax
	push	cs
	call	near ptr convertSpellLevel
	add	sp, 4
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bii_char_t.sorcLevel]
	sub	ah, ah
	push	ax
	mov	ax, 2
	push	ax
	push	cs
	call	near ptr convertSpellLevel
	add	sp, 4
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bii_char_t.conjLevel]
	sub	ah, ah
	push	ax
	mov	ax, 3
	push	ax
	push	cs
	call	near ptr convertSpellLevel
	add	sp, 4
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bii_char_t.magiLevel]
	sub	ah, ah
	push	ax
	mov	ax, 4
	push	ax
	push	cs
	call	near ptr convertSpellLevel
	add	sp, 4
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bii_char_t.archLevel]
	sub	ah, ah
	push	ax
	mov	ax, 0Ah
	push	ax
	push	cs
	call	near ptr convertSpellLevel
	add	sp, 4
	pop	si
	mov	sp, bp
	pop	bp
	retf
importBIIChar endp

; Attributes: bp-based frame

importBICharacter proc far

	var_8= byte ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	ax, 8
	call	someStackOperation
	push	si
	mov	ax, 78h	
	push	ax
	sub	ax, ax
	push	ax
	mov	ax, offset newCharBuffer
	mov	dx, seg	seg027
	push	dx
	push	ax
	call	_memset
	add	sp, 8
	mov	[bp+var_4], 0
	jmp	short loc_26E03
loc_26E00:
	inc	[bp+var_4]
loc_26E03:
	mov	bx, [bp+var_4]
	lfs	si, [bp+arg_0]
	mov	al, fs:[bx+si]
	mov	[bp+var_8], al
	or	al, al
	jz	short loc_26E1E
	mov	byte ptr gs:newCharBuffer._name[bx], al
	jmp	short loc_26E00
loc_26E1E:
	lfs	bx, [bp+arg_0]
	mov	al, byte ptr fs:[bx+bi_char_t.strength]
	mov	gs:newCharBuffer.strength, al
	mov	al, byte ptr fs:[bx+bi_char_t.intelligence]
	mov	gs:newCharBuffer.intelligence, al
	mov	al, byte ptr fs:[bx+bi_char_t.dexterity]
	mov	gs:newCharBuffer.dexterity, al
	mov	al, byte ptr fs:[bx+bi_char_t.constitution]
	mov	gs:newCharBuffer.constitution, al
	mov	al, byte ptr fs:[bx+bi_char_t.luck]
	mov	gs:newCharBuffer.luck, al
	mov	ax, word ptr fs:[bx+bi_char_t.experience]
	mov	dx, fs:[bx+47h]
	mov	word ptr gs:newCharBuffer.experience, ax
	mov	word ptr gs:newCharBuffer.experience+2,	dx
	mov	ax, word ptr fs:[bx+bi_char_t.gold]
	mov	dx, fs:[bx+4Bh]
	mov	word ptr gs:newCharBuffer.gold,	ax
	mov	word ptr gs:newCharBuffer.gold+2, dx
	mov	ax, fs:[bx+bi_char_t.level]
	sub	ax, 35
	sbb	cx, cx
	and	ax, cx
	add	ax, 35
	mov	gs:newCharBuffer.level,	ax
	mov	gs:newCharBuffer.maxLevel, ax
	mov	ax, fs:[bx+bi_char_t.maxHP]
	mov	gs:newCharBuffer.currentHP, ax
	mov	ax, fs:[bx+bi_char_t.maxHP]
	mov	gs:newCharBuffer.maxHP,	ax
	mov	ax, fs:[bx+bi_char_t.currentSppt]
	mov	gs:newCharBuffer.currentSppt, ax
	mov	ax, fs:[bx+bi_char_t.maxSppt]
	mov	gs:newCharBuffer.maxSppt, ax
	mov	bx, fs:[bx+bi_char_t.class]
	mov	al, bii_classMap[bx]
	mov	gs:newCharBuffer.class,	al
	lfs	bx, [bp+arg_0]
	mov	al, byte ptr fs:[bx+bi_char_t.race]
	mov	gs:newCharBuffer.race, al
	call	getCharacterGender
	and	al, 1
	mov	gs:newCharBuffer.gender, al
	mov	bl, gs:newCharBuffer.class
	sub	bh, bh
	shl	bx, 1
	sub	ah, ah
	add	bx, ax
	mov	al, byte_42F8C[bx]
	mov	gs:newCharBuffer.picIndex, al
	mov	gs:newCharBuffer.status, ah
	mov	[bp+var_6], 0
	mov	[bp+var_4], 0
	jmp	short loc_26F55
loc_26F52:
	inc	[bp+var_4]
loc_26F55:
	cmp	[bp+var_4], 8
	jge	short loc_26FD4
	mov	si, [bp+var_4]
	shl	si, 1
	lfs	bx, [bp+arg_0]
	mov	bl, byte ptr fs:[bx+si+bi_char_t.inventory]
	sub	bh, bh
	mov	al, bi_inventoryMap[bx]
	cbw
	mov	[bp+var_2], ax
	or	ax, ax
	jz	short loc_26FD1
	mov	al, byte ptr [bp+var_2]
	mov	bx, [bp+var_6]
	mov	gs:newCharBuffer.inventory.itemNo[bx], al
	mov	bx, [bp+var_2]
	mov	al, byte_464B8[bx]
	mov	bx, [bp+var_6]
	mov	gs:newCharBuffer.inventory.itemCount[bx], al
	mov	bl, gs:newCharBuffer.class
	sub	bh, bh
	mov	al, classEquipMask[bx]
	sub	ah, ah
	mov	bx, [bp+var_2]
	mov	cl, itemEquipMask[bx]
	sub	ch, ch
	test	ax, cx
	jnz	short loc_26FCD
	mov	bx, [bp+var_6]
	mov	gs:newCharBuffer.inventory.itemFlags[bx], 2
loc_26FCD:
	add	[bp+var_6], 3
loc_26FD1:
	jmp	loc_26F52
loc_26FD4:
	mov	al, gs:newCharBuffer.class
	sub	ah, ah
	jmp	short loc_27034
loc_26FE0:
	lfs	bx, [bp+arg_0]
	mov	al, byte ptr fs:[bx+bi_char_t.field_55]
	mov	gs:newCharBuffer.specAbil, al
	mov	gs:newCharBuffer.specAbil+1, al
	mov	gs:newCharBuffer.specAbil+2, al
	jmp	short loc_27053
loc_26FF9:
	lfs	bx, [bp+arg_0]
	mov	al, byte ptr fs:[bx+bi_char_t.songsLeft]
	mov	gs:newCharBuffer.specAbil, al
	mov	gs:newCharBuffer.specAbil+1, 0FCh
	jmp	short loc_27053
loc_27010:
	lfs	bx, [bp+arg_0]
	mov	al, byte ptr fs:[bx+bi_char_t.numAttacks]
	mov	gs:newCharBuffer.numAttacks, al
	jmp	short loc_27053
loc_27021:
	lfs	bx, [bp+arg_0]
	mov	al, byte ptr fs:[bx+bi_char_t.field_5B]
	mov	gs:newCharBuffer.specAbil, al
loc_27030:
	jmp	short loc_27053
	jmp	short loc_27053
loc_27034:
	or	ax, ax
	jz	short loc_27010
	cmp	ax, class_rogue
	jz	short loc_26FE0
	cmp	ax, class_bard
	jz	short loc_26FF9
	cmp	ax, class_paladin
	jz	short loc_27010
	cmp	ax, class_hunter
	jz	short loc_27021
	cmp	ax, class_monk
	jz	short loc_27010
	jmp	short loc_27030
loc_27053:
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bi_char_t.wizdLevel]
	sub	ah, ah
	push	ax
	mov	ax, 1
	push	ax
	push	cs
	call	near ptr convertSpellLevel
	add	sp, 4
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bi_char_t.sorcLevel]
	sub	ah, ah
	push	ax
	mov	ax, 2
	push	ax
	push	cs
	call	near ptr convertSpellLevel
	add	sp, 4
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bi_char_t.conjLevel]
	sub	ah, ah
	push	ax
	mov	ax, 3
	push	ax
	push	cs
	call	near ptr convertSpellLevel
	add	sp, 4
	lfs	bx, [bp+arg_0]
	mov	al, fs:[bx+bi_char_t.magiLevel]
	sub	ah, ah
	push	ax
	mov	ax, 4
	push	ax
	push	cs
	call	near ptr convertSpellLevel
	add	sp, 4
	pop	si
	mov	sp, bp
	pop	bp
	retf
importBICharacter endp

seg017 ends

; Segment type:	Pure code
seg018 segment byte public 'CODE' use16
	assume cs:seg018
;org 0Ch
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:seg027
; Attributes: bp-based frame
geomancerSomething proc	far

	var_14C= word ptr -14Ch
	var_14A= word ptr -14Ah
	var_136= word ptr -136h
	random16_3= word ptr -134h
	var_132= word ptr -132h
	var_130= word ptr -130h
	var_12E= word ptr -12Eh
	var_12C= word ptr -12Ch
	var_12A= word ptr -12Ah
	random16_1= word ptr -2Ah
	var_28=	word ptr -28h
	var_26=	word ptr -26h
	var_24=	word ptr -24h
	random16_2= word ptr -22h
	var_20=	word ptr -20h
	var_1E=	word ptr -1Eh
	var_A= word ptr	-0Ah
	random16_4= word ptr -6
	var_4= word ptr	-4
	var_2= word ptr	-2

;	mov	ax, 1
;	retf
;geomancerSomething endp

	push	bp
	mov	bp, sp
	mov	ax, 14Ch
	call	someStackOperation
	push	si
	call	_random
	and	ax, 0Fh
	mov	[bp+random16_1], ax
	call	_random
	and	ax, 0Fh
	mov	[bp+random16_2], ax
	call	_random
	and	ax, 0Fh
	mov	[bp+random16_3], ax
	call	_random
	and	ax, 0Fh
	mov	[bp+random16_4], ax
	mov	bx, ax
	mov	al, byte_4CA18[bx]
	sub	ah, ah
	mov	[bp+var_A], ax
	mov	cl, 4
	shr	ax, cl
	mov	[bp+var_136], ax
	mov	al, byte ptr [bp+random16_4]
	xor	al, byte ptr [bp+random16_1]
	test	al, 1
	jz	short loc_2712B
	mov	ax, [bp+var_A]
	and	ax, 7
	shl	ax, 1
	mov	cx, [bp+random16_2]
	and	cx, 1
	or	ax, cx
	mov	[bp+var_12E], ax
	mov	bx, ax
	mov	al, byte_4CA28[bx]
	sub	ah, ah
	add	ax, [bp+random16_1]
	sub	ax, [bp+var_136]
	and	ax, 0Fh
	mov	[bp+random16_2], ax
loc_2712B:
	mov	ax, [bp+var_A]
	and	ax, 7
	shl	ax, 1
	mov	[bp+var_12E], ax
	mov	ax, [bp+random16_2]
	sub	ax, [bp+random16_1]
	add	ax, [bp+var_136]
	and	ax, 0Fh
	mov	[bp+var_12C], ax
	mov	bx, [bp+var_12E]
	mov	al, byte_4CA28[bx]
	sub	ah, ah
	cmp	ax, [bp+var_12C]
	jz	short loc_27162
	mov	al, byte_4CA29[bx]
	cmp	ax, [bp+var_12C]
	jnz	short loc_27167
loc_27162:
	mov	ax, 1
	jmp	short loc_27169
loc_27167:
	sub	ax, ax
loc_27169:
	mov	[bp+var_26], ax
	or	ax, ax
	jz	short loc_2717F
	mov	ax, [bp+random16_3]
	sub	ax, [bp+random16_1]
	mov	cl, 4
	shl	ax, cl
	or	al, 8
	jmp	short loc_27189
loc_2717F:
	mov	ax, [bp+random16_2]
	sub	ax, [bp+random16_1]
	mov	cl, 4
	shl	ax, cl
loc_27189:
	mov	[bp+var_4], ax
	mov	al, byte ptr [bp+var_4]
	add	al, byte ptr [bp+var_A]
	sub	ah, ah
	mov	[bp+var_2], ax
	mov	ah, byte ptr [bp+var_2]
	sub	al, al
	add	ax, [bp+var_2]
	mov	[bp+var_24], ax
	mov	[bp+var_28], 0Fh
	jmp	short loc_271AC
loc_271A9:
	dec	[bp+var_28]
loc_271AC:
	cmp	[bp+var_28], 0
	jle	short loc_271C8
	mov	ax, [bp+var_24]
	and	ax, 1
	mov	[bp+var_4], ax
	shr	[bp+var_24], 1
	or	ax, ax
	jz	short loc_271C6
	add	byte ptr [bp+var_24+1],	0B4h
loc_271C6:
	jmp	short loc_271A9
loc_271C8:
	mov	al, byte ptr [bp+var_24+1]
	sub	ah, ah
	mov	[bp+var_14C], ax
	mov	ax, [bp+var_2]
	and	ax, 7
	mov	si, ax
	shr	si, 1
	mov	al, byte_4CA38[si]
	sub	ah, ah
	and	[bp+var_14C], ax
	mov	ax, si
	xor	al, 3
	mov	[bp+var_20], ax
	mov	[bp+var_28], 0
	jmp	short loc_271F6
loc_271F3:
	inc	[bp+var_28]
loc_271F6:
	cmp	[bp+var_28], 14h
	jge	short loc_27205
	mov	si, [bp+var_28]
	mov	byte ptr [bp+si+var_1E], 0
	jmp	short loc_271F3
loc_27205:
	mov	[bp+var_28], 0
	mov	ax, [bp+var_14C]
	mov	cl, 7
	shr	ax, cl
	push	ax
	push	cs
	call	near ptr sub_273DA
	add	sp, 2
	mov	si, [bp+var_28]
	inc	[bp+var_28]
	mov	byte ptr [bp+si+var_1E], al
	mov	ax, [bp+var_14C]
	mov	cl, 4
	shr	ax, cl
	push	ax
	push	cs
	call	near ptr sub_273DA
	add	sp, 2
	mov	si, [bp+var_28]
	inc	[bp+var_28]
	mov	byte ptr [bp+si+var_1E], al
	mov	ax, [bp+var_14C]
	shr	ax, 1
	push	ax
	push	cs
	call	near ptr sub_273DA
	add	sp, 2
	mov	si, [bp+var_28]
	inc	[bp+var_28]
	mov	byte ptr [bp+si+var_1E], al
	mov	ax, [bp+var_24]
	mov	cl, 6
	shr	ax, cl
	push	ax
	push	cs
	call	near ptr sub_273DA
	add	sp, 2
	mov	si, [bp+var_28]
	inc	[bp+var_28]
	mov	byte ptr [bp+si+var_1E], al
	mov	ax, [bp+var_24]
	mov	cl, 3
	shr	ax, cl
	push	ax
	push	cs
	call	near ptr sub_273DA
	add	sp, 2
	mov	si, [bp+var_28]
	inc	[bp+var_28]
	mov	byte ptr [bp+si+var_1E], al
	push	[bp+var_24]
	push	cs
	call	near ptr sub_273DA
	add	sp, 2
	mov	si, [bp+var_28]
	inc	[bp+var_28]
	mov	byte ptr [bp+si+var_1E], al
	mov	ax, offset aToTraverseTime
	push	ds
	push	ax
	lea	ax, [bp+var_12A]
	push	ss
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_132], ax
	mov	[bp+var_130], dx
	mov	bx, [bp+random16_1]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (off_4C958+2)[bx]
	push	word ptr off_4C958[bx]
	push	dx
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_132], ax
	mov	[bp+var_130], dx
	mov	ax, offset asc_4C8DA
	push	ds
	push	ax
	push	dx
	push	[bp+var_132]
	call	_strcat
	add	sp, 8
	mov	[bp+var_132], ax
	mov	[bp+var_130], dx
	mov	bx, [bp+random16_2]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (off_4C998+2)[bx]
	push	word ptr off_4C998[bx]
	push	dx
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_132], ax
	mov	[bp+var_130], dx
	mov	ax, offset asc_4C8DA
	push	ds
	push	ax
	push	dx
	push	[bp+var_132]
	call	_strcat
	add	sp, 8
	mov	[bp+var_132], ax
	mov	[bp+var_130], dx
	mov	bx, [bp+random16_3]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (off_4C9D8+2)[bx]
	push	word ptr off_4C9D8[bx]
	push	dx
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_132], ax
	mov	[bp+var_130], dx
	mov	ax, offset aAnd_0
	push	ds
	push	ax
	push	dx
	push	[bp+var_132]
	call	_strcat
	add	sp, 8
	mov	[bp+var_132], ax
	mov	[bp+var_130], dx
	mov	bx, [bp+random16_4]
	shl	bx, 1
	shl	bx, 1
	push	word ptr (off_4C918+2)[bx]
	push	word ptr off_4C918[bx]
	push	dx
	push	ax
	call	_strcat
	add	sp, 8
	mov	[bp+var_132], ax
	mov	[bp+var_130], dx
	mov	ax, offset a__0
	push	ds
	push	ax
	push	dx
	push	[bp+var_132]
	call	_strcat
	add	sp, 8
	mov	[bp+var_132], ax
	mov	[bp+var_130], dx
	lea	ax, [bp+var_12A]
	push	ss
	push	ax
	call	printString
	add	sp, 4
	mov	ax, 10h
	push	ax
	lea	ax, [bp+var_14A]
	push	ss
	push	ax
	call	_readString
	add	sp, 6
	push	[bp+var_20]
	lea	ax, [bp+var_1E]
	push	ss
	push	ax
	lea	ax, [bp+var_14A]
	push	ss
	push	ax
	push	cs
	call	near ptr sub_273F2
	add	sp, 0Ah
	jmp	short $+2
	pop	si
	mov	sp, bp
	pop	bp
	retf
geomancerSomething endp

; Attributes: bp-based frame

sub_273DA proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	xor	ax, ax
	call	someStackOperation
	mov	ax, [bp+arg_0]
	and	ax, 7
	or	al, 30h
	jmp	short $+2
	mov	sp, bp
	pop	bp
	retf
sub_273DA endp

; Attributes: bp-based frame

sub_273F2 proc far

	var_2= word ptr	-2
	arg_0= dword ptr  6
	arg_4= dword ptr  0Ah
	arg_8= word ptr	 0Eh

	push	bp
	mov	bp, sp
	mov	ax, 2
	call	someStackOperation
	push	si
	mov	ax, [bp+arg_8]
	mov	[bp+var_2], ax
	jmp	short loc_27409
loc_27406:
	inc	[bp+var_2]
loc_27409:
	cmp	[bp+var_2], 7
	jge	short loc_27429
	lfs	bx, [bp+arg_0]
	inc	word ptr [bp+arg_0]
	mov	al, fs:[bx]
	mov	bx, [bp+var_2]
	lfs	si, [bp+arg_4]
	cmp	fs:[bx+si], al
	jmp	short loc_27427
	sub	ax, ax
	jmp	short loc_2742E
loc_27427:
	jmp	short loc_27406
loc_27429:
	mov	ax, 1
	jmp	short $+2
loc_2742E:
	pop	si
	mov	sp, bp
	pop	bp
locret_27432:
	retf
sub_273F2 endp

seg018 ends

; Segment type:	Pure code
seg019 segment word public 'CODE' use16
	assume cs:seg019
;org 3
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:nothing
byte_27433 db 90h, 10h dup(0)
; Attributes: bp-based frame

dcmp_init proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	push	ds
	push	si
	push	di
	push	es
	mov	ax, seg	seg020
	mov	ds, ax
	assume ds:seg020
	mov	bx, [bp+arg_0]
	mov	word_2AD1E, bx
	mov	ah, 3Fh	
	mov	dx, offset byte_2AD20
	mov	cx, 200h
	int	21h		; BX = file handle, CX = number	of bytes to read
			; DS:DX	-> buffer
	mov	si, offset byte_2AD20
	lodsw
	mov	dx, ax
	lodsw
	xchg	al, ah
	xchg	dl, dh
	mov	decompBytes23, ax
	mov	decompBytes01, dx
	mov	word_2AD1C, 0
	add	si, 4
	lodsb
	mov	_decompBufIndex, si
	mov	byte ptr _decompByteMask, 80h
	mov	byte ptr _decompByteMask+1, al
	mov	ax, offset byte_2AF24
	push	ax
	call	dcmp_expandTree
	inc	sp
	inc	sp
	pop	es
	pop	di
	pop	si
	pop	ds
	assume ds:dseg
	pop	bp
	retf
dcmp_init endp ; sp = -2
; Attributes: bp-based frame

dcmp_decompress	proc far

	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	push	es
	push	ds
	mov	ax, seg	seg020
	mov	ds, ax
	assume ds:seg020
	push	si
	push	di
	les	di, [bp+arg_0]
	mov	word_2BE29, di
	mov	bx, [bp+arg_4]
	mov	word_2BE2B, bx
	mov	ax, decompBytes23
	mov	dx, decompBytes01
	sub	cx, cx
	sub	bx, ax
	sbb	cx, dx
	jl	short loc_274C4
	mov	word_2BE2B, ax
loc_274C4:
	mov	word_2BE2D, 0
loc_274CA:
	mov	ax, word_2BE2B
	cmp	ax, word_2BE2D
	jz	short loc_2750A
	mov	di, offset byte_2AF24
loc_274D6:
	cmp	word ptr [di], 0
	jz	short loc_274F8
	mov	ax, _decompByteMask
	or	al, al
	jz	short loc_27519
loc_274E2:
	and	ah, al
	shr	al, 1
	mov	byte ptr _decompByteMask, al
	mov	al, ah
	or	al, al
	jnz	short loc_274F3
	mov	di, [di]
	jmp	short loc_274D6
loc_274F3:
	mov	di, [di+2]
	jmp	short loc_274D6
loc_274F8:
	mov	al, [di+4]
	mov	di, word_2BE29
	stosb
	mov	word_2BE29, di
	inc	word_2BE2D
	jmp	short loc_274CA
loc_2750A:
	sub	decompBytes23, ax
	sbb	decompBytes01, 0
	pop	di
	pop	si
	pop	ds
	assume ds:dseg
	pop	es
	pop	bp
	retf
loc_27519:
	mov	si, ds:_decompBufIndex
	cmp	si, offset _decompBufIndex
	jz	short loc_27531
	lodsb
	mov	byte ptr ds:_decompByteMask+1, al
	mov	ds:_decompBufIndex, si
	mov	ah, 80h
	xchg	al, ah
	jmp	short loc_274E2
loc_27531:
	mov	ah, 3Fh	
	mov	bx, ds:word_2AD1E
	mov	cx, 200h
	mov	dx, offset byte_2AD20
	int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
			; BX = file handle, CX = number	of bytes to read
			; DS:DX	-> buffer
	mov	si, dx
	lodsb
	mov	ah, 80h
	mov	ds:_decompBufIndex, si
	mov	byte ptr ds:_decompByteMask+1, al
	xchg	al, ah
	jmp	short loc_274E2
dcmp_decompress	endp

; Attributes: bp-based frame
dcmp_expandTree	proc near

	arg_0= word ptr	 2

	call	dcmp_getNextBit
	jnz	short loc_27576
	call	dcmp_newNode
	mov	di, ax
	call	dcmp_newNode
	mov	bp, sp
	mov	si, [bp+arg_0]
	mov	[si], di
	mov	[si+2],	ax
	push	ax
	push	di
	call	dcmp_expandTree
	inc	sp
	inc	sp
	call	dcmp_getNextBit
	call	dcmp_expandTree
	inc	sp
	inc	sp
locret_27575:
	retn
loc_27576:
	call	dcmp_extractByte
	mov	bp, sp
	mov	si, [bp+arg_0]
	mov	[si+4],	al
	retn
dcmp_expandTree	endp

dcmp_getNextBit	proc near
	mov	ax, ds:_decompByteMask
	or	al, al
	jz	short loc_27595
loc_27589:
	and	ah, al
	shr	al, 1
	mov	byte ptr ds:_decompByteMask, al
	mov	al, ah
	or	al, al
	retn
loc_27595:
	mov	si, ds:_decompBufIndex
	cmp	si, offset _decompBufIndex
	jz	short loc_275AD
	lodsb
	mov	byte ptr ds:_decompByteMask+1, al
	mov	ds:_decompBufIndex, si
	mov	ah, 80h
	xchg	al, ah
	jmp	short loc_27589
loc_275AD:
	mov	ah, 3Fh	
	mov	bx, ds:word_2AD1E
	mov	cx, 200h
	mov	dx, offset byte_2AD20
	int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
			; BX = file handle, CX = number	of bytes to read
			; DS:DX	-> buffer
	mov	si, dx
	lodsb
	mov	ah, 80h
	mov	ds:_decompBufIndex, si
	mov	byte ptr ds:_decompByteMask+1, al
	xchg	al, ah
	jmp	short loc_27589
dcmp_getNextBit	endp

dcmp_extractByte proc near
	mov	bp, 8
loc_275CE:
	shl	di, 1
	call	dcmp_getNextBit
	jz	short loc_275D8
	or	di, 1
loc_275D8:
	dec	bp
	jnz	short loc_275CE
	mov	ax, di
	retn
dcmp_extractByte endp

dcmp_newNode proc near
	mov	ax, ds:word_2AD1C
	cmp	ax, 300h
	jge	short loc_275FE
	mov	bx, ax
	inc	ax
	mov	ds:word_2AD1C, ax
	mov	ax, bx
	shl	ax, 1
	shl	ax, 1
	add	ax, bx
	add	ax, (offset byte_2AF24+5)
	mov	bx, ax
	mov	word ptr [bx], 0
	retn
loc_275FE:
	sub	ax, ax
	retn
dcmp_newNode endp

align 2
d3cmp_readData proc near
	push	es
	push	di
	push	cx
	push	si
	push	ax
	cld
	mov	ax, ds
	mov	es, ax
	assume es:dseg
	mov	di, offset workBuf
	mov	si, curFromOffset
	add	curFromOffset, 80h
	mov	ds, curFromSegment
	mov	cx, 64
	rep movsw
	mov	ax, es
	mov	ds, ax
	mov	workBufIndex, 0
	pop	ax
	pop	si
	pop	cx
	pop	di
	pop	es
	assume es:nothing
	retn
d3cmp_readData endp

sub_27632 proc near
	mov	si, workBufIndex
	xor	ax, ax
	test	si, 80h
	jnz	short loc_27647
loc_2763E:
	mov	al, byte ptr workBuf[si]
	inc	workBufIndex
	retn
loc_27647:
	call	d3cmp_readData
	xor	si, si
	jmp	short loc_2763E
sub_27632 endp

d3cmp_outputToBuffer proc near
	push	es
	push	di
	push	si
	cld
	mov	ax, curToSegment
	mov	es, ax
	mov	di, curToOffset
	mov	si, offset byte_4DD7B
	mov	cx, bp
	rep movsb
	add	curToOffset, bp
	jb	short loc_2766C
loc_27668:
	pop	si
	pop	di
	pop	es
	retn
loc_2766C:
	add	curToSegment, 1000h
	add	word_4EE46, 1
	jmp	short loc_27668
d3cmp_outputToBuffer endp

d3cmp_updateMemory proc	near
	push	bp
	push	ax
	push	di
	cmp	word_4CC4B+4E4h, 8000h
	jnz	short loc_27699
	push	ax
	push	bx
	push	cx
	push	dx
	push	si
	push	di
	push	ds
	push	es
	push	bp
	call	sub_27980
	pop	bp
	pop	es
	pop	ds
	pop	di
	pop	si
	pop	dx
	pop	cx
	pop	bx
	pop	ax
loc_27699:
	mov	si, ax
	shl	si, 1
	mov	bp, (word_4CC4B+9CEh)[si]
loc_276A1:
	mov	cx, bp
	shl	bp, 1
	inc	ds:word_4CC4B[bp]
	mov	si, ds:word_4CC4B[bp]
	mov	bx, cx
	inc	bx
	shl	bx, 1
	cmp	word_4CC4B[bx],	si
	jb	short loc_276BE
	mov	bx, bp
	jmp	short loc_27716
loc_276BE:
	add	bx, 2
	cmp	si, word_4CC4B[bx]
	ja	short loc_276BE
	sub	bx, 2
	mov	ax, word_4CC4B[bx]
	mov	di, cx
	shl	di, 1
	mov	word_4CC4B[di],	ax
	mov	word_4CC4B[bx],	si
	mov	si, (word_4CC4B+0C42h)[di]
	shl	si, 1
	shr	bx, 1
	mov	(word_4CC4B+4E8h)[si], bx
	cmp	si, 1254
	jge	short loc_276F0
	mov	(word_4CC4B+4EAh)[si], bx
loc_276F0:
	shl	bx, 1
	mov	di, (word_4CC4B+0C42h)[bx]
	shl	di, 1
	shr	si, 1
	mov	(word_4CC4B+0C42h)[bx],	si
	mov	(word_4CC4B+4E8h)[di], cx
	cmp	di, 4E6h
	jge	short loc_2770C
	mov	(word_4CC4B+4EAh)[di], cx
loc_2770C:
	mov	si, cx
	shl	si, 1
	shr	di, 1
	mov	(word_4CC4B+0C42h)[si],	di
loc_27716:
	mov	bp, (word_4CC4B+4E8h)[bx]
	or	bp, bp
	jz	short loc_27720
	jmp	short loc_276A1
loc_27720:
	pop	di
	pop	ax
	pop	bp
	retn
d3cmp_updateMemory endp

sub_27724 proc near
	cmp	dl, 8
	jbe	short loc_27733
loc_27729:
	xor	ax, ax
	shl	di, 1
	adc	ax, 0
	dec	dl
	retn
loc_27733:
	mov	si, workBufIndex
	xor	ax, ax
	test	si, 80h
	jnz	short loc_27759
loc_2773F:
	mov	al, byte ptr workBuf[si]
	inc	workBufIndex
	mov	cl, 8
	sub	cl, dl
	shl	ax, cl
	or	di, ax
	add	dl, 8
	test	cl, 8
	jz	short loc_27729
	jmp	short loc_27733
loc_27759:
	call	d3cmp_readData
	xor	si, si
	jmp	short loc_2773F
sub_27724 endp

; START	OF FUNCTION CHUNK FOR d3cmp_getNextWord
loc_27760:
	mov	si, workBufIndex
	xor	ax, ax
	test	si, 80h
	jnz	short loc_27786
loc_2776C:
	mov	al, byte ptr workBuf[si]
	inc	workBufIndex
	mov	cl, 8
	sub	cl, dl
	shl	ax, cl
	or	di, ax
	add	dl, 8
	test	cl, 8
	jz	short loc_2779E
	jmp	short loc_27760
loc_27786:
	call	d3cmp_readData
	xor	si, si
	jmp	short loc_2776C
; END OF FUNCTION CHUNK	FOR d3cmp_getNextWord
d3cmp_getNextWord proc near
; FUNCTION CHUNK AT 0330 SIZE 0000002D BYTES
	mov	bx, word_4CC4B+1126h
loc_27791:
	shl	bx, 1
	cmp	bx, 1254
	jnb	short loc_277B1
	cmp	dl, 8
	jbe	short loc_27760
loc_2779E::
	xor	ax, ax
	shl	di, 1
	adc	ax, 0
	dec	dl
	shl	ax, 1
	add	bx, ax
	mov	bx, (word_4CC4B+0C42h)[bx]
	jmp	short loc_27791
loc_277B1:
	mov	ax, bx
	shr	ax, 1
	sub	ax, 627
	call	d3cmp_updateMemory
	retn
d3cmp_getNextWord endp

d3cmp_readCopyOffset proc near

	arg_6= byte ptr	 8

	cmp	dl, 8
	ja	short loc_277EE
loc_277C1:
	mov	si, workBufIndex
	xor	ax, ax
	test	si, 80h
	jnz	short loc_277E7
loc_277CD:
	mov	al, byte ptr workBuf[si]
	inc	workBufIndex
	mov	cl, 8
	sub	cl, dl
	shl	ax, cl
	or	di, ax
	add	dl, 8
	test	cl, 8
	jz	short loc_277EE
	jmp	short loc_277C1
loc_277E7:
	call	d3cmp_readData
	xor	si, si
	jmp	short loc_277CD
loc_277EE:
	sub	dl, 8
	mov	bx, di
	xor	ax, ax
	xchg	bl, ah
	mov	di, ax		; di = (bl << 8)
	xchg	bh, bl
	xor	cx, cx
	mov	ch, byte_4CB3F[bx]
	shr	cx, 1
	shr	cx, 1
	push	cx
	xor	cx, cx
	mov	cl, byte_4CA3F[bx]
	dec	cl
	dec	cl
	jcxz	short loc_2782A
loc_27812:
	shl	bx, 1
	xchg	dh, cl
	cmp	dl, 8
	jbe	short loc_27833
loc_2781B:
	xor	ax, ax
	shl	di, 1
	adc	ax, 0
	dec	dl
	xchg	cl, dh
	add	bx, ax
	loop	loc_27812
loc_2782A:
	pop	cx
	and	bx, 3Fh
	or	cx, bx
	mov	ax, cx
	retn
loc_27833:
	mov	si, workBufIndex
	xor	ax, ax
	test	si, 80h
	jnz	short loc_27859
loc_2783F:
	mov	al, byte ptr workBuf[si]
	inc	workBufIndex
	mov	cl, 8
	sub	cl, dl
	shl	ax, cl
	or	di, ax
	add	dl, 8
	test	cl, 8
	jz	short loc_2781B
	jmp	short loc_27833
loc_27859:
	call	d3cmp_readData
	xor	si, si
	jmp	short loc_2783F
d3cmp_readCopyOffset endp

d3cmp_init proc	near
	push	bp
	push	di
	push	si
	xor	si, si
	mov	bp, 2
loc_27868:
	mov	cx, si
	shr	cx, 1
	mov	word_4CC4B[si],	1
	mov	di, cx
	add	di, 627
	mov	(word_4CC4B+0C42h)[si],	di
	shl	di, 1
	mov	(word_4CC4B+4E8h)[di], cx
	add	si, bp
	cmp	si, 628
	jl	short loc_27868
	xor	di, di
	mov	bx, 628
loc_2788F:
	mov	ax, word_4CC4B[di]
	add	ax, (word_4CC4B+2)[di]
	mov	word_4CC4B[bx],	ax
	shr	di, 1
	mov	(word_4CC4B+0C42h)[bx],	di
	shl	di, 1
	shr	bx, 1
	mov	(word_4CC4B+4E8h)[di], bx
	mov	(word_4CC4B+4EAh)[di], bx
	shl	bx, 1
	add	di, 4
	add	bx, bp
	cmp	bx, 1252
	jle	short loc_2788F
	mov	word_4CC4B+4E6h, 0FFFFh
	mov	word_4CC4B+9CCh, 0
	pop	si
	pop	di
	pop	bp
	retn
d3cmp_init endp

d3cmp_doDecomp proc near
	push	bp
	mov	ax, word ptr dataHeader
	or	ax, word ptr dataHeader+2
	jnz	short loc_278D7
	jmp	loc_2797E
loc_278D7:
	call	d3cmp_init
	xor	bp, bp
	sub	ax, ax
	mov	word ptr countMaybe+2, ax
	mov	word ptr countMaybe, ax
	sub	dx, dx
loc_278E6:
	mov	ax, word ptr dataHeader
	mov	cx, word ptr dataHeader+2
	cmp	word ptr countMaybe+2, cx
	jbe	short loc_278F6
	jmp	loc_2797B
loc_278F6:
	jb	short loc_27901
	cmp	word ptr countMaybe, ax
	jb	short loc_27901
	jmp	short loc_2797B
db 90h
loc_27901:
	call	d3cmp_getNextWord
	cmp	ax, 256
	jge	short loc_27927
	mov	ds:byte_4DD7B[bp], al
	inc	bp
	test	bp, 4096
	jz	short loc_2791B
	call	d3cmp_outputToBuffer
	mov	bp, 0
loc_2791B:
	add	word ptr countMaybe, 1
	adc	word ptr countMaybe+2, 0
	jmp	short loc_27978
loc_27927:
	sub	ax, 253
	mov	word_4CC41, ax
	call	d3cmp_readCopyOffset
	mov	cx, bp
	sub	cx, ax
	dec	cx
	mov	_d3cmp_baseAddr, cx
	mov	_d3cmp_offset, 0
	jmp	short loc_2796F
loc_27941:
	mov	bx, _d3cmp_baseAddr
	add	bx, _d3cmp_offset
	and	bh, 0Fh
	mov	al, byte_4DD7B[bx]
	mov	ds:byte_4DD7B[bp], al
	inc	bp
	test	bp, 1000h
	jz	short loc_27961
	call	d3cmp_outputToBuffer
	xor	bp, bp
loc_27961:
	add	word ptr countMaybe, 1
	adc	word ptr countMaybe+2, 0
	inc	_d3cmp_offset
loc_2796F:
	mov	ax, word_4CC41
	cmp	_d3cmp_offset, ax
	jl	short loc_27941
loc_27978:
	jmp	loc_278E6
loc_2797B:
	call	d3cmp_outputToBuffer
loc_2797E:
	pop	bp
	retn
d3cmp_doDecomp endp

sub_27980 proc near
	push	ax
	push	bx
	push	cx
	push	dx
	push	si
	push	di
	push	ds
	push	es
	push	bp
	mov	word_4EE4A, 0
	mov	word_4EE48, 0
loc_27995:
	mov	si, word_4EE48
	shl	si, 1
	cmp	(word_4CC4B+0C42h)[si],	273h
	jl	short loc_279C0
	mov	di, word_4EE4A
	shl	di, 1
	mov	ax, word_4CC4B[si]
	inc	ax
	shr	ax, 1
	mov	word_4CC4B[di],	ax
	mov	ax, (word_4CC4B+0C42h)[si]
	mov	(word_4CC4B+0C42h)[di],	ax
	inc	word_4EE4A
loc_279C0:
	inc	word_4EE48
	cmp	word_4EE48, 273h
	jl	short loc_27995
	mov	word_4EE48, 0
	mov	word_4EE4A, 13Ah
	jmp	short loc_27A52
loc_279DA:
	dec	word_4EE4C
loc_279DE:
	mov	bx, word_4EE4C
	shl	bx, 1
	mov	ax, word_4EE4E
	cmp	word_4CC4B[bx],	ax
	ja	short loc_279DA
	inc	word_4EE4C
	mov	cx, word_4EE4A
	sub	cx, word_4EE4C
	shl	cx, 1
	mov	word_4EE50, cx
	std
	mov	di, word_4EE4C
	shl	di, 1
	add	di, offset word_4CC4B
	add	di, cx
	shr	cx, 1
	mov	si, di
	sub	si, 2
	rep movsw
	mov	si, word_4EE4C
	shl	si, 1
	mov	ax, word_4EE4E
	mov	word_4CC4B[si],	ax
	mov	cx, word_4EE50
	mov	di, word_4EE4C
	shl	di, 1
	add	di, (offset word_4CC4B+0C42h)
	add	di, cx
	shr	cx, 1
	mov	si, di
	sub	si, 2
	rep movsw
	cld
	mov	bx, word_4EE4C
	shl	bx, 1
	mov	ax, word_4EE48
	mov	(word_4CC4B+0C42h)[bx],	ax
	add	word_4EE48, 2
	inc	word_4EE4A
loc_27A52:
	cmp	word_4EE4A, 273h
	jge	short loc_27A8C
	mov	ax, word_4EE48
	inc	ax
	mov	word_4EE4C, ax
	mov	bx, word_4EE4A
	shl	bx, 1
	mov	si, word_4EE48
	shl	si, 1
	mov	ax, word_4CC4B[si]
	mov	si, word_4EE4C
	shl	si, 1
	add	ax, word_4CC4B[si]
	mov	word_4CC4B[bx],	ax
	mov	word_4EE4E, ax
	mov	ax, word_4EE4A
	dec	ax
	mov	word_4EE4C, ax
	jmp	loc_279DE
loc_27A8C:
	mov	word_4EE48, 0
	jmp	short loc_27AA9
loc_27A94:
	mov	si, word_4EE4C
	shl	si, 1
	mov	ax, word_4EE48
	mov	(word_4CC4B+4EAh)[si], ax
	mov	(word_4CC4B+4E8h)[si], ax
loc_27AA5:
	inc	word_4EE48
loc_27AA9:
	cmp	word_4EE48, 273h
	jge	short loc_27AD0
	mov	bx, word_4EE48
	shl	bx, 1
	mov	ax, (word_4CC4B+0C42h)[bx]
	mov	word_4EE4C, ax
	cmp	ax, 273h
	jl	short loc_27A94
	mov	bx, ax
	shl	bx, 1
	mov	ax, word_4EE48
	mov	(word_4CC4B+4E8h)[bx], ax
	jmp	short loc_27AA5
loc_27AD0:
	pop	bp
	pop	es
	pop	ds
	pop	di
	pop	si
	pop	dx
	pop	cx
	pop	bx
	pop	ax
	retn
sub_27980 endp

; Attributes: bp-based frame

d3comp proc far

	fromOffset= word ptr  6
	fromSegment= word ptr  8
	toOffset= word ptr  0Ah
	toSegment= word	ptr  0Ch

	push	bp
	mov	bp, sp
	push	di
	push	si
	push	ds
	push	es
	mov	ax, seg	dseg
	mov	ds, ax
	mov	ax, [bp+fromOffset]
	mov	curFromOffset, ax
	mov	ax, [bp+fromSegment]
	mov	curFromSegment,	ax
	mov	ax, [bp+toOffset]
	mov	curToOffset, ax
	mov	ax, [bp+toSegment]
	mov	curToSegment, ax
	mov	ax, curFromSegment
	mov	es, ax
	mov	di, curFromOffset
	mov	ax, es:[di]
	mov	word ptr dataHeader, ax
	mov	ax, es:[di+2]
	mov	word ptr dataHeader+2, ax
	add	curFromOffset, 4
	mov	ax, ds
	mov	es, ax
	assume es:dseg
	mov	di, offset byte_4DD7B
	mov	cx, 4155
	mov	al, 20h	
	rep stosb
	xor	di, di
	call	d3cmp_readData
	call	d3cmp_doDecomp
	pop	es
	assume es:nothing
	pop	ds
	pop	si
	pop	di
	pop	bp
	retf
d3comp endp


_readChFromKeyboard proc far
	sub	ax, ax
	int	16h		; KEYBOARD - READ CHAR FROM BUFFER, WAIT IF EMPTY
			; Return: AH = scan code, AL = character
	retf
_readChFromKeyboard endp


_random	proc far
	cli
	in	al, 40h		; Timer	8253-5 (AT: 8254.2).
	mov	ah, al
	in	al, 40h		; Timer	8253-5 (AT: 8254.2).
	add	al, ah
	sti
	add	ax, randomSeed
	mov	randomSeed, ax
	retf
_random	endp

; Attributes: bp-based frame

sub_27B4C proc far

	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	push	ds
	lds	dx, [bp+arg_0]
	sub	cx, cx
	mov	ah, 3Ch
	int	21h		; DOS -	2+ - CREATE A FILE WITH	HANDLE (CREAT)
			; CX = attributes for file
			; DS:DX	-> ASCIZ filename (may include drive and path)
	jnb	short loc_27B5E
	sub	ax, ax
	dec	ax
loc_27B5E:
	pop	ds
	pop	bp
	retf
sub_27B4C endp

; Attributes: bp-based frame

openFile proc far

	arg_0= dword ptr  6
	arg_4= byte ptr	 0Ah

	push	bp
	mov	bp, sp
	push	ds
	lds	dx, [bp+arg_0]
	mov	al, [bp+arg_4]
	mov	ah, 3Dh
	int	21h		; DS:DX	-> ASCIZ filename
			; AL = access mode
			; 0 - read, 1 -	write, 2 - read	& write
	jnb	short loc_27B74
	sub	ax, ax
	dec	ax
loc_27B74:
	pop	ds
	pop	bp
	retf
openFile endp

; Attributes: bp-based frame

_close proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	mov	bx, [bp+arg_0]
	mov	ah, 3Eh
	int	21h		; DOS -	2+ - CLOSE A FILE WITH HANDLE
			; BX = file handle
	jnb	short loc_27B86
	sub	ax, ax
	dec	ax
loc_27B86:
	pop	bp
	retf
_close endp

; Attributes: bp-based frame

_read proc far

	fd= word ptr  6
	memBuf=	dword ptr  8
	numBytes= word ptr  0Ch

	push	bp
	mov	bp, sp
	push	ds
	mov	bx, [bp+fd]
	lds	dx, [bp+memBuf]
	mov	cx, [bp+numBytes]
	mov	ah, 3Fh
	int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
			; BX = file handle, CX = number	of bytes to read
			; DS:DX	-> buffer
	jnb	short loc_27B9E
	sub	ax, ax
	dec	ax
loc_27B9E:
	pop	ds
	pop	bp
	retf
_read endp

	push	bp
	mov	bp, sp
	push	ds
	mov	bx, [bp+6]
	lds	dx, [bp+8]
	mov	cx, 4
	mov	ah, 3Fh
	int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
			; BX = file handle, CX = number	of bytes to read
			; DS:DX	-> buffer
	jnb	short loc_27BBA
	sub	ax, ax
	dec	ax
	pop	ds
	pop	bp
	retf
loc_27BBA:
	mov	bx, [bp+8]
	mov	ax, [bx]
	mov	cx, [bx+2]
	xchg	al, ah
	xchg	cl, ch
	mov	[bx], cx
	mov	[bx+2],	ax
	sub	ax, ax
	pop	ds
	pop	bp
	retf
; Attributes: bp-based frame

_write proc far

	arg_0= word ptr	 6
	arg_2= dword ptr  8
	arg_6= word ptr	 0Ch

	push	bp
	mov	bp, sp
	push	ds
	mov	bx, [bp+arg_0]
	lds	dx, [bp+arg_2]
	mov	cx, [bp+arg_6]
	mov	ah, 40h
	int	21h		; DOS -	2+ - WRITE TO FILE WITH	HANDLE
			; BX = file handle, CX = number	of bytes to write, DS:DX -> buffer
	jnb	short loc_27BE6
	sub	ax, ax
	dec	ax
loc_27BE6::
	pop	ds
	pop	bp
	retf
_write endp

	push	bp
	mov	bp, sp
	push	ds
	mov	bx, [bp+6]
	lds	dx, [bp+8]
	mov	cx, [bp+0Ch]
	mov	ah, 40h
	int	21h		; DOS -	2+ - WRITE TO FILE WITH	HANDLE
			; BX = file handle, CX = number	of bytes to write, DS:DX -> buffer
	jnb	short loc_27BE6
	sub	ax, ax
	dec	ax
; Attributes: bp-based frame

_lseek proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	push	ds
	mov	bx, [bp+arg_0]
	mov	cx, [bp+arg_4]
	mov	dx, [bp+arg_2]
	mov	ax, 4200h
	int	21h		; DOS -	2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
			; AL = method: offset from beginning of	file
	jnb	short loc_27C16
	sub	ax, ax
	dec	ax
loc_27C16:
	pop	ds
	pop	bp
	retf
_lseek endp

	push	bp
	mov	bp, sp
	push	ds
	lds	dx, [bp+6]
	mov	ah, 41h
	int	21h		; DOS -	2+ - DELETE A FILE (UNLINK)
			; DS:DX	-> ASCIZ pathname of file to delete (no	wildcards allowed)
	jnb	short loc_27C29
	sub	ax, ax
	dec	ax
loc_27C29:
	pop	ds
	pop	bp
	retf
; Attributes: bp-based frame

findFirstFile proc far

	arg_0= dword ptr  6
	arg_4= dword ptr  0Ah

	push	bp
	mov	bp, sp
	push	ds
	lds	dx, [bp+arg_4]
	mov	ah, 1Ah
	int	21h		; DOS -	SET DISK TRANSFER AREA ADDRESS
			; DS:DX	-> disk	transfer buffer
	lds	dx, [bp+arg_0]
	mov	cx, 7
	mov	ah, 4Eh
	int	21h		; DOS -	2+ - FIND FIRST	ASCIZ (FINDFIRST)
			; CX = search attributes
			; DS:DX	-> ASCIZ filespec
			; (drive, path,	and wildcards allowed)
	mov	ax, 0
	jb	short loc_27C47
	inc	ax
loc_27C47:
	pop	ds
	pop	bp
	retf
findFirstFile endp


sub_27C4A proc far
	push	bp
	mov	ah, 4Fh
	int	21h		; DOS -	2+ - FIND NEXT ASCIZ (FINDNEXT)
			; [DTA]	= data block from
			; last AH = 4Eh/4Fh call
	mov	ax, 0
	jb	short loc_27C55
	inc	ax
loc_27C55:
	pop	bp
	retf
sub_27C4A endp

align 2
	retf

checkKeyboard proc far
	mov	ah, 1
	int	16h		; KEYBOARD - CHECK BUFFER, DO NOT CLEAR
			; Return: ZF clear if character	in buffer
			; AH = scan code, AL = character
			; ZF set if no character in buffer
	jnz	short loc_27C62
	sub	ax, ax
locret_27C61:
	retf
loc_27C62:
	or	ax, ax
	jnz	short locret_27C61
	inc	ax
	retf
checkKeyboard endp

; Attributes: bp-based frame
bigpic_initBuffers proc	far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	push	ds
	mov	ax, seg	seg021
	mov	ds, ax
	assume ds:seg021
	mov	dx, [bp+arg_0]
	mov	dh, dl
	and	dx, 0F00Fh
	mov	cl, 4
	mov	bx, 0FFh
loc_27C7F:
	xor	ah, ah
	mov	al, bl
	and	al, 0Fh
	mov	byte_2C234[bx],	al
	cmp	dl, al
	jnz	short loc_27C8F
	mov	ah, 0Fh
loc_27C8F:
	shl	al, cl
	mov	byte_2C134[bx],	al
	mov	al, bl
	and	al, 0F0h
	mov	byte_2BF34[bx],	al
	cmp	dh, al
	jnz	short loc_27CA4
	or	ah, 0F0h
loc_27CA4:
	shr	al, cl
	mov	byte_2C034[bx],	al
	mov	byte_2C334[bx],	ah
	dec	bx
	jns	short loc_27C7F
	pop	ds
	assume ds:dseg
	pop	bp
	retf
bigpic_initBuffers endp

; Attributes: bp-based frame

_bigpic_copyTopoElem proc far

	gbuf= dword ptr	 6
	column=	word ptr  0Ah
	row= word ptr  0Ch
	arg_8= word ptr	 0Eh
	arg_A= word ptr	 10h
	height=	word ptr  12h
	arg_E= word ptr	 14h
	rightFlag= word	ptr  16h

	push	bp
	mov	bp, sp
	push	di
	push	si
	push	ds
	push	es
	mov	ax, seg	seg021
	mov	ds, ax
	assume ds:seg021
	mov	es, ax
	assume es:seg021
	mov	word_2BF30, 0
	mov	word_2BF32, 0
loc_27CCE:
	mov	ax, word_2BF30
	sub	ax, [bp+arg_E]
	mov	word_2BF30, ax
	jge	short loc_27D1D
	add	ax, 64
	mov	word_2BF30, ax
	mov	dx, [bp+row]
	mov	ax, 56
	mul	dx
	add	ax, [bp+column]
	add	ax, offset bigpicBuf
	mov	si, ax
	mov	cx, [bp+arg_8]
	or	cx, cx
	jz	short loc_27D29
	les	di, [bp+gbuf]
	assume es:nothing
	add	di, word_2BF32
	mov	dx, [bp+arg_E]
	mov	dh, dl
	xor	dl, dl
	xor	bx, bx
	mov	ax, [bp+rightFlag]
	or	ax, ax
	jz	short loc_27D17
	add	di, [bp+arg_A]
	dec	di
	call	_bigpic_copyRightTopo
	jmp	short loc_27D1A
db 90h
loc_27D17:
	call	_bigpic_copyLeftTopo
loc_27D1A:
	inc	[bp+row]
loc_27D1D:
	mov	ax, [bp+arg_A]
	add	word_2BF32, ax
	dec	[bp+height]
	jnz	short loc_27CCE
loc_27D29:
	pop	es
	pop	ds
	assume ds:dseg
	pop	si
	pop	di
	pop	bp
	retf
_bigpic_copyTopoElem endp

	assume ds:seg021
_bigpic_copyLeftTopo proc near
	mov	bl, es:[di]
	inc	di
	sub	dl, dh
	jge	short loc_27D5A
	add	dl, 64
	mov	al, byte_2BF34[bx]
loc_27D3E:
	sub	dl, dh
	jge	short loc_27D65
	add	dl, 64
	or	al, byte_2C234[bx]
	mov	bl, al
	xor	al, [si]
	and	al, byte_2C334[bx]
	xor	al, bl
	mov	[si], al
	inc	si
	dec	cx
	jns	short _bigpic_copyLeftTopo
	retn
loc_27D5A:
	sub	dl, dh
	jge	short _bigpic_copyLeftTopo
	add	dl, 40h	
	mov	al, byte_2C134[bx]
loc_27D65:
	mov	bl, es:[di]
	inc	di
	sub	dl, dh
	jge	short loc_27D3E
	add	dl, 40h	
	or	al, byte_2C034[bx]
	push	bx
	mov	bl, al
	xor	al, [si]
	and	al, byte_2C334[bx]
	xor	al, bl
	pop	bx
	mov	[si], al
	inc	si
	dec	cx
	jns	short loc_27D5A
	retn
_bigpic_copyLeftTopo endp

_bigpic_copyRightTopo proc near
	mov	bl, es:[di]
	mov	bl, [bx+0]
	dec	di
	sub	dl, dh
	jge	short loc_27DB6
	add	dl, 64
	mov	al, byte_2BF34[bx]
loc_27D9A:
	sub	dl, dh
	jge	short loc_27DC3
	add	dl, 64
	or	al, byte_2C234[bx]
	mov	bl, al
	xor	al, [si]
	and	al, byte_2C334[bx]
	xor	al, bl
	mov	[si], al
	inc	si
	dec	cx
	jns	short _bigpic_copyRightTopo
	retn
loc_27DB6:
	sub	dl, dh
	jge	short _bigpic_copyRightTopo
	add	dl, 64
	shl	ah, 1
	mov	al, byte_2C134[bx]
loc_27DC3:
	mov	bl, es:[di]
	mov	bl, [bx+0]
	dec	di
	sub	dl, dh
	jge	short loc_27D9A
	add	dl, 64
	or	al, byte_2C034[bx]
	push	bx
	mov	bl, al
	xor	al, [si]
	and	al, byte_2C334[bx]
	xor	al, bl
	pop	bx
	mov	[si], al
	inc	si
	dec	cx
	jns	short loc_27DB6
	retn
_bigpic_copyRightTopo endp

; Attributes: bp-based frame

song_initSound proc far

	_segment= word ptr  8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	mov	cx, [bp+_segment]
	mov	ax, [bp+arg_4]
	and	al, 3
	mov	ah, 1
	call	music_driver
	pop	bp
	retf
song_initSound endp


song_endMusic proc far
	mov	ah, 2
	call	music_driver
	retf
song_endMusic endp


sub_27E05 proc far
	mov	ah, al
	and	ah, 1
	add	ah, 3
	call	music_driver
	retf
sub_27E05 endp

; Attributes: bp-based frame

sub_27E13 proc far

	walls= word ptr	 6
	_dirFacing= word ptr  8

	push	bp
	mov	bp, sp
	mov	ax, [bp+_dirFacing]
	and	al, 3
	mov	cl, 2
	shl	ax, cl
	mov	cl, al
	mov	ax, [bp+walls]
	rol	ax, cl
	xor	dx, dx
	pop	bp
	retf
sub_27E13 endp

; Attributes: bp-based frame

sub_27E2A proc far

	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	push	es
	push	di
	les	di, [bp+arg_0]
	xor	ax, ax
	mov	cx, 8
	rep stosb
	pop	di
	pop	es
	pop	bp
	retf
sub_27E2A endp

; Attributes: bp-based frame

sub_27E3D proc far

	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	push	di
	push	si
	push	ds
	push	es
	mov	si, offset byte_4EECD
	les	di, [bp+arg_0]
	mov	ax, [bp+arg_4]
	shl	ax, 1
	shl	ax, 1
	shl	ax, 1
	add	si, ax
	mov	cx, 8
loc_27E58:
	lodsb
	or	al, es:[di]
	stosb
	dec	cx
	jnz	short loc_27E58
	pop	es
	pop	ds
	assume ds:dseg
	pop	si
	pop	di
	pop	bp
	retf
sub_27E3D endp

; Attributes: bp-based frame

bigpic_setBG proc far

	arg_0= dword ptr  6
	skyColor= word ptr  0Ah
	grndColor= word	ptr  0Ch

	push	bp
	mov	bp, sp
	push	di
	push	es
	les	di, [bp+arg_0]
	mov	cx, 1288
	mov	ax, [bp+skyColor]
	mov	ah, al
	rep stosw
	mov	cx, 498h
	mov	ax, [bp+grndColor]
	mov	ah, al
	rep stosw
	pop	es
	pop	di
	pop	bp
	retf
bigpic_setBG endp

byte_27E86 db 0, 1, 2, 3, 4, 5,	6, 7; 0
db 8, 9, 0Ah, 0, 0Ch, 0Dh, 0Eh,	0Fh; 8
byte_27E96 db 0, 10h, 20h, 30h,	40h, 50h, 60h, 70h; 0
db 80h,	90h, 0A0h, 0, 0C0h, 0D0h, 0E0h,	0F0h; 8
; Attributes: bp-based frame

bigpic_makeNight proc far

	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	push	di
	push	ds
	push	es
	les	di, [bp+arg_0]
	mov	ax, cs
	mov	ds, ax
	assume ds:seg019
	sub	bx, bx
	mov	cx, 0F04h
	mov	dx, 1340h
	cld
loc_27EBC:
	mov	ah, es:[di]
	mov	bl, ah
	and	bl, ch
	mov	al, byte_27E86[bx]
	shr	ah, cl
	mov	bl, ah
	or	al, byte_27E96[bx]
	stosb
	dec	dx
	jnz	short loc_27EBC
	pop	es
	pop	ds
	assume ds:dseg
	pop	di
	pop	bp
	retf
bigpic_makeNight endp


sub_27ED8 proc far
	push	bp
	push	si
	push	di
	push	es
	int	11h		; EQUIPMENT DETERMINATION
			; Return: AX = equipment flag bits
	and	ax, 0C0h
	pop	es
	pop	di
	pop	si
	pop	bp
	cld
	retf
sub_27ED8 endp

; Attributes: bp-based frame

sub_27EE7 proc far

	arg_0= byte ptr	 6

	push	bp
	mov	bp, sp
	push	si
	push	di
	push	es
	mov	dl, [bp+arg_0]
	mov	ah, 0Eh
	int	21h		; DOS -	SELECT DISK
			; DL = new default drive number	(0 = A,	1 = B, etc.)
			; Return: AL = number of logical drives
	pop	es
	pop	di
	pop	si
	pop	bp
	cld
	retf
sub_27EE7 endp


sub_27EFA proc far
	push	bp
	mov	ah, 19h
	int	21h		; DOS -	GET DEFAULT DISK NUMBER
	sub	ah, ah
	pop	bp
	retf
sub_27EFA endp

db    0
db    0
word_27F05 dw 0
dword_27F07 dd 0
word_27F0B dw 0
word_27F0D dw 0
align 2

timerIntHandler proc far
	push	es
	push	ds
	push	ax
	mov	ds, cs:word_27F05
	xor	ax, ax
	call	music_driver
	mov	al, 20h	
	out	20h, al		; Interrupt controller,	8259A.
	mov	ds, cs:word_27F05
	inc	word_4EF49
	mov	ax, word_4EF49
	and	ax, 3
	jnz	short loc_27F40
	inc	_clockTicks
	pop	ax
	pop	ds
	pop	es
	jmp	cs:dword_27F07
loc_27F40:
	pop	ax
	pop	ds
	pop	es
	iret
timerIntHandler endp


errorHandler	proc far
                push    ds
                push    es
                push    bx
                push    cx
                push    dx
                push    si
                push    di
                push    bp
                mov     ds, cs:word_27F05
                push    ax
                call    sub_17729
                add     sp, 2
                pop     bp
                pop     di
                pop     si
                pop     dx
                pop     cx
                pop     bx
                pop     es
                pop     ds
                iret
errorHandler       endp

; Attributes: bp-based frame

sub_27F63 proc far
	push	bp
	mov	bp, sp
	push	es
	sub	ax, ax
	mov	es, ax
	assume es:nothing
	cli
	mov	ax, es:20h
	mov	word ptr cs:dword_27F07, ax
	mov	ax, es:22h
	mov	word ptr cs:dword_27F07+2, ax
	mov	word ptr es:20h, offset	timerIntHandler
	mov	word ptr es:22h, cs
	mov	cs:word_27F05, ds
	mov	al, 36h	
	out	43h, al		; Timer	8253-5 (AT: 8254.2).
	mov	ax, 4DA7h
	out	40h, al		; Timer	8253-5 (AT: 8254.2).
	xchg	al, ah
	out	40h, al		; Timer	8253-5 (AT: 8254.2).
	sti
	mov	di, 90h	
	cli
	mov	ax, es:[di]
	mov	cs:word_27F0B, ax
	mov	ax, es:[di+2]
	mov	cs:word_27F0D, ax
	mov	word ptr es:[di], offset errorHandler
	mov	word ptr es:[di+2], cs
	sti
	sub	ax, ax
	mov	es, ax
	cmp	word ptr es:0CCh, 0
	jz	short loc_27FD6
	int	33h		; - MS MOUSE - RESET DRIVER AND	READ STATUS
			; Return: AX = status
			; BX = number of buttons
	or	ax, ax
	jz	short loc_27FD6
	mov	byte_4EF4B, 1
	mov	byte_4EF5E, 1
	jmp	short loc_28008
loc_27FD6:
	mov	byte_4EF4C, 0
	cmp	byte_4EF4C, 0
	jz	short loc_28008
	cmp	ax, 0FFFFh
	jnz	short loc_27FEF
	mov	byte_4EF4C, 0
	jmp	short loc_28008
db 90h
loc_27FEF:
	mov	byte_4EF5E, 1
	mov	bl, ah
	sub	ah, ah
	inc	ax
	mov	word_4EF59, ax
	sub	bh, bh
	inc	bx
	mov	word_4EF5B, bx
	call	_doNothing
loc_28008:
	pop	es
	assume es:nothing
	pop	bp
	retf
sub_27F63 endp


sub_2800B proc far
	push	es
	sub	ax, ax
	mov	es, ax
	assume es:nothing
	cli
	mov	ax, word ptr cs:dword_27F07
	mov	es:20h,	ax
	mov	ax, word ptr cs:dword_27F07+2
	mov	es:22h,	ax
	mov	al, 36h	
	out	43h, al		; Timer	8253-5 (AT: 8254.2).
	mov	ax, 0
	out	40h, al		; Timer	8253-5 (AT: 8254.2).
	xchg	al, ah
	out	40h, al		; Timer	8253-5 (AT: 8254.2).
	mov	di, 90h	
	mov	ax, cs:word_27F0B
	mov	es:[di], ax
	mov	ax, cs:word_27F0D
	mov	es:[di+2], ax
	sti
	pop	es
	assume es:nothing
	retf
sub_2800B endp

checkMouse proc	far
	push	bp
	push	si
	push	di
	push	ds
	push	es
	cmp	byte_4EF4B, 0
	jz	short loc_280C0
	mov	byte_4EF50, 0
	mov	ax, 5
	sub	bx, bx
	int	33h		; - MS MOUSE - RETURN BUTTON PRESS DATA
			; BX = button
			; Return: AX = button states
			; BX = number of times specified button	has been pressed
			; CX = column at time specified	button was last	pressed
			; DX = row at time specified button was	last pressed
	test	al, 3
	jz	short loc_28077
	mov	byte_4EF50, 1
	cmp	byte_4EF4D, 0
	jnz	short loc_2807C
	mov	byte_4EF52, 1
	mov	byte_4EF4D, 1
	jmp	short loc_2807C
loc_28077:
	mov	byte_4EF4D, 0
loc_2807C:
	mov	ax, 0Bh
	int	33h		; - MS MOUSE - READ MOTION COUNTERS
			; Return: CX = number of mickeys mouse moved horizontally since	last call
			; DX = number of mickeys mouse moved vertically
	or	cx, cx
	jnz	short loc_2808C
	or	dx, dx
	jnz	short loc_2808C
	jmp	loc_2810F
loc_2808C:
	add	cx, mouse_x
	test	ch, 80h
	jz	short loc_28098
	mov	cx, 1
loc_28098:
	cmp	cx, 130h
	jbe	short loc_280A1
	mov	cx, 130h
loc_280A1:
	mov	mouse_x, cx
	add	dx, mouse_y
	test	dh, 80h
	jz	short loc_280B1
	mov	dx, 1
loc_280B1:
	cmp	dx, 0C2h 
	jbe	short loc_280BA
	mov	dx, 0C2h 
loc_280BA:
	mov	mouse_y, dx
	jmp	short loc_2810A
loc_280C0:
	cmp	byte_4EF5E, 0
	jz	short loc_2810F
	cmp	byte_4EF4C, 0
	jz	short loc_2810F
	sti
	call	sub_28115
	or	ax, ax
	jz	short loc_2810F
	mov	ax, mouse_x
	cmp	ax, 130h
	jbe	short loc_280E6
	mov	ax, 130h
	jmp	short loc_280EE
align 2
loc_280E6:
	cmp	ax, 1
	jnb	short loc_280EE
	mov	ax, 1
loc_280EE:
	mov	mouse_x, ax
	mov	ax, mouse_y
	cmp	ax, 0C2h 
	jbe	short loc_280FF
	mov	ax, 0C2h 
	jmp	short loc_28107
db 90h
loc_280FF:
	cmp	ax, 1
	jnb	short loc_28107
	mov	ax, 1
loc_28107:
	mov	mouse_y, ax
loc_2810A:
	mov	mouse_moved, 1
loc_2810F:
	pop	es
	pop	ds
	pop	di
	pop	si
	pop	bp
	retf
checkMouse endp


sub_28115 proc far
	mov	byte_4EF5D, 0
	cmp	byte_4EF4C, 0
	jz	short loc_28183
	cmp	byte_4EF4B, 0
	jnz	short loc_28183
	call	sub_2821E
	mov	bl, ah
	sub	ah, ah
	sub	bh, bh
	mov	cx, word_4EF59
	sub	cx, ax
	mov	ax, cx
	sar	ax, 1
	sar	ax, 1
	or	ax, ax
	jz	short loc_2815A
	add	mouse_x, ax
	mov	byte_4EF5D, 1
	test	mouse_x, 8000h
	jz	short loc_2815A
	mov	mouse_x, 0
loc_2815A:
	mov	ax, bx
	mov	cx, word_4EF5B
	sub	cx, ax
	mov	ax, cx
	sar	ax, 1
	sar	ax, 1
	or	ax, ax
	jz	short loc_28183
	add	mouse_y, ax
	mov	byte_4EF5D, 1
	test	mouse_y, 8000h
	jz	short loc_28183
	mov	mouse_y, 0
loc_28183:
	mov	al, byte_4EF5D
	sub	ah, ah
	retf
sub_28115 endp

	cmp	byte_4EF5E, 0
	jz	short locret_281A1
	cmp	byte_4EF79, 0
	jnz	short locret_281A1
	call	_doNothing_0
	call	_doNothing
locret_281A1:
	retf

checkGamePort proc far
	xor	ax, ax
	cmp	byte_4EF52, al
	jz	short loc_281B1
	mov	byte_4EF52, al
	inc	ax
	jmp	short locret_281DE
db 90h
loc_281B1:
	cmp	byte_4EF4C, al
	jz	short loc_281CF
	mov	dx, 201h
	in	al, dx		; Game I/O port
			; bits 0-3: Coordinates	(resistive, time-dependent inputs)
			; bits 4-7: Buttons/Triggers (digital inputs)
	cmp	byte_4EF50, 0
	jz	short loc_281D2
	test	al, 10h
	mov	ax, 0
	jz	short locret_281DE
	mov	byte_4EF50, al
	jmp	short locret_281DE
db 90h
loc_281CF:
	jmp	short locret_281DE
align 2
loc_281D2:
	test	al, 10h
	mov	ax, 0
	jnz	short locret_281DE
	inc	al
	mov	byte_4EF50, al
locret_281DE:
	retf
checkGamePort endp

checkOtherGamePort proc	far
	xor	ax, ax
	cmp	byte_4EF53, 0
	jz	short loc_281EF
	mov	byte_4EF53, al
	inc	ax
	jmp	short locret_2821D
db 90h
loc_281EF:
	cmp	byte_4EF4C, 0
	jz	short loc_2820E
	mov	dx, 201h
	in	al, dx		; Game I/O port
			; bits 0-3: Coordinates	(resistive, time-dependent inputs)
			; bits 4-7: Buttons/Triggers (digital inputs)
	cmp	byte_4EF51, 0
	jz	short loc_28211
	test	al, 20h
	mov	ax, 0
	jz	short locret_2821D
	mov	byte_4EF51, al
	jmp	short locret_2821D
align 2
loc_2820E:
	jmp	short locret_2821D
db 90h
loc_28211:
	test	al, 20h
	mov	ax, 0
	jnz	short locret_2821D
	inc	al
	mov	byte_4EF51, al
locret_2821D:
	retf
checkOtherGamePort endp


sub_2821E proc far
	cli
	sub	cx, cx
	cmp	byte_4EF4C, 0
	jz	short loc_2824E
	dec	cx
	xor	bx, bx
	mov	dx, 201h
	out	dx, al		; Game I/O port
			; bits 0-3: Coordinates	(resistive, time-dependent inputs)
			; bits 4-7: Buttons/Triggers (digital inputs)
	sub	ax, ax
loc_28231:		; Game I/O port
	in	al, dx		; bits 0-3: Coordinates	(resistive, time-dependent inputs)
			; bits 4-7: Buttons/Triggers (digital inputs)
	mov	bl, al
	and	bl, 1
	sub	cl, bl
	mov	bl, al
	shr	bl, 1
	and	bl, 1
	sub	ch, bl
	test	al, 3
	jz	short loc_2824E
	inc	ah
	jnz	short loc_28231
	mov	byte_4EF4C, ah
loc_2824E:
	mov	ax, cx
	sti
	retf
sub_2821E endp

	cmp	byte_4EF7A, 1
	jz	short locret_28272
	cmp	byte_4EF79, 0
	jnz	short locret_28272
	call	_doNothing_2
	call	_doNothing_1
	call	_doNothing
	jmp	short locret_28272
align 2
locret_28272:
	retf
	push	bp
	mov	bp, sp
	sub	dx, dx
	cmp	word_4EF6F, 3F8h
	jz	short loc_28282
	mov	dl, 1
loc_28282:
	mov	al, [bp+4]
	sub	ah, ah
	int	14h		; SERIAL I/O - INITIALIZE USART
			; AL = initializing parameters,	DX = port number (0-3)
			; Return: AH = RS-232 status code bits,	AL = modem status bits
	mov	dx, word_4EF6F
	mov	dl, 0F8h 
	in	al, dx		; COM: receiver	buffer register.
			; 8 bits of character received.
	pop	bp
	retn
	assume ss:seg029, ds:nothing
public start

start proc far
	mov	ah, 30h
	int	21h		; DOS -	GET DOS	VERSION
			; Return: AL = major version number (00h for DOS 1.x)
	cmp	al, 2
	jnb	short loc_2829C
	int	20h		; DOS -	PROGRAM	TERMINATION
			; returns to DOS--identical to INT 21/AH=00h
loc_2829C:
	mov	di, seg	dseg
	mov	si, ds:2
	sub	si, di
	cmp	si, 1000h
	jb	short loc_282AE
	mov	si, 1000h
loc_282AE:
	cli
	mov	ss, di
	assume ss:dseg
	add	sp, offset dseg_end
	sti
	jnb	short loc_282CC
	push	ss
	pop	ds
	assume ds:dseg
	call	sub_284C2
	xor	ax, ax
	push	ax
	call	sub_28785
	mov	ax, 4CFFh
	int	21h		; DOS -	2+ - QUIT WITH EXIT CODE (EXIT)
			; AL = exit code
loc_282CC:
	assume ds:nothing
	and	sp, 0FFFEh
	mov	ss:word_4EF82, sp
	mov	ss:word_4EF7E, sp
	mov	ax, si
	mov	cl, 4
	shl	ax, cl
	dec	ax
	mov	ss:word_4EF7C, ax
	add	si, di
	mov	ds:2, si
	mov	bx, es
	sub	bx, si
	neg	bx
	mov	ah, 4Ah
	int	21h		; DOS -	2+ - ADJUST MEMORY BLOCK SIZE (SETBLOCK)
			; ES = segment address of block	to change
			; BX = new size	in paragraphs
	mov	ss:word_4EFF3, ds
	push	ss
	pop	es
	assume es:dseg
	cld
	mov	di, offset word_4FD56
	mov	cx, offset dseg_end+2
	sub	cx, di
	xor	ax, ax
	rep stosb
	push	ss
	pop	ds
	call 	far ptr loc_28360
	push	ss
	pop	ds
	call	far ptr sub_286DE
	call	far ptr	sub_28536
	xor	bp, bp
	push	ds:word_4F018
	push	ds:word_4F016
	push	ds:word_4F014
	push	ds:word_4F012
	push	ds:word_4F010
	call	_main
	push	ax
	call	far ptr	sub_28424

loc_2833C:
	mov	ax, seg	dseg
	mov	ds, ax
	mov	ax, 3
	mov	ss:off_4EF80, offset sub_28424
loc_2834B::
	push	ax
	call	sub_284C2
	call	sub_28785
	mov	ax, 0FFh
	push	ax
	push	cs
	call	off_4EF80

	db 0

loc_28360:
	mov	ah, 30h
	int	21h
	mov	ds:word_4EFF5, ax
	mov	ax, 3500h
	int	21h		; DOS -	2+ - GET INTERRUPT VECTOR
			; AL = interrupt number
			; Return: ES:BX	= value	of interrupt vector
	mov	word ptr ds:dword_4EFE1, bx
	mov	word ptr ds:dword_4EFE1+2,	es
	push	cs
	pop	ds
	assume ds:seg019
	mov	ax, 2500h
	mov	dx, offset loc_2833C
	int	21h		; DOS -	SET INTERRUPT VECTOR
			; AL = interrupt number
			; DS:DX	= new vector to	be used	for specified interrupt
	push	ss
	pop	ds
	assume ds:dseg
	mov	cx, word_4F906
	jcxz	short loc_283B4
	mov	es, word_4EFF3
	assume es:nothing
	mov	si, es:2Ch
	lds	ax, dword_4F908
	mov	dx, ds
	xor	bx, bx
	call	dword ptr ss:unk_4F904
	jnb	short loc_283A3
	push	ss
	pop	ds
	jmp	sub_284E6
loc_283A3:
	lds	ax, ss:dword_4F90C
	mov	dx, ds
	mov	bx, 3
	call	dword ptr ss:unk_4F904
	push	ss
	pop	ds
loc_283B4:
	mov	es, word_4EFF3
	mov	cx, es:2Ch
	jcxz	short loc_283F5
	mov	es, cx
	xor	di, di
loc_283C3:
	cmp	byte ptr es:[di], 0
	jz	short loc_283F5
	mov	cx, 0Ch
	mov	si, offset aC_file_info
	repe cmpsb
	jz	short loc_283DE
	mov	cx, 7FFFh
	xor	ax, ax
	repne scasb
	jnz	short loc_283F5
	jmp	short loc_283C3
loc_283DE:
	push	es
	push	ds
	pop	es
	assume es:dseg
	pop	ds
	mov	si, di
	mov	di, offset byte_4EFFC
	lodsb
	cbw
	xchg	ax, cx
loc_283EA:
	lodsb
	inc	al
	jz	short loc_283F0
	dec	ax
loc_283F0:
	stosb
	loop	loc_283EA
	push	ss
	pop	ds
loc_283F5:
	mov	bx, 4
loc_283F8:
	and	byte_4EFFC[bx],	0BFh
	mov	ax, 4400h
	int	21h		; DOS -	2+ - IOCTL - GET DEVICE	INFORMATION
			; BX = file or device handle
	jb	short loc_2840E
	test	dl, 80h
	jz	short loc_2840E
	or	byte_4EFFC[bx],	40h
loc_2840E:
	dec	bx
	jns	short loc_283F8
	mov	si, offset off_4F910
	mov	di, offset off_4F910
	call	sub_284AF
	mov	si, offset off_4F910
	mov	di, offset off_4F910
	call	sub_284AF
	retf
start endp

; Attributes: bp-based frame
sub_28424 proc near
	push	bp
	mov	bp, sp
	mov	si, offset byte_5006A
	mov	di, offset byte_5006A
	call	sub_284AF
	mov	si, offset off_4F910
	mov	di, offset seg027_41
	call	sub_284AF
	jmp	short loc_2843E
sub_28424 endp

; Attributes: bp-based frame
sub_2843B proc near
arg_2= word ptr	 6
	push	bp
	mov	bp, sp
loc_2843E::
	mov	si, offset seg027_41
	mov	di, offset seg027_41
	call	sub_284AF
	mov	si, offset seg027_41
	mov	di, offset seg027_41
	call	sub_284AF
	call	sub_28510
	or	ax, ax
	jz	short loc_28464
	cmp	[bp+arg_2], 0
	jnz	short loc_28464
	mov	[bp+arg_2], 0FFh
loc_28464:
	mov	cx, 0Fh
	mov	bx, 5
loc_2846A:
	test	byte_4EFFC[bx],	1
	jz	short loc_28475
	mov	ah, 3Eh
	int	21h		; DOS -	2+ - CLOSE A FILE WITH HANDLE
			; BX = file handle
loc_28475:
	inc	bx
	loop	loc_2846A
	call	sub_28482
	mov	ax, [bp+arg_2]
	mov	ah, 4Ch
	int	21h		; DOS -	2+ - QUIT WITH EXIT CODE (EXIT)
sub_2843B endp		; AL = exit code
sub_28482 proc near
	mov	cx, word_4F906
	jcxz	short loc_2848F
	mov	bx, 2
	call	dword ptr unk_4F904
loc_2848F:
	push	ds
	lds	dx, dword_4EFE1
	mov	ax, 2500h
	int	21h		; DOS -	SET INTERRUPT VECTOR
			; AL = interrupt number
			; DS:DX	= new vector to	be used	for specified interrupt
	pop	ds
	cmp	byte_4F022, 0
	jz	short locret_284AE
	push	ds
	mov	al, byte_4F023
	lds	dx, dword_4F024
	mov	ah, 25h
	int	21h		; DOS -	SET INTERRUPT VECTOR
			; AL = interrupt number
			; DS:DX	= new vector to	be used	for specified interrupt
	pop	ds
locret_284AE:
	retn
sub_28482 endp

sub_284AF proc near
	cmp	si, di
	jnb	short locret_284C1
	sub	di, 4
	mov	ax, [di]
	or	ax, [di+2]
	jz	short sub_284AF
	call	dword ptr [di]
	jmp	short sub_284AF
locret_284C1:
	retn
sub_284AF endp

; Attributes: bp-based frame

sub_284C2 proc far
	push	bp
	mov	bp, sp
	mov	ax, 0FCh 
	push	ax
	call	sub_28785
	cmp	word_4F02A, 0
	jz	short loc_284D9
	call	dword ptr unk_4F028
loc_284D9:
	mov	ax, 0FFh
	push	ax
	call	sub_28785
	mov	sp, bp
	pop	bp
	retf
sub_284C2 endp

sub_284E6 proc near
	mov	ax, 2
	jmp	loc_2834B
sub_284E6 endp

someStackOperation proc	far
	pop	cx
	pop	dx
	mov	bx, sp
	sub	bx, ax
	jb	short loc_284FF
	cmp	bx, word_4F030
	jb	short loc_284FF
	mov	sp, bx
	push	dx
	push	cx
	retf
loc_284FF:
	mov	ax, word ptr dword_4F02C
	inc	ax
	jnz	short loc_2850A
	xor	ax, ax
	jmp	loc_2834B
loc_2850A:
	push	dx
	push	cx
	jmp	dword_4F02C
someStackOperation endp


sub_28510 proc far
	push	si
	mov	si, offset word_42670
	mov	cx, 42h	
	xor	ah, ah
	cld
loc_28519:
	lodsb
	xor	ah, al
	loop	loc_28519
	xor	ah, 55h
	jz	short loc_28534
	call	sub_284C2
	mov	ax, 1
	push	ax
	call	sub_28785
	mov	ax, 1
loc_28534:
	pop	si
	retf
sub_28510 endp

sub_28536 proc near
	pop	word ptr dword_4F032
	pop	word ptr dword_4F032+2
	mov	dx, 2
	cmp	byte ptr word_4EFF5, dl
	jz	short loc_28570
	mov	es, word_4EFF3
	assume es:nothing
	mov	es, word ptr es:2Ch
	mov	word ptr off_4F01A+2, es
	xor	ax, ax
	cwd
	mov	cx, 8000h
	xor	di, di
loc_2855C:
	repne scasb
	scasb
	jnz	short loc_2855C
	inc	di
	inc	di
	mov	word ptr off_4F01A, di
	mov	cx, 0FFFFh
	repne scasb
	not	cx
	mov	dx, cx
loc_28570:
	mov	di, 1
	mov	si, 81h	
	mov	ds, word_4EFF3
loc_2857A:
	lodsb
	cmp	al, 20h	
	jz	short loc_2857A
	cmp	al, 9
	jz	short loc_2857A
	cmp	al, 0Dh
	jz	short loc_285F6
	or	al, al
	jz	short loc_285F6
	inc	di
loc_2858C:
	dec	si
loc_2858D:
	lodsb
	cmp	al, 20h	
	jz	short loc_2857A
	cmp	al, 9
	jz	short loc_2857A
	cmp	al, 0Dh
	jz	short loc_285F6
	or	al, al
	jz	short loc_285F6
	cmp	al, 22h	
	jz	short loc_285C6
	cmp	al, 5Ch	
	jz	short loc_285A9
	inc	dx
	jmp	short loc_2858D
loc_285A9:
	xor	cx, cx
loc_285AB:
	inc	cx
	lodsb
	cmp	al, 5Ch	
	jz	short loc_285AB
	cmp	al, 22h	
	jz	short loc_285B9
	add	dx, cx
	jmp	short loc_2858C
loc_285B9:
	mov	ax, cx
	shr	cx, 1
	adc	dx, cx
	test	al, 1
	jnz	short loc_2858D
	jmp	short loc_285C6
loc_285C5:
	dec	si
loc_285C6:
	lodsb
	cmp	al, 0Dh
	jz	short loc_285F6
	or	al, al
	jz	short loc_285F6
	cmp	al, 22h	
	jz	short loc_2858D
	cmp	al, 5Ch	
	jz	short loc_285DA
	inc	dx
	jmp	short loc_285C6
loc_285DA:
	xor	cx, cx
loc_285DC:
	inc	cx
	lodsb
	cmp	al, 5Ch	
	jz	short loc_285DC
	cmp	al, 22h	
	jz	short loc_285EA
	add	dx, cx
	jmp	short loc_285C5
loc_285EA:
	mov	ax, cx
	shr	cx, 1
	adc	dx, cx
	test	al, 1
	jnz	short loc_285C6
	jmp	short loc_2858D
loc_285F6:
	push	ss
	pop	ds
	mov	word_4F010, di
	add	dx, di
	inc	di
	shl	di, 1
	shl	di, 1
	add	dx, di
	and	dl, 0FEh
	sub	sp, dx
	mov	ax, sp
	mov	word_4F012, ax
	mov	word_4F014, ds
	mov	bx, ax
	add	di, bx
	push	ss
	pop	es
	assume es:dseg
	mov	ss:[bx], di
	mov	word ptr ss:[bx+2], ss
	add	bx, 4
	lds	si, off_4F01A
loc_28627:
	lodsb
	stosb
	or	al, al
	jnz	short loc_28627
	mov	si, 81h	
	mov	ds, ss:word_4EFF3
	jmp	short loc_2863A
loc_28637:
	xor	ax, ax
	stosb
loc_2863A:
	lodsb
	cmp	al, 20h	
	jz	short loc_2863A
	cmp	al, 9
	jz	short loc_2863A
	cmp	al, 0Dh
	jnz	short loc_2864A
	jmp	loc_286CE
loc_2864A:
	or	al, al
	jnz	short loc_28651
	jmp	short loc_286CE
db 90h
loc_28651:
	mov	ss:[bx], di
	mov	word ptr ss:[bx+2], ss
	add	bx, 4
loc_2865B:
	dec	si
loc_2865C:
	lodsb
	cmp	al, 20h	
	jz	short loc_28637
	cmp	al, 9
	jz	short loc_28637
	cmp	al, 0Dh
	jz	short loc_286CB
	or	al, al
	jz	short loc_286CB
	cmp	al, 22h	
	jz	short loc_28698
	cmp	al, 5Ch	
	jz	short loc_28678
	stosb
	jmp	short loc_2865C
loc_28678:
	xor	cx, cx
loc_2867A:
	inc	cx
	lodsb
	cmp	al, 5Ch	
	jz	short loc_2867A
	cmp	al, 22h	
	jz	short loc_2868A
	mov	al, 5Ch	
	rep stosb
	jmp	short loc_2865B
loc_2868A:
	mov	al, 5Ch	
	shr	cx, 1
	rep stosb
	jnb	short loc_28698
	mov	al, 22h	
	stosb
	jmp	short loc_2865C
loc_28697:
	dec	si
loc_28698:
	lodsb
	cmp	al, 0Dh
	jz	short loc_286CB
	or	al, al
	jz	short loc_286CB
	cmp	al, 22h	
	jz	short loc_2865C
	cmp	al, 5Ch	
	jz	short loc_286AC
	stosb
	jmp	short loc_28698
loc_286AC:
	xor	cx, cx
loc_286AE:
	inc	cx
	lodsb
	cmp	al, 5Ch	
	jz	short loc_286AE
	cmp	al, 22h	
	jz	short loc_286BE
	mov	al, 5Ch	
	rep stosb
	jmp	short loc_28697
loc_286BE:
	mov	al, 5Ch	
	shr	cx, 1
	rep stosb
	jnb	short loc_2865C
	mov	al, 22h	
	stosb
	jmp	short loc_28698
loc_286CB:
	xor	ax, ax
	stosb
loc_286CE:
	push	ss
	pop	ds
	mov	word ptr [bx], 0
	mov	word ptr [bx+2], 0
	jmp	dword_4F032
sub_28536 endp

align 2
; Attributes: bp-based frame

sub_286DE proc far
	push	bp
	mov	bp, sp
	push	bp
	mov	ds, word_4EFF3
	assume ds:nothing
	xor	cx, cx
	mov	ax, cx
	mov	bp, cx
	mov	di, cx
	dec	cx
	mov	si, ds:2Ch
	or	si, si
	jz	short loc_28707
	mov	es, si
	assume es:nothing
	cmp	byte ptr es:0, 0
	jz	short loc_28707
loc_28701:
	repne scasb
	inc	bp
	scasb
	jnz	short loc_28701
loc_28707:
	inc	bp
	xchg	ax, di
	inc	ax
	and	al, 0FEh
	mov	di, bp
	shl	bp, 1
	shl	bp, 1
	add	ax, bp
	push	ss
	pop	ds
	push	di
	mov	di, 9
	call	sub_287B0
	pop	di
	mov	cx, di
	mov	di, bp
	add	di, ax
	mov	ds:word_4F016, bp
	mov	ds:word_4F018, ds
	push	ds
	pop	es
	assume es:dseg
	mov	ds, si
	xor	si, si
	dec	cx
	jcxz	short loc_2874C
loc_28735:
	cmp	word ptr [si], 433Bh
	jz	short loc_28744
	mov	[bp+0],	di
	mov	word ptr [bp+2], es
	add	bp, 4
loc_28744:
	lodsb
	stosb
	or	al, al
	jnz	short loc_28744
	loop	loc_28735
loc_2874C:
	mov	[bp+0],	cx
	mov	[bp+2],	cx
	push	ss
	pop	ds
	pop	bp
	mov	sp, bp
	pop	bp
	retf
sub_286DE endp

align 2
; Attributes: bp-based frame

sub_2875A proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	push	si
	push	di
	push	ds
	pop	es
	mov	dx, [bp+arg_0]
	mov	si, (offset aNmsg+8)
loc_28767:
	lodsw
	cmp	ax, dx
	jz	short loc_2877C
	inc	ax
	xchg	ax, si
	jz	short loc_2877C
	xchg	ax, di
	xor	ax, ax
	mov	cx, 0FFFFh
	repne scasb
	mov	si, di
	jmp	short loc_28767
loc_2877C:
	xchg	ax, si
	pop	di
	pop	si
	mov	sp, bp
	pop	bp
	retf	2
sub_2875A endp

; Attributes: bp-based frame

sub_28785 proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	push	di
	push	[bp+arg_0]
	call	sub_2875A
	or	ax, ax
	jz	short loc_287A9
	xchg	ax, dx
	mov	di, dx
	xor	ax, ax
	mov	cx, 0FFFFh
	repne scasb
	not	cx
	dec	cx
	mov	bx, 2
	mov	ah, 40h
	int	21h		; DOS -	2+ - WRITE TO FILE WITH	HANDLE
			; BX = file handle, CX = number	of bytes to write, DS:DX -> buffer
loc_287A9:
	pop	di
	mov	sp, bp
	pop	bp
	retf	2
sub_28785 endp

sub_287B0 proc near
	mov	dx, ax
	add	ax, ds:word_4EF82
	jb	short loc_287ED
	cmp	ds:word_4EF7C, ax
	jnb	short loc_287E3
	add	ax, 0Fh
	push	ax
	rcr	ax, 1
	mov	cl, 3
	shr	ax, cl
	mov	cx, ds
	mov	bx, ds:word_4EFF3
	sub	cx, bx
	add	ax, cx
	mov	es, bx
	assume es:nothing
	mov	bx, ax
	mov	ah, 4Ah
	int	21h		; DOS -	2+ - ADJUST MEMORY BLOCK SIZE (SETBLOCK)
			; ES = segment address of block	to change
			; BX = new size	in paragraphs
	pop	ax
	jb	short loc_287ED
	and	al, 0F0h
	dec	ax
	mov	ds:word_4EF7C, ax
loc_287E3:
	xchg	ax, bp
	mov	bp, ds:word_4EF82
	add	ds:word_4EF82, dx
	retn
loc_287ED:
	mov	ax, di
	jmp	loc_2834B
sub_287B0 endp

	jb	short loc_28807
loc_287F4:
	xor	ax, ax
	mov	sp, bp
	pop	bp
	retf
	jnb	short loc_287F4
	push	ax
	call	sub_28818
	pop	ax
	mov	sp, bp
	pop	bp
	retf
; START	OF FUNCTION CHUNK FOR sub_2A2F6
loc_28805:
	jnb	short loc_2880E
loc_28807:
	call	sub_28818
	mov	ax, 0FFFFh
	cwd
loc_2880E:
	mov	sp, bp
	pop	bp
	retf
; END OF FUNCTION CHUNK	FOR sub_2A2F6
	xor	ah, ah
	call	sub_28818
	retf

sub_28818 proc near
	mov	ds:byte_4EFF8, al
	or	ah, ah
	jnz	short loc_28842
	cmp	ds:word_4EFF5, 3
	jb	short loc_28833
	cmp	al, 22h	
	jnb	short loc_28837
	cmp	al, 20h	
	jb	short loc_28833
	mov	al, 5
	jmp	short loc_28839
db 90h
loc_28833:
	cmp	al, 13h
	jbe	short loc_28839
loc_28837:
	mov	al, 13h
loc_28839:
	mov	bx, offset byte_4F036
	xlat
loc_2883D:
	cbw
	mov	ds:word_4EFED, ax
	retn
loc_28842:
	mov	al, ah
	jmp	short loc_2883D
sub_28818 endp

sub_28846	proc far

	var_6 = dword ptr -6

	push	bp
	mov	bp, sp
	sub	sp, 6
	push	si
	mov	ax, offset off_4F64C
	mov	[bp-6],	ax
	mov	word ptr [bp-4], ds
	sub	si, si
	jmp	short loc_28876
loc_2885A:
	les	bx, [bp-6]
	test	byte ptr es:[bx+0Ah], 83h
	jz	short loc_28872
	push	es
	push	bx
	call	sub_28DC2
	add	sp, 4
	inc	ax
	jz	short loc_28872
	inc	si
loc_28872:
	add	word ptr [bp-6], 0Ch
loc_28876:
	mov	ax, ds:word_4F7B4
	mov	dx, ds:seg_4F7B6
	cmp	[bp-6],	ax
	jbe	short loc_2885A
	mov	ax, si
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_28846	endp

align 2
; Attributes: bp-based frame

printf proc far

	var_C= word ptr	-0Ch
	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	sub	sp, 0Ch
	push	si
	mov	ax, offset byte_4F658
	mov	[bp+var_A], ax
	mov	[bp+var_8], ds
	lea	ax, [bp+arg_4]
	mov	[bp+var_6], ax
	mov	[bp+var_4], ss
	push	ds
	push	[bp+var_A]
	call	sub_28C28
	add	sp, 4
	mov	si, ax
	push	[bp+var_4]
	push	[bp+var_6]
	push	[bp+arg_2]
	push	[bp+arg_0]
	push	[bp+var_8]
	push	[bp+var_A]
	call	printf_doPrint
	add	sp, 0Ch
	mov	[bp+var_C], ax
	push	[bp+var_8]
	push	[bp+var_A]
	push	si
	call	sub_28CE2
	add	sp, 6
	mov	ax, [bp+var_C]
	pop	si
	mov	sp, bp
	pop	bp
	retf
printf endp

align 2
; Attributes: bp-based frame

sub_288E6 proc far

	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	sub	sp, 2
	push	si
	mov	ax, [bp+arg_0]
	sub	ax, offset off_4F64C
	cwd
	mov	cx, 0Ch
	idiv	cx
	mov	cx, ax
	shl	ax, 1
	add	ax, cx
	shl	ax, 1
	add	ax, offset off_4F64C
	mov	[bp+var_2], ax
	les	bx, dword ptr [bp+arg_0]
	test	byte ptr es:[bx+0Ah], 83h
	jz	short loc_28918
	test	byte ptr es:[bx+0Ah], 40h
	jz	short loc_2891E
loc_28918:
	mov	ax, 0FFFFh
	jmp	loc_289DB
loc_2891E:
	les	bx, dword ptr [bp+arg_0]
	test	byte ptr es:[bx+0Ah], 2
	jz	short loc_28930
	or	byte ptr es:[bx+0Ah], 20h
	jmp	short loc_28918
align 2
loc_28930:
	or	byte ptr es:[bx+0Ah], 1
	mov	bx, [bp+var_2]
	and	byte ptr [bx], 0FBh
	mov	bx, [bp+arg_0]
	test	byte ptr es:[bx+0Ah], 0Ch
	jnz	short loc_2896C
	mov	ax, bx
	sub	ax, offset off_4F64C
	cwd
	mov	cx, 0Ch
	idiv	cx
	mov	bx, ax
	shl	bx, 1
	add	bx, ax
	shl	bx, 1
	test	ds:byte_4F73C[bx], 1
	jnz	short loc_2896C
	push	es
	push	[bp+arg_0]
	call	sub_28B9E
	add	sp, 4
	jmp	short loc_2897E
align 2
loc_2896C:
	les	bx, dword ptr [bp+arg_0]
	mov	ax, es:[bx+6]
	mov	dx, es:[bx+8]
	mov	es:[bx], ax
	mov	es:[bx+2], dx
loc_2897E:
	mov	bx, [bp+var_2]
	push	word ptr [bx+2]
	les	bx, dword ptr [bp+arg_0]
	push	word ptr es:[bx+8]
	push	word ptr es:[bx+6]
	mov	al, es:[bx+0Bh]
	cbw
	push	ax
	call	sub_2A370
	add	sp, 8
	les	bx, dword ptr [bp+arg_0]
	mov	es:[bx+4], ax
	or	ax, ax
	jz	short loc_289AD
	cmp	ax, 0FFFFh
	jnz	short loc_289C8
loc_289AD:
	cmp	word ptr es:[bx+4], 0
	jz	short loc_289B8
	mov	al, 20h	
	jmp	short loc_289BA
loc_289B8:
	mov	al, 10h
loc_289BA:
	or	es:[bx+0Ah], al
	mov	word ptr es:[bx+4], 0
	jmp	loc_28918
align 2
loc_289C8:
	dec	word ptr es:[bx+4]
	mov	si, es:[bx]
	inc	word ptr es:[bx]
	mov	es, word ptr es:[bx+2]
	mov	al, es:[si]
	sub	ah, ah
loc_289DB:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_288E6 endp

; Attributes: bp-based frame

sub_289E0 proc far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	arg_0= word ptr	 6
	arg_2= dword ptr  8

	push	bp
	mov	bp, sp
	sub	sp, 8
	push	di
	push	si
	les	bx, [bp+arg_2]
	mov	al, es:[bx+0Bh]
	cbw
	mov	[bp+var_6], ax
	mov	ax, bx
	sub	ax, offset off_4F64C
	cwd
	mov	cx, 0Ch
	idiv	cx
	mov	cx, ax
	shl	ax, 1
	add	ax, cx
	shl	ax, 1
	add	ax, offset off_4F64C
	mov	[bp+var_8], ax
	test	byte ptr es:[bx+0Ah], 83h
	jz	short loc_28A1A
	test	byte ptr es:[bx+0Ah], 40h
	jz	short loc_28A28
loc_28A1A:
	les	bx, [bp+arg_2]
	or	byte ptr es:[bx+0Ah], 20h
	mov	ax, 0FFFFh
	jmp	loc_28B98
loc_28A28:
	test	byte ptr es:[bx+0Ah], 1
	jnz	short loc_28A1A
	or	byte ptr es:[bx+0Ah], 2
	and	byte ptr es:[bx+0Ah], 0EFh
	sub	ax, ax
	mov	es:[bx+4], ax
	mov	si, ax
	mov	[bp+var_4], si
	test	byte ptr es:[bx+0Ah], 0Ch
	jz	short loc_28A4E
	jmp	loc_28AE4
loc_28A4E:
	mov	ax, bx
	sub	ax, offset off_4F64C
	cwd
	mov	cx, 0Ch
	idiv	cx
	mov	bx, ax
	shl	bx, 1
	add	bx, ax
	shl	bx, 1
	test	ds:byte_4F73C[bx], 1
	jnz	short loc_28AE4
	cmp	word ptr [bp+arg_2], offset byte_4F658
	jnz	short loc_28A76
	cmp	word ptr [bp+arg_2+2], seg dseg
	jz	short loc_28A84
loc_28A76:
	cmp	word ptr [bp+arg_2], offset byte_4F664
	jnz	short loc_28AD8
	cmp	word ptr [bp+arg_2+2], seg dseg
	jnz	short loc_28AD8
loc_28A84:
	push	[bp+var_6]
	call	sub_2A9AC
	add	sp, 2
	or	ax, ax
	jnz	short loc_28AE4
	inc	word_4F04A
	cmp	word ptr [bp+arg_2], offset byte_4F658
	jnz	short loc_28AB2
	cmp	word ptr [bp+arg_2+2], seg dseg
	jnz	short loc_28AB2
	les	bx, [bp+arg_2]
	mov	ax, offset byte_4F24C
	mov	dx, seg	dseg
	jmp	short loc_28ABB
db 2 dup(90h)
loc_28AB2:
	les	bx, [bp+arg_2]
	mov	ax, offset byte_4F44C
	mov	dx, seg	dseg
loc_28ABB:
	mov	es:[bx+6], ax
	mov	es:[bx+8], dx
	mov	es:[bx], ax
	mov	es:[bx+2], dx
	mov	bx, [bp+var_8]
	mov	word ptr [bx+2], 200h
	mov	byte ptr [bx], 1
	jmp	short loc_28AE4
align 2
loc_28AD8:
	push	word ptr [bp+arg_2+2]
	push	word ptr [bp+arg_2]
	call	sub_28B9E
	add	sp, 4
loc_28AE4:
	les	bx, [bp+arg_2]
	test	byte ptr es:[bx+0Ah], 8
	jnz	short loc_28B08
	mov	ax, bx
	sub	ax, offset off_4F64C
	cwd
	mov	cx, 0Ch
	idiv	cx
	mov	bx, ax
	shl	bx, 1
	add	bx, ax
	shl	bx, 1
	test	ds:byte_4F73C[bx], 1
	jz	short loc_28B72
loc_28B08:
	mov	bx, word ptr [bp+arg_2]
	mov	si, es:[bx]
	sub	si, es:[bx+6]
	mov	ax, es:[bx+6]
	mov	dx, es:[bx+8]
	inc	ax
	mov	es:[bx], ax
	mov	es:[bx+2], dx
	mov	di, [bp+var_8]
	mov	ax, [di+2]
	dec	ax
	mov	es:[bx+4], ax
	or	si, si
	jle	short loc_28B48
	push	si
	push	dx
	push	word ptr es:[bx+6]
	push	[bp+var_6]
	call	sub_2A45A
	add	sp, 8
	mov	[bp+var_4], ax
	jmp	short loc_28B63
align 2
loc_28B48:
	mov	bx, [bp+var_6]
	test	ds:byte_4EFFC[bx], 20h
	jz	short loc_28B63
	mov	ax, 2
	push	ax
	sub	ax, ax
	push	ax
	push	ax
	push	bx
	call	sub_2A2F6
	add	sp, 8
loc_28B63:
	les	bx, [bp+arg_2]
	les	bx, es:[bx+6]
	mov	al, byte ptr [bp+arg_0]
	mov	es:[bx], al
	jmp	short loc_28B8B
loc_28B72:
	mov	si, 1
	mov	ax, si
	push	ax
	lea	ax, [bp+arg_0]
	push	ss
	push	ax
	push	[bp+var_6]
	call	sub_2A45A
	add	sp, 8
	mov	[bp+var_4], ax
loc_28B8B:
	cmp	[bp+var_4], si
	jz	short loc_28B93
	jmp	loc_28A1A
loc_28B93:
	mov	al, byte ptr [bp+arg_0]
	sub	ah, ah
loc_28B98:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
sub_289E0 endp

; Attributes: bp-based frame
sub_28B9E proc near

	var_4= dword ptr -4
	arg_0= word ptr	 4

	push	bp
	mov	bp, sp
	sub	sp, 4
	mov	ax, [bp+arg_0]
	sub	ax, offset off_4F64C
	cwd
	mov	cx, 0Ch
	idiv	cx
	mov	cx, ax
	shl	ax, 1
	add	ax, cx
	shl	ax, 1
	add	ax, offset byte_4F73C
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], ds
	mov	ax, 200h
	push	ax
	call	_mallocMaybe
	add	sp, 2
	les	bx, dword ptr [bp+arg_0]
	mov	es:[bx+6], ax
	mov	es:[bx+8], dx
	or	dx, ax
	jz	short loc_28BEC
	or	byte ptr es:[bx+0Ah], 8
	les	bx, [bp+var_4]
	mov	word ptr es:[bx+2], 200h
	jmp	short loc_28C0C
loc_28BEC:
	les	bx, dword ptr [bp+arg_0]
	or	byte ptr es:[bx+0Ah], 4
	mov	ax, word ptr [bp+var_4]
	mov	dx, word ptr [bp+var_4+2]
	inc	ax
	mov	es:[bx+6], ax
	mov	es:[bx+8], dx
	les	bx, [bp+var_4]
	mov	word ptr es:[bx+2], 1
loc_28C0C:
	les	bx, dword ptr [bp+arg_0]
	mov	ax, es:[bx+6]
	mov	dx, es:[bx+8]
	mov	es:[bx], ax
	mov	es:[bx+2], dx
	mov	word ptr es:[bx+4], 0
	mov	sp, bp
	pop	bp
	retn
sub_28B9E endp

; Attributes: bp-based frame

sub_28C28 proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	sub	sp, 6
	push	si
	inc	word_4F04A
	cmp	word ptr [bp+arg_0], offset byte_4F658
	jnz	short loc_28C4E
	cmp	word ptr [bp+arg_0+2], seg dseg
	jnz	short loc_28C4E
	mov	[bp+var_4], offset byte_4F24C
	mov	[bp+var_2], seg	dseg
	jmp	short loc_28C66
align 2
loc_28C4E:
	cmp	word ptr [bp+arg_0], offset byte_4F664
	jnz	short loc_28C8A
	cmp	word ptr [bp+arg_0+2], seg dseg
	jnz	short loc_28C8A
	mov	[bp+var_4], offset byte_4F44C
	mov	[bp+var_2], seg	dseg
loc_28C66:
	les	bx, [bp+arg_0]
	test	byte ptr es:[bx+0Ah], 0Ch
	jnz	short loc_28C8A
	mov	ax, bx
	sub	ax, offset off_4F64C
	cwd
	mov	cx, 0Ch
	idiv	cx
	mov	bx, ax
	shl	bx, 1
	add	bx, ax
	shl	bx, 1
	test	ds:byte_4F73C[bx],	1
	jz	short loc_28C8E
loc_28C8A:
	sub	ax, ax
	jmp	short loc_28CDD
loc_28C8E:
	mov	ax, word ptr [bp+arg_0]
	sub	ax, offset off_4F64C
	cwd
	mov	cx, 0Ch
	idiv	cx
	mov	cx, ax
	shl	ax, 1
	add	ax, cx
	shl	ax, 1
	add	ax, offset byte_4F73C
	mov	[bp+var_6], ax
	les	bx, [bp+arg_0]
	mov	ax, [bp+var_4]
	mov	dx, [bp+var_2]
	mov	es:[bx+6], ax
	mov	es:[bx+8], dx
	mov	es:[bx], ax
	mov	es:[bx+2], dx
	mov	si, [bp+var_6]
	mov	ax, 200h
	mov	[si+2],	ax
	mov	es:[bx+4], ax
	mov	bx, si
	mov	byte ptr [bx], 1
	mov	bx, word ptr [bp+arg_0]
	or	byte ptr es:[bx+0Ah], 2
	mov	ax, 1
loc_28CDD:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_28C28 endp

; Attributes: bp-based frame

sub_28CE2 proc far

	var_4= dword ptr -4
	arg_0= word ptr	 6
	arg_2= dword ptr  8

	push	bp
	mov	bp, sp
	sub	sp, 4
	cmp	[bp+arg_0], 0
	jnz	short loc_28CF1
	jmp	loc_28D7A
loc_28CF1:
	cmp	word ptr [bp+arg_2], offset byte_4F658
	jnz	short loc_28CFF
	cmp	word ptr [bp+arg_2+2], seg dseg
	jz	short loc_28D13
loc_28CFF:
	cmp	word ptr [bp+arg_2], offset byte_4F664
	jz	short loc_28D09
	jmp	loc_28DBD
loc_28D09:
	cmp	word ptr [bp+arg_2+2], seg dseg
	jz	short loc_28D13
	jmp	loc_28DBD
loc_28D13:
	les	bx, [bp+arg_2]
	mov	al, es:[bx+0Bh]
	cbw
	push	ax
	call	sub_2A9AC
	add	sp, 2
	or	ax, ax
	jnz	short loc_28D2B
	jmp	loc_28DBD
loc_28D2B:
	mov	ax, word ptr [bp+arg_2]
	sub	ax, offset off_4F64C
	cwd
	mov	cx, 0Ch
	idiv	cx
	mov	cx, ax
	shl	ax, 1
	add	ax, cx
	shl	ax, 1
	add	ax, offset byte_4F73C
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], ds
	push	word ptr [bp+arg_2+2]
	push	word ptr [bp+arg_2]
	call	sub_28DC2
	add	sp, 4
	les	bx, [bp+var_4]
	mov	byte ptr es:[bx], 0
	mov	word ptr es:[bx+2], 0
	les	bx, [bp+arg_2]
	sub	ax, ax
	cwd
	mov	es:[bx], ax
	mov	es:[bx+2], dx
	mov	es:[bx+6], ax
	mov	es:[bx+8], dx
	jmp	short loc_28DBD
loc_28D7A:
	les	bx, [bp+arg_2]
	cmp	word ptr es:[bx+6], offset byte_4F24C
	jnz	short loc_28D8D
	cmp	word ptr es:[bx+8], seg	dseg
	jz	short loc_28D9D
loc_28D8D:
	cmp	word ptr es:[bx+6], offset byte_4F44C
	jnz	short loc_28DBD
	cmp	word ptr es:[bx+8], seg	dseg
	jnz	short loc_28DBD
loc_28D9D:
	mov	al, es:[bx+0Bh]
	cbw
	push	ax
	call	sub_2A9AC
	add	sp, 2
	or	ax, ax
	jz	short loc_28DBD
	push	word ptr [bp+arg_2+2]
	push	word ptr [bp+arg_2]
	call	sub_28DC2
	add	sp, 4
loc_28DBD:
	mov	sp, bp
	pop	bp
	retf
sub_28CE2 endp

align 2
; Attributes: bp-based frame

sub_28DC2 proc far
	var_4= word ptr	-4
	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	sub	sp, 4
	push	si
	sub	si, si
	les	bx, [bp+arg_0]
	mov	al, es:[bx+0Ah]
	and	al, 3
	cmp	al, 2
	jnz	short loc_28E31
	test	byte ptr es:[bx+0Ah], 8
	jnz	short loc_28DF9
	mov	ax, bx
	sub	ax, offset off_4F64C
	cwd
	mov	cx, 0Ch
	idiv	cx
	mov	bx, ax
	shl	bx, 1
	add	bx, ax
	shl	bx, 1
	test	ds:byte_4F73C[bx], 1
	jz	short loc_28E31
loc_28DF9:
	mov	bx, word ptr [bp+arg_0]
	mov	ax, es:[bx]
	sub	ax, es:[bx+6]
	mov	[bp+var_4], ax
	or	ax, ax
	jle	short loc_28E31
	push	ax
	push	word ptr es:[bx+8]
	push	word ptr es:[bx+6]
	mov	al, es:[bx+0Bh]
	cbw
	push	ax
	call	sub_2A45A
	add	sp, 8
	cmp	ax, [bp+var_4]
	jz	short loc_28E31
	les	bx, [bp+arg_0]
	or	byte ptr es:[bx+0Ah], 20h
	mov	si, 0FFFFh
loc_28E31:
	les	bx, [bp+arg_0]
	mov	ax, es:[bx+6]
	mov	dx, es:[bx+8]
	mov	es:[bx], ax
	mov	es:[bx+2], dx
	mov	word ptr es:[bx+4], 0
	mov	ax, si
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_28DC2 endp

; Attributes: bp-based frame

_sscanf proc far

	var_6= byte ptr	-6
	var_4= byte ptr	-4
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= dword ptr  0Ah
	arg_8= word ptr	 0Eh
	arg_A= word ptr	 10h

	push	bp
	mov	bp, sp
	mov	ax, 6
	call	someStackOperation
	push	di
	push	si
	mov	word_4FD7A, 0
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	mov	word ptr sscanf_structP, ax
	mov	word ptr sscanf_structP+2,	dx
	mov	ax, offset sscanf_buf
	mov	word ptr sscanf_bufp, ax
	mov	word ptr sscanf_bufp+2,	ds
	mov	word_4FE8A, 0
	mov	word_4FE8C, 0
	mov	ax, [bp+arg_8]
	mov	dx, [bp+arg_A]
	mov	word ptr dword_4FD7C, ax
	mov	word ptr dword_4FD7C+2,	dx
loc_28E93:
	les	bx, [bp+arg_4]
	mov	al, es:[bx]
	mov	[bp+var_6], al
	or	al, al
	jnz	short loc_28EA3
	jmp	loc_2927E
loc_28EA3:
	cbw
	mov	bx, ax
	test	sscanf_charFlags[bx],	8
	jz	short loc_28EC4
	push	cs
	call	near ptr _sscanf_skipWhitespace
loc_28EB1:
	inc	word ptr [bp+arg_4]
	les	bx, [bp+arg_4]
	mov	al, es:[bx]
	cbw
	mov	bx, ax
	test	sscanf_charFlags[bx],	8
	jnz	short loc_28EB1
loc_28EC4:
	mov	bx, word ptr [bp+arg_4]
	cmp	byte ptr es:[bx], 25h ;	'%'
	jz	short loc_28ED0
	jmp	loc_29254
loc_28ED0:
	sub	ax, ax
	mov	sscanf_noAssign, ax
	mov	word_4FD84, ax
	mov	sscanf_charListFlag, ax
	mov	word_4FD72, ax
	mov	word_4FD74, ax
	mov	word_4FD6C, ax
	mov	sscanf_argSizeFlag, ax
	mov	sscanf_minWidth, ax
	mov	[bp+var_4], al
	inc	word ptr [bp+arg_4]
	mov	bx, word ptr [bp+arg_4]
	cmp	byte ptr es:[bx], 2Ah ;	'*'
	jnz	short loc_28F00
	inc	sscanf_noAssign
	inc	word ptr [bp+arg_4]
loc_28F00:
	mov	bx, word ptr [bp+arg_4]
	mov	al, es:[bx]
	cbw
	mov	bx, ax
	test	sscanf_charFlags[bx], 4
	jz	short loc_28F50
	mov	di, word ptr [bp+arg_4]
loc_28F13:
	mov	al, es:[di]
	cbw
	mov	cx, sscanf_minWidth
	shl	cx, 1
	shl	cx, 1
	add	cx, sscanf_minWidth
	shl	cx, 1
	add	cx, ax
	sub	cx, 30h	
	mov	sscanf_minWidth, cx
	inc	di
	mov	al, es:[di]
	cbw
	mov	bx, ax
	test	sscanf_charFlags[bx], 4
	jnz	short loc_28F13
	mov	word ptr [bp+arg_4], di
	mov	word ptr [bp+arg_4+2], es
	or	cx, cx
	jz	short loc_28F4C
	inc	word_4FD84
	jmp	short loc_28F50
loc_28F4C:
	inc	word_4FD74
loc_28F50:
	mov	bx, word ptr [bp+arg_4]
	mov	al, es:[bx]
	cbw
	cmp	ax, 46h	
	jz	short loc_28FD0
	cmp	ax, 4Eh	
	jz	short loc_28FC8
	cmp	ax, 68h	
	jz	short loc_28F72
	cmp	ax, 6Ch	
	jz	short loc_28FC0
	cmp	ax, 70h	
	jz	short loc_28FD0
	jmp	short loc_28F78
loc_28F72:
	mov	sscanf_argSizeFlag, 1
loc_28F78:
	cmp	sscanf_argSizeFlag, 0
	jz	short loc_28F88
	les	bx, [bp+arg_4]
	cmp	byte ptr es:[bx], 70h ;	'p'
	jnz	short loc_28F91
loc_28F88:
	les	bx, [bp+arg_4]
	cmp	byte ptr es:[bx], 4Ch ;	'L'
	jnz	short loc_28F94
loc_28F91:
	inc	word ptr [bp+arg_4]
loc_28F94:
	mov	bx, word ptr [bp+arg_4]
	mov	al, es:[bx]
	cbw
	mov	si, ax
	test	sscanf_charFlags[si], 1
	jz	short loc_28FD8
	cmp	si, 45h	
	jz	short loc_28FB9
	cmp	si, 47h	
	jz	short loc_28FB9
	cmp	si, 58h	
	jz	short loc_28FB9
	mov	sscanf_argSizeFlag, 2
loc_28FB9:
	add	si, 20h	
	jmp	loc_29040
align 2
loc_28FC0:
	mov	sscanf_argSizeFlag, 2
	jmp	short loc_28F78
loc_28FC8:
	mov	sscanf_argSizeFlag, 8
	jmp	short loc_28F78
loc_28FD0:
	mov	sscanf_argSizeFlag, 10h
	jmp	short loc_28F78
loc_28FD8:
	cmp	si, 5Bh	
	jnz	short loc_29040
	inc	sscanf_charListFlag
	inc	word ptr [bp+arg_4]
	les	bx, [bp+arg_4]
	cmp	byte ptr es:[bx], 5Eh ;	'^'
	jnz	short loc_28FF3
	inc	[bp+var_4]
	inc	word ptr [bp+arg_4]
loc_28FF3:
	mov	ax, 100h
	push	ax
	mov	al, [bp+var_4]
	cbw
	push	ax
	push	word ptr sscanf_bufp+2
	push	word ptr sscanf_bufp
	call	_memset
	add	sp, 8
	jmp	short loc_29028
loc_2900E:
	les	bx, [bp+arg_4]
	cmp	byte ptr es:[bx], 5Dh ;	']'
	jz	short loc_29031
	mov	al, es:[bx]
	cbw
	mov	bx, ax
	les	di, sscanf_bufp
	xor	byte ptr es:[bx+di], 1
	inc	word ptr [bp+arg_4]
loc_29028:
	les	bx, [bp+arg_4]
	cmp	byte ptr es:[bx], 0
	jnz	short loc_2900E
loc_29031:
	cmp	byte ptr es:[bx], 0
	jz	short loc_2903C
	mov	ax, 73h	
	jmp	short loc_2903E
loc_2903C:
	sub	ax, ax
loc_2903E:
	mov	si, ax
loc_29040:
	cmp	si, 69h	
	jz	short loc_29048
	jmp	loc_290FA
loc_29048:
	mov	word_4F7B8, 1
	push	cs
	call	near ptr _sscanf_skipWhitespace
	inc	word_4FE8C
	les	bx, sscanf_structP
	dec	word ptr es:[bx+4]
	js	short loc_29072
	mov	di, es:[bx]
	inc	word ptr es:[bx]
	mov	es, word ptr es:[bx+2]
	mov	al, es:[di]
	sub	ah, ah
	jmp	short loc_2907F
align 2
loc_29072:
	push	word ptr sscanf_structP+2
	push	bx
	call	sub_288E6
	add	sp, 4
loc_2907F:
	mov	si, ax
	cmp	si, 30h	
	jnz	short loc_290E2
	inc	word_4FD72
	inc	word_4FE8C
	les	bx, sscanf_structP
	dec	word ptr es:[bx+4]
	js	short loc_290AA
	mov	di, es:[bx]
	inc	word ptr es:[bx]
	mov	es, word ptr es:[bx+2]
	mov	al, es:[di]
	sub	ah, ah
	jmp	short loc_290B7
align 2
loc_290AA:
	push	word ptr sscanf_structP+2
	push	bx
	call	sub_288E6
	add	sp, 4
loc_290B7:
	mov	si, ax
	cmp	si, 78h	
	jz	short loc_290C3
	cmp	si, 58h	
	jnz	short loc_290C8
loc_290C3:
	mov	si, 78h	
	jmp	short loc_290FA
loc_290C8:
	dec	word_4FE8C
	push	word ptr sscanf_structP+2
	push	word ptr sscanf_structP
	push	si
	call	sscanf_segAdjust
	add	sp, 6
	mov	si, 6Fh	
	jmp	short loc_290FA
loc_290E2:
	dec	word_4FE8C
	push	word ptr sscanf_structP+2
	push	word ptr sscanf_structP
	push	si
	call	sscanf_segAdjust
	add	sp, 6
	mov	si, 64h	
loc_290FA:
	or	si, si
	jnz	short loc_29101
	jmp	loc_2927E
loc_29101:
	mov	ax, si
	sub	ax, 63h	
	cmp	ax, 15h
	jbe	short loc_2910E
	jmp	_sscanf_parseLiteral
loc_2910E:
	add	ax, ax
	xchg	ax, bx
	jmp	cs:_sscanf_parsers[bx]
_sscanf_parseChar:
	cmp	word_4FD84, 0
	jnz	short loc_29126
	mov	ax, 1
	mov	sscanf_minWidth, ax
	mov	word_4FD84, ax
loc_29126:
	sub	ax, ax
loc_29128:
	push	ax
	push	cs
	call	near ptr sscanf_readString
loc_2912D:
	add	sp, 2
	jmp	loc_29240
align 2
_sscanf_parseString:
	mov	ax, 1
	jmp	short loc_29128
align 2
_sscanf_parseNchars:
	inc	word_4FD6C
_sscanf_parseSignedInt:
	mov	ax, 0Ah
loc_29141:
	push	ax
	push	cs
	call	near ptr sscanf_readNumber
	jmp	short loc_2912D
_sscanf_parseOctal:
	mov	ax, 8
	jmp	short loc_29141
align 2
_sscanf_parsePointer:
	cmp	sscanf_argSizeFlag, 1
	jnz	short loc_29158
	jmp	_sscanf_parseHex
loc_29158:
	cmp	sscanf_argSizeFlag, 8
	jnz	short loc_29162
	jmp	_sscanf_parseHex
loc_29162:
	cmp	sscanf_argSizeFlag, 0
	jnz	short loc_2916C
	jmp	_sscanf_parseHex
loc_2916C:
	mov	ax, 10h
	push	ax
	push	cs
	call	near ptr sscanf_readNumber
	add	sp, 2
	sub	word ptr dword_4FD7C, 4
	les	bx, dword_4FD7C
	les	bx, es:[bx]
	mov	ax, es:[bx]
	mov	dx, es:[bx+2]
	mov	word_4FED0, ax
	mov	word_4FED2, dx
	inc	word_4FE8C
	les	bx, sscanf_structP
	dec	word ptr es:[bx+4]
	js	short loc_291B0
	mov	di, es:[bx]
	inc	word ptr es:[bx]
	mov	es, word ptr es:[bx+2]
	mov	al, es:[di]
	sub	ah, ah
	jmp	short loc_291BD
loc_291B0:
	push	word ptr sscanf_structP+2
	push	bx
	call	sub_288E6
	add	sp, 4
loc_291BD:
	mov	si, ax
	cmp	si, 3Ah	
	jnz	short loc_291EC
	inc	word_4FE8A
	mov	ax, 10h
	push	ax
	push	cs
	call	near ptr sscanf_readNumber
	add	sp, 2
	sub	word ptr dword_4FD7C, 4
	les	bx, dword_4FD7C
	les	bx, es:[bx]
	mov	dx, word_4FED0
	sub	ax, ax
	or	es:[bx+2], dx
	jmp	short loc_29201
align 2
loc_291EC:
	dec	word_4FE8C
	push	word ptr sscanf_structP+2
	push	word ptr sscanf_structP
	push	si
	call	sscanf_segAdjust
	add	sp, 6
loc_29201:
	add	word ptr dword_4FD7C, 4
	jmp	short loc_29240
_sscanf_parseHex:
	mov	ax, 10h
	jmp	loc_29141
_sscanf_parseFloat:
	push	cs
	call	near ptr sscanf_readFloat
	jmp	short loc_29240
_sscanf_parsers dw offset _sscanf_parseChar
dw offset _sscanf_parseSignedInt
dw offset _sscanf_parseFloat
dw offset _sscanf_parseFloat
dw offset _sscanf_parseFloat
dw offset _sscanf_parseLiteral
dw offset _sscanf_parseLiteral
dw offset _sscanf_parseLiteral
dw offset _sscanf_parseLiteral
dw offset _sscanf_parseLiteral
dw offset _sscanf_parseLiteral
dw offset _sscanf_parseNchars
dw offset _sscanf_parseOctal
dw offset _sscanf_parsePointer
dw offset _sscanf_parseLiteral
dw offset _sscanf_parseLiteral
dw offset _sscanf_parseString
dw offset _sscanf_parseLiteral
dw offset _sscanf_parseSignedInt
dw offset _sscanf_parseLiteral
dw offset _sscanf_parseLiteral
dw offset _sscanf_parseHex
loc_29240:
	cmp	word_4FD7A, 0
	jz	short loc_29284
	cmp	word_4FE8A, 0
	jnz	short loc_2927E
loc_2924E:
	mov	ax, 0FFFFh
	jmp	short loc_2928A
align 2
loc_29254:
	les	bx, [bp+arg_4]
	cmp	byte ptr es:[bx], 0
	jz	short loc_2927E
_sscanf_parseLiteral:
	les	bx, [bp+arg_4]
	mov	al, es:[bx]
	cbw
	push	ax
	push	cs
	call	near ptr sscanf_readLiteral
	add	sp, 2
	mov	si, ax
	or	si, si
	jz	short loc_29284
	cmp	si, 1
	jz	short loc_2927E
	cmp	word_4FE8A, 0
	jz	short loc_2924E
loc_2927E:
	mov	ax, word_4FE8A
	jmp	short loc_2928A
align 2
loc_29284:
	inc	word ptr [bp+arg_4]
	jmp	loc_28E93
loc_2928A:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
_sscanf endp

; Attributes: bp-based frame

sscanf_readString proc far

	var_A= word ptr	-0Ah
	var_8= word ptr	-8
	var_4= dword ptr -4
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	sub	sp, 0Ah
	push	di
	push	si
	les	bx, dword_4FD7C
	mov	ax, es:[bx]
	mov	dx, es:[bx+2]
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	mov	[bp+var_A], ax
	mov	[bp+var_8], dx
	cmp	sscanf_noAssign, 0
	jnz	short loc_292BB
	add	word ptr dword_4FD7C, 4
loc_292BB:
	cmp	word_4FD74, 0
	jz	short loc_292C5
	jmp	loc_293A8
loc_292C5:
	cmp	[bp+arg_0], 0
	jz	short loc_292D6
	cmp	sscanf_charListFlag, 0
	jnz	short loc_292D6
	push	cs
	call	near ptr _sscanf_skipWhitespace
loc_292D6:
	mov	di, [bp+arg_0]
	jmp	short loc_29301
align 2
loc_292DC:
	mov	al, sscanf_charFlags[si]
	and	al, 8
	mov	cx, ax
	cmp	cl, 1
	sbb	ax, ax
	neg	ax
loc_292EB:
	or	ax, ax
	jz	short loc_29328
loc_292EF:
	cmp	sscanf_noAssign, 0
	jnz	short loc_29301
	les	bx, [bp+var_4]
	mov	ax, si
	mov	es:[bx], al
	inc	word ptr [bp+var_4]
loc_29301:
	push	cs
	call	near ptr sub_297F0
	or	ax, ax
	jz	short loc_29328
	push	cs
	call	near ptr sscanf_getc
	mov	si, ax
	inc	ax
	jz	short loc_29328
	or	di, di
	jz	short loc_292EF
	cmp	sscanf_charListFlag, 0
	jz	short loc_292DC
	les	bx, sscanf_bufp
	mov	al, es:[bx+si]
	cbw
	jmp	short loc_292EB
align 2
loc_29328:
	cmp	si, 0FFFFh
	jnz	short loc_29334
	inc	word_4FD7A
	jmp	short loc_29380
align 2
loc_29334:
	cmp	[bp+arg_0], 0
	jz	short loc_29380
	cmp	word_4FD84, 0
	jz	short loc_2936B
	cmp	sscanf_minWidth, 0
	jnz	short loc_2936B
	cmp	sscanf_charListFlag, 0
	jz	short loc_2935E
	les	bx, sscanf_bufp
	cmp	byte ptr es:[bx+si], 1
	sbb	ax, ax
	neg	ax
	jmp	short loc_29367
align 2
loc_2935E:
	mov	al, sscanf_charFlags[si]
	sub	ah, ah
	and	ax, 8
loc_29367:
	or	ax, ax
	jz	short loc_29380
loc_2936B:
	dec	word_4FE8C
	push	word ptr sscanf_structP+2
	push	word ptr sscanf_structP
	push	si
	call	sscanf_segAdjust
	add	sp, 6
loc_29380:
	cmp	sscanf_noAssign, 0
	jnz	short loc_293A8
	cmp	[bp+arg_0], 0
	jz	short loc_29394
	les	bx, [bp+var_4]
	mov	byte ptr es:[bx], 0
loc_29394:
	mov	ax, word ptr [bp+var_4]
	mov	dx, word ptr [bp+var_4+2]
	cmp	[bp+var_A], ax
	jnz	short loc_293A4
	cmp	[bp+var_8], dx
	jz	short loc_293A8
loc_293A4:
	inc	word_4FE8A
loc_293A8:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
sscanf_readString endp

; Attributes: bp-based frame

sscanf_readNumber proc far

	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	sub	sp, 8
	push	di
	push	si
	mov	si, [bp+arg_0]
	sub	ax, ax
	mov	[bp+var_2], ax
	cwd
	mov	[bp+var_6], ax
	mov	[bp+var_4], dx
	cmp	word_4FD6C, ax
	jz	short loc_293CE
	jmp	loc_294EE
loc_293CE:
	cmp	word_4FD74, ax
	jz	short loc_293E0
	cmp	sscanf_noAssign, ax
	jz	short loc_293DD
	jmp	loc_2954F
loc_293DD:
	jmp	loc_2954A
loc_293E0:
	cmp	word_4F7B8, 0
	jnz	short loc_293EB
	push	cs
	call	near ptr _sscanf_skipWhitespace
loc_293EB:
	push	cs
	call	near ptr sscanf_getc
	mov	di, ax
	cmp	di, 2Dh	
	jz	short loc_293FE
	cmp	di, 2Bh	
	jz	short loc_293FE
	jmp	loc_294A5
loc_293FE:
	cmp	di, 2Dh	
	jnz	short loc_29406
	inc	[bp+var_2]
loc_29406:
	dec	sscanf_minWidth
	jmp	loc_2949F
align 2
loc_2940E:
	mov	ax, 30h	
loc_29411:
	sub	di, ax
	jmp	short loc_29492
align 2
loc_29416:
	cmp	si, 8
	jnz	short loc_29468
	cmp	di, 38h	
	jge	short loc_2942E
	mov	al, 3
	push	ax
	lea	ax, [bp+var_6]
	push	ax
	call	sub_2ACF6
	jmp	short loc_2948F
loc_2942E:
	cmp	di, 0FFFFh
	jz	short loc_29448
	dec	word_4FE8C
	push	word ptr ds:sscanf_structP+2
	push	word ptr ds:sscanf_structP
	push	di
	call	sscanf_segAdjust
	add	sp, 6
loc_29448:
	cmp	[bp+var_2], 0
	jnz	short loc_29451
	jmp	loc_294F9
loc_29451:
	mov	ax, [bp+var_6]
	mov	dx, [bp+var_4]
	neg	ax
	adc	dx, 0
	neg	dx
	mov	[bp+var_6], ax
	mov	[bp+var_4], dx
	jmp	loc_294F9
align 2
loc_29468:
	test	ds:sscanf_charFlags[di], 4
	jz	short loc_2942E
	mov	ax, [bp+var_6]
	mov	dx, [bp+var_4]
	mov	cl, 2
loc_29477:
	shl	ax, 1
	rcl	dx, 1
	dec	cl
	jnz	short loc_29477
	add	ax, [bp+var_6]
	adc	dx, [bp+var_4]
	shl	ax, 1
	rcl	dx, 1
	mov	[bp+var_6], ax
	mov	[bp+var_4], dx
loc_2948F:
	sub	di, 30h	
loc_29492:
	mov	ax, di
	cwd
	add	[bp+var_6], ax
	adc	[bp+var_4], dx
	inc	word_4FD72
loc_2949F:
	push	cs
	call	near ptr sscanf_getc
	mov	di, ax
loc_294A5:
	push	cs
	call	near ptr sub_297F0
	or	ax, ax
	jz	short loc_2942E
	cmp	di, 0FFFFh
	jnz	short loc_294B5
	jmp	loc_2942E
loc_294B5:
	test	ds:sscanf_charFlags[di], 80h
	jnz	short loc_294BF
	jmp	loc_2942E
loc_294BF:
	cmp	si, 10h
	jz	short loc_294C7
	jmp	loc_29416
loc_294C7:
	mov	al, 4
	push	ax
	lea	ax, [bp+var_6]
	push	ax
	call	sub_2ACF6
	test	sscanf_charFlags[di], 1
	jz	short loc_294DD
	add	di, 20h	
loc_294DD:
	test	sscanf_charFlags[di], 2
	jnz	short loc_294E7
	jmp	loc_2940E
loc_294E7:
	mov	ax, 57h	
	jmp	loc_29411
align 2
loc_294EE:
	mov	ax, word_4FE8C
	mov	[bp+var_6], ax
	mov	[bp+var_4], 0
loc_294F9:
	cmp	sscanf_noAssign, 0
	jnz	short loc_2954F
	cmp	word_4FD72, 0
	jnz	short loc_2950E
	cmp	word_4FD6C, 0
	jz	short loc_2954A
loc_2950E:
	cmp	sscanf_argSizeFlag, 2
	jz	short loc_2951C
	cmp	sscanf_argSizeFlag, 10h
	jnz	short loc_29532
loc_2951C:
	les	bx, dword_4FD7C
	les	bx, es:[bx]
	mov	ax, [bp+var_6]
	mov	dx, [bp+var_4]
	mov	es:[bx], ax
	mov	es:[bx+2], dx
	jmp	short loc_2953F
loc_29532:
	les	bx, dword_4FD7C
	les	bx, es:[bx]
	mov	ax, [bp+var_6]
	mov	es:[bx], ax
loc_2953F:
	cmp	word_4FD6C, 0
	jnz	short loc_2954A
	inc	word_4FE8A
loc_2954A:
	add	word ptr dword_4FD7C, 4
loc_2954F:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
sscanf_readNumber endp

align 2
; Attributes: bp-based frame

sscanf_readFloat proc far

	var_C= word ptr	-0Ch
	var_A= word ptr	-0Ah
	var_6= word ptr	-6
	var_4= dword ptr -4

	push	bp
	mov	bp, sp
	sub	sp, 0Ch
	push	di
	push	si
	mov	[bp+var_6], 0
	cmp	word_4FD74, 0
	jz	short loc_29578
	cmp	sscanf_noAssign, 0
	jz	short loc_29574
	jmp	loc_2971E
loc_29574:
	jmp	loc_29719
align 2
loc_29578:
	push	cs
	call	near ptr _sscanf_skipWhitespace
	mov	ax, offset _sscanf_floatBuf
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], ds
	mov	dx, ds
	add	ax, 40h	
	mov	[bp+var_C], ax
	mov	[bp+var_A], dx
	push	cs
	call	near ptr sscanf_getc
	mov	si, ax
	cmp	si, 2Bh	
	jz	short loc_295A0
	cmp	si, 2Dh	
	jnz	short loc_295BA
loc_295A0:
	cmp	si, 2Dh	
	jnz	short loc_295B0
	les	bx, [bp+var_4]
	inc	word ptr [bp+var_4]
	mov	ax, si
	mov	es:[bx], al
loc_295B0:
	dec	sscanf_minWidth
	push	cs
	call	near ptr sscanf_getc
	mov	si, ax
loc_295BA:
	mov	di, [bp+var_6]
	jmp	short loc_295DD
align 2
loc_295C0:
	mov	ax, [bp+var_C]
	mov	dx, [bp+var_A]
	cmp	word ptr [bp+var_4], ax
	jnb	short loc_295E9
	inc	di
	les	bx, [bp+var_4]
	mov	ax, si
	mov	es:[bx], al
	inc	word ptr [bp+var_4]
	push	cs
	call	near ptr sscanf_getc
	mov	si, ax
loc_295DD:
	push	si
	push	cs
	call	near ptr sub_29724
	add	sp, 2
	or	ax, ax
	jnz	short loc_295C0
loc_295E9:
	mov	[bp+var_6], di
	cmp	si, 2Eh	
	jnz	short loc_2963E
	push	cs
	call	near ptr sub_297F0
	or	ax, ax
	jz	short loc_2963E
	mov	ax, [bp+var_C]
	mov	dx, [bp+var_A]
	cmp	word ptr [bp+var_4], ax
	jnb	short loc_2963E
	les	bx, [bp+var_4]
	inc	word ptr [bp+var_4]
	mov	ax, si
	mov	es:[bx], al
	jmp	short loc_29629
align 2
loc_29612:
	mov	ax, [bp+var_C]
	mov	dx, [bp+var_A]
	cmp	word ptr [bp+var_4], ax
	jnb	short loc_2963B
	inc	di
	les	bx, [bp+var_4]
	mov	ax, si
	mov	es:[bx], al
	inc	word ptr [bp+var_4]
loc_29629:
	push	cs
	call	near ptr sscanf_getc
	mov	si, ax
	push	si
	push	cs
	call	near ptr sub_29724
	add	sp, 2
	or	ax, ax
	jnz	short loc_29612
loc_2963B:
	mov	[bp+var_6], di
loc_2963E:
	cmp	[bp+var_6], 0
	jnz	short loc_29647
	jmp	loc_296CC
loc_29647:
	cmp	si, 65h	
	jz	short loc_29651
	cmp	si, 45h	
	jnz	short loc_296CC
loc_29651:
	push	cs
	call	near ptr sub_297F0
	or	ax, ax
	jz	short loc_296CC
	mov	ax, [bp+var_C]
	mov	dx, [bp+var_A]
	cmp	word ptr [bp+var_4], ax
	jnb	short loc_296CC
	les	bx, [bp+var_4]
	inc	word ptr [bp+var_4]
	mov	ax, si
	mov	es:[bx], al
	push	cs
	call	near ptr sscanf_getc
	mov	si, ax
	cmp	si, 2Dh	
	jz	short loc_2967F
	cmp	si, 2Bh	
	jnz	short loc_296C0
loc_2967F:
	push	cs
	call	near ptr sub_297F0
	or	ax, ax
	jz	short loc_296C0
	cmp	si, 2Dh	
	jnz	short loc_296BA
	mov	ax, [bp+var_C]
	mov	dx, [bp+var_A]
	cmp	word ptr [bp+var_4], ax
	jnb	short loc_296BA
	les	bx, [bp+var_4]
	inc	word ptr [bp+var_4]
	mov	ax, si
	mov	es:[bx], al
	jmp	short loc_296BA
loc_296A4:
	mov	ax, [bp+var_C]
	mov	dx, [bp+var_A]
	cmp	word ptr [bp+var_4], ax
	jnb	short loc_296CC
	les	bx, [bp+var_4]
	mov	ax, si
	mov	es:[bx], al
	inc	word ptr [bp+var_4]
loc_296BA:
	push	cs
	call	near ptr sscanf_getc
	mov	si, ax
loc_296C0:
	push	si
	push	cs
	call	near ptr sub_29724
	add	sp, 2
	or	ax, ax
	jnz	short loc_296A4
loc_296CC:
	dec	word_4FE8C
	push	word ptr sscanf_structP+2
	push	word ptr sscanf_structP
	push	si
	call	sscanf_segAdjust
	add	sp, 6
	cmp	sscanf_noAssign, 0
	jnz	short loc_2971E
	cmp	[bp+var_6], 0
	jz	short loc_29719
	les	bx, [bp+var_4]
	mov	byte ptr es:[bx], 0
	mov	ax, offset _sscanf_floatBuf
	push	ds
	push	ax
	push	word ptr dword_4FD7C+2
	push	word ptr dword_4FD7C
	mov	ax, sscanf_argSizeFlag
	and	ax, 2
	push	ax
	call	off_4F7EC
	add	sp, 0Ah
	inc	word_4FE8A
loc_29719:
	add	word ptr dword_4FD7C, 4
loc_2971E:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
sscanf_readFloat endp

; Attributes: bp-based frame

sub_29724 proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	cmp	[bp+arg_0], 0FFFFh
	jz	short loc_29744
	mov	bx, [bp+arg_0]
	test	sscanf_charFlags[bx], 4
	jz	short loc_29744
	push	cs
	call	near ptr sub_297F0
	or	ax, ax
	jz	short loc_29744
	mov	ax, 1
	jmp	short loc_29746
loc_29744:
	sub	ax, ax
loc_29746:
	pop	bp
	retf
sub_29724 endp

; Attributes: bp-based frame

sscanf_readLiteral proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	sub	sp, 2
	push	si
	push	cs
	call	near ptr sscanf_getc
	mov	si, ax
	cmp	si, [bp+arg_0]
	jnz	short loc_2975E
	sub	ax, ax
	jmp	short loc_29780
loc_2975E:
	cmp	si, 0FFFFh
	jnz	short loc_29768
	mov	ax, 0FFFFh
	jmp	short loc_29780
loc_29768:
	dec	word_4FE8C
	push	word ptr sscanf_structP+2
	push	word ptr sscanf_structP
	push	si
	call	sscanf_segAdjust
	add	sp, 6
	mov	ax, 1
loc_29780:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sscanf_readLiteral endp

align 2

sscanf_getc proc far
	push	si
	inc	word_4FE8C
	les	bx, sscanf_structP
	assume es:nothing
	dec	word ptr es:[bx+4]
	js	short loc_297A6
	mov	si, es:[bx]
	inc	word ptr es:[bx]
	mov	es, word ptr es:[bx+2]
	mov	al, es:[si]
	sub	ah, ah
	jmp	short loc_297B3
loc_297A6:
	push	word ptr sscanf_structP+2
	push	bx
	call	sub_288E6
	add	sp, 4
loc_297B3:
	pop	si
	retf
sscanf_getc endp

align 2
; Attributes: bp-based frame

_sscanf_skipWhitespace proc far
	push	bp
	mov	bp, sp
	sub	sp, 2
	push	si
loc_297BD:
	push	cs
	call	near ptr sscanf_getc
	mov	si, ax
	test	sscanf_charFlags[si], 8
	jnz	short loc_297BD
	cmp	si, 0FFFFh
	jnz	short loc_297D6
	inc	word_4FD7A
	jmp	short loc_297EB
align 2
loc_297D6:
	dec	word_4FE8C
	push	word ptr sscanf_structP+2
	push	word ptr sscanf_structP
	push	si
	call	sscanf_segAdjust
	add	sp, 6
loc_297EB:
	pop	si
	mov	sp, bp
	pop	bp
	retf
_sscanf_skipWhitespace endp


sub_297F0 proc far
	cmp	word_4FD84, 0
	jnz	short loc_297FC
loc_297F7:
	mov	ax, 1
	jmp	short locret_2980C
loc_297FC:
	cmp	sscanf_minWidth, 0
	jle	short loc_2980A
	dec	sscanf_minWidth
	jmp	short loc_297F7
align 2
loc_2980A:
	sub	ax, ax
locret_2980C:
	retf
sub_297F0 endp

align 2
; Attributes: bp-based frame

printf_doPrint proc far

	var_A= byte ptr	-0Ah
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= dword ptr -4
	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= dword ptr  0Ah
	arg_8= word ptr	 0Eh
	arg_A= word ptr	 10h

	push	bp
	mov	bp, sp
	mov	ax, 0Ah
	call	someStackOperation
	mov	ax, offset byte_4FF08
	mov	word_4FF02, ax
	mov	word_4FF04, ds
	mov	ax, [bp+arg_8]
	mov	dx, [bp+arg_A]
	mov	word ptr dword_4FEF0, ax
	mov	word ptr dword_4FEF0+2,	dx
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	mov	word ptr dword_4FED6, ax
	mov	word ptr dword_4FED6+2,	dx
	mov	word_4FEFC, 0
	mov	word_4FEFA, 0
	jmp	loc_29B8D
loc_2984C:
	cmp	[bp+var_A], 25h	
	jz	short loc_29855
	jmp	loc_29AFC
loc_29855:
	mov	word_4FEFE, 1
	sub	ax, ax
	mov	word_4FEE0, ax
	mov	word_4FEDC, ax
	mov	word_4FEF8, ax
	mov	word_4FEDE, ax
	mov	word_4FEF6, ax
	mov	word_4FEF4, ax
	mov	word_4FEDA, ax
	mov	word_4FED4, ax
	mov	word_4FEEE, ax
	mov	word_50068, 20h	
	les	bx, [bp+arg_4]
	cmp	byte ptr es:[bx+1], 30h	
	jnz	short loc_298D1
	inc	word ptr [bp+arg_4]
	mov	word_50068, 30h	
	jmp	short loc_298D1
align 2
loc_29894:
	mov	bx, word ptr [bp+arg_4]
	cmp	byte ptr es:[bx], 2Bh ;	'+'
	jnz	short loc_298AA
	inc	word_4FEE0
	mov	word_4FEF4, 0
	jmp	short loc_298D1
align 2
loc_298AA:
	cmp	byte ptr es:[bx], 20h ;	' '
	jnz	short loc_298BE
	cmp	word_4FEE0, 0
	jnz	short loc_298D1
	inc	word_4FEF4
	jmp	short loc_298D1
align 2
loc_298BE:
	inc	word_4FED4
	jmp	short loc_298D1
loc_298C4:
	les	bx, [bp+arg_4]
	cmp	byte ptr es:[bx], 2Dh ;	'-'
	jnz	short loc_29894
	inc	word_4FEEE
loc_298D1:
	inc	word ptr [bp+arg_4]
	mov	bx, word ptr [bp+arg_4]
	mov	al, es:[bx]
	cbw
	push	ax
	push	cs
	call	near ptr sub_2A22A
	add	sp, 2
	or	ax, ax
	jnz	short loc_298C4
	push	word ptr [bp+arg_4+2]
	push	word ptr [bp+arg_4]
	mov	ax, offset word_4FF06
	push	ds
	push	ax
	push	cs
	call	near ptr sub_2A188
	add	sp, 8
	mov	word ptr [bp+arg_4], ax
	mov	word ptr [bp+arg_4+2], dx
	cmp	word_4FF06, 0
	jge	short loc_29912
	inc	word_4FEEE
	mov	ax, word_4FF06
	neg	ax
	mov	word_4FF06, ax
loc_29912:
	les	bx, [bp+arg_4]
	cmp	byte ptr es:[bx], 2Eh ;	'.'
	jnz	short loc_29949
	inc	word_4FEF6
	inc	word ptr [bp+arg_4]
	push	es
	push	word ptr [bp+arg_4]
	mov	ax, word_4FEFE
	push	ds
	push	ax
	push	cs
	call	near ptr sub_2A188
	add	sp, 8
	mov	word ptr [bp+arg_4], ax
	mov	word ptr [bp+arg_4+2], dx
	cmp	word_4FEFE, 0
	jge	short loc_29949
	mov	word_4FEFE, 1
	dec	word_4FEF6
loc_29949:
	les	bx, [bp+arg_4]
	mov	al, es:[bx]
	cbw
	cmp	ax, 46h	
	jz	short loc_29992
	cmp	ax, 4Eh	
	jz	short loc_2999A
	cmp	ax, 68h	
	jz	short loc_2998A
	cmp	ax, 6Ch	
	jnz	short loc_2996A
	mov	word_4FEDE, 2
loc_2996A:
	cmp	word_4FEDE, 0
	jnz	short loc_2997A
	les	bx, [bp+arg_4]
	cmp	byte ptr es:[bx], 4Ch ;	'L'
	jnz	short loc_2997D
loc_2997A:
	inc	word ptr [bp+arg_4]
loc_2997D:
	les	bx, [bp+arg_4]
	cmp	byte ptr es:[bx], 0
	jnz	short loc_299A2
	jmp	loc_29B9D
align 2
loc_2998A:
	mov	word_4FEDE, 1
	jmp	short loc_2996A
loc_29992:
	mov	word_4FEDE, 10h
	jmp	short loc_2996A
loc_2999A:
	mov	word_4FEDE, 8
	jmp	short loc_2996A
loc_299A2:
	mov	al, es:[bx]
	cbw
	mov	[bp+var_8], ax
	cmp	ax, 45h	
	jz	short loc_299B8
	cmp	ax, 47h	
	jz	short loc_299B8
	cmp	ax, 58h	
	jnz	short loc_299C0
loc_299B8:
	inc	word_4FEDC
	add	[bp+var_8], 20h	
loc_299C0:
	mov	ax, [bp+var_8]
	sub	ax, 63h	
	cmp	ax, 15h
	jbe	short loc_299CE
	jmp	loc_29AEC
loc_299CE:
	add	ax, ax
	xchg	ax, bx
	jmp	cs:off_29B0C[bx]
loc_299D6:
	les	bx, dword_4FEF0
	les	bx, es:[bx]
	mov	ax, word_4FEFA
	mov	es:[bx], ax
	add	word ptr dword_4FEF0, 4
	jmp	loc_29B38
align 2
loc_299EC:
	inc	word_4FEF8
loc_299F0:
	mov	word_4FED4, 0
	mov	ax, 0Ah
loc_299F9:
	push	ax
	push	cs
	call	near ptr sub_29BBC
loc_299FE:
	add	sp, 2
	jmp	loc_29B38
loc_29A04:
	mov	ax, 8
	jmp	short loc_299F9
align 2
loc_29A0A:
	inc	word_4FEDA
	inc	word_4FEDC
	cmp	word_4FEF6, 0
	jnz	short loc_29A22
	mov	word_4FF00, 1
	jmp	short loc_29A28
align 2
loc_29A22:
	mov	word_4FF00, 0
loc_29A28:
	inc	word_4FEF6
	mov	word_4FEFE, 4
	cmp	word_4FEDE, 8
	jnz	short loc_29A3C
	jmp	loc_29ACC
loc_29A3C:
	sub	ax, ax
	mov	word_4FEDE, ax
	mov	[bp+var_6], ax
	cmp	word_4FF06, ax
	jz	short loc_29A71
	mov	ax, word_4FF06
	mov	[bp+var_6], ax
	cmp	word_4FEEE, 0
	jz	short loc_29A60
	mov	word_4FF06, 0
	jmp	short loc_29A71
align 2
loc_29A60:
	sub	word_4FF06, 5
	mov	ax, word_4FF06
	or	ax, ax
	jge	short loc_29A6E
	sub	ax, ax
loc_29A6E:
	mov	word_4FF06, ax
loc_29A71:
	add	word ptr dword_4FEF0, 2
	mov	ax, 10h
	push	ax
	push	cs
	call	near ptr sub_29BBC
	add	sp, 2
	mov	ax, 3Ah	
	push	ax
	push	cs
	call	near ptr sub_29F12
	add	sp, 2
	cmp	[bp+var_6], 0
	jz	short loc_29AB4
	cmp	word_4FEEE, 0
	jz	short loc_29AAE
	mov	ax, [bp+var_6]
	sub	ax, 5
	mov	word_4FF06, ax
	or	ax, ax
	jge	short loc_29AA8
	sub	ax, ax
loc_29AA8:
	mov	word_4FF06, ax
	jmp	short loc_29AB4
align 2
loc_29AAE:
	mov	word_4FF06, 0
loc_29AB4:
	sub	word ptr dword_4FEF0, 4
	mov	ax, 10h
	push	ax
	push	cs
	call	near ptr sub_29BBC
	add	sp, 2
	add	word ptr dword_4FEF0, 2
	jmp	short loc_29B38
align 2
loc_29ACC:
	mov	ax, 10h
	jmp	loc_299F9
loc_29AD2:
	sub	ax, ax
loc_29AD4:
	push	ax
	push	cs
	call	near ptr sub_29D32
	jmp	loc_299FE
loc_29ADC:
	mov	ax, 1
	jmp	short loc_29AD4
align 2
loc_29AE2:
	push	[bp+var_8]
	push	cs
	call	near ptr sub_29E26
	jmp	loc_299FE
loc_29AEC:
	cmp	word_4FEDE, 0
	jz	short loc_29AFC
	mov	ax, word ptr [bp+arg_4]
	mov	dx, word ptr [bp+arg_4+2]
	dec	word ptr [bp+arg_4]
loc_29AFC:
	mov	ax, word ptr [bp+arg_4]
	mov	dx, word ptr [bp+arg_4+2]
	inc	ax
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], dx
	jmp	short loc_29B5D
align 2
off_29B0C dw offset loc_29ADC
dw offset loc_299F0
dw offset loc_29AE2
dw offset loc_29AE2
dw offset loc_29AE2
dw offset loc_29AEC
dw offset loc_299F0
dw offset loc_29AEC
dw offset loc_29AEC
dw offset loc_29AEC
dw offset loc_29AEC
dw offset loc_299D6
dw offset loc_29A04
dw offset loc_29A0A
dw offset loc_29AEC
dw offset loc_29AEC
dw offset loc_29AD2
dw offset loc_29AEC
dw offset loc_299EC
dw offset loc_29AEC
dw offset loc_29AEC
dw offset loc_29ACC
loc_29B38:
	cmp	word_4FEFC, 0
	jz	short loc_29B54
	cmp	word_4FEFA, 0
	jnz	short loc_29BB4
	les	bx, dword_4FED6
	test	byte ptr es:[bx+0Ah], 20h
	jnz	short loc_29BAF
	jmp	short loc_29BB4
align 2
loc_29B54:
	inc	word ptr [bp+arg_4]
	jmp	short loc_29B8D
align 2
loc_29B5A:
	inc	word ptr [bp+var_4]
loc_29B5D:
	les	bx, [bp+var_4]
	mov	al, es:[bx]
	mov	[bp+var_A], al
	or	al, al
	jz	short loc_29B6E
	cmp	al, 25h	
	jnz	short loc_29B5A
loc_29B6E:
	mov	ax, bx
	sub	ax, word ptr [bp+arg_4]
	push	ax
	push	word ptr [bp+arg_4+2]
	push	word ptr [bp+arg_4]
	push	cs
	call	near ptr sub_29FCA
	add	sp, 6
	mov	ax, word ptr [bp+var_4]
	mov	dx, word ptr [bp+var_4+2]
	mov	word ptr [bp+arg_4], ax
	mov	word ptr [bp+arg_4+2], dx
loc_29B8D:
	les	bx, [bp+arg_4]
	mov	al, es:[bx]
	mov	[bp+var_A], al
	or	al, al
	jz	short loc_29B9D
	jmp	loc_2984C
loc_29B9D:
	cmp	word_4FEFA, 0
	jnz	short loc_29BB4
	les	bx, dword_4FED6
	test	byte ptr es:[bx+0Ah], 20h
	jz	short loc_29BB4
loc_29BAF:
	mov	ax, 0FFFFh
	jmp	short loc_29BB7
loc_29BB4:
	mov	ax, word_4FEFA
loc_29BB7:
	mov	sp, bp
	pop	bp
	retf
printf_doPrint endp

align 2
; Attributes: bp-based frame

sub_29BBC proc far

	var_12=	word ptr -12h
	var_10=	word ptr -10h
	var_E= dword ptr -0Eh
	var_A= word ptr	-0Ah
	var_8= dword ptr -8
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	sub	sp, 12h
	push	di
	push	si
	cmp	[bp+arg_0], 0Ah
	jz	short loc_29BCE
	inc	word_4FEF8
loc_29BCE:
	cmp	word_4FEDE, 2
	jz	short loc_29BDC
	cmp	word_4FEDE, 10h
	jnz	short loc_29BF4
loc_29BDC:
	les	bx, dword_4FEF0
	mov	ax, es:[bx]
	mov	dx, es:[bx+2]
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	add	word ptr dword_4FEF0, 4
	jmp	short loc_29C1F
loc_29BF4:
	cmp	word_4FEF8, 0
	jz	short loc_29C0C
	les	bx, dword_4FEF0
	mov	ax, es:[bx]
	mov	[bp+var_4], ax
	mov	[bp+var_2], 0
	jmp	short loc_29C1A
loc_29C0C:
	les	bx, dword_4FEF0
	mov	ax, es:[bx]
	cwd
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
loc_29C1A:
	add	word ptr dword_4FEF0, 2
loc_29C1F:
	cmp	word_4FED4, 0
	jz	short loc_29C34
	mov	ax, [bp+var_4]
	or	ax, [bp+var_2]
	jz	short loc_29C34
	mov	ax, [bp+arg_0]
	jmp	short loc_29C36
align 2
loc_29C34:
	sub	ax, ax
loc_29C36:
	mov	word_50066, ax
	mov	ax, word_4FF02
	mov	dx, word_4FF04
	mov	word ptr [bp+var_E], ax
	mov	word ptr [bp+var_E+2], dx
	cmp	word_4FEF8, 0
	jnz	short loc_29C7E
	cmp	[bp+var_2], 0
	jge	short loc_29C7E
	cmp	[bp+arg_0], 0Ah
	jnz	short loc_29C76
	les	bx, [bp+var_E]
	inc	word ptr [bp+var_E]
	mov	byte ptr es:[bx], 2Dh ;	'-'
	mov	ax, [bp+var_4]
	mov	dx, [bp+var_2]
	neg	ax
	adc	dx, 0
	neg	dx
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
loc_29C76:
	mov	[bp+var_A], 1
	jmp	short loc_29C83
align 2
loc_29C7E:
	mov	[bp+var_A], 0
loc_29C83:
	mov	ax, offset byte_4FEE2
	mov	word ptr [bp+var_8], ax
	mov	word ptr [bp+var_8+2], ds
	push	[bp+arg_0]
	push	ds
	push	ax
	push	[bp+var_2]
	push	[bp+var_4]
	call	sub_2A98A
	add	sp, 0Ah
	cmp	word_4FEF6, 0
	jz	short loc_29CD7
	push	word ptr [bp+var_8+2]
	push	word ptr [bp+var_8]
	call	_strlen
	add	sp, 4
	mov	cx, word_4FEFE
	sub	cx, ax
	mov	[bp+var_10], cx
	les	di, [bp+var_E]
	jmp	short loc_29CC7
loc_29CC2:
	mov	byte ptr es:[di], 30h ;	'0'
	inc	di
loc_29CC7:
	mov	ax, cx
	dec	cx
	or	ax, ax
	jg	short loc_29CC2
	mov	word ptr [bp+var_E], di
	mov	word ptr [bp+var_E+2], es
	mov	[bp+var_10], cx
loc_29CD7:
	mov	cx, word_4FEDC
	mov	[bp+var_12], ds
	lds	si, [bp+var_E]
loc_29CE1:
	les	bx, [bp+var_8]
	mov	al, es:[bx]
	mov	[si], al
	or	cx, cx
	jz	short loc_29CF4
	cmp	al, 61h	
	jl	short loc_29CF4
	sub	byte ptr [si], 20h 
loc_29CF4:
	inc	si
	inc	word ptr [bp+var_8]
	cmp	byte ptr es:[bx], 0
	jnz	short loc_29CE1
	mov	word ptr [bp+var_E], si
	mov	word ptr [bp+var_E+2], ds
	mov	ds, [bp+var_12]
	cmp	word_4FEF8, 0
	jnz	short loc_29D22
	mov	ax, word_4FEE0
	or	ax, word_4FEF4
	jz	short loc_29D22
	cmp	[bp+var_A], 0
	jnz	short loc_29D22
	mov	ax, 1
	jmp	short loc_29D24
loc_29D22:
	sub	ax, ax
loc_29D24:
	push	ax
	push	cs
	call	near ptr sub_2A040
	add	sp, 2
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
sub_29BBC endp

; Attributes: bp-based frame

sub_29D32 proc far

	var_E= dword ptr -0Eh
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	sub	sp, 10h
	push	di
	push	si
	cmp	[bp+arg_0], 0
	jz	short loc_29D58
	mov	si, 1
	mov	ax, word ptr dword_4FEF0
	mov	dx, word ptr dword_4FEF0+2
	mov	[bp+var_8], ax
	mov	[bp+var_6], dx
	add	word ptr dword_4FEF0, 2
	jmp	loc_29DED
loc_29D58:
	cmp	word_4FEDE, 8
	jz	short loc_29D78
	les	bx, dword_4FEF0
	mov	ax, es:[bx]
	mov	dx, es:[bx+2]
	mov	[bp+var_8], ax
	mov	[bp+var_6], dx
	add	word ptr dword_4FEF0, 4
	jmp	short loc_29D8D
align 2
loc_29D78:
	les	bx, dword_4FEF0
	mov	ax, es:[bx]
	mov	[bp+var_4], ax
	mov	[bp+var_8], ax
	mov	[bp+var_6], ds
	add	word ptr dword_4FEF0, 2
loc_29D8D:
	cmp	word_4FEDE, 8
	jz	short loc_29DA2
	mov	ax, [bp+var_8]
	or	ax, [bp+var_6]
	jnz	short loc_29DB1
	mov	ax, offset aNull
	jmp	short loc_29DAB
align 2
loc_29DA2:
	cmp	[bp+var_4], 0
	jnz	short loc_29DB1
	mov	ax, offset aNull_0
loc_29DAB:
	mov	[bp+var_8], ax
	mov	[bp+var_6], ds
loc_29DB1:
	mov	ax, [bp+var_8]
	mov	dx, [bp+var_6]
	mov	word ptr [bp+var_E], ax
	mov	word ptr [bp+var_E+2], dx
	sub	si, si
	cmp	word_4FEF6, si
	jz	short loc_29DE1
	mov	cx, word_4FEFE
	jmp	short loc_29DD9
align 2
loc_29DCC:
	les	bx, [bp+var_E]
	inc	word ptr [bp+var_E]
	cmp	byte ptr es:[bx], 0
	jz	short loc_29DED
	inc	si
loc_29DD9:
	cmp	cx, si
	jle	short loc_29DED
	jmp	short loc_29DCC
align 2
loc_29DE0:
	inc	si
loc_29DE1:
	les	bx, [bp+var_E]
	inc	word ptr [bp+var_E]
	cmp	byte ptr es:[bx], 0
	jnz	short loc_29DE0
loc_29DED:
	mov	di, word_4FF06
	sub	di, si
	cmp	word_4FEEE, 0
	jnz	short loc_29E02
	push	di
	push	cs
	call	near ptr sub_29F5E
	add	sp, 2
loc_29E02:
	push	si
	push	[bp+var_6]
	push	[bp+var_8]
	push	cs
	call	near ptr sub_29FCA
	add	sp, 6
	cmp	word_4FEEE, 0
	jz	short loc_29E1F
	push	di
	push	cs
	call	near ptr sub_29F5E
	add	sp, 2
loc_29E1F:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
sub_29D32 endp

align 2
; Attributes: bp-based frame

sub_29E26 proc far

	var_6= byte ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	sub	sp, 6
	mov	ax, word ptr dword_4FEF0
	mov	dx, word ptr dword_4FEF0+2
	mov	[bp+var_4], ax
	mov	[bp+var_2], dx
	cmp	[bp+arg_0], 67h	
	jz	short loc_29E45
	cmp	[bp+arg_0], 47h	
	jnz	short loc_29E4A
loc_29E45:
	mov	al, 1
	jmp	short loc_29E4C
align 2
loc_29E4A:
	sub	al, al
loc_29E4C:
	mov	[bp+var_6], al
	cmp	word_4FEF6, 0
	jnz	short loc_29E5C
	mov	word_4FEFE, 6
loc_29E5C:
	cmp	[bp+var_6], 0
	jz	short loc_29E6F
	cmp	word_4FEFE, 0
	jnz	short loc_29E6F
	mov	word_4FEFE, 1
loc_29E6F:
	push	word_4FEDC
	push	word_4FEFE
	push	[bp+arg_0]
	push	word_4FF04
	push	word_4FF02
	push	[bp+var_2]
	push	[bp+var_4]
	call	off_4F7E4
	add	sp, 0Eh
	cmp	[bp+var_6], 0
	jz	short loc_29EB5
	cmp	word_4FED4, 0
	jnz	short loc_29EB5
	push	word_4FF04
	push	word_4FF02
	call	off_4F7E8
	add	sp, 4
loc_29EB5:
	cmp	word_4FED4, 0
	jz	short loc_29ED7
	cmp	word_4FEFE, 0
	jnz	short loc_29ED7
	push	word_4FF04
	push	word_4FF02
	call	off_4F7F0
	add	sp, 4
loc_29ED7:
	add	word ptr dword_4FEF0, 8
	mov	word_50066, 0
	mov	ax, word_4FEE0
	or	ax, word_4FEF4
	jz	short loc_29F06
	push	[bp+var_2]
	push	[bp+var_4]
	call	off_4F7F4
	add	sp, 4
	or	ax, ax
	jz	short loc_29F06
	mov	ax, 1
	jmp	short loc_29F08
loc_29F06:
	sub	ax, ax
loc_29F08:
	push	ax
	push	cs
	call	near ptr sub_2A040
	mov	sp, bp
	pop	bp
	retf
sub_29E26 endp

align 2
; Attributes: bp-based frame

sub_29F12 proc far

	arg_0= byte ptr	 6

	push	bp
	mov	bp, sp
	push	si
	cmp	word_4FEFC, 0
	jnz	short loc_29F5A
	les	bx, dword_4FED6
	assume es:nothing
	dec	word ptr es:[bx+4]
	js	short loc_29F3C
	mov	al, [bp+arg_0]
	mov	si, es:[bx]
	inc	word ptr es:[bx]
	mov	es, word ptr es:[bx+2]
	mov	es:[si], al
	sub	ah, ah
	jmp	short loc_29F4C
align 2
loc_29F3C:
	push	word ptr dword_4FED6+2
	push	bx
	push	word ptr [bp+arg_0]
	call	sub_289E0
	add	sp, 6
loc_29F4C:
	inc	ax
	jnz	short loc_29F56
	inc	word_4FEFC
	jmp	short loc_29F5A
align 2
loc_29F56:
	inc	word_4FEFA
loc_29F5A:
	pop	si
	pop	bp
	retf
sub_29F12 endp

align 2
; Attributes: bp-based frame

sub_29F5E proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	sub	sp, 2
	push	di
	push	si
	cmp	word_4FEFC, 0
	jnz	short loc_29FC4
	mov	si, [bp+arg_0]
	or	si, si
	jle	short loc_29FC4
	jmp	short loc_29F91
loc_29F76:
	push	word ptr dword_4FED6+2
	push	word ptr dword_4FED6
	push	word_50068
	call	sub_289E0
	add	sp, 6
loc_29F8A:
	inc	ax
	jnz	short loc_29F91
	inc	word_4FEFC
loc_29F91:
	mov	ax, si
	dec	si
	or	ax, ax
	jle	short loc_29FB6
	les	bx, dword_4FED6
	dec	word ptr es:[bx+4]
	js	short loc_29F76
	mov	al, byte ptr word_50068
	mov	di, es:[bx]
	inc	word ptr es:[bx]
	mov	es, word ptr es:[bx+2]
	mov	es:[di], al
	sub	ah, ah
	jmp	short loc_29F8A
loc_29FB6:
	cmp	word_4FEFC, 0
	jnz	short loc_29FC4
	mov	ax, [bp+arg_0]
	add	word_4FEFA, ax
loc_29FC4:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
sub_29F5E endp

; Attributes: bp-based frame

sub_29FCA proc far

	arg_0= dword ptr  6
	arg_4= word ptr	 0Ah

	push	bp
	mov	bp, sp
	sub	sp, 2
	push	di
	push	si
	mov	si, [bp+arg_4]
	cmp	word_4FEFC, 0
	jnz	short loc_2A03A
	jmp	short loc_2A000
loc_29FDE:
	push	word ptr dword_4FED6+2
	push	word ptr dword_4FED6
	les	bx, [bp+arg_0]
	mov	al, es:[bx]
	cbw
	push	ax
	call	sub_289E0
	add	sp, 6
loc_29FF6:
	inc	ax
	jnz	short loc_29FFD
	inc	word_4FEFC
loc_29FFD:
	inc	word ptr [bp+arg_0]
loc_2A000:
	mov	ax, si
	dec	si
	or	ax, ax
	jz	short loc_2A02C
	les	bx, dword_4FED6
	dec	word ptr es:[bx+4]
	js	short loc_29FDE
	les	bx, [bp+arg_0]
	mov	al, es:[bx]
	les	bx, dword_4FED6
	mov	di, es:[bx]
	inc	word ptr es:[bx]
	mov	es, word ptr es:[bx+2]
	mov	es:[di], al
	sub	ah, ah
	jmp	short loc_29FF6
loc_2A02C:
	cmp	word_4FEFC, 0
	jnz	short loc_2A03A
	mov	ax, [bp+arg_4]
	add	word_4FEFA, ax
loc_2A03A:
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
sub_29FCA endp

; Attributes: bp-based frame

sub_2A040 proc far

	var_C= dword ptr -0Ch
	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	sub	sp, 0Ch
	push	si
	mov	ax, word_4FF02
	mov	dx, word_4FF04
	mov	word ptr [bp+var_C], ax
	mov	word ptr [bp+var_C+2], dx
	sub	ax, ax
	mov	[bp+var_4], ax
	mov	[bp+var_6], ax
	cmp	word_50068, 30h	
	jnz	short loc_2A07B
	cmp	word_4FEF6, ax
	jz	short loc_2A07B
	cmp	word_4FEDA, ax
	jz	short loc_2A075
	cmp	word_4FF00, ax
	jnz	short loc_2A07B
loc_2A075:
	mov	word_50068, 20h	
loc_2A07B:
	mov	si, word_4FF06
	push	word ptr [bp+var_C+2]
	push	word ptr [bp+var_C]
	call	_strlen
	add	sp, 4
	mov	[bp+var_8], ax
	sub	si, ax
	sub	si, [bp+arg_0]
	cmp	word_4FEEE, 0
	jnz	short loc_2A0BE
	les	bx, [bp+var_C]
	cmp	byte ptr es:[bx], 2Dh ;	'-'
	jnz	short loc_2A0BE
	cmp	word_50068, 30h	
	jnz	short loc_2A0BE
	inc	word ptr [bp+var_C]
	mov	al, es:[bx]
	cbw
	push	ax
	push	cs
	call	near ptr sub_29F12
	add	sp, 2
	dec	[bp+var_8]
loc_2A0BE:
	cmp	word_50068, 30h	
	jz	short loc_2A0D0
	or	si, si
	jle	short loc_2A0D0
	cmp	word_4FEEE, 0
	jz	short loc_2A0EB
loc_2A0D0:
	cmp	[bp+arg_0], 0
	jz	short loc_2A0DD
	inc	[bp+var_6]
	push	cs
	call	near ptr sub_2A146
loc_2A0DD:
	cmp	word_50066, 0
	jz	short loc_2A0EB
	inc	[bp+var_4]
	push	cs
	call	near ptr sub_2A15E
loc_2A0EB:
	cmp	word_4FEEE, 0
	jnz	short loc_2A11B
	push	si
	push	cs
	call	near ptr sub_29F5E
	add	sp, 2
	cmp	[bp+arg_0], 0
	jz	short loc_2A10A
	cmp	[bp+var_6], 0
	jnz	short loc_2A10A
	push	cs
	call	near ptr sub_2A146
loc_2A10A:
	cmp	word_50066, 0
	jz	short loc_2A11B
	cmp	[bp+var_4], 0
	jnz	short loc_2A11B
	push	cs
	call	near ptr sub_2A15E
loc_2A11B:
	push	[bp+var_8]
	push	word ptr [bp+var_C+2]
	push	word ptr [bp+var_C]
	push	cs
	call	near ptr sub_29FCA
	add	sp, 6
	cmp	word_4FEEE, 0
	jz	short loc_2A140
	mov	word_50068, 20h	
	push	si
	push	cs
	call	near ptr sub_29F5E
	add	sp, 2
loc_2A140:
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_2A040 endp

align 2

sub_2A146 proc far
	cmp	word_4FEE0, 0
	jz	short loc_2A152
	mov	ax, 2Bh	
	jmp	short loc_2A155
loc_2A152:
	mov	ax, 20h	
loc_2A155:
	push	ax
	push	cs
	call	near ptr sub_29F12
	add	sp, 2
	retf
sub_2A146 endp


sub_2A15E proc far
	mov	ax, 30h	
	push	ax
	push	cs
	call	near ptr sub_29F12
	add	sp, 2
	cmp	word_50066, 10h
	jnz	short locret_2A187
	cmp	word_4FEDC, 0
	jz	short loc_2A17C
	mov	ax, 58h	
	jmp	short loc_2A17F
loc_2A17C:
	mov	ax, 78h	
loc_2A17F:
	push	ax
	push	cs
	call	near ptr sub_29F12
	add	sp, 2
locret_2A187:
	retf
sub_2A15E endp

; Attributes: bp-based frame

sub_2A188 proc far

	var_6= byte ptr	-6
	var_2= word ptr	-2
	arg_0= dword ptr  6
	arg_4= dword ptr  0Ah

	push	bp
	mov	bp, sp
	sub	sp, 6
	push	di
	push	si
	mov	[bp+var_2], 1
	les	bx, [bp+arg_4]
	cmp	byte ptr es:[bx], 2Ah ;	'*'
	jnz	short loc_2A1B0
	les	bx, dword_4FEF0
	mov	si, es:[bx]
	add	word ptr dword_4FEF0, 2
	inc	word ptr [bp+arg_4]
	jmp	short loc_2A210
align 2
loc_2A1B0:
	les	bx, [bp+arg_4]
	cmp	byte ptr es:[bx], 2Dh ;	'-'
	jnz	short loc_2A1C1
	mov	[bp+var_2], 0FFFFh
	inc	word ptr [bp+arg_4]
loc_2A1C1:
	sub	si, si
	mov	bx, word ptr [bp+arg_4]
	mov	al, es:[bx]
	mov	[bp+var_6], al
	cmp	al, 30h	
	jl	short loc_2A210
	cmp	al, 39h	
	jg	short loc_2A210
	cmp	word_4FEF6, si
	jnz	short loc_2A1E4
	cmp	al, 30h	
	jnz	short loc_2A1E4
	mov	word_50068, 30h	
loc_2A1E4:
	mov	di, bx
	jmp	short loc_2A1EE
loc_2A1E8:
	cmp	byte ptr es:[di], 39h ;	'9'
	jg	short loc_2A20A
loc_2A1EE:
	mov	al, es:[di]
	cbw
	mov	cx, si
	shl	cx, 1
	shl	cx, 1
	add	cx, si
	shl	cx, 1
	add	cx, ax
	sub	cx, 30h	
	mov	si, cx
	inc	di
	cmp	byte ptr es:[di], 30h ;	'0'
	jge	short loc_2A1E8
loc_2A20A:
	mov	word ptr [bp+arg_4], di
	mov	word ptr [bp+arg_4+2], es
loc_2A210:
	mov	ax, [bp+var_2]
	imul	si
	mov	si, ax
	les	bx, [bp+arg_0]
	mov	es:[bx], si
	mov	ax, word ptr [bp+arg_4]
	mov	dx, word ptr [bp+arg_4+2]
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf
sub_2A188 endp

align 2
; Attributes: bp-based frame

sub_2A22A proc far

	var_4= dword ptr -4
	arg_0= byte ptr	 6

	push	bp
	mov	bp, sp
	sub	sp, 4
	push	di
	mov	ax, offset asc_4F7C8
	mov	word ptr [bp+var_4], ax
	mov	word ptr [bp+var_4+2], ds
	mov	cl, [bp+arg_0]
	les	di, [bp+var_4]
	jmp	short loc_2A243
loc_2A242:
	inc	di
loc_2A243:
	cmp	byte ptr es:[di], 0
	jz	short loc_2A25A
	cmp	es:[di], cl
	jnz	short loc_2A242
	mov	ax, 1
	mov	word ptr [bp+var_4], di
	mov	word ptr [bp+var_4+2], es
	jmp	short loc_2A262
align 2
loc_2A25A:
	mov	word ptr [bp+var_4], di
	mov	word ptr [bp+var_4+2], es
	sub	ax, ax
loc_2A262:
	pop	di
	mov	sp, bp
	pop	bp
	retf
sub_2A22A endp

align 2
; Attributes: bp-based frame

sscanf_segAdjust proc far

	arg_0= word ptr	 6
	arg_2= dword ptr  8

	push	bp
	mov	bp, sp
	push	si
	mov	si, [bp+arg_0]
	les	bx, [bp+arg_2]
	test	byte ptr es:[bx+0Ah], 1
	jz	short loc_2A27E
	cmp	si, 0FFFFh
	jnz	short loc_2A284
loc_2A27E:
	mov	ax, 0FFFFh
	jmp	short loc_2A2F3
align 2
loc_2A284:
	les	bx, [bp+arg_2]
	mov	ax, es:[bx+6]
	or	ax, es:[bx+8]
	jnz	short loc_2A299
	push	es
	push	bx
	call	sub_28B9E
	add	sp, 4
loc_2A299:
	les	bx, [bp+arg_2]
	mov	ax, es:[bx]
	mov	dx, es:[bx+2]
	cmp	es:[bx+6], ax
	jnz	short loc_2A2B9
	cmp	es:[bx+8], dx
	jnz	short loc_2A2B9
	cmp	word ptr es:[bx+4], 0
	jnz	short loc_2A27E
	inc	word ptr es:[bx]
loc_2A2B9:
	inc	word ptr es:[bx+4]
	dec	word ptr es:[bx]
	les	bx, es:[bx]
	mov	ax, si
	mov	es:[bx], al
	les	bx, [bp+arg_2]
	and	byte ptr es:[bx+0Ah], 0EFh
	test	byte ptr es:[bx+0Ah], 40h
	jnz	short loc_2A2EF
	mov	ax, bx
	sub	ax, offset off_4F64C
	cwd
	mov	cx, 0Ch
	idiv	cx
	mov	bx, ax
	shl	bx, 1
	add	bx, ax
	shl	bx, 1
	or	byte_4F73C[bx], 4
loc_2A2EF:
	mov	ax, si
	sub	ah, ah
loc_2A2F3:
	pop	si
	pop	bp
	retf
sscanf_segAdjust endp

; Attributes: bp-based frame

sub_2A2F6 proc far

	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_2= word ptr	 6
	arg_4= word ptr	 8
	arg_6= word ptr	 0Ah
	arg_8= word ptr	 0Ch

; FUNCTION CHUNK AT 13D5 SIZE 0000000D BYTES
	push	bp
	mov	bp, sp
	sub	sp, 4
	mov	bx, [bp+arg_2]
	cmp	bx, word_4EFFA
	jb	short loc_2A30A
	mov	ax, 900h
	jmp	short loc_2A334
loc_2A30A:
	test	[bp+arg_6], 8000h
	jz	short loc_2A359
	cmp	[bp+arg_8], 0
	jz	short loc_2A331
	xor	cx, cx
	mov	dx, cx
	mov	ax, 4201h
	int	21h		; DOS -	2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
			; AL = method: offset from present location
	jb	short loc_2A36D
	test	[bp+arg_8], 2
	jnz	short loc_2A337
	add	ax, [bp+arg_4]
	adc	dx, [bp+arg_6]
	jns	short loc_2A359
loc_2A331:
	mov	ax, 1600h
loc_2A334:
	stc
	jmp	short loc_2A36D
loc_2A337:
	mov	[bp+var_2], dx
	mov	[bp+var_4], ax
	mov	dx, cx
	mov	ax, 4202h
	int	21h		; DOS -	2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
			; AL = method: offset from end of file
	add	ax, [bp+arg_4]
	adc	dx, [bp+arg_6]
	jns	short loc_2A359
	mov	cx, [bp+var_2]
	mov	dx, [bp+var_4]
	mov	ax, 4200h
	int	21h		; DOS -	2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
			; AL = method: offset from beginning of	file
	jmp	short loc_2A331
loc_2A359:
	mov	dx, [bp+arg_4]
	mov	cx, [bp+arg_6]
	mov	al, byte ptr [bp+arg_8]
	mov	ah, 42h
	int	21h		; DOS -	2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
			; AL = method:
			; 0-from beginnig,1-from current,2-from	end
	jb	short loc_2A36D
	and	byte_4EFFC[bx], 0FDh
loc_2A36D:
	jmp	loc_28805
sub_2A2F6 endp

; Attributes: bp-based frame

sub_2A370 proc far

	var_1= word ptr	-1
	arg_2= word ptr	 6
	arg_4= dword ptr  8
	arg_8= word ptr	 0Ch

	push	bp
	mov	bp, sp
	sub	sp, 2
	mov	bx, [bp+arg_2]
	cmp	bx, word_4EFFA
	jb	short loc_2A385
	stc
	mov	ax, 900h
	jmp	short loc_2A3EC
loc_2A385:
	xor	ax, ax
	mov	cx, [bp+arg_8]
	jcxz	short loc_2A3EC
	test	byte_4EFFC[bx],	2
	jnz	short loc_2A3EC
	mov	cx, [bp+arg_8]
	push	ds
	lds	dx, [bp+arg_4]
	mov	ah, 3Fh
	int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
			; BX = file handle, CX = number	of bytes to read
			; DS:DX	-> buffer
	pop	ds
	jnb	short loc_2A3A5
	mov	ah, 9
	jmp	short loc_2A3EC
loc_2A3A5:
	test	byte_4EFFC[bx],	80h
	jz	short loc_2A3EC
	and	byte_4EFFC[bx],	0FBh
	push	si
	push	di
	push	ds
	pop	es
	assume es:dseg
	mov	ds, word ptr [bp+arg_4+2]
	cld
	mov	si, dx
	mov	di, dx
	mov	cx, ax
	jcxz	short loc_2A3E8
	mov	ah, 0Dh
	cmp	byte ptr [si], 0Ah
	jnz	short loc_2A3CE
	or	es:byte_4EFFC[bx], 4
loc_2A3CE:
	lodsb
	cmp	al, ah
	jz	short loc_2A3EF
	cmp	al, 1Ah
	jnz	short loc_2A3DF
	or	es:byte_4EFFC[bx],	2
	jmp	short loc_2A3E4
loc_2A3DF:
	mov	[di], al
	inc	di
loc_2A3E2:
	loop	loc_2A3CE
loc_2A3E4:
	mov	ax, di
	sub	ax, dx
loc_2A3E8:
	push	es
	pop	ds
loc_2A3EA:
	pop	di
	pop	si
loc_2A3EC:
	jmp	loc_28805
loc_2A3EF:
	cmp	cx, 1
	jz	short loc_2A3FB
	cmp	byte ptr [si], 0Ah
	jz	short loc_2A3E2
	jmp	short loc_2A3DF
loc_2A3FB:
	push	es
	pop	ds
	test	byte_4EFFC[bx],	40h
	jz	short loc_2A41C
	mov	ax, 4400h
	int	21h		; DOS -	2+ - IOCTL - GET DEVICE	INFORMATION
			; BX = file or device handle
	test	dx, 20h
	jnz	short loc_2A418
	lea	dx, [bp-1]
	mov	ah, 3Fh
	int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
			; BX = file handle, CX = number	of bytes to read
			; DS:DX	-> buffer
	jb	short loc_2A3EA
loc_2A418:
	mov	al, 0Ah
	jmp	short loc_2A448
loc_2A41C:
	mov	byte ptr [bp+var_1], 0
	lea	dx, [bp+var_1]
	mov	ah, 3Fh
	int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
			; BX = file handle, CX = number	of bytes to read
			; DS:DX	-> buffer
	jb	short loc_2A3EA
	or	ax, ax
	jz	short loc_2A446
	cmp	[bp+arg_8], 1
	jz	short loc_2A452
loc_2A433:
	mov	cx, 0FFFFh
	mov	dx, cx
	mov	ax, 4201h
	int	21h		; DOS -	2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
			; AL = method: offset from present location
	mov	cx, 1
	cmp	byte ptr [bp+var_1], 0Ah
	jz	short loc_2A44D
loc_2A446:
	mov	al, 0Dh
loc_2A448:
	lds	dx, [bp+arg_4]
	jmp	short loc_2A3DF
loc_2A44D:
	lds	dx, [bp+arg_4]
	jmp	short loc_2A3E2
loc_2A452:
	cmp	byte ptr [bp+var_1], 0Ah
	jnz	short loc_2A433
	jmp	short loc_2A418
sub_2A370 endp

; Attributes: bp-based frame

sub_2A45A proc far

	var_8= word ptr	-8
	var_6= word ptr	-6
	var_4= word ptr	-4
	var_2= word ptr	-2
	arg_2= word ptr	 6
	arg_4= word ptr	 0Ah
	arg_6= word ptr	 0Ch

; FUNCTION CHUNK AT 313A SIZE 00000039 BYTES
	push	bp
	mov	bp, sp
	sub	sp, 8
	mov	bx, [bp+arg_2]
	cmp	bx, word_4EFFA
	jb	short loc_2A470
	mov	ax, 900h
	stc
loc_2A46D:
	jmp	loc_28805
loc_2A470:
	test	byte_4EFFC[bx], 20h
	jz	short loc_2A482
	mov	ax, 4202h
	xor	cx, cx
	mov	dx, cx
	int	21h		; DOS -	2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
			; AL = method: offset from end of file
	jb	short loc_2A46D
loc_2A482:
	test	byte_4EFFC[bx], 80h
	jz	short loc_2A505
	mov	[bp+var_6], ds
	mov	es, [bp+arg_4]
	assume es:nothing
	lds	dx, [bp+8]
	xor	ax, ax
	mov	[bp+var_2], ax
	mov	[bp+var_4], ax
	cld
	push	di
	push	si
	mov	di, dx
	mov	si, dx
	mov	[bp+var_8], sp
	mov	cx, [bp+arg_6]
	jcxz	short loc_2A507
	mov	al, 0Ah
	repne scasb
	jnz	short loc_2A500
	push	ds
	mov	ds, [bp+var_6]
	call	sub_2A5A4
	pop	ds
	cmp	ax, 0A8h 
	jbe	short loc_2A509
	sub	sp, 2
	mov	bx, sp
	mov	dx, 200h
	cmp	ax, 228h
	jnb	short loc_2A4CE
	mov	dx, 80h
loc_2A4CE:
	sub	sp, dx
	mov	dx, sp
	mov	di, dx
	push	ss
	pop	es
	assume es:dseg
	mov	cx, [bp+arg_6]
loc_2A4D9:
	lodsb
	cmp	al, 0Ah
	jz	short loc_2A4EA
loc_2A4DE:
	cmp	di, bx
	jz	short loc_2A4FB
loc_2A4E2:
	stosb
	loop	loc_2A4D9
	call	near ptr sub_2A50E
	jmp	short loc_2A559
loc_2A4EA:
	mov	al, 0Dh
	cmp	di, bx
	jnz	short loc_2A4F3
	call	near ptr sub_2A50E
loc_2A4F3:
	stosb
	mov	al, 0Ah
	inc	[bp+var_4]
	jmp	short loc_2A4DE
loc_2A4FB:
	call	near ptr sub_2A50E
	jmp	short loc_2A4E2
loc_2A500:
	pop	si
	pop	di
	mov	ds, [bp+var_6]
loc_2A505:
	jmp	short loc_2A56A
loc_2A507:
	jmp	short loc_2A559
loc_2A509:
	xor	ax, ax
	jmp	loc_2834B
sub_2A45A endp


sub_2A50E proc far
	push	ax
	push	bx
	push	cx
	push	ds
	push	es
	pop	ds
	mov	cx, di
	sub	cx, dx
	jcxz	short loc_2A52A
	mov	bx, [bp+6]
	mov	ah, 40h
	int	21h		; DOS -	2+ - WRITE TO FILE WITH	HANDLE
			; BX = file handle, CX = number	of bytes to write, DS:DX -> buffer
	jb	short loc_2A531
	add	[bp-2],	ax
	or	ax, ax
	jz	short loc_2A531
loc_2A52A:
	pop	ds
	pop	cx
	pop	bx
	pop	ax
	mov	di, dx
	retn
loc_2A531:
	pop	ds
	add	sp, 8
	jnb	short loc_2A53B
	mov	ah, 9
	jmp	short loc_2A55F
loc_2A53B:
	mov	ds, word ptr [bp-2]
	test	byte_4EFFC[bx], 40h
	jz	short loc_2A553
	mov	ds, word ptr [bp+0Ah]
	mov	bx, [bp+8]
	cmp	byte ptr [bx], 1Ah
	jnz	short loc_2A553
	clc
	jmp	short loc_2A55F
loc_2A553:
	stc
	mov	ax, 1C00h
	jmp	short loc_2A55F
loc_2A559::
	mov	ax, [bp-2]
	sub	ax, [bp-4]
loc_2A55F:
	mov	sp, [bp-8]
	pop	si
	pop	di
	mov	ds, word ptr [bp-6]
loc_2A567::
	jmp	loc_28805
sub_2A50E endp

; START	OF FUNCTION CHUNK FOR sub_2A45A
loc_2A56A:
	mov	cx, [bp+arg_6]
	or	cx, cx
	jnz	short loc_2A576
	mov	ax, cx
	jmp	loc_28805
loc_2A576:
	push	ds
	lds	dx, [bp+8]
	mov	ah, 40h
	int	21h		; DOS -	2+ - WRITE TO FILE WITH	HANDLE
			; BX = file handle, CX = number	of bytes to write, DS:DX -> buffer
	push	ds
	pop	es
	pop	ds
	jnb	short loc_2A587
	mov	ah, 9
	jmp	short loc_2A567
loc_2A587:
	or	ax, ax
	jnz	short loc_2A567
	test	byte_4EFFC[bx], 40h
	jz	short loc_2A59D
	mov	bx, dx
	cmp	byte ptr es:[bx], 1Ah
	jnz	short loc_2A59D
	clc
	jmp	short loc_2A567
loc_2A59D:
	stc
	mov	ax, 1C00h
	jmp	short loc_2A567
; END OF FUNCTION CHUNK	FOR sub_2A45A
align 2

sub_2A5A4 proc far
	pop	cx
	pop	dx
	mov	ax, word_4F030
	cmp	ax, sp
	jnb	short loc_2A5B4
	sub	ax, sp
	neg	ax
loc_2A5B1:
	push	dx
	push	cx
	retf
loc_2A5B4:
	xor	ax, ax
	jmp	short loc_2A5B1
sub_2A5A4 endp

	push	bp
	mov	bp, sp
	mov	bx, [bp+6]
	or	bx, bx
	jz	short loc_2A5C6
	or	byte ptr [bx-2], 1
loc_2A5C6:
	mov	sp, bp
	pop	bp
	retf
; Attributes: bp-based frame

sub_2A5CA proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	push	si
	push	di
	mov	bx, offset word_4F7CE
	cmp	word ptr [bx], 0
	jnz	short loc_2A600
	push	ds
	pop	es
	mov	ax, 5
	call	sub_2A82C
	jnz	short loc_2A5E6
	xor	ax, ax
	cwd
	jmp	short loc_2A60A
loc_2A5E6:
	inc	ax
	and	al, 0FEh
	mov	word_4F7CE, ax
	mov	word_4F7D0, ax
	xchg	ax, si
	mov	word ptr [si], 1
	add	si, 4
	mov	word ptr [si-2], 0FFFEh
	mov	word_4F7D4, si
loc_2A600:
	mov	cx, [bp+arg_0]
	mov	ax, ds
	mov	es, ax
	call	sub_2A6ED
loc_2A60A:
	pop	di
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_2A5CA endp

; Attributes: bp-based frame
_freeMaybe proc	far

	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	les	bx, [bp+arg_0]
	assume es:nothing
	mov	ax, es
	or	ax, bx
	jz	short loc_2A621
	or	byte ptr es:[bx-2], 1
loc_2A621:
	mov	sp, bp
	pop	bp
	retf
_freeMaybe endp

; Attributes: bp-based frame

_mallocMaybe proc far

	arg_0= word ptr	 6

	push	bp
	mov	bp, sp
	sub	sp, 2
	push	si
	push	di
	mov	ax, [bp+arg_0]
	cmp	ax, 0FFF1h
	jnb	short loc_2A653
	cmp	word_4F7D8, 0
	jnz	short loc_2A644
	call	sub_2A664
	jz	short loc_2A653
	mov	word_4F7D8, ax
loc_2A644:
	call	sub_2A6D2
	jnz	short loc_2A65E
	call	sub_2A664
	jz	short loc_2A653
	call	sub_2A6D2
	jnz	short loc_2A65E
loc_2A653:
	push	[bp+arg_0]
	call	sub_2A5CA
	add	sp, 2
loc_2A65E:
	pop	di
	pop	si
	mov	sp, bp
	pop	bp
	retf
_mallocMaybe endp

sub_2A664 proc near
	mov	bx, 0F0h 
	cmp	[bp+6],	bx
	jbe	short loc_2A673
	mov	bx, [bp+6]
	inc	bx
	and	bx, 0FFFEh
loc_2A673:
	mov	[bp-2],	bx
	xor	ax, ax
	push	ds
	push	ax
	push	ax
	lea	cx, [bx+0Eh]
	push	cx
	mov	al, 2
	push	ax
	call	sub_2A84E
	add	sp, 8
	cmp	dx, 0FFFFh
	jz	short loc_2A6D0
	mov	ax, dx
	xchg	dx, word_4F7DA
	mov	word_4F7DC, ax
	cmp	ax, word_4F7E0
	jbe	short loc_2A6A1
	mov	word_4F7E0, ax
loc_2A6A1:
	or	dx, dx
	jz	short loc_2A6AA
	mov	ds, dx
	assume ds:nothing
	mov	ds:8,	ax
loc_2A6AA:
	mov	bx, [bp-2]
	mov	ds, ax
	assume ds:nothing
	xor	ax, ax
	mov	ds:8,	ax
	dec	ax
	dec	ax
	mov	[bx+0Ch], ax
	mov	ax, 0Ah
	mov	ds:0, ax
	mov	ds:2, ax
	lea	ax, [bx+1]
	mov	ds:0Ah, ax
	add	ax, 0Dh
	mov	ds:6, ax
	mov	ax, ds
loc_2A6D0:
	pop	ds
	retn
sub_2A664 endp

sub_2A6D2 proc near
	mov	ax, ds
	mov	es, ax
	assume es:dseg
	mov	cx, [bp+6]
	xor	bx, bx
	mov	ds, word_4F7DC
	call	sub_2A6ED
	or	dx, dx
	mov	cx, es
	mov	ds, cx
	retn
sub_2A6D2 endp

align 2
; START	OF FUNCTION CHUNK FOR sub_2A6ED
loc_2A6EA:
	jmp	loc_2A7BB
; END OF FUNCTION CHUNK	FOR sub_2A6ED
sub_2A6ED proc near
; FUNCTION CHUNK AT 32BA SIZE 00000003 BYTES
	inc	cx
	jz	short loc_2A6EA
	and	cl, 0FEh
	cmp	cx, 0FFEEh
	jnb	short loc_2A6EA
	mov	si, [bx+2]
	cld
	lodsw
	mov	di, si
	test	al, 1
	jz	short loc_2A745
loc_2A703:
	dec	ax
	cmp	ax, cx
	jnb	short loc_2A71D
	mov	dx, ax
	add	si, ax
	lodsw
	test	al, 1
	jz	short loc_2A745
	add	ax, dx
	add	ax, 2
	mov	si, di
	mov	[si-2],	ax
	jmp	short loc_2A703
loc_2A71D:
	mov	di, si
	jz	short loc_2A72D
	add	di, cx
	mov	[si-2],	cx
	sub	ax, cx
	dec	ax
	mov	[di], ax
	jmp	short loc_2A732
loc_2A72D:
	add	di, cx
	dec	byte ptr [si-2]
loc_2A732:
	mov	ax, si
	mov	dx, ds
	mov	cx, ss
	cmp	dx, cx
	jz	short loc_2A741
	mov	es:word_4F7DC, ds
loc_2A741:
	mov	[bx+2],	di
	retn
loc_2A745:
	mov	es:byte_4F7E2, 2
loc_2A74B:
	cmp	ax, 0FFFEh
	jz	short loc_2A775
	mov	di, si
	add	si, ax
loc_2A754:
	lodsw
	test	al, 1
	jz	short loc_2A74B
	mov	di, si
loc_2A75B:
	dec	ax
	cmp	ax, cx
	jnb	short loc_2A71D
	mov	dx, ax
	add	si, ax
	lodsw
	test	al, 1
	jz	short loc_2A74B
	add	ax, dx
	add	ax, 2
	mov	si, di
	mov	[si-2],	ax
	jmp	short loc_2A75B
loc_2A775:
	mov	ax, [bx+8]
	or	ax, ax
	jz	short loc_2A780
	mov	ds, ax
	jmp	short loc_2A794
loc_2A780:
	dec	es:byte_4F7E2
	jz	short loc_2A798
	mov	ax, ds
	mov	di, ss
	cmp	ax, di
	jz	short loc_2A794
	mov	ds, es:word_4F7D8
loc_2A794:
	mov	si, [bx]
	jmp	short loc_2A754
loc_2A798:
	mov	si, [bx+6]
	xor	ax, ax
	call	sub_2A80A
	cmp	ax, si
	jz	short loc_2A7B1
	and	al, 1
	inc	ax
	inc	ax
	cbw
	call	sub_2A80A
	jz	short loc_2A7BB
	dec	byte ptr [di-2]
loc_2A7B1:
	call	sub_2A7D0
	jz	short loc_2A7BB
	xchg	ax, si
	dec	si
	dec	si
	jmp	short loc_2A754
loc_2A7BB::
	mov	ax, ds
	mov	cx, ss
	cmp	ax, cx
	jz	short loc_2A7C7
	mov	es:word_4F7DC, ax
loc_2A7C7:
	mov	ax, [bx]
	mov	[bx+2],	ax
	xor	ax, ax
	cwd
	retn
sub_2A6ED endp

sub_2A7D0 proc near
	push	cx
	mov	ax, [di-2]
	test	al, 1
	jz	short loc_2A7DB
	sub	cx, ax
	dec	cx
loc_2A7DB:
	inc	cx
	inc	cx
	mov	dx, 7FFFh
loc_2A7E0:
	cmp	dx, es:word_4F7DE
	jbe	short loc_2A7EB
	shr	dx, 1
	jnz	short loc_2A7E0
loc_2A7EB:
	mov	ax, cx
	add	ax, si
	jb	short loc_2A806
	add	ax, dx
	jb	short loc_2A802
	not	dx
	and	ax, dx
	sub	ax, si
	call	sub_2A80A
	jnz	short loc_2A808
	not	dx
loc_2A802:
	shr	dx, 1
	jnz	short loc_2A7EB
loc_2A806:
	xor	ax, ax
loc_2A808:
	pop	cx
	retn
sub_2A7D0 endp

sub_2A80A proc near
	push	dx
	push	cx
	call	sub_2A82C
	jz	short loc_2A829
	push	di
	mov	di, si
	mov	si, ax
	add	si, dx
	mov	word ptr [si-2], 0FFFEh
	mov	[bx+6],	si
	mov	dx, si
	sub	dx, di
	dec	dx
	mov	[di-2],	dx
	pop	ax
loc_2A829:
	pop	cx
	pop	dx
	retn
sub_2A80A endp

sub_2A82C proc near
	push	bx
	push	ax
	xor	dx, dx
	push	ds
	push	dx
	push	dx
	push	ax
	mov	ax, 1
	push	ax
	push	es
	pop	ds
	call	sub_2A84E
	add	sp, 8
	cmp	dx, 0FFFFh
	pop	ds
	pop	dx
	pop	bx
	jz	short locret_2A84C
	or	dx, dx
locret_2A84C:
	retn
sub_2A82C endp

align 2
; Attributes: bp-based frame

sub_2A84E proc far

	arg_0= word ptr	 6
	arg_2= word ptr	 8
	arg_4= word ptr	 0Ah
	arg_8= word ptr	 0Eh

	push	bp
	mov	bp, sp
	push	si
	push	di
	push	es
	cmp	[bp+arg_4], 0
	jnz	short loc_2A892
	mov	di, offset word_4EF82
	mov	dx, [bp+arg_2]
	mov	ax, [bp+arg_0]
	dec	ax
	jnz	short loc_2A86D
	call	sub_2A8BC
	jb	short loc_2A892
	jmp	short loc_2A8B5
loc_2A86D:
	mov	si, off_4EFD2
	dec	ax
	jz	short loc_2A885
	cmp	si, di
	jz	short loc_2A885
	mov	ax, [si+2]
	mov	[bp+arg_8], ax
	push	si
	call	sub_2A8BC
	pop	si
	jnb	short loc_2A8B5
loc_2A885:
	add	si, 4
	cmp	si, offset off_4EFD2
	jnb	short loc_2A892
	or	dx, dx
	jnz	short loc_2A898
loc_2A892:
	mov	ax, 0FFFFh
	cwd
	jmp	short loc_2A8B5
loc_2A898:
	mov	bx, dx
	add	bx, 0Fh
	rcr	bx, 1
	mov	cl, 3
	shr	bx, cl
	mov	ah, 48h
	int	21h		; DOS -	2+ - ALLOCATE MEMORY
			; BX = number of 16-byte paragraphs desired
	jb	short loc_2A892
	xchg	ax, dx
	mov	[si], ax
	mov	[si+2],	dx
	mov	off_4EFD2, si
	xor	ax, ax
loc_2A8B5:
	pop	es
	assume es:nothing
	pop	di
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_2A84E endp

sub_2A8BC proc near
	mov	cx, [bp+0Eh]
	mov	si, di
loc_2A8C1:
	cmp	[si+2],	cx
	jz	short loc_2A8D2
	add	si, 4
	cmp	si, off_4EFD2
	jnz	short loc_2A8C1
	stc
	jmp	short locret_2A911
loc_2A8D2:
	mov	bx, dx
	add	bx, [si]
	jb	short locret_2A911
	mov	dx, bx
	mov	es, cx
	cmp	si, di
	jnz	short loc_2A8E6
	cmp	word_4EF7C, bx
	jnb	short loc_2A90C
loc_2A8E6:
	add	bx, 0Fh
	rcr	bx, 1
	shr	bx, 1
	shr	bx, 1
	shr	bx, 1
	cmp	si, di
	jnz	short loc_2A8FE
	add	bx, cx
	mov	ax, word_4EFF3
	sub	bx, ax
	mov	es, ax
loc_2A8FE:
	mov	ah, 4Ah
	int	21h		; DOS -	2+ - ADJUST MEMORY BLOCK SIZE (SETBLOCK)
			; ES = segment address of block	to change
			; BX = new size	in paragraphs
	jb	short locret_2A911
	cmp	si, di
	jnz	short loc_2A90C
	mov	word_4EF7C, dx
loc_2A90C:
	xchg	ax, dx
	xchg	ax, [si]
	mov	dx, cx
locret_2A911:
	retn
sub_2A8BC endp

; Attributes: bp-based frame

sub_2A912 proc far

	arg_0= dword ptr  6
	arg_4= dword ptr  0Ah

	push	bp
	mov	bp, sp
	mov	dx, di
	mov	bx, si
	push	ds
	lds	si, [bp+arg_4]
	mov	di, si
	mov	ax, ds
	mov	es, ax
	assume es:dseg
	xor	ax, ax
	mov	cx, 0FFFFh
	repne scasb
	not	cx
	les	di, [bp+arg_0]
	assume es:nothing
	mov	ax, di
	test	al, 1
	jz	short loc_2A937
	movsb
	dec	cx
loc_2A937:
	shr	cx, 1
	rep movsw
	adc	cx, cx
	rep movsb
	mov	si, bx
	mov	di, dx
	pop	ds
	mov	dx, es
	pop	bp
	retf
sub_2A912 endp

; Attributes: bp-based frame

_strcmp	proc far

	arg_0= dword ptr  6
	arg_4= dword ptr  0Ah

	push	bp
	mov	bp, sp
	mov	dx, di
	mov	bx, si
	push	ds
	lds	si, [bp+arg_0]
	les	di, [bp+arg_4]
	xor	ax, ax
	mov	cx, 0FFFFh
	repne scasb
	not	cx
	sub	di, cx
	repe cmpsb
	jz	short loc_2A96A
	sbb	ax, ax
	sbb	ax, 0FFFFh
loc_2A96A:
	pop	ds
	mov	si, bx
	mov	di, dx
	pop	bp
	retf
_strcmp	endp

align 2
; Attributes: bp-based frame

_strlen	proc far

	arg_0= dword ptr  6

	push	bp
	mov	bp, sp
	mov	dx, di
	les	di, [bp+arg_0]
	xor	ax, ax
	mov	cx, 0FFFFh
	repne scasb
	not	cx
	dec	cx
	xchg	ax, cx
	mov	di, dx
	pop	bp
	retf
_strlen	endp

align 2
; Attributes: bp-based frame
; Attributes: bp-based frame

_str_capitalize	proc far
arg_0= word ptr	 6
	push	bp
	mov	bp, sp
	mov	bx, [bp+arg_0]
	test	sscanf_charFlags[bx],	2
	jz	short loc_2A9A8
	mov	ax, bx
	sub	ax, 20h	
	jmp	short loc_2A9AA
loc_2A9A8:
	mov	ax, bx
loc_2A9AA:
	pop	bp
	retf
_str_capitalize	endp

; Attributes: bp-based frame

sub_2A9AC proc far
arg_0= word ptr	 6
	push	bp
	mov	bp, sp
	mov	bx, [bp+arg_0]
	cmp	bx, word_4EFFA
	jge	short loc_2A9C9
	cmp	bx, 0
	jl	short loc_2A9C9
	test	byte_4EFFC[bx],	40h
	jz	short loc_2A9C9
	mov	ax, 1
	jmp	short loc_2A9CB
loc_2A9C9:
	xor	ax, ax
loc_2A9CB:
	mov	sp, bp
	pop	bp
	retf
sub_2A9AC endp

align 2
	mov	dh, 1
	jmp	short loc_2A9D6

sub_2A9D4 proc far
	mov	dh, 8
loc_2A9D6::
	mov	ax, word_4F900
	or	ah, ah
	jnz	short loc_2A9E5
	mov	word_4F900, 0FFFFh
	jmp	short locret_2A9EA
loc_2A9E5:
	xchg	ax, dx
	int	21h		; DOS -
	mov	ah, 0
locret_2A9EA:
	retf
sub_2A9D4 endp

align 2
; Attributes: bp-based frame

sscanf proc far
var_14=	word ptr -14h
var_8= dword ptr -8
var_4= word ptr	-4
var_2= word ptr	-2
arg_0= word ptr	 6
arg_2= word ptr	 8
arg_4= word ptr	 0Ah
arg_6= word ptr	 0Ch
arg_8= word ptr	 0Eh
	push	bp
	mov	bp, sp
	sub	sp, 14h
	lea	ax, [bp+var_14]
	mov	word ptr [bp+var_8], ax
	mov	word ptr [bp+var_8+2], ss
	lea	ax, [bp+arg_8]
	mov	[bp+var_4], ax
	mov	[bp+var_2], ss
	les	bx, [bp+var_8]
	mov	byte ptr es:[bx+0Ah], 49h 
	mov	ax, [bp+arg_0]
	mov	dx, [bp+arg_2]
	mov	es:[bx+6], ax
	mov	es:[bx+8], dx
	mov	es:[bx], ax
	mov	es:[bx+2], dx
	push	dx
	push	ax
	call	_strlen
	add	sp, 4
	les	bx, [bp+var_8]
	mov	es:[bx+4], ax
	push	[bp+var_2]
	push	[bp+var_4]
	push	[bp+arg_6]
	push	[bp+arg_4]
	push	es
	push	bx
	call	_sscanf
	mov	sp, bp
	pop	bp
	retf
sscanf endp

align 2
; Attributes: bp-based frame

_memcpy	proc far
arg_0= dword ptr  6
arg_4= dword ptr  0Ah
arg_8= word ptr	 0Eh
	push	bp
	mov	bp, sp
	mov	cx, [bp+arg_8]
	jcxz	short loc_2AAA0
	push	ds
	push	di
	push	si
	lds	si, [bp+arg_4]
	les	di, [bp+arg_0]
loc_2AA5B:
	mov	ax, cx
	dec	ax
	mov	dx, di
	not	dx
	sub	ax, dx
	sbb	bx, bx
	and	ax, bx
	add	ax, dx
	mov	dx, si
	not	dx
	sub	ax, dx
	sbb	bx, bx
	and	ax, bx
	add	ax, dx
	inc	ax
	xchg	ax, cx
	sub	ax, cx
	shr	cx, 1
	rep movsw
	adc	cx, cx
	rep movsb
	xchg	ax, cx
	jcxz	short loc_2AA9D
	or	si, si
	jnz	short loc_2AA90
	mov	ax, ds
	add	ax, 1000h
	mov	ds, ax
	assume ds:nothing
loc_2AA90:
	or	di, di
	jnz	short loc_2AA5B
	mov	ax, es
	add	ax, 1000h
	mov	es, ax
	assume es:nothing
	jmp	short loc_2AA5B
loc_2AA9D:
	pop	si
	pop	di
	pop	ds
	assume ds:dseg
loc_2AAA0:
	mov	ax, word ptr [bp+arg_0]
	mov	dx, word ptr [bp+arg_0+2]
	pop	bp
	retf
_memcpy	endp

; Attributes: bp-based frame

_memset	proc far
_ptr= dword ptr	 6
_c= word ptr  0Ah
_size= word ptr	 0Ch
	push	bp
	mov	bp, sp
	mov	cx, [bp+_size]
	jcxz	short loc_2AAE8
	push	di
	les	di, [bp+_ptr]
	assume es:nothing
	mov	dx, di
	neg	dx
	jz	short loc_2AAC6
	sub	dx, cx
	sbb	bx, bx
	and	dx, bx
	add	dx, cx
	xchg	dx, cx
	sub	dx, cx
loc_2AAC6:
	mov	ax, [bp+_c]
	mov	ah, al
	shr	cx, 1
	rep stosw
	adc	cx, cx
	rep stosb
	xchg	dx, cx
	jcxz	short loc_2AAE7
	mov	bx, es
	add	bx, 1000h
	mov	es, bx
	assume es:nothing
	shr	cx, 1
	rep stosw
	adc	cx, cx
	rep stosb
loc_2AAE7:
	pop	di
loc_2AAE8:
	mov	ax, word ptr [bp+_ptr]
	mov	dx, word ptr [bp+_ptr+2]
	pop	bp
	retf
_memset	endp

; START	OF FUNCTION CHUNK FOR sub_2A98A

sub_2A98A proc far
arg_2= word ptr	 6
arg_4= word ptr	 8
arg_6= dword ptr  0Ah
arg_A= word ptr	 0Eh
; FUNCTION CHUNK AT 36C0 SIZE 00000063 BYTES
	push	bp
	mov	bp, sp
	push	si
	push	di
	mov	bl, 0
	jmp	loc_2AAF0
loc_2AAF0:
	mov	cx, [bp+arg_A]
	mov	ax, [bp+arg_2]
	mov	dx, [bp+arg_4]
	push	ds
	lds	di, [bp+arg_6]
	push	di
	push	ds
	pop	es
	assume es:dseg
	cld
	xchg	ax, bx
	or	al, al
	jz	short loc_2AB19
	cmp	cx, 0Ah
	jnz	short loc_2AB19
	or	dx, dx
	jns	short loc_2AB19
	mov	al, 2Dh	
	stosb
	neg	bx
	adc	dx, 0
	neg	dx
loc_2AB19:
	mov	si, di
loc_2AB1B:
	xchg	ax, dx
	xor	dx, dx
	or	ax, ax
	jz	short loc_2AB24
	div	cx
loc_2AB24:
	xchg	ax, bx
	div	cx
	xchg	ax, dx
	xchg	dx, bx
	add	al, 30h	
	cmp	al, 39h	
	jbe	short loc_2AB32
	add	al, 27h	
loc_2AB32:
	stosb
	mov	ax, dx
	or	ax, bx
	jnz	short loc_2AB1B
	mov	[di], al
loc_2AB3B:
	dec	di
	lodsb
	xchg	al, [di]
	mov	[si-1],	al
	lea	ax, [si+1]
	cmp	ax, di
	jb	short loc_2AB3B
	mov	dx, ds
	pop	ax
	pop	ds
	pop	di
	pop	si
	mov	sp, bp
	pop	bp
	retf
sub_2A98A endp

; END OF FUNCTION CHUNK	FOR sub_2A98A
align 2
; Attributes: bp-based frame

__32bitDivide proc far
arg_0= word ptr	 6
arg_2= word ptr	 8
arg_4= word ptr	 0Ah
arg_6= word ptr	 0Ch
	push	bp
	mov	bp, sp
	push	di
	push	si
	push	bx
	xor	di, di
	mov	ax, [bp+arg_2]
	or	ax, ax
	jge	short loc_2AB74
	inc	di
	mov	dx, [bp+arg_0]
	neg	ax
	neg	dx
	sbb	ax, 0
	mov	[bp+arg_2], ax
	mov	[bp+arg_0], dx
loc_2AB74:
	mov	ax, [bp+arg_6]
	or	ax, ax
	jge	short loc_2AB8C
	inc	di
	mov	dx, [bp+arg_4]
	neg	ax
	neg	dx
	sbb	ax, 0
	mov	[bp+arg_6], ax
	mov	[bp+arg_4], dx
loc_2AB8C:
	or	ax, ax
	jnz	short loc_2ABA5
	mov	cx, [bp+arg_4]
	mov	ax, [bp+arg_2]
	xor	dx, dx
	div	cx
	mov	bx, ax
	mov	ax, [bp+arg_0]
	div	cx
	mov	dx, bx
	jmp	short loc_2ABDD
loc_2ABA5:
	mov	bx, ax
	mov	cx, [bp+arg_4]
	mov	dx, [bp+arg_2]
	mov	ax, [bp+arg_0]
loc_2ABB0:
	shr	bx, 1
	rcr	cx, 1
	shr	dx, 1
	rcr	ax, 1
	or	bx, bx
	jnz	short loc_2ABB0
	div	cx
	mov	si, ax
	mul	[bp+arg_6]
	xchg	ax, cx
	mov	ax, [bp+arg_4]
	mul	si
	add	dx, cx
	jb	short loc_2ABD9
	cmp	dx, [bp+arg_2]
	ja	short loc_2ABD9
	jb	short loc_2ABDA
	cmp	ax, [bp+arg_0]
	jbe	short loc_2ABDA
loc_2ABD9:
	dec	si
loc_2ABDA:
	xor	dx, dx
	xchg	ax, si
loc_2ABDD:
	dec	di
	jnz	short loc_2ABE7
	neg	dx
	neg	ax
	sbb	dx, 0
loc_2ABE7:
	pop	bx
	pop	si
	pop	di
	mov	sp, bp
	pop	bp
	retf	8
__32bitDivide endp

; This function	multiplies the characters level
; times	a 32 bit number. The first argument is the
; character level. The second is the high word of the
; level	converted to a 32 bit double. This is always
; going	to be zero. The	third and fourth are the lo
; and hi words of the multiplicant
; Attributes: bp-based frame

_level32bitMult	proc far
level= word ptr	 6
zero= word ptr	8
numLo= word ptr	 0Ah
numHi= word ptr	 0Ch
	push	bp
	mov	bp, sp
	mov	ax, [bp+zero]
	mov	bx, [bp+numHi]
	or	bx, ax
	mov	bx, [bp+numLo]
	jnz	short loc_2AC0B
	mov	ax, [bp+level]
	mul	bx
	mov	sp, bp
	pop	bp
locret_2AC08:
	retf	8
loc_2AC0B:
	mul	bx
	mov	cx, ax
	mov	ax, [bp+level]
	mul	[bp+numHi]
	add	cx, ax
	mov	ax, [bp+level]
	mul	bx
	add	dx, cx
	mov	sp, bp
	pop	bp
	retf	8
_level32bitMult	endp

; Attributes: bp-based frame

_32bitMod proc far
arg_0= word ptr	 6
arg_2= word ptr	 8
arg_4= word ptr	 0Ah
arg_6= word ptr	 0Ch
	push	bp
	mov	bp, sp
	push	bx
	push	di
	xor	di, di
	mov	ax, [bp+arg_2]
	or	ax, ax
	jge	short loc_2AC43
	inc	di
	mov	dx, [bp+arg_0]
	neg	ax
	neg	dx
	sbb	ax, 0
	mov	[bp+arg_2], ax
	mov	[bp+arg_0], dx
loc_2AC43:
	mov	ax, [bp+arg_6]
	or	ax, ax
	jge	short loc_2AC5A
	mov	dx, [bp+arg_4]
	neg	ax
	neg	dx
	sbb	ax, 0
	mov	[bp+arg_6], ax
	mov	[bp+arg_4], dx
loc_2AC5A:
	or	ax, ax
	jnz	short loc_2AC76
	mov	cx, [bp+arg_4]
	mov	ax, [bp+arg_2]
	xor	dx, dx
	div	cx
	mov	ax, [bp+arg_0]
	div	cx
	mov	ax, dx
	xor	dx, dx
	dec	di
	jns	short loc_2ACB7
	jmp	short loc_2ACBE
loc_2AC76:
	mov	bx, ax
	mov	cx, [bp+arg_4]
	mov	dx, [bp+arg_2]
	mov	ax, [bp+arg_0]
loc_2AC81:
	shr	bx, 1
	rcr	cx, 1
	shr	dx, 1
	rcr	ax, 1
	or	bx, bx
	jnz	short loc_2AC81
	div	cx
	mov	cx, ax
	mul	[bp+arg_6]
	xchg	ax, cx
	mul	[bp+arg_4]
	add	dx, cx
	jb	short loc_2ACA8
	cmp	dx, [bp+arg_2]
	ja	short loc_2ACA8
	jb	short loc_2ACAE
	cmp	ax, [bp+arg_0]
	jbe	short loc_2ACAE
loc_2ACA8:
	sub	ax, [bp+arg_4]
	sbb	dx, [bp+arg_6]
loc_2ACAE:
	sub	ax, [bp+arg_0]
	sbb	dx, [bp+arg_2]
	dec	di
	jns	short loc_2ACBE
loc_2ACB7:
	neg	dx
	neg	ax
	sbb	dx, 0
loc_2ACBE:
	pop	di
	pop	bx
	mov	sp, bp
	pop	bp
	retf	8
_32bitMod endp


sub_2ACC6 proc far
	xor	ch, ch
	jcxz	short locret_2ACD0
loc_2ACCA:
	shl	ax, 1
	rcl	dx, 1
	loop	loc_2ACCA
locret_2ACD0:
	retf
sub_2ACC6 endp

align 2
; Attributes: bp-based frame

_32bitDivide proc far
arg_0= word ptr	 6
arg_2= word ptr	 8
arg_4= word ptr	 0Ah
	push	bp
	mov	bp, sp
	mov	bx, [bp+arg_0]
	push	[bp+arg_4]
	push	[bp+arg_2]
	push	word ptr [bx+2]
	push	word ptr [bx]
	call	__32bitDivide
	mov	bx, [bp+arg_0]
	mov	[bx+2],	dx
	mov	[bx], ax
	mov	sp, bp
	pop	bp
	retf	6
_32bitDivide endp

; Attributes: bp-based frame

sub_2ACF6 proc far
arg_0= word ptr	 6
arg_2= word ptr	 8
	push	bp
	mov	bp, sp
	mov	bx, [bp+arg_0]
	mov	ax, [bx]
	mov	dx, [bx+2]
	mov	cx, [bp+arg_2]
	call	sub_2ACC6
	mov	bx, [bp+arg_0]
	mov	[bx], ax
	mov	[bx+2],	dx
	mov	sp, bp
	pop	bp
locret_2AD14:
	retf	4
sub_2ACF6 endp

seg019 ends

; Segment type:	Regular
seg020 segment word public 'DATA' use16
	assume cs:seg020
;org 7
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:nothing
algn_2AD17:
align 2
decompBytes23 dw 0
decompBytes01 dw 0
word_2AD1C dw 0
word_2AD1E dw 0
byte_2AD20 db 200h dup(0)	   ; 0
_decompBufIndex	dw 0
_decompByteMask	dw 0
byte_2AF24 db 0F05h dup(0)	   ; 0
word_2BE29 dw 0
word_2BE2B dw 0
word_2BE2D dw 0
align 2
seg020 ends

; Segment type:	Regular
seg021 segment para public 'DATA' use16
	assume cs:seg021
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:nothing
byte_2BE30 db 0, 10h, 20h, 30h,	40h, 50h, 60h, 70h; 0
db 80h,	90h, 0A0h, 0B0h, 0C0h, 0D0h, 0E0h, 0F0h; 8
db 1, 11h, 21h,	31h, 41h, 51h, 61h, 71h; 16
db 81h,	91h, 0A1h, 0B1h, 0C1h, 0D1h, 0E1h, 0F1h; 24
db 2, 12h, 22h,	32h, 42h, 52h, 62h, 72h; 32
db 82h,	92h, 0A2h, 0B2h, 0C2h, 0D2h, 0E2h, 0F2h; 40
db 3, 13h, 23h,	33h, 43h, 53h, 63h, 73h; 48
db 83h,	93h, 0A3h, 0B3h, 0C3h, 0D3h, 0E3h, 0F3h; 56
db 4, 14h, 24h,	34h, 44h, 54h, 64h, 74h; 64
db 84h,	94h, 0A4h, 0B4h, 0C4h, 0D4h, 0E4h, 0F4h; 72
db 5, 15h, 25h,	35h, 45h, 55h, 65h, 75h; 80
db 85h,	95h, 0A5h, 0B5h, 0C5h, 0D5h, 0E5h, 0F5h; 88
db 6, 16h, 26h,	36h, 46h, 56h, 66h, 76h; 96
db 86h,	96h, 0A6h, 0B6h, 0C6h, 0D6h, 0E6h, 0F6h; 104
db 7, 17h, 27h,	37h, 47h, 57h, 67h, 77h; 112
db 87h,	97h, 0A7h, 0B7h, 0C7h, 0D7h, 0E7h, 0F7h; 120
db 8, 18h, 28h,	38h, 48h, 58h, 68h, 78h; 128
db 88h,	98h, 0A8h, 0B8h, 0C8h, 0D8h, 0E8h, 0F8h; 136
db 9, 19h, 29h,	39h, 49h, 59h, 69h, 79h; 144
db 89h,	99h, 0A9h, 0B9h, 0C9h, 0D9h, 0E9h, 0F9h; 152
db 0Ah,	1Ah, 2Ah, 3Ah, 4Ah, 5Ah, 6Ah, 7Ah; 160
db 8Ah,	9Ah, 0AAh, 0BAh, 0CAh, 0DAh, 0EAh, 0FAh; 168
db 0Bh,	1Bh, 2Bh, 3Bh, 4Bh, 5Bh, 6Bh, 7Bh; 176
db 8Bh,	9Bh, 0ABh, 0BBh, 0CBh, 0DBh, 0EBh, 0FBh; 184
db 0Ch,	1Ch, 2Ch, 3Ch, 4Ch, 5Ch, 6Ch, 7Ch; 192
db 8Ch,	9Ch, 0ACh, 0BCh, 0CCh, 0DCh, 0ECh, 0FCh; 200
db 0Dh,	1Dh, 2Dh, 3Dh, 4Dh, 5Dh, 6Dh, 7Dh; 208
db 8Dh,	9Dh, 0ADh, 0BDh, 0CDh, 0DDh, 0EDh, 0FDh; 216
db 0Eh,	1Eh, 2Eh, 3Eh, 4Eh, 5Eh, 6Eh, 7Eh; 224
db 8Eh,	9Eh, 0AEh, 0BEh, 0CEh, 0DEh, 0EEh, 0FEh; 232
db 0Fh,	1Fh, 2Fh, 3Fh, 4Fh, 5Fh, 6Fh, 7Fh; 240
db 8Fh,	9Fh, 0AFh, 0BFh, 0CFh, 0DFh, 0EFh, 0FFh; 248
word_2BF30 dw 0
word_2BF32 dw 0
byte_2BF34 db 100h dup(0)	   ; 0
byte_2C034 db 100h dup(0)	   ; 0
byte_2C134 db 100h dup(0)	   ; 0
byte_2C234 db 100h dup(0)	   ; 0
byte_2C334 db 100h dup(0)	   ; 0
bigpicBuf db 268Ch dup(0)	  ; 0
seg021 ends

; Segment type:	Regular
seg022 segment para public 'DATA' use16
	assume cs:seg022
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:nothing
characterIOBuf db 2328h	dup(0)	       ; 0
partyIOBuf dw 240h dup(0)	   ; 0
byte_31268 db 5948h dup(0)	   ; 0
seg022 ends

; Segment type:	Regular
seg023 segment para public 'DATA' use16
	assume cs:seg023
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:nothing
graphicsBuf db 4A38h dup(0)	    ; 0
monsterBuf db 480h dup(0)	   ; 0
byte_3BA68 db 11C4h dup(0)	   ; 0
iconLight db 474h dup(0)	  ; 0
iconCompass db 820h dup(0)	    ; 0
iconAreaEnchant	db 550h	dup(0)		; 0
iconShield db 1E0h dup(0)	   ; 0
iconLevitation db 640h dup(0)	       ; 0
byte_3E630 db 0, 0, 0, 0, 0, 0,	0, 0, 60h, 0F0h; 0
db 0F0h, 60h, 60h, 0, 60h, 0, 0D8h, 0D8h, 0D8h,	0; 10
db 0, 0, 0, 0, 6Ch, 6Ch, 0FEh, 6Ch, 0FEh, 6Ch; 20
db 6Ch,	0, 30h,	7Ch, 0C0h, 78h,	0Ch, 0F8h, 30h,	0; 30
db 0, 0C6h, 0CCh, 18h, 30h, 66h, 0C6h, 0, 38h, 6Ch; 40
db 38h,	76h, 0DCh, 0CCh, 76h, 0, 60h, 60h, 0C0h, 0; 50
db 0, 0, 0, 0, 30h, 60h, 0C0h, 0C0h, 0C0h, 60h;	60
db 30h,	0, 0C0h, 60h, 30h, 30h,	30h, 60h, 0C0h,	0; 70
db 0, 0CCh, 78h, 0FCh, 78h, 0CCh, 0, 0,	0, 30h;	80
db 30h,	0FCh, 30h, 30h,	0, 0, 0, 0, 0, 0; 90
db 0, 60h, 60h,	0C0h, 0, 0, 0, 0F8h, 0,	0; 100
db 0, 0, 0, 0, 0, 0, 0,	60h, 60h, 0; 110
db 0, 0Ch, 18h,	30h, 60h, 0C0h,	80h, 0,	7Ch, 0C6h; 120
db 0CEh, 0DEh, 0F6h, 0E6h, 7Ch,	0, 30h,	70h, 30h, 30h; 130
db 30h,	30h, 0FCh, 0, 78h, 0CCh, 0Ch, 38h, 60h,	0CCh; 140
db 0FCh, 0, 78h, 0CCh, 0Ch, 38h, 0Ch, 0CCh, 78h, 0; 150
db 1Ch,	3Ch, 6Ch, 0CCh,	0FEh, 0Ch, 1Eh,	0, 0FCh, 0C0h; 160
db 0F8h, 0Ch, 0Ch, 0CCh, 78h, 0, 38h, 60h, 0C0h, 0F8h; 170
db 0CCh, 0CCh, 78h, 0, 0FCh, 0CCh, 0Ch,	18h, 30h, 30h; 180
db 30h,	0, 78h,	0CCh, 0CCh, 78h, 0CCh, 0CCh, 78h, 0; 190
db 78h,	0CCh, 0CCh, 7Ch, 0Ch, 18h, 70h,	0, 0, 0C0h; 200
db 0C0h, 0, 0, 0C0h, 0C0h, 0, 0, 60h, 60h, 0; 210
db 0, 60h, 60h,	0C0h, 18h, 30h,	60h, 0C0h, 60h,	30h; 220
db 18h,	0, 0, 0, 0F8h, 0, 0, 0F8h, 0, 0; 230
db 0C0h, 60h, 30h, 18h,	30h, 60h, 0C0h,	0, 78h,	0CCh; 240
db 0Ch,	18h, 30h, 0, 30h, 0, 7Ch, 0C6h,	0DEh, 0DEh; 250
db 0DEh, 0C0h, 78h, 0, 30h, 78h, 0CCh, 0CCh, 0FCh, 0CCh; 260
db 0CCh, 0, 0FCh, 66h, 66h, 7Ch, 66h, 66h, 0FCh, 0; 270
db 3Ch,	66h, 0C0h, 0C0h, 0C0h, 66h, 3Ch, 0, 0F8h, 6Ch; 280
db 66h,	66h, 66h, 6Ch, 0F8h, 0,	0FEh, 62h, 68h,	78h; 290
db 68h,	62h, 0FEh, 0, 0FEh, 62h, 68h, 78h, 68h,	60h; 300
db 0F0h, 0, 3Ch, 66h, 0C0h, 0C0h, 0CEh,	66h, 3Eh, 0; 310
db 0CCh, 0CCh, 0CCh, 0FCh, 0CCh, 0CCh, 0CCh, 0,	78h, 30h; 320
db 30h,	30h, 30h, 30h, 78h, 0, 1Eh, 0Ch, 0Ch, 0Ch; 330
db 0CCh, 0CCh, 78h, 0, 0E6h, 66h, 6Ch, 78h, 6Ch, 66h; 340
db 0E6h, 0, 0F0h, 60h, 60h, 60h, 62h, 66h, 0FEh, 0; 350
db 0C6h, 0EEh, 0FEh, 0FEh, 0D6h, 0C6h, 0C6h, 0,	0C6h, 0E6h; 360
db 0F6h, 0DEh, 0CEh, 0C6h, 0C6h, 0, 38h, 6Ch, 0C6h, 0C6h; 370
db 0C6h, 6Ch, 38h, 0, 0FCh, 66h, 66h, 7Ch, 60h,	60h; 380
db 0F0h, 0, 78h, 0CCh, 0CCh, 0CCh, 0DCh, 78h, 1Ch, 0; 390
db 0FCh, 66h, 66h, 7Ch,	6Ch, 66h, 0E6h,	0, 78h,	0CCh; 400
db 0E0h, 70h, 1Ch, 0CCh, 78h, 0, 0FCh, 0B4h, 30h, 30h; 410
db 30h,	30h, 78h, 0, 0CCh, 0CCh, 0CCh, 0CCh, 0CCh, 0CCh; 420
db 0FCh, 0, 0CCh, 0CCh,	0CCh, 0CCh, 0CCh, 78h, 30h, 0; 430
db 0C6h, 0C6h, 0C6h, 0D6h, 0FEh, 0EEh, 0C6h, 0,	0C6h, 0C6h; 440
db 6Ch,	38h, 38h, 6Ch, 0C6h, 0,	0CCh, 0CCh, 0CCh, 78h; 450
db 30h,	30h, 78h, 0, 0FEh, 0C6h, 8Ch, 18h, 32h,	66h; 460
db 0FEh, 0, 0F0h, 0C0h,	0C0h, 0C0h, 0C0h, 0C0h,	0F0h, 0; 470
db 0, 0C0h, 60h, 30h, 18h, 0Ch,	4, 0, 0F0h, 30h; 480
db 30h,	30h, 30h, 30h, 0F0h, 0,	10h, 38h, 6Ch, 0C6h; 490
db 0, 0, 0, 0, 0, 0, 0,	0, 0, 0; 500
db 0, 0FFh, 0C0h, 0C0h,	60h, 0,	0, 0, 0, 0; 510
db 0, 0, 0F0h, 18h, 0F8h, 98h, 0E8h, 0,	0C0h, 0C0h; 520
db 0C0h, 0F0h, 0D8h, 0D8h, 0F0h, 0, 0, 0, 0F0h,	0D0h; 530
db 0C0h, 0D0h, 0F0h, 0,	38h, 18h, 18h, 78h, 0D8h, 0D8h;	540
db 78h,	0, 0, 0, 70h, 0D8h, 0F8h, 0C0h,	70h, 0;	550
db 38h,	68h, 60h, 0F0h,	60h, 60h, 0F0h,	0, 0, 0; 560
db 68h,	0D8h, 0D8h, 0F8h, 18h, 0F0h, 0C0h, 0C0h, 0C0h, 0F0h; 570
db 0D8h, 0D8h, 0D8h, 0,	0C0h, 0, 0C0h, 0C0h, 0C0h, 0C0h; 580
db 0C0h, 0, 18h, 0, 18h, 18h, 18h, 0D8h, 0D8h, 0F0h; 590
db 0C0h, 0C0h, 0C8h, 0D8h, 0F0h, 0D8h, 0C8h, 0,	0E0h, 60h; 600
db 60h,	60h, 60h, 60h, 0F0h, 0,	0, 0, 0CCh, 0FEh; 610
db 0FEh, 0D6h, 0C6h, 0,	0, 0, 0F0h, 0D8h, 0D8h,	0D8h; 620
db 0D8h, 0, 0, 0, 70h, 0D8h, 0D8h, 0D8h, 70h, 0; 630
db 0, 0, 70h, 0D8h, 0D8h, 0F0h,	0C0h, 0C0h, 0, 0; 640
db 78h,	0D8h, 0D8h, 78h, 18h, 38h, 0, 0, 70h, 0D8h; 650
db 0C0h, 0C0h, 0E0h, 0,	0, 0, 78h, 0C0h, 70h, 18h; 660
db 0F0h, 0, 20h, 60h, 0F8h, 60h, 60h, 68h, 30h,	0; 670
db 0, 0, 0D8h, 0D8h, 0D8h, 0D8h, 0F8h, 0, 0, 0;	680
db 0D8h, 0D8h, 0D8h, 70h, 20h, 0, 0, 0,	88h, 0A8h; 690
db 0A8h, 0A8h, 0F8h, 0,	0, 0, 88h, 0D8h, 70h, 0D8h; 700
db 88h,	0, 0, 0, 0D8h, 0D8h, 0D8h, 0F8h, 18h, 0F0h; 710
db 0, 0, 0F8h, 30h, 60h, 0C8h, 0F8h, 0,	38h, 60h; 720
db 60h,	0C0h, 60h, 60h,	38h, 0,	0C0h, 0C0h, 0C0h, 0; 730
db 0C0h, 0C0h, 0C0h, 0,	0E0h, 30h, 30h,	18h, 30h, 30h; 740
db 0E0h, 0, 76h, 0DCh, 0, 0, 0,	0, 0, 0; 750
db 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 7Eh,	42h; 760
db 42h,	42h, 42h, 42h, 42h, 7Eh, 18h, 3Ch, 7Eh,	0FFh; 770
db 18h,	18h, 18h, 18h, 18h, 18h, 18h, 18h, 0FFh, 7Eh; 780
db 3Ch,	18h		; 790
byte_3E948 db 8, 8, 8, 89h, 8, 8, 8, 8;	0
seg023 ends

; Segment type:	Pure code
seg024 segment para public 'DATA' use16
	assume cs:seg024
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:nothing

_vid_mouseMoved	dw offset mouse_moved
vid_mouseXp	dw offset mouse_x
vid_mouseYp	dw offset mouse_y
off_3E956	dw offset byte_4EF5E
off_3E958	dw offset byte_4EF79
off_3E95A	dw offset byte_4EF7A
off_3E95C	dd monsterBuf
off_3E960	dd monsterBuf
off_3E964	dd byte_3E630

vid_setMode proc near
	jmp	near ptr _vid_setMode
vid_setMode endp

; Attributes: thunk
sub_3E96B proc near
	jmp	near ptr sub_3EF35
sub_3E96B endp

; Attributes: thunk
sub_3E96E proc near
	jmp	near ptr sub_3F426
sub_3E96E endp

; Attributes: thunk
sub_3E971 proc near
	jmp	near ptr sub_3F603
sub_3E971 endp

; Attributes: thunk
sub_3E974 proc near
	jmp	near ptr sub_3F6A9
sub_3E974 endp

; Attributes: thunk
sub_3E977 proc near
	jmp	near ptr sub_3F714
sub_3E977 endp

; Attributes: thunk
sub_3E97A proc near
	jmp	near ptr sub_3F0D2
sub_3E97A endp

; Attributes: thunk
sub_3E97D proc near
	jmp	near ptr sub_3F1CA
sub_3E97D endp

; Attributes: thunk
sub_3E980 proc near
	jmp	near ptr sub_3F2C2
sub_3E980 endp

vid_drawBigpic proc near
	jmp	near ptr _vid_drawBigpic
vid_drawBigpic endp

; Attributes: thunk
sub_3E986 proc near
	jmp	sub_3F490
sub_3E986 endp

; Attributes: thunk

sub_3E989 proc far
	jmp	near ptr sub_3F899
sub_3E989 endp

; Attributes: thunk

sub_3E98C proc far
	jmp	near ptr sub_3F7C1
sub_3E98C endp

; Attributes: thunk
sub_3E98F proc near
	jmp	near ptr sub_3F919
sub_3E98F endp

; Attributes: thunk
j_nullsub_3 proc near
	jmp	near ptr nullsub_3
j_nullsub_3 endp

; Attributes: thunk
j_nullsub_2 proc near
	jmp	near ptr nullsub_2
j_nullsub_2 endp

; Attributes: thunk
vid_setMouseIcon proc near
	jmp	near ptr _vid_setMouseIcon
vid_setMouseIcon endp

; Attributes: thunk

sub_3E99B proc far
	jmp	near ptr sub_3F95D
sub_3E99B endp

byte_3E99E db 0, 1, 2, 3, 4, 5,	6, 7, 8, 9; 0
db 0Ah,	0Bh, 0Ch, 0Dh, 0Eh, 0Fh; 10
unk_3E9AE db	3
dword_3E9AF dd 0A0001F40h
word_3E9B3 dw 0
word_3E9B5 dw 0
word_3E9B7 dw 0
byte_3E9B9 db 0
byte_3E9BA db 0
byte_3E9BB db 0
byte_3E9BC db 0FFh, 7Fh, 3Fh, 1Fh, 0Fh,	7, 3, 1; 0
byte_3E9C4 db 80h,	0C0h, 0E0h, 0F0h, 0F8h,	0FCh, 0FEh, 0FFh; 0
byte_3E9CC db 1, 0, 2, 0, 3, 0, 4, 0, 5, 0; 0
db 6			; 10
byte_3E9D7 db 0
db    7
db 0
db    8
db    0
db    0
db    0
db    0
db    0
db    0
db    0
word_3E9E2 dw 0A000h
vid_mouseY dw 0
vid_mouseX dw 0
vid_mouseIndex dw 0
vid_mouseBuf db	0C0h dup(0)	     ; 0
byte_3EAAA db 0, 0, 31,	192, 63, 240, 127, 248,	117, 248, 123, 248, 126, 88, 97, 152
db 127,	248, 62, 24, 63, 240, 31, 224, 6, 192, 0, 0, 0,	0, 0, 0
db 0, 0, 31, 192, 63, 240, 127,	248, 117, 248, 123, 248, 126, 88, 97, 152
db 127,	248, 62, 24, 63, 240, 31, 224, 6, 192, 0, 0, 0,	0, 0, 0
db 0, 0, 31, 192, 63, 240, 127,	248, 117, 248, 123, 248, 126, 88, 97, 152
db 127,	248, 62, 24, 63, 240, 31, 224, 6, 192, 0, 0, 0,	0, 0, 0
db 0, 0, 31, 192, 32, 48, 94, 8, 68, 8,	73, 232, 94, 72, 64, 136
db 65, 232, 38,	8, 40, 208, 25,	32, 6, 192, 0, 0, 0, 0,	0, 0
db 0, 0, 31, 192, 35, 240, 94, 120, 68,	24, 73,	232, 94, 72, 64, 136
db 65, 232, 38,	8, 43, 208, 25,	96, 6, 192, 0, 0, 0, 0,	0, 0
byte_3EB4A db 0, 0, 1, 0, 3, 128, 7, 192, 15, 224, 31, 240, 7, 192, 7, 192
db 7, 192, 7, 192, 7, 192, 7, 192, 7, 192, 0, 0, 0, 0, 0, 0
db 0, 0, 0, 0, 1, 0, 3,	128, 7,	192, 3,	128, 3,	128, 3,	128
db 3, 128, 3, 128, 3, 128, 3, 128, 0, 0, 0, 0, 0, 0, 0,	0
db 0, 0, 0, 0, 0, 0, 0,	0, 0, 0, 0, 0, 0, 0, 0,	0
db 0, 0, 0, 0, 0, 0, 0,	0, 0, 0, 0, 0, 0, 0, 0,	0
db 0, 0, 1, 0, 2, 128, 4, 64, 8, 32, 28, 112, 4, 64, 4,	64
db 4, 64, 4, 64, 4, 64,	4, 64, 7, 192, 0, 0, 0,	0, 0, 0
db 0, 0, 1, 0, 3, 128, 7, 192, 15, 224,	31, 240, 7, 192, 4, 64
db 3, 128, 4, 64, 3, 128, 0, 0,	0, 0, 0, 0, 0, 0, 0, 0
byte_3EBEA db 0, 0, 7, 224, 15,	240, 31, 248, 31, 248, 31, 120,	31, 120, 31, 0
db 127,	192, 63, 128, 31, 0, 14, 0, 4, 0, 0, 0,	0, 0, 0, 0
db 0, 0, 0, 0, 7, 224, 15, 240,	14, 48,	14, 48,	14, 0, 14, 0
db 14, 0, 31, 0, 14, 0,	4, 0, 0, 0, 0, 0, 0, 0,	0, 0
db 0, 0, 0, 0, 0, 0, 0,	0, 0, 0, 0, 0, 0, 0, 0,	0
db 0, 0, 0, 0, 0, 0, 0,	0, 0, 0, 0, 0, 0, 0, 0,	0
db 0, 0, 7, 224, 8, 16,	16, 8, 17, 200,	17, 72,	17, 120, 17, 0
db 113,	192, 32, 128, 17, 0, 10, 0, 4, 0, 0, 0,	0, 0, 0, 0
db 0, 0, 0, 0, 8, 0, 0,	0, 30, 128, 1, 0, 31, 0, 17, 0
db 127,	192, 63, 128, 31, 0, 14, 0, 4, 0, 0, 0,	0, 0, 0, 0
byte_3EC8A db 0, 0, 0, 0, 4, 0,	12, 0, 31, 224,	63, 240, 127, 248, 63, 248
db 31, 248, 12,	248, 4,	248, 0,	248, 0,	248, 0,	0, 0, 0, 0, 0
db 0, 0, 0, 0, 0, 0, 0,	0, 8, 0, 31, 224, 63, 240, 31, 240
db 8, 112, 0, 112, 0, 112, 0, 112, 0, 0, 0, 0, 0, 0, 0,	0
db 0, 0, 0, 0, 0, 0, 0,	0, 0, 0, 0, 0, 0, 0, 0,	0
db 0, 0, 0, 0, 0, 0, 0,	0, 0, 0, 0, 0, 0, 0, 0,	0
db 0, 0, 0, 0, 4, 0, 12, 0, 23,	224, 32, 16, 64, 8, 32,	8
db 23, 136, 12,	136, 4,	136, 0,	136, 0,	248, 0,	0, 0, 0, 0, 0
db 0, 0, 0, 0, 4, 0, 12, 0, 29,	64, 61,	16, 125, 32, 61, 64
db 30, 128, 12,	0, 4, 0, 0, 0, 0, 0, 0,	0, 0, 0, 0, 0
byte_3ED2A db 0, 0, 0, 128, 0, 192, 31,	224, 63, 240, 127, 248,	127, 240, 127, 224
db 124,	192, 124, 128, 124, 0, 124, 0, 0, 0, 0,	0, 0, 0, 0, 0
db 0, 0, 0, 0, 0, 0, 0,	64, 31,	224, 63, 240, 63, 224, 56, 64
db 56, 0, 56, 0, 56, 0,	0, 0, 0, 0, 0, 0, 0, 0,	0, 0
db 0, 0, 0, 0, 0, 0, 0,	0, 0, 0, 0, 0, 0, 0, 0,	0
db 0, 0, 0, 0, 0, 0, 0,	0, 0, 0, 0, 0, 0, 0, 0,	0
db 0, 0, 0, 128, 0, 192, 31, 160, 32, 16, 64, 8, 64, 16, 71, 160
db 68, 192, 68,	128, 68, 0, 124, 0, 0, 0, 0, 0,	0, 0, 0, 0
db 0, 0, 0, 128, 0, 192, 10, 224, 34, 240, 18, 248, 10,	240, 5,	224
db 0, 192, 0, 128, 0, 0, 0, 0, 0, 0, 0,	0, 0, 0, 0, 0
byte_3EDCA db 0, 0, 48,	0, 56, 0, 28, 0, 15, 0,	15, 128, 31, 192, 27, 224
db 31, 240, 31,	240, 15, 248, 1, 248, 0, 112, 0, 0, 0, 0, 0, 0
db 0, 0, 48, 0,	24, 0, 12, 0, 7, 0, 11,	128, 27, 192, 19, 224
db 3, 240, 31, 240, 1, 248, 0, 120, 0, 0, 0, 0,	0, 0, 0, 0
db 0, 0, 0, 0, 32, 0, 16, 0, 8,	0, 4, 0, 4, 0, 8, 0
db 28, 0, 0, 0,	14, 0, 1, 128, 0, 112, 0, 0, 0,	0, 0, 0
db 0, 0, 48, 0,	56, 0, 28, 0, 15, 0, 15, 128, 31, 192, 27, 224
db 31, 240, 31,	240, 15, 248, 1, 248, 0, 112, 0, 0, 0, 0, 0, 0
db 0, 0, 48, 0,	24, 0, 12, 0, 7, 0, 11,	128, 27, 192, 19, 224
db 3, 240, 31, 240, 1, 248, 0, 120, 0, 0, 0, 0,	0, 0, 0, 0
byte_3EE6A db 0, 0, 3, 192, 7, 224, 15,	240, 15, 248, 15, 248, 63, 248,	63, 248
db 63, 248, 63,	248, 31, 248, 15, 240, 7, 224, 0, 0, 0,	0, 0, 0
db 0, 0, 0, 0, 1, 64, 5, 64, 5,	80, 5, 80, 7, 240, 23, 240
db 25, 240, 30,	240, 15, 240, 3, 224, 0, 0, 0, 0, 0, 0,	0, 0
db 0, 0, 3, 192, 6, 160, 10, 176, 10, 168, 10, 168, 56,	8, 40, 8
db 38, 8, 33, 8, 16, 8,	12, 16,	7, 224,	0, 0, 0, 0, 0, 0
db 0, 0, 3, 192, 7, 224, 15, 240, 15, 248, 15, 248, 63,	248, 63, 248
db 63, 248, 63,	248, 31, 248, 15, 240, 7, 224, 0, 0, 0,	0, 0, 0
db 0, 0, 0, 0, 1, 64, 5, 64, 5,	80, 5, 80, 7, 240, 23, 240
db 25, 240, 30,	240, 15, 240, 3, 224, 0, 0, 0, 0, 0, 0,	0, 0
off_3EF0A dw offset byte_3EAAA
off_3EF0C dw offset byte_3EAAA
dw offset byte_3EB4A
dw offset byte_3EBEA
dw offset byte_3EC8A
dw offset byte_3ED2A
dw offset byte_3EDCA
dw offset byte_3EE6A
dw offset byte_3EE6A
; Attributes: bp-based frame

_vid_setMode proc far
arg_0= word ptr	 6
	push	bp
	mov	bp, sp
	mov	ax, [bp+arg_0]
	or	ax, ax
	jz	short loc_3EF2E
	mov	ax, 0Dh
	int	10h		; - VIDEO - SET	VIDEO MODE
			; AL = mode
	jmp	short loc_3EF33
db  90h	; 
loc_3EF2E:
	mov	ax, 3
	int	10h		; - VIDEO - SET	VIDEO MODE
			; AL = mode
loc_3EF33:
	pop	bp
	retf
_vid_setMode endp

; Attributes: bp-based frame

sub_3EF35 proc far
arg_0= word ptr	 6
arg_2= word ptr	 8
arg_4= word ptr	 0Ah
arg_6= word ptr	 0Ch
arg_8= byte ptr	 0Eh
	push	bp
	mov	bp, sp
	push	es
	push	ds
	push	si
	push	di
	mov	ax, cs
	mov	ds, ax
	assume ds:seg024
	mov	ax, [bp+arg_2]
	mov	cx, ax
	shl	ax, 1
	shl	ax, 1
	shl	ax, 1
	mov	bx, ax
	shl	ax, 1
	shl	ax, 1
	add	ax, bx
	mov	cs:word_3E9B3, ax
	mov	ax, [bp+arg_6]
	sub	ax, cx
	inc	ax
	mov	cs:word_3E9B5, ax
	mov	al, [bp+arg_8]
	not	al
	mov	cs:byte_3E9B9, al
	mov	cs:byte_3E9BA, 0
	mov	cs:byte_3E9BB, 1
	mov	dx, 3C4h
	mov	al, 2
	out	dx, al		; EGA: sequencer address reg
			; map mask: data bits 0-3 enable writes	to bit planes 0-3
	mov	dx, 3CEh
	mov	al, 4
	out	dx, al		; EGA: graph 1 and 2 addr reg:
			; read map select.
			; Data bits 0-2	select map # for read mode 00.
	mov	ax, [bp+arg_0]
	mov	bx, ax
	and	bx, 7
	mov	dh, cs:byte_3E9BC[bx]
	mov	cx, [bp+arg_4]
	mov	bx, cx
	and	bx, 7
	mov	dl, cs:byte_3E9C4[bx]
	mov	bx, cx
	mov	cl, 3
	shr	ax, cl
	shr	bx, cl
	add	cs:word_3E9B3, ax
	cmp	ax, bx
	jnz	short loc_3F003
	and	dh, dl
	mov	bl, dh
loc_3EFB1:
	mov	dx, 3C5h
	mov	al, cs:byte_3E9BB
	shl	cs:byte_3E9BB, 1
	out	dx, al		; EGA port: sequencer data register
	mov	dx, 3CFh
	mov	al, cs:byte_3E9BA
	out	dx, al		; EGA port: graphics controller	data register
	sub	bh, bh
	rcr	cs:byte_3E9B9, 1
	rcl	bh, 1
	dec	bh
	and	bh, bl
	not	bl
	mov	cx, cs:word_3E9B5
	mov	di, cs:word_3E9B3
	mov	ax, ds
	mov	ds, cs:word_3E9E2
	assume ds:nothing
loc_3EFE6:
	and	[di], bl
	or	[di], bh
	add	di, 28h	
	loop	loc_3EFE6
	mov	ds, ax
	assume ds:seg024
	not	bl
	inc	cs:byte_3E9BA
	cmp	cs:byte_3E9BA, 4
	jnz	short loc_3EFB1
	jmp	loc_3F0CC
loc_3F003:
	dec	bx
	cmp	ax, bx
	jnz	short loc_3F05D
	mov	ax, dx
	xchg	al, ah
	mov	bx, ax
loc_3F00E:
	mov	dx, 3C5h
	mov	al, cs:byte_3E9BB
	shl	cs:byte_3E9BB, 1
	out	dx, al		; EGA port: sequencer data register
	mov	dx, 3CFh
	mov	al, cs:byte_3E9BA
	out	dx, al		; EGA port: graphics controller	data register
	sub	ax, ax
	rcr	cs:byte_3E9B9, 1
	rcl	ax, 1
	dec	ax
	and	ax, bx
	not	bx
	mov	cx, cs:word_3E9B5
	mov	di, cs:word_3E9B3
	push	ds
	mov	ds, cs:word_3E9E2
	assume ds:nothing
loc_3F041:
	and	[di], bx
	or	[di], ax
	add	di, 28h	
	loop	loc_3F041
	pop	ds
	assume ds:dseg
	not	bx
	inc	cs:byte_3E9BA
	cmp	cs:byte_3E9BA, 4
	jnz	short loc_3F00E
	jmp	short loc_3F0CC
db  90h	; 
loc_3F05D:
	inc	bx
	sub	bx, ax
	dec	bx
	mov	bp, bx
	inc	bx
	neg	bx
	add	bx, 28h	
	mov	si, bx
	not	dx
	mov	bx, dx
	mov	es, cs:word_3E9E2
	assume es:nothing
loc_3F074:
	mov	dx, 3C5h
	mov	al, cs:byte_3E9BB
	shl	cs:byte_3E9BB, 1
	out	dx, al		; EGA port: sequencer data register
	mov	dx, 3CFh
	mov	al, cs:byte_3E9BA
	out	dx, al		; EGA port: graphics controller	data register
	sub	dx, dx
	rcr	cs:byte_3E9B9, 1
	rcl	dx, 1
	dec	dx
	mov	al, dl
	not	bx
	and	dx, bx
	not	bx
	mov	di, cs:word_3E9B3
	mov	ah, byte ptr cs:word_3E9B5
	push	ds
	mov	ds, cs:word_3E9E2
	assume ds:nothing
loc_3F0AB:
	and	[di], bh
	or	[di], dh
	inc	di
	mov	cx, bp
	rep stosb
	and	[di], bl
	or	[di], dl
	add	di, si
	dec	ah
	jnz	short loc_3F0AB
	pop	ds
	assume ds:dseg
	inc	cs:byte_3E9BA
	cmp	cs:byte_3E9BA, 4
	jnz	short loc_3F074
loc_3F0CC:
	pop	di
	pop	si
	pop	ds
	pop	es
	assume es:nothing
	pop	bp
	retf
sub_3EF35 endp

; Attributes: bp-based frame

sub_3F0D2 proc far
arg_0= word ptr	 6
arg_2= word ptr	 8
arg_4= word ptr	 0Ah
arg_6= byte ptr	 0Ch
	push	bp
	mov	bp, sp
	push	si
	push	di
	push	es
	push	ds
	mov	ax, cs
	mov	es, ax
	assume es:seg024
	lds	si, cs:off_3E964
	mov	ax, [bp+arg_4]
	sub	ah, ah
	shl	ax, 1
	shl	ax, 1
	shl	ax, 1
	add	si, ax
	mov	di, offset byte_3E9CC
	mov	cl, byte ptr [bp+arg_2]
	and	cl, 7
	cld
	sub	ax, ax
	lodsb
	ror	ax, cl
	stosw
	sub	ax, ax
	lodsb
	ror	ax, cl
	stosw
	sub	ax, ax
	lodsb
	ror	ax, cl
	stosw
	sub	ax, ax
	lodsb
	ror	ax, cl
	stosw
	sub	ax, ax
	lodsb
	ror	ax, cl
	stosw
	sub	ax, ax
	lodsb
	ror	ax, cl
	stosw
	sub	ax, ax
	lodsb
	ror	ax, cl
	stosw
	sub	ax, ax
	lodsb
	ror	ax, cl
	stosw
	mov	ax, es
	mov	ds, ax
	assume ds:seg024
	mov	ax, 0A000h
	mov	es, ax
	assume es:nothing
	mov	si, offset byte_3E9CC
	mov	dx, [bp+arg_0]
	and	dl, 0FEh
	shl	dx, 1
	shl	dx, 1
	shl	dx, 1
	mov	di, dx
	shl	dx, 1
	shl	dx, 1
	add	di, dx
	mov	ax, [bp+arg_2]
	shr	ax, 1
	shr	ax, 1
	shr	ax, 1
	add	di, ax
	mov	dx, 3C4h
	mov	al, 2
	out	dx, al		; EGA: sequencer address reg
			; map mask: data bits 0-3 enable writes	to bit planes 0-3
	mov	dx, 3CEh
	mov	al, 4
	out	dx, al		; EGA: graph 1 and 2 addr reg:
			; read map select.
			; Data bits 0-2	select map # for read mode 00.
	mov	bx, 1
	test	[bp+arg_6], 1
	jnz	short loc_3F196
loc_3F169:
	push	si
	push	di
	mov	dx, 3C5h
	mov	al, bl
	shl	bl, 1
	out	dx, al		; EGA port: sequencer data register
	mov	dx, 3CFh
	mov	al, bh
	inc	bh
	out	dx, al		; EGA port: graphics controller	data register
	mov	cx, 4
loc_3F17E:
	lodsw
	or	es:[di], ax
	lodsw
	or	es:[di+28h], ax
	add	di, 50h	
	loop	loc_3F17E
	pop	di
	pop	si
	cmp	bh, 4
	jnz	short loc_3F169
	jmp	short loc_3F1C4
db  90h	; 
loc_3F196:
	push	si
	push	di
	mov	dx, 3C5h
	mov	al, bl
	shl	bl, 1
	out	dx, al		; EGA port: sequencer data register
	mov	dx, 3CFh
	mov	al, bh
	inc	bh
	out	dx, al		; EGA port: graphics controller	data register
	mov	cx, 4
loc_3F1AB:
	lodsw
	not	ax
	and	es:[di], ax
	lodsw
	not	ax
	and	es:[di+28h], ax
	add	di, 50h	
	loop	loc_3F1AB
	pop	di
	pop	si
	cmp	bh, 4
	jnz	short loc_3F196
loc_3F1C4:
	pop	ds
	assume ds:dseg
	pop	es
	assume es:nothing
	pop	di
	pop	si
	pop	bp
	retf
sub_3F0D2 endp

; Attributes: bp-based frame

sub_3F1CA proc far
arg_0= dword ptr  6
arg_4= dword ptr  0Ah
	push	bp
	mov	bp, sp
	push	es
	push	si
	push	di
	push	ds
	lds	si, [bp+arg_0]
	les	di, [bp+arg_4]
	mov	al, 2
	mov	dx, 3C4h
	out	dx, al		; EGA: sequencer address reg
			; map mask: data bits 0-3 enable writes	to bit planes 0-3
	inc	dx
	mov	al, 0Fh
	out	dx, al		; EGA port: sequencer data register
	mov	bx, 8000
	cld
loc_3F1E5:
	lodsw
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	ch, 1
	rcl	al, 1
	rcl	cl, 1
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	ch, 1
	rcl	al, 1
	rcl	cl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	ch, 1
	rcl	ah, 1
	rcl	cl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	ch, 1
	rcl	ah, 1
	rcl	cl, 1
	lodsw
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	ch, 1
	rcl	al, 1
	rcl	cl, 1
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	ch, 1
	rcl	al, 1
	rcl	cl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	ch, 1
	rcl	ah, 1
	rcl	cl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	ch, 1
	rcl	ah, 1
	rcl	cl, 1
	mov	es:[di+5DC0h], dh
	mov	es:[di+3E80h], dl
	mov	es:[di+1F40h], ch
	mov	es:[di], cl
	inc	di
	dec	bx
	jz	short loc_3F280
	jmp	loc_3F1E5
loc_3F280:
	lds	si, [bp+arg_4]
	mov	ax, 0A000h
	mov	es, ax
	assume es:nothing
	mov	bl, 1
	sub	ch, ch
loc_3F28C:
	mov	dx, 3DAh
	in	al, dx		; Video	status bits:
			; 0: retrace.  1=display is in vert or horiz retrace.
			; 1: 1=light pen is triggered; 0=armed
			; 2: 1=light pen switch	is open; 0=closed
			; 3: 1=vertical	sync pulse is occurring.
	and	al, 8
	jz	short loc_3F28C
loc_3F294:
	mov	dx, 3DAh
	in	al, dx		; Video	status bits:
			; 0: retrace.  1=display is in vert or horiz retrace.
			; 1: 1=light pen is triggered; 0=armed
			; 2: 1=light pen switch	is open; 0=closed
			; 3: 1=vertical	sync pulse is occurring.
	and	al, 8
	jnz	short loc_3F294
	mov	al, 2
	mov	dx, 3C4h
	out	dx, al		; EGA: sequencer address reg
			; map mask: data bits 0-3 enable writes	to bit planes 0-3
loc_3F2A2:
	xor	di, di
	mov	al, bl
	shl	bl, 1
	mov	dl, 0C5h 
	out	dx, al		; EGA port: sequencer data register
	mov	bh, 0C8h 
	mov	dl, 14h
loc_3F2AF:
	mov	cl, dl
	rep movsw
	dec	bh
	jnz	short loc_3F2AF
	test	bl, 10h
	jz	short loc_3F2A2
	pop	ds
	pop	di
	pop	si
	pop	es
	assume es:nothing
	pop	bp
	retf
sub_3F1CA endp

; Attributes: bp-based frame

sub_3F2C2 proc far
	push	bp
	mov	bp, sp
	push	si
	push	di
	push	es
	push	ds
	mov	ax, 0A000h
	mov	ds, ax
	assume ds:nothing
	mov	es, ax
	assume es:nothing
	cld
	mov	cs:byte_3E9BA, 2
loc_3F2D7:
	mov	di, 105h
	mov	si, di
	add	si, 50h	
	mov	dx, 3C4h
	mov	al, 2
	out	dx, al		; EGA: sequencer address reg
			; map mask: data bits 0-3 enable writes	to bit planes 0-3
	mov	dx, 3CEh
	mov	al, 4
	out	dx, al		; EGA: graph 1 and 2 addr reg:
			; read map select.
			; Data bits 0-2	select map # for read mode 00.
loc_3F2EB:
	mov	dx, 3DAh
	in	al, dx		; Video	status bits:
			; 0: retrace.  1=display is in vert or horiz retrace.
			; 1: 1=light pen is triggered; 0=armed
			; 2: 1=light pen switch	is open; 0=closed
			; 3: 1=vertical	sync pulse is occurring.
	and	al, 8
	jz	short loc_3F2EB
loc_3F2F3:
	mov	dx, 3DAh
	in	al, dx		; Video	status bits:
			; 0: retrace.  1=display is in vert or horiz retrace.
			; 1: 1=light pen is triggered; 0=armed
			; 2: 1=light pen switch	is open; 0=closed
			; 3: 1=vertical	sync pulse is occurring.
	and	al, 8
	jnz	short loc_3F2F3
	sub	ch, ch
	mov	dx, 3C5h
	mov	al, 0Fh
	out	dx, al		; EGA port: sequencer data register
	mov	dx, 3CFh
	sub	al, al
	out	dx, al		; EGA port: graphics controller	data register
	mov	ax, 16h
	mov	dl, 9
	mov	bl, 60h	
loc_3F310:
	mov	cl, dl
	rep movsw
	add	si, ax
	add	di, ax
	dec	bl
	jnz	short loc_3F310
	dec	cs:byte_3E9BA
	jnz	short loc_3F2D7
	pop	ds
	assume ds:dseg
	pop	es
	assume es:nothing
	pop	di
	pop	si
	pop	bp
	retf
sub_3F2C2 endp

; Attributes: bp-based frame

_vid_drawBigpic	proc far
arg_0= dword ptr  6
arg_4= dword ptr  0Ah
	push	bp
	mov	bp, sp
	push	es
	push	si
	push	di
	push	ds
	lds	si, [bp+arg_0]
	les	di, [bp+arg_4]
	mov	al, 2
	mov	dx, 3C4h
	out	dx, al		; EGA: sequencer address reg
			; map mask: data bits 0-3 enable writes	to bit planes 0-3
	inc	dx
	mov	al, 0Fh
	out	dx, al		; EGA port: sequencer data register
	mov	bx, 4D0h
loc_3F343:
	lodsw
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	ch, 1
	rcl	al, 1
	rcl	cl, 1
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	ch, 1
	rcl	al, 1
	rcl	cl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	ch, 1
	rcl	ah, 1
	rcl	cl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	ch, 1
	rcl	ah, 1
	rcl	cl, 1
	lodsw
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	ch, 1
	rcl	al, 1
	rcl	cl, 1
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	ch, 1
	rcl	al, 1
	rcl	cl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	ch, 1
	rcl	ah, 1
	rcl	cl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	ch, 1
	rcl	ah, 1
	rcl	cl, 1
	mov	es:[di+0E70h], dh
	mov	es:[di+9A0h], dl
	mov	es:[di+4D0h], ch
	mov	es:[di], cl
	inc	di
	dec	bx
	jz	short loc_3F3DE
	jmp	loc_3F343
loc_3F3DE:
	lds	si, [bp+arg_4]
	mov	ax, 0A000h
	mov	es, ax
	assume es:nothing
	mov	bl, 1
	sub	ch, ch
loc_3F3EA:
	mov	dx, 3DAh
	in	al, dx		; Video	status bits:
			; 0: retrace.  1=display is in vert or horiz retrace.
			; 1: 1=light pen is triggered; 0=armed
			; 2: 1=light pen switch	is open; 0=closed
			; 3: 1=vertical	sync pulse is occurring.
	and	al, 8
	jz	short loc_3F3EA
loc_3F3F2:
	mov	dx, 3DAh
	in	al, dx		; Video	status bits:
			; 0: retrace.  1=display is in vert or horiz retrace.
			; 1: 1=light pen is triggered; 0=armed
			; 2: 1=light pen switch	is open; 0=closed
			; 3: 1=vertical	sync pulse is occurring.
	and	al, 8
	jnz	short loc_3F3F2
	mov	al, 2
	mov	dx, 3C4h
	out	dx, al		; EGA: sequencer address reg
			; map mask: data bits 0-3 enable writes	to bit planes 0-3
loc_3F400:
	mov	di, 25Ah
	mov	al, bl
	shl	bl, 1
	mov	dl, 0C5h 
	out	dx, al		; EGA port: sequencer data register
	mov	bh, 58h	
	mov	ax, 1Ah
	mov	dl, 7
loc_3F411:
	mov	cl, dl
	rep movsw
	add	di, ax
	dec	bh
	jnz	short loc_3F411
	test	bl, 10h
	jz	short loc_3F400
	pop	ds
	pop	di
	pop	si
	pop	es
	assume es:nothing
	pop	bp
	retf
_vid_drawBigpic	endp

; Attributes: bp-based frame

sub_3F426 proc far
arg_0= word ptr	 6
	push	bp
	mov	bp, sp
	push	di
	push	ds
	mov	dx, 3C4h
	mov	al, 2
	out	dx, al		; EGA: sequencer address reg
			; map mask: data bits 0-3 enable writes	to bit planes 0-3
	inc	dx
	dec	al
	out	dx, al		; EGA port: sequencer data register
	mov	dx, 3CEh
	mov	al, 4
	out	dx, al		; EGA: graph 1 and 2 addr reg:
			; read map select.
			; Data bits 0-2	select map # for read mode 00.
	inc	dx
	sub	al, al
	out	dx, al		; EGA port: graphics controller	data register
	mov	ax, [bp+arg_0]
	mov	cl, 6
	shl	ax, cl
	mov	di, ax
	shl	ax, 1
	shl	ax, 1
	add	di, ax
	add	di, 0DDh 
	mov	cx, 8
	mov	ax, 0A000h
	mov	ds, ax
	assume ds:nothing
	sub	ax, ax
	dec	ax
loc_3F45D:
	xor	[di], ax
	add	di, 2
	xor	[di], ax
	add	di, 2
	xor	[di], ax
	add	di, 2
	xor	[di], ax
	add	di, 2
	xor	[di], ax
	add	di, 2
	xor	[di], ax
	add	di, 2
	xor	[di], ax
	add	di, 2
	xor	[di], ax
	add	di, 2
	xor	[di], al
	add	di, 18h
	loop	loc_3F45D
	pop	ds
	assume ds:dseg
	pop	di
	pop	bp
	retf
sub_3F426 endp

; Attributes: bp-based frame
sub_3F490 proc near
arg_2= dword ptr  6
arg_6= word ptr	 0Ah
arg_8= byte ptr	 0Ch
arg_A= byte ptr	 0Eh
; FUNCTION CHUNK AT 0C75 SIZE 0000003E BYTES
	push	bp
	mov	bp, sp
	push	es
	push	si
	push	di
	push	ds
	lds	si, [bp+arg_2]
	les	di, cs:dword_3E9AF
	mov	al, 2
	mov	dx, 3C4h
	out	dx, al		; EGA: sequencer address reg
			; map mask: data bits 0-3 enable writes	to bit planes 0-3
	inc	dx
	mov	al, 0Fh
	out	dx, al		; EGA port: sequencer data register
	mov	bl, [bp+arg_8]
loc_3F4AC:
	mov	bh, [bp+arg_A]
	shr	bh, 1
	shr	bh, 1
loc_3F4B3:
	lodsw
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	ch, 1
	rcl	al, 1
	rcl	cl, 1
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	ch, 1
	rcl	al, 1
	rcl	cl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	ch, 1
	rcl	ah, 1
	rcl	cl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	ch, 1
	rcl	ah, 1
	rcl	cl, 1
	lodsw
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	ch, 1
	rcl	al, 1
	rcl	cl, 1
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	ch, 1
	rcl	al, 1
	rcl	cl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	ch, 1
	rcl	ah, 1
	rcl	cl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	ch, 1
	rcl	ah, 1
	rcl	cl, 1
	mov	es:[di+0E70h], dh
	mov	es:[di+9A0h], dl
	mov	es:[di+4D0h], ch
	mov	es:[di], cl
	inc	di
	dec	bh
	jz	short loc_3F54F
	jmp	loc_3F4B3
loc_3F54F:
	dec	bl
	jz	short loc_3F556
	jmp	loc_3F4AC
loc_3F556:
	lds	si, cs:dword_3E9AF
	mov	ax, ds
	mov	es, ax
	assume es:dseg
	mov	ax, [bp+arg_6]
	shr	ax, 1
	shr	ax, 1
	mov	di, ax
	add	di, 11D0h
	mov	word ptr [bp+arg_2+2], di
	mov	bl, 1
	sub	ch, ch
loc_3F573:
	mov	dx, 3DAh
	in	al, dx		; Video	status bits:
			; 0: retrace.  1=display is in vert or horiz retrace.
			; 1: 1=light pen is triggered; 0=armed
			; 2: 1=light pen switch	is open; 0=closed
			; 3: 1=vertical	sync pulse is occurring.
	and	al, 8
	jz	short loc_3F573
loc_3F57B:
	mov	dx, 3DAh
	in	al, dx		; Video	status bits:
			; 0: retrace.  1=display is in vert or horiz retrace.
			; 1: 1=light pen is triggered; 0=armed
			; 2: 1=light pen switch	is open; 0=closed
			; 3: 1=vertical	sync pulse is occurring.
	and	al, 8
	jnz	short loc_3F57B
	mov	al, 2
	mov	ah, [bp+arg_8]
	mov	dx, 3C4h
	out	dx, al		; EGA: sequencer address reg
			; map mask: data bits 0-3 enable writes	to bit planes 0-3
	inc	dx
	mov	al, 1
	mov	bx, word ptr cs:dword_3E9AF
	cmp	[bp+arg_A], 0Ch
	jz	short loc_3F5C5
	cmp	[bp+arg_A], 10h
	jz	short loc_3F5E4
	mov	bp, word ptr [bp+arg_2+2]
	sub	ch, ch
loc_3F5A5:
	mov	di, bp
	mov	si, bx
	mov	cl, ah
	out	dx, al		; EGA port: sequencer data register
	shl	al, 1
loc_3F5AE:
	movsw
	movsw
	movsb
	add	di, 23h	
	loop	loc_3F5AE
	add	bx, 4D0h
	test	al, 10h
	jz	short loc_3F5A5
loc_3F5BE::
	pop	ds
	pop	di
	pop	si
	pop	es
	assume es:nothing
	pop	bp
sub_3F490 endp

; START	OF FUNCTION CHUNK FOR sub_3F603
loc_3F5C3:
	sti
	retf
; END OF FUNCTION CHUNK	FOR sub_3F603
; START	OF FUNCTION CHUNK FOR sub_3F490
loc_3F5C5:
	mov	bp, word ptr [bp+arg_2+2]
	sub	ch, ch
loc_3F5CA:
	mov	di, bp
	mov	si, bx
	mov	cl, ah
	out	dx, al		; EGA port: sequencer data register
	shl	al, 1
loc_3F5D3:
	movsw
	movsb
	add	di, 25h	
	loop	loc_3F5D3
	add	bx, 4D0h
	test	al, 10h
	jz	short loc_3F5CA
	jmp	short loc_3F5BE
loc_3F5E4:
	mov	bp, word ptr [bp+arg_2+2]
	sub	ch, ch
loc_3F5E9:
	mov	di, bp
	mov	si, bx
	mov	cl, ah
	out	dx, al		; EGA port: sequencer data register
	shl	al, 1
loc_3F5F2:
	movsw
	movsw
	add	di, 24h	
	loop	loc_3F5F2
	add	bx, 4D0h
	test	al, 10h
	jz	short loc_3F5E9
	jmp	short loc_3F5BE
; END OF FUNCTION CHUNK	FOR sub_3F490
; Attributes: bp-based frame

sub_3F603 proc far
; FUNCTION CHUNK AT 0C73 SIZE 00000002 BYTES
	cli
	nop
	mov	bx, cs:off_3E958
	cmp	byte ptr [bx], 0
	jz	short loc_3F5C3
	mov	byte ptr [bx], 0
	mov	bx, cs:off_3E956
	cmp	byte ptr [bx], 0
	jz	short loc_3F5C3
	push	bp
	push	si
	push	di
	mov	bp, sp
	mov	bx, cs:off_3E95A
	mov	byte ptr [bx], 1
	sti
	mov	bx, cs:_vid_mouseMoved
	mov	byte ptr [bx], 0
	push	ds
	push	es
	mov	bx, cs:vid_mouseXp
	mov	ax, [bx]
	mov	cs:vid_mouseX, ax
	shr	ax, 1
	shr	ax, 1
	shr	ax, 1
	mov	si, ax
	mov	bx, cs:vid_mouseYp
	mov	ax, [bx]
	mov	cs:vid_mouseY, ax
	shl	ax, 1
	shl	ax, 1
	shl	ax, 1
	add	si, ax
	shl	ax, 1
	shl	ax, 1
	add	si, ax
	mov	cs:vid_mouseIndex, si
	mov	di, offset vid_mouseBuf
	mov	ax, cs
	mov	es, ax
	assume es:seg024
	mov	ax, 0A000h
	mov	ds, ax
	assume ds:nothing
	mov	dx, 3CEh
	mov	al, 4
	out	dx, al		; EGA: graph 1 and 2 addr reg:
			; read map select.
			; Data bits 0-2	select map # for read mode 00.
	inc	dx
	mov	ax, 400h
	mov	bx, 10h
	mov	bp, 25h	
	cld
loc_3F682:		; EGA port: graphics controller	data register
	out	dx, al
	inc	al
	mov	cx, bx
loc_3F687:
	movsw
	movsb
	add	si, bp
	loop	loc_3F687
	mov	si, es:vid_mouseIndex
	cmp	al, ah
	jnz	short loc_3F682
	pop	es
	assume es:nothing
	pop	ds
	assume ds:dseg
	push	cs
	call	sub_3E977
	mov	bx, cs:off_3E95A
	mov	byte ptr [bx], 0
	pop	di
	pop	si
	pop	bp
	sti
	retf
sub_3F603 endp


sub_3F6A9 proc far
	cli
	nop
	mov	bx, cs:off_3E958
	cmp	byte ptr [bx], 0
	jnz	short loc_3F712
	inc	byte ptr [bx]
	mov	bx, cs:off_3E956
	cmp	byte ptr [bx], 0
	jz	short loc_3F712
	mov	bx, cs:off_3E95A
	mov	byte ptr [bx], 1
	sti
	push	bp
	push	es
	push	si
	push	di
	push	ds
	mov	ax, cs
	mov	ds, ax
	assume ds:seg024
	mov	di, cs:vid_mouseIndex
	mov	si, offset vid_mouseBuf
	mov	ax, 0A000h
	mov	es, ax
	assume es:nothing
	mov	dx, 3C4h
	mov	al, 2
	out	dx, al		; EGA: sequencer address reg
			; map mask: data bits 0-3 enable writes	to bit planes 0-3
	inc	dx
	mov	ax, 1001h
	mov	bx, 10h
	mov	bp, 25h	
	cld
loc_3F6F1:		; EGA port: sequencer data register
	out	dx, al
	shl	al, 1
	mov	cx, bx
loc_3F6F6:
	movsw
	movsb
	add	di, bp
	loop	loc_3F6F6
	mov	di, cs:vid_mouseIndex
	test	al, ah
	jz	short loc_3F6F1
	pop	ds
	assume ds:dseg
	mov	bx, cs:off_3E95A
	mov	byte ptr [bx], 0
	pop	di
	pop	si
	pop	es
	assume es:nothing
	pop	bp
loc_3F712:
	sti
	retf
sub_3F6A9 endp


sub_3F714 proc far
	push	bp
	push	es
	push	si
	push	di
	push	ds
	mov	ax, cs
	mov	ds, ax
	assume ds:seg024
	mov	ax, 0A000h
	mov	es, ax
	assume es:nothing
	mov	dx, 3CEh
	mov	al, 4
	out	dx, al		; EGA: graph 1 and 2 addr reg:
			; read map select.
			; Data bits 0-2	select map # for read mode 00.
	mov	dx, 3C4h
	mov	al, 2
	out	dx, al		; EGA: sequencer address reg
			; map mask: data bits 0-3 enable writes	to bit planes 0-3
	mov	bx, 1
	mov	ax, cs:vid_mouseX
	and	al, 7
	mov	ch, al
loc_3F739:
	mov	si, cs:off_3EF0A
	mov	dx, 3CFh
	mov	al, bh
	out	dx, al		; EGA port: graphics controller	data register
	inc	bh
	mov	dx, 3C5h
	mov	al, bl
	out	dx, al		; EGA port: sequencer data register
	shl	bl, 1
	mov	dl, 10h
	mov	di, cs:vid_mouseIndex
loc_3F755:
	lodsb
	mov	cl, ch
	sub	ah, ah
	ror	ax, cl
	not	ax
	and	es:[di], ax
	inc	di
	lodsb
	mov	cl, ch
	sub	ah, ah
	ror	ax, cl
	not	ax
	and	es:[di], ax
	add	di, 27h	
	dec	dl
	jnz	short loc_3F755
	test	bl, 10h
	jz	short loc_3F739
	mov	bx, 1
loc_3F77D:
	mov	dx, 3CFh
	mov	al, bh
	out	dx, al		; EGA port: graphics controller	data register
	inc	bh
	mov	dx, 3C5h
	mov	al, bl
	out	dx, al		; EGA port: sequencer data register
	shl	bl, 1
	mov	dl, 10h
	mov	di, cs:vid_mouseIndex
loc_3F794:
	lodsb
	mov	cl, ch
	sub	ah, ah
	ror	ax, cl
	or	es:[di], ax
	inc	di
	lodsb
	mov	cl, ch
	sub	ah, ah
	ror	ax, cl
	or	es:[di], ax
	add	di, 27h	
	dec	dl
	jnz	short loc_3F794
	test	bl, 10h
	jz	short loc_3F77D
	pop	ds
	assume ds:dseg
	pop	di
	pop	si
	pop	es
	assume es:nothing
	pop	bp
	retf
sub_3F714 endp

; START	OF FUNCTION CHUNK FOR sub_3F7C1
loc_3F7BB:
	pop	di
	pop	si
	pop	es
	pop	ds
	pop	bp
	retf
; END OF FUNCTION CHUNK	FOR sub_3F7C1
; Attributes: bp-based frame

sub_3F7C1 proc far
arg_2= dword ptr  6
; FUNCTION CHUNK AT 0E6B SIZE 00000006 BYTES
	push	bp
	mov	bp, sp
	push	ds
	push	es
	push	si
	push	di
	lds	si, [bp+arg_2]
loc_3F7CB:
	mov	ax, [si]
	cmp	ax, 0FFFFh
	jz	short loc_3F7BB
	mov	cx, ax
	and	ax, 7F0h
	mov	bx, ax
	shr	bx, 1
	shl	ax, 1
	add	bx, ax
	mov	ax, cx
	and	ax, 0Fh
	add	ax, bx
	add	ax, 25Ah
	and	cx, 7000h
	shl	cx, 1
	or	ax, cx
	mov	[si], ax
	add	si, 2
	rol	cx, 1
	rol	cx, 1
	rol	cx, 1
	inc	cx
loc_3F7FD:
	mov	ax, [si]
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	bh, 1
	rcl	al, 1
	rcl	bl, 1
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	bh, 1
	rcl	al, 1
	rcl	bl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	bh, 1
	rcl	ah, 1
	rcl	bl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	bh, 1
	rcl	ah, 1
	rcl	bl, 1
	mov	ax, [si+2]
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	bh, 1
	rcl	al, 1
	rcl	bl, 1
	rcl	al, 1
	rcl	dh, 1
	rcl	al, 1
	rcl	dl, 1
	rcl	al, 1
	rcl	bh, 1
	rcl	al, 1
	rcl	bl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	bh, 1
	rcl	ah, 1
	rcl	bl, 1
	rcl	ah, 1
	rcl	dh, 1
	rcl	ah, 1
	rcl	dl, 1
	rcl	ah, 1
	rcl	bh, 1
	rcl	ah, 1
	rcl	bl, 1
	mov	[si+3],	dh
	mov	[si+2],	dl
	mov	[si+1],	bh
	mov	[si], bl
	add	si, 4
	dec	cx
	jz	short loc_3F896
	jmp	loc_3F7FD
loc_3F896:
	jmp	loc_3F7CB
sub_3F7C1 endp

; Attributes: bp-based frame

sub_3F899 proc far
arg_0= dword ptr  6
	push	bp
	mov	bp, sp
	push	ds
	push	es
	push	si
	push	di
	lds	si, [bp+arg_0]
	mov	ax, 0A000h
	mov	es, ax
	assume es:nothing
	mov	dx, 3C4h
	mov	al, 2
	out	dx, al		; EGA: sequencer address reg
			; map mask: data bits 0-3 enable writes	to bit planes 0-3
	mov	dx, 3CEh
	mov	al, 4
	out	dx, al		; EGA: graph 1 and 2 addr reg:
			; read map select.
			; Data bits 0-2	select map # for read mode 00.
	mov	bx, 3C5h
loc_3F8B7:
	lodsw
	cmp	ax, 0FFFFh
	jz	short loc_3F90F
	mov	cx, ax
	rol	cx, 1
	rol	cx, 1
	rol	cx, 1
	and	cx, 7
	inc	cx
	and	ax, 1FFFh
	mov	di, ax
loc_3F8CE:
	mov	dx, bx
	mov	al, 1
	out	dx, al		; EGA port: sequencer data register
	mov	dx, 3CFh
	dec	al
	out	dx, al		; EGA port: graphics controller	data register
	lodsb
	xor	es:[di], al
	mov	dx, bx
	mov	al, 2
	out	dx, al		; EGA port: sequencer data register
	mov	dx, 3CFh
	dec	al
	out	dx, al		; EGA port: graphics controller	data register
	lodsb
	xor	es:[di], al
	mov	dx, bx
	mov	al, 4
	out	dx, al		; EGA port: sequencer data register
	mov	dx, 3CFh
	mov	al, 2
	out	dx, al		; EGA port: graphics controller	data register
	lodsb
	xor	es:[di], al
	mov	dx, bx
	mov	al, 8
	out	dx, al		; EGA port: sequencer data register
	mov	dx, 3CFh
	mov	al, 3
	out	dx, al		; EGA port: graphics controller	data register
	lodsb
	xor	es:[di], al
	inc	di
	loop	loc_3F8CE
	jmp	short loc_3F8B7
loc_3F90F:
	mov	ax, si
	mov	dx, ds
	pop	di
	pop	si
	pop	es
	assume es:nothing
	pop	ds
	pop	bp
	retf
sub_3F899 endp

; Attributes: bp-based frame

sub_3F919 proc far
	push	bp
	mov	bp, sp
	push	es
	push	di
	mov	al, 2
	mov	dx, 3C4h
	out	dx, al		; EGA: sequencer address reg
			; map mask: data bits 0-3 enable writes	to bit planes 0-3
	inc	dx
	mov	al, 0Fh
	out	dx, al		; EGA port: sequencer data register
	mov	ax, 0A000h
	mov	es, ax
	assume es:nothing
	sub	ax, ax
	mov	di, 25Ah
	mov	dh, 58h	
	mov	bx, 1Ah
	mov	dl, 7
loc_3F939:
	mov	cl, dl
	rep stosw
	add	di, bx
	dec	dh
	jnz	short loc_3F939
	pop	di
	pop	es
	assume es:nothing
	pop	bp
	retf
sub_3F919 endp


nullsub_3 proc far
	retf
nullsub_3 endp


nullsub_2 proc far
	retf
nullsub_2 endp

; Attributes: bp-based frame

_vid_setMouseIcon proc far
arg_0= word ptr	 6
	push	bp
	mov	bp, sp
	mov	bx, [bp+arg_0]
	shl	bx, 1
	mov	bx, cs:off_3EF0C[bx]
	mov	cs:off_3EF0A, bx
	pop	bp
	retf
_vid_setMouseIcon endp


sub_3F95D proc far
	push	bp
	push	ds
	pop	ds
	pop	bp
	retf
sub_3F95D endp

db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
db    0
seg024 ends

; Segment type:	Pure code
seg025 segment para public 'DATA' use16
	assume cs:seg025
	assume es:nothing, ss:nothing, ds:seg025, fs:nothing, gs:nothing

music_driver proc far
	jmp	near ptr _music_driver
music_driver endp

j_music_init    proc near
                jmp     music_init
j_music_init    endp

j_music_end     proc near
                jmp     music_end
j_music_end     endp

j_music_end_0   proc near
                jmp     music_end
j_music_end_0   endp

j_music_end_1   proc near
                jmp     music_end
j_music_end_1   endp

j_music_end_2   proc near
                jmp     music_end
j_music_end_2   endp

musicSeg dw 0
noteFreqs dw 21248, 16368, 11776, 7440,	3344, 65008, 61360, 57920
dw 54656, 51600, 48704,	45968, 43392, 40952, 38656, 36488
dw 34440, 32504, 30680,	28960, 27328, 25800, 24352, 22984
dw 21696, 20476, 19328,	18244, 17220, 16252, 15340, 14480
dw 13664, 12900, 12176,	11492, 10848, 10238, 9664, 9122
dw 8610, 8126, 7670, 7240, 6832, 6450, 6088, 5746
dw 5424, 5119, 4832, 4561, 4305, 4063, 3835, 3620
dw 3416, 3225, 3044, 2873, 2712, 2559, 2416, 2280
dw 2152, 2031, 1917, 1810, 1708, 1612, 1522, 1436
dw 1356, 1279, 1208, 1140, 1076, 1015, 958, 905
dw 854,	806, 761, 718, 678, 639, 604, 570
dw 538,	507, 479, 452, 427, 403, 380, 359
byte_3FB24 db 1
byte_3FB25 db 0
byte_3FB26 db 0
byte_3FB27 db 0
word_3FB28 dw 0
word_3FB2A dw 0
baseNote dw 0
word_3FB2E dw 0
byte_3FB30 db 0
byte_3FB31 db 0
noteDurationMaybe db 0
byte_3FB33 db 0
byte_3FB34 db 0
musicOn	db 0
db    0
db    0
byte_3FB38 db 1
db    0
off_3FB3A dw offset music_playNote
dw offset music_init
dw offset music_end
dw offset _music_speakerOff
dw offset sub_3FBC5

_music_driver proc far
	push	bx
	push	cx
	push	dx
	push	di
	push	si
	push	ds
	push	cs
	pop	ds
	mov	si, bx
	xor	bh, bh
	mov	bl, ah
	shl	bl, 1
	call	off_3FB3A[bx]
	pop	ds
	assume ds:dseg
	pop	si
	pop	di
	pop	dx
	pop	cx
	pop	bx
	retf
_music_driver endp

	assume ds:seg025
music_init proc	near
	cli
	mov	musicSeg, cx
	push	es
	mov	es, cx
	mov	ax, es:0
	mov	baseNote, ax
	mov	word_3FB2E, ax
	xor	di, di
loc_3FB73:
	mov	al, es:[di+4Bh]
	mov	byte_3FB24[di],	al
	inc	di
	cmp	di, 2
	jnz	short loc_3FB73
	pop	es
	mov	byte_3FB26, 0
	mov	byte_3FB27, 0
	mov	word_3FB2A, 0
	mov	noteDurationMaybe, 0
	in	al, 61h		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	or	al, 3
	out	61h, al		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	in	al, 61h		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	and	al, 0FCh
	out	61h, al		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	mov	al, 0B6h 
	out	43h, al		; Timer	8253-5 (AT: 8254.2).
	mov	ax, 2
	out	42h, al		; Timer	8253-5 (AT: 8254.2).
	mov	al, ah
	out	42h, al		; Timer	8253-5 (AT: 8254.2).
	mov	musicOn, 1
	sti
	retn
music_init endp

music_end proc near
	cli
	mov	musicOn, 0
	in	al, 61h		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	and	al, 0FCh
	out	61h, al		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	sti
	retn
music_end endp

sub_3FBC5 proc near
	cli
	mov	byte_3FB38, 1
	sti
	retn
sub_3FBC5 endp

_music_speakerOff proc near
	cli
	mov	byte_3FB38, 0
	in	al, 61h		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	and	al, 0FCh
	out	61h, al		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	sti
	retn
_music_speakerOff endp

music_playNote proc near
	cmp	musicOn, 1
	jz	short loc_3FBE5
	jmp	locret_3FC96
loc_3FBE5:
	mov	es, musicSeg
	mov	si, baseNote
	cmp	noteDurationMaybe, 0
	jz	short loc_3FBFB
	dec	noteDurationMaybe
	jmp	loc_3FC92
loc_3FBFB:
	mov	al, es:[si]
	inc	si
	test	al, al
	js	short loc_3FC1B
	mov	ah, byte_3FB30
	dec	si
	cmp	byte_3FB33, 0
	jz	short loc_3FC34
	inc	si
	cmp	byte_3FB34, 0
	jz	short loc_3FC18
	inc	si
loc_3FC18:
	jmp	short loc_3FC7F
db  90h	; 
loc_3FC1B:
	cmp	al, 0FCh	; is 0x80, the song loops. Otherwise the song is
			; over.
	jnz	short loc_3FC22
	jmp	short loc_3FC97
db  90h	; 
loc_3FC22:
	mov	ah, al
	and	ah, 0Fh
	mov	byte_3FB31, ah
	mov	ah, al
	and	ah, 0F0h
	mov	byte_3FB30, ah
loc_3FC34:
	cmp	ah, 0E0h
	jnz	short loc_3FC48
	mov	byte_3FB34, 1
	mov	byte_3FB33, 1
	inc	si
	inc	si
	jmp	short loc_3FC7F
db  90h	; 
loc_3FC48:
	mov	byte_3FB33, 0
	mov	byte_3FB34, 1
	cmp	ah, 0C0h
	jnz	short loc_3FC60
	mov	byte_3FB34, 0
	inc	si
	jmp	short loc_3FC7F
db 90h
loc_3FC60:
	cmp	ah, 90h
	jnz	short loc_3FC68
	jmp	short loc_3FCB3
db  90h	; 
loc_3FC68:
	cmp	ah, 80h
	jnz	short loc_3FC70
	jmp	loc_3FD0A
loc_3FC70:
	inc	si
	inc	si
	mov	byte_3FB34, 1
	mov	byte_3FB33, 1
	jmp	short loc_3FC7F
db  90h	; 
loc_3FC7F:
	mov	al, es:[si]
	inc	si
	cmp	al, 0
	jnz	short loc_3FC8A
	jmp	loc_3FBFB
loc_3FC8A:
	dec	al
	mov	noteDurationMaybe, al
	jmp	short loc_3FC92
db  90h	; 
loc_3FC92:
	mov	baseNote, si
locret_3FC96:
	retn
loc_3FC97:
	mov	al, es:[si]
	inc	si
	cmp	al, 80h
	jz	short loc_3FCAC
	mov	musicOn, 0
	in	al, 61h		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	and	al, 0FCh
	out	61h, al		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	jmp	short locret_3FC96
loc_3FCAC:
	mov	si, word_3FB2E
	jmp	loc_3FBFB
loc_3FCB3:
	mov	bl, es:[si+1]
	cmp	bl, 0
	jnz	short loc_3FCBF
	jmp	short loc_3FD0A
db  90h	; 
loc_3FCBF:
	xor	di, di
	xor	cx, cx
	mov	bl, es:[si]
	inc	si
	inc	si
	mov	al, byte_3FB31
	cmp	al, byte_3FB24
	jnz	short loc_3FD07
	mov	byte_3FB26, 1
	mov	byte_3FB27, bl
	add	bl, byte_3FB25
	shl	bl, 1
	xor	bh, bh
	mov	bx, noteFreqs[bx]
	mov	word_3FB28, bx
	cmp	byte_3FB38, 1
	jz	short loc_3FCF9
	in	al, 61h		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	and	al, 0FCh
	out	61h, al		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	jmp	short loc_3FC7F
loc_3FCF9:		; PC/XT	PPI port B bits:
	in	al, 61h		; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	or	al, 3
	out	61h, al		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	mov	ax, bx
	out	42h, al		; Timer	8253-5 (AT: 8254.2).
	mov	al, ah
	out	42h, al		; Timer	8253-5 (AT: 8254.2).
loc_3FD07:
	jmp	loc_3FC7F
loc_3FD0A:
	xor	di, di
	xor	cx, cx
	mov	bl, es:[si]
	inc	si
	inc	si
	mov	al, byte_3FB31
	cmp	al, byte_3FB24
	jnz	short loc_3FD27
	mov	byte_3FB26[di],	0
	in	al, 61h		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
	and	al, 0FCh
	out	61h, al		; PC/XT	PPI port B bits:
			; 0: Tmr 2 gate	 OR	03H=spkr ON
			; 1: Tmr 2 data	  AND	0fcH=spkr OFF
			; 3: 1=read high switches
			; 4: 0=enable RAM parity checking
			; 5: 0=enable I/O channel check
			; 6: 0=hold keyboard clock low
			; 7: 0=enable kbrd
loc_3FD27:
	jmp	loc_3FC7F
music_playNote endp

byte_3FD2A db 0C3h, 0E9h, 18h, 2, 0E9h,	30h, 2,	0E9h
db 0A4h, 2, 0E9h, 0A1h,	2, 0E9h, 9Eh, 2
db 0E9h, 9Bh, 2, 6 dup(0), 0FAh, 3, 0C0h
db 3, 8Ah, 3, 58h, 3, 28h, 3, 0FAh, 2, 0D0h
db 2, 0A6h, 2, 80h, 2, 5Ch, 2, 3Ch, 2, 1Ah
db 2, 0FCh, 1, 0E0h, 1,	0C5h, 1, 0ACh, 1
db 94h,	1, 7Dh,	1, 68h,	1, 53h,	1, 40h,	1
db 2Eh,	1, 1Eh,	1, 0Dh,	1, 0FEh, 0, 0F0h
db 0, 0E3h, 0, 0D6h, 0,	0CAh, 0, 0BEh, 0
db 0B4h, 0, 0AAh, 0, 0A0h, 0, 97h, 0, 8Fh
db 0, 87h, 0, 7Fh, 0, 78h, 0, 71h, 0, 6Bh
db 0, 65h, 0, 5Fh, 0, 5Ah, 0, 55h, 0, 50h
db 0, 4Bh, 0, 47h, 0, 43h, 0, 3Fh, 0, 3Ch
db 0, 38h, 2 dup(0), 1,	2, 3, 4, 5, 6, 7
db 8, 9, 0Ah, 0Bh, 0Ch,	0Dh, 0Eh, 0Fh, 10h
db 6 dup(0), 10h, 0D9h,	0, 0DEh, 0, 0D9h
db 0, 0DEh, 0, 0C0h, 0,	0C0h, 0, 0D9h, 0
db 0DEh, 0, 0DEh, 0, 0D9h, 0, 0DEh, 0, 0DEh
db 0, 0C0h, 0, 0DEh, 0,	0D4h, 0, 0DEh, 0
db 0CFh, 0, 0CAh, 0, 0CFh, 0, 0CAh, 0, 0EDh
db 0, 0F5h, 0, 6Dh, 1, 0, 5Fh, 1, 6Dh, 1
db 0, 3Eh, 1, 6Dh, 1, 0, 44h, 1, 6Dh, 1
db 0, 4Eh, 1, 86h, 1, 1Eh, 0FBh, 0, 62h
db 1, 78h, 1Eh,	1, 6Dh,	1, 0, 3, 1, 76h
db 1, 5Ah, 13h,	1, 76h,	1, 0, 2Eh, 1, 6Dh
db 2 dup(1), 3Ah, 56h, 3, 7, 8,	9, 0Ah,	0FFh
db 2, 5, 2 dup(6), 3 dup(7), 0FFh, 2, 3
db 5, 6, 7, 2 dup(8), 2	dup(9),	0Ah, 0Bh
db 0Ch,	0Dh, 0Eh, 0Fh, 0FFh, 1,	5, 7, 9
db 0Ah,	0Bh, 0Ch, 0Dh, 0Eh, 0Fh, 0FFh, 1
db 5, 6, 7, 8, 2 dup(9), 2 dup(0Ah), 2 dup(0Bh)
db 0Ch,	0Dh, 0Eh, 0Fh, 0FFh, 1,	4, 0Bh,	5
db 0Ch,	6, 0Bh,	7, 0Ch,	9, 0Bh,	0Ch, 0Dh
db 0Eh,	0Fh, 0FFh, 1, 3, 6, 2 dup(0Fh),	0FFh
db 1, 5, 6, 7, 8, 9, 0Ah, 0Bh, 0Fh, 0FFh
db 1, 3, 4, 5, 6, 7, 2 dup(8), 9, 0Ah, 0Bh
db 2 dup(0Ch), 0Dh, 0Eh, 0Fh, 0FFh, 1, 6
db 0Fh,	0FFh, 0, 1, 2, 2 dup(1), 0, 0FFh
db 2 dup(0FEh),	0FFh, 80h, 0, 1, 2, 1, 0
db 0FFh, 0FEh, 0FFh, 80h, 0, 2 dup(1), 2
db 3, 2	dup(2),	1, 0, 1, 2 dup(0FFh), 2	dup(0FEh)
db 0FFh, 80h, 0FEh, 0FDh, 0FCh,	0FBh, 0FAh
db 0F9h, 0F8h, 0F7h, 0F6h, 0F5h, 0F4h, 0F3h
db 0F2h, 0F1h, 0F0h, 0EFh, 0EEh, 0EDh, 0ECh
db 0EBh, 0EAh, 80h, 1, 4, 0FFh,	9, 3 dup(0C4h)
db 4Dh dup(0), 80h, 0A0h, 0C0h,	0, 90h,	0B0h
db 0D0h, 0F0h, 17h dup(0), 1, 0, 0E9h, 2
db 36h,	2, 0ADh, 2, 0CDh, 2, 0C5h, 2, 53h
db 51h,	52h, 57h, 56h, 1Eh, 0Eh, 1Fh, 8Bh
db 0F3h, 32h, 0FFh, 8Ah, 0DCh, 0D0h, 0E3h
db 0FFh, 97h, 11h, 2, 1Fh, 5Eh,	5Fh, 5Ah
db 59h,	5Bh, 0CBh, 0FAh, 0A2h, 10h, 2, 89h
db 0Eh,	12h, 0,	6, 8Eh,	0C1h, 26h, 0A1h
db 2 dup(0), 0A3h, 0, 2, 0A3h, 2 dup(2)
db 33h,	0FFh, 26h, 8Ah,	45h, 43h, 88h, 85h
db 9Ch,	1, 47h,	83h, 0FFh, 8, 75h, 0F2h
db 7, 33h, 0FFh, 8Bh, 0DFh, 0D1h, 0E3h,	0C6h
db 85h,	0A4h, 1, 0, 0C6h, 85h, 0A8h, 1,	0
db 0C7h, 87h, 0F8h, 1, 2 dup(0), 0C6h, 85h
db 0BCh, 1, 0Fh, 0C6h, 85h, 0D4h, 1, 0,	0C6h
db 85h,	0C0h, 1, 0, 0C6h, 85h, 0B4h, 1,	0
db 47h,	83h, 0FFh, 4, 75h, 0D2h, 0B0h, 9Fh
db 0E6h, 0C0h, 0B0h, 0BFh, 0E6h, 0C0h, 0B0h
db 0DFh, 0E6h, 0C0h, 0B0h, 0FFh, 0E6h, 0C0h
db 0C6h, 2 dup(6), 2, 0, 0C6h, 6, 0Ah, 2
db 0, 0C6h, 6, 9, 2, 1,	0FBh, 0C3h, 0FAh
db 0C6h, 6, 9, 2, 0, 0B0h, 9Fh,	0E6h, 0C0h
db 0B0h, 0BFh, 0E6h, 0C0h, 0B0h, 0DFh, 0E6h
db 0C0h, 0B0h, 0FFh, 0E6h, 0C0h, 0FBh, 0C3h
db 0FAh, 0C6h, 6, 0Fh, 2, 1, 0FBh, 0C3h
db 0FAh, 0C6h, 6, 0Fh, 2, 0, 0C6h, 6, 0B4h
db 1, 0, 0C6h, 6, 0B5h,	1, 0, 0C6h, 6, 0B6h
db 1, 0, 0C6h, 6, 0B7h,	1, 0, 0EBh, 0CAh
db 80h,	3Eh, 9,	2, 1, 74h, 3, 0E9h, 2 dup(1)
db 8Eh,	6, 12h,	0, 8Bh,	36h, 0,	2, 33h,	0FFh
db 80h,	3Eh, 6,	2, 0, 74h, 7, 0FEh, 0Eh
db 6, 2, 0E9h, 0C4h, 0,	26h, 8Ah, 4, 46h
db 84h,	0C0h, 78h, 18h,	8Ah, 26h, 4, 2,	4Eh
db 80h,	3Eh, 7,	2, 0, 74h, 25h,	46h, 80h
db 3Eh,	8, 2, 0, 74h, 1, 46h, 0E9h, 91h
db 0, 3Ch, 0FCh, 75h, 3, 0E9h, 0E3h, 0,	8Ah
db 0E0h, 80h, 0E4h, 0Fh, 88h, 26h, 5, 2
db 8Ah,	0E0h, 80h, 0E4h, 0F0h, 88h, 26h
db 4, 2, 80h, 0FCh, 0E0h, 75h, 3Dh, 0C6h
db 6, 8, 2, 1, 26h, 8Ah, 14h, 46h, 26h,	8Ah
db 34h,	46h, 0D0h, 0EEh, 73h, 3, 80h, 0CAh
db 80h,	89h, 16h, 0Dh, 2, 0A0h,	5, 2, 33h
db 0FFh, 3Ah, 85h, 9Ch,	1, 75h,	11h, 80h
db 0BDh, 0A4h, 2 dup(1), 75h, 0Ah, 0C6h
db 85h,	0C0h, 2	dup(1),	57h, 0E8h, 0B0h
db 2, 5Fh, 47h,	83h, 0FFh, 3, 75h, 0E3h
db 0EBh, 37h, 90h, 0C6h, 6, 7, 2, 0, 0C6h
db 6, 8, 2, 1, 80h, 0FCh, 0C0h,	75h, 8,	0C6h
db 6, 8, 2, 0, 0EBh, 59h, 90h, 80h, 0FCh
db 90h,	75h, 3,	0E9h, 96h, 0, 80h, 0FCh
db 80h,	75h, 3,	0E9h, 94h, 1, 2	dup(46h)
db 0C6h, 6, 8, 2, 1, 0C6h, 6, 7, 2, 1, 0EBh
db 1, 90h, 26h,	8Ah, 4,	46h, 3Ch, 0, 75h
db 3, 0E9h, 44h, 0FFh, 0FEh, 0C8h, 0A2h
db 6, 2, 0EBh, 1, 90h, 89h, 36h, 0, 2, 33h
db 0FFh, 8Bh, 0DFh, 0D1h, 0E3h,	53h, 0E8h
db 6Ah,	2, 5Bh,	0C6h, 85h, 0C0h, 1, 0, 80h
db 0BDh, 0A4h, 2 dup(1), 75h, 4, 0FFh, 87h
db 0F8h, 1, 47h, 83h, 0FFh, 4, 75h, 0E1h
db 0C3h, 33h, 0FFh, 26h, 8Ah, 1Ch, 46h,	0A0h
db 5, 2, 3Ch, 9, 74h, 0Bh, 3Ah,	85h, 9Ch
db 1, 75h, 5, 57h, 0E8h, 0E1h, 1, 5Fh, 47h
db 83h,	0FFh, 4, 75h, 0E8h, 0EBh, 0A7h,	26h
db 8Ah,	4, 46h,	3Ch, 80h, 74h, 17h, 0C6h
db 6, 9, 2, 0, 0B0h, 9Fh, 0E6h,	0C0h, 0B0h
db 0BFh, 0E6h, 0C0h, 0B0h, 0DFh, 0E6h, 0C0h
db 0B0h, 0FFh, 0E6h, 0C0h, 0EBh, 0C0h, 8Bh
db 36h,	2 dup(2), 0E9h,	0D0h, 0FEh, 26h
db 8Ah,	5Ch, 1,	80h, 0FBh, 0, 75h, 3, 0E9h
db 0FAh, 0, 33h, 0FFh, 26h, 8Ah, 1Ch, 46h
db 26h,	8Ah, 24h, 46h, 0A0h, 5,	2, 3Ch,	9
db 75h,	3, 0E9h, 2Dh, 1, 3Ah, 85h, 9Ch,	1
db 74h,	3, 0E9h, 8Ch, 0, 80h, 0BDh, 0A4h
db 2 dup(1), 75h, 3, 0E9h, 82h,	0, 57h,	0C6h
db 85h,	0A4h, 2	dup(1),	88h, 9Dh, 0A8h,	1
db 2, 9Dh, 0A0h, 1, 80h, 0FBh, 0, 7Dh, 0Bh
db 80h,	0C3h, 0Ch, 80h,	0FBh, 0, 7Ch, 0F8h
db 0EBh, 0Eh, 90h, 80h,	0FBh, 32h, 7Eh,	8
db 80h,	0EBh, 0Ch, 80h,	0FBh, 32h, 7Fh,	0F3h
db 0D0h, 0E3h, 32h, 0FFh, 8Bh, 9Fh, 18h
db 0, 0E8h, 2Bh, 1, 8Ah, 85h, 0ACh, 1, 88h
db 85h,	0B0h, 1, 8Ah, 85h, 0B8h, 1, 88h
db 85h,	0BCh, 1, 80h, 3Eh, 0Fh,	2, 1, 74h
db 10h,	0C6h, 85h, 0B4h, 1, 0, 0B0h, 0Fh
db 0Ah,	85h, 0F4h, 1, 0E6h, 0C0h, 0EBh,	0Ch
db 90h,	0C6h, 85h, 0B4h, 2 dup(1), 0Ah,	85h
db 0F4h, 1, 0E6h, 0C0h,	0D1h, 0E7h, 8Bh
db 85h,	0C4h, 1, 89h, 85h, 0CCh, 1, 89h
db 9Dh,	0E8h, 1, 8Bh, 85h, 0E0h, 1, 89h
db 85h,	0D8h, 1, 5Fh, 0E9h, 0CCh, 0FEh,	47h
db 83h,	0FFh, 4, 74h, 3, 0E9h, 62h, 0FFh
db 53h,	33h, 0FFh, 33h,	0D2h, 0C7h, 6, 0Bh
db 2, 2	dup(0FFh), 8Bh,	0DFh, 0D1h, 0E3h
db 3Ah,	85h, 9Ch, 1, 75h, 0Eh, 8Bh, 8Fh
db 0F8h, 1, 3Bh, 0D1h, 73h, 6, 8Bh, 0D1h
db 89h,	3Eh, 0Bh, 2, 47h, 83h, 0FFh, 4,	75h
db 0E2h, 83h, 3Eh, 0Bh,	2, 0FFh, 75h, 4
db 5Bh,	0E9h, 8Fh, 0FEh, 8Bh, 0Eh, 0Bh,	2
db 8Bh,	0F9h, 8Bh, 0DFh, 0D1h, 0E3h, 0C7h
db 87h,	0F8h, 1, 2 dup(0), 5Bh,	0E9h, 2Dh
db 0FFh, 33h, 0FFh, 26h, 8Ah, 1Ch, 2 dup(46h)
db 0A0h, 5, 2, 3Ah, 85h, 9Ch, 1, 75h, 2Eh
db 38h,	9Dh, 0A8h, 1, 75h, 28h,	57h, 0C6h
db 85h,	0A4h, 1, 0, 0C6h, 85h, 0A8h, 1,	0
db 0B0h, 0Fh, 88h, 85h,	0BCh, 1, 0Ah, 85h
db 0F4h, 1, 0E6h, 0C0h,	0C6h, 85h, 0B4h
db 1, 0, 0D1h, 0E7h, 0C7h, 85h,	0F8h, 1
db 2 dup(0), 5Fh, 0E9h,	3Dh, 0FEh, 47h,	83h
db 0FFh, 4, 75h, 0C6h, 0E9h, 34h, 0FEh,	80h
db 0FBh, 24h, 74h, 8, 80h, 0FBh, 26h, 74h
db 16h,	0E9h, 27h, 0FEh, 0BFh, 3, 0, 0B3h
db 11h,	0E8h, 50h, 0, 0BFh, 3, 0, 0B0h,	2 dup(0E6h)
db 0C0h, 57h, 0E9h, 0FCh, 0FEh,	0BFh, 3
db 0, 0B3h, 17h, 0E8h, 3Dh, 0, 0BFh, 3,	0
db 0B0h, 0E4h, 0E6h, 0C0h, 57h,	2 dup(0E9h)
db 0FEh, 52h, 8Bh, 0D0h, 24h, 0Fh, 0D1h
db 0E2h, 0D1h, 0E2h, 0D1h, 0E2h, 0D1h, 0E2h
db 8Ah,	0E6h, 80h, 0E4h, 3Fh, 5Ah, 0C3h
db 8Bh,	0C3h, 8Bh, 0D0h, 24h, 0Fh, 0D1h
db 0E2h, 0D1h, 0E2h, 0D1h, 0E2h, 0D1h, 0E2h
db 8Ah,	0E6h, 80h, 0E4h, 3Fh, 0Ah, 85h,	0F0h
db 1, 0E6h, 0C0h, 8Ah, 0C4h, 0E6h, 0C0h
db 0C3h, 53h, 56h, 32h,	0FFh, 80h, 0FBh
db 0FFh, 75h, 4, 8Ah, 1Eh, 10h,	2, 8Ah,	9Fh
db 7Eh,	0, 0D0h, 0E3h, 8Bh, 9Fh, 96h, 0
db 8Bh,	37h, 8Ah, 4Ch, 0FFh, 88h, 8Dh, 0ACh
db 1, 8Ah, 0Ch,	88h, 8Dh, 0B8h,	1, 0D1h
db 0E7h, 89h, 0B5h, 0C4h, 1, 8Bh, 77h, 2
db 89h,	0B5h, 0E0h, 1, 0D1h, 0EFh, 8Ah,	4Fh
db 4, 88h, 8Dh,	0D4h, 1, 5Eh, 5Bh, 0C3h
db 50h,	8Bh, 0DFh, 0D1h, 0E3h, 8Bh, 87h
db 0E8h, 1, 0BAh, 0, 20h, 0F7h,	0E2h, 0F7h
db 36h,	0Dh, 2,	8Bh, 0D8h, 50h,	0E8h, 8Bh
db 0FFh, 2 dup(58h), 0C3h, 32h,	0E4h, 80h
db 0BDh, 0B4h, 1, 0, 74h, 26h, 0FEh, 8Dh
db 0B0h, 1, 75h, 20h, 8Ah, 85h,	0ACh, 1
db 88h,	85h, 0B0h, 1, 8Bh, 0B7h, 0CCh, 1
db 8Ah,	4, 3Ch,	0FFh, 74h, 0Eh,	0FFh, 87h
db 0CCh, 1, 88h, 85h, 0BCh, 1, 0Ah, 85h
db 0F4h, 1, 0E6h, 0C0h,	8Ah, 95h, 0D4h,	1
db 80h,	0FAh, 0, 74h, 39h, 80h,	0BDh, 0C0h
db 2 dup(1), 74h, 32h, 8Bh, 87h, 0E8h, 1
db 8Bh,	0C8h, 0F6h, 0F2h, 8Bh, 0B7h, 0D8h
db 1, 8Ah, 14h,	80h, 0FAh, 80h,	75h, 6,	8Bh
db 0B7h, 0E0h, 1, 8Ah, 14h, 32h, 0E4h, 0F6h
db 0EAh, 3, 0C1h, 46h, 89h, 0B7h, 0D8h,	1
db 8Bh,	0D8h, 81h, 0FBh, 0FFh, 3, 72h, 3
db 0BBh, 0FFh, 3, 0E8h,	17h, 0FFh, 0C3h
db 0E9h, 18h, 2, 0E9h, 30h, 2, 0E9h, 0A5h
db 2, 0E9h, 0A2h, 2, 0E9h, 9Fh,	2, 0E9h
db 9Ch,	2, 6 dup(0), 0FAh, 3, 0C0h, 3, 8Ah
db 3, 58h, 3, 28h, 3, 0FAh, 2, 0D0h, 2,	0A6h
db 2, 80h, 2, 5Ch, 2, 3Ch, 2, 1Ah, 2, 0Bh dup(0)
db    0
seg025 ends

; Segment type:	Regular
seg026 segment para public 'DATA' use16
	assume cs:seg026
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:nothing
byte_40420 db 1A30h dup(0)	   ; 0
seg026 ends

; Segment type:	Regular
seg027 segment para public 'DATA' use16
	assume cs:seg027
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:nothing
byte_41E50	db 4 dup(0)		; 0
songRegenSppt	db 0
monDisbelieveFlag	db 0
isNight		db 0
byte_41E57	db 0
vorpalPlateBonus	db 7 dup(0)
align 2
antiMagicFlag	db 0
byte_41E61	db 0
byte_41E62	db 0
byte_41E63	db 0
charActionList db 7	dup(0)		   ; 0
unk_41E6B	db	0
word_41E6C	dw 0
word_41E6E	dw 0
byte_41E70	db 0
byte_41E71	db 0
strengthBonus	db 7 dup(0)	      ;	0
byte_41E79	db 0
mapWidth	db 0
align 2
batRewardLo	dw 0
batRewardHi	dw 0
mapHeight	db 0
byte_41E81	db 0
roster		character_t <>
stru_41EFA	character_t <>
		character_t <>
		character_t <>
		character_t <>
		character_t <>
rosterTail	character_t <>
newCharBuffer	character_t <>
byte_42242	db 0
		db 0
byte_42244	db 0
		db 0
		db 0
		db 0
		db 0
		db 0
		db 0
		db 0
bat_curSong	db 0
bat_curTarget	db 0
musicBufs	memoryPointer	8 dup(<0>)
monFrozenFlag	db 0
		db 0
byte_42270	db 0
		db 0
		db 0
		db 0
byte_42274	db 0
		db 0
byte_42276	db 0
		db 0
		db 0
		db 0
		db 0
		db 0
		db 0
		db 0
byte_4227E	db 0
		db 0
byte_42280	db 6	dup(0)		   ; 0
byte_42286	db 0
align 2
byte_42288	db 0
wildWrapFlag	db	0
		db    0
byte_4228B	db 0
mapRval		dw 0
byte_4228E	db 0
align 2
mapDataOff	dw 0
mapDataSeg	dw 0
word_42294	dw 0
byte_42296	db 0
align 2
word_42298	dw 0
byte_4229A	db 0
byte_4229B	db 0
byte_4229C	db 4	dup(0)		   ; 0
byte_422A0	db 0
align 2
specialAttackVal	dw 0
byte_422A4	db 0
		db    0
bat_charPriority 	db 7 dup(0)		 ; 0
		db 0
wallIsPhased	db 0
		db 0
rowOffset	dd 20h dup(0)		  ; 0 ;	This array holds the offsets into the maps-lo|hi-XX
			; file for the rows. This makes	it easy	to index into
			; the map. To access a square rowOffset[sqNorth]+sqEast
word_42330	dw 0
partyFrozenFlag	db 0
		db    0
byte_42334	db 0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
songExtraAttack	db 0
align 2
word_4233E	dw 0
bigpicImageNo	db 0
align 2
monGroups	mon_t <>
stru_42372	mon_t <>
		mon_t <>
		mon_t <>
levelChangedFlag	dw 0
summonMeleeDamage	dw 0
regenSpptSq	db 0
align 2
summonMeleeType	dw 0
word_4240A	dw 0
word_4240C	dw 0
byte_4240E	db 0
align 2
word_42410	dw 0
damageAmount	dw 0
stuckFlag	db 0
align 2
word_42416	dw 0
db    0
byte_42419	db 0
byte_4241A	db 0
txt_numLines	db 0
songAntiMonster	db 0
align 2
word_4241E	dw 0
byte_42420	db 0
db    0
byte_42422	db 4	dup(0)		   ; 0
mfunc_ioBuf	db 10h dup(0)	    ; 0
dword_42436	dd 0
word_4243A	dw 0
word_4243C	dw 0
word_4243E	dw 0
byte_42440	db 0
runAwayFlag	db 0
songRegenHP	db 0
db    0
byte_42444	db 7	dup(0)
align 2
word_4244C	dw 0
byte_4244E	db 0
align 2
word_42450	dw 0
breakAfterFunc	dw 0
sq_antiMagicFlag		db 0
align 2
word_42456	dw 0
byte_42458	db 0
align 2
word_4245A	dw 0
monHpList	dw 80h dup(0)		  ; 0
songCanRun	db 0
byte_4255D	db 0
byte_4255E	db 0
align 2
word_42560	dw 0
word_42562	dw 0
word_42564	dw 0
byte_42566	db 0
byte_42567	db 0
songACBonus	db 0
songHalfDamage	db 0
bat_monPriorityList dw 80h dup(0)	    ; 0
		db    0
byte_4266B	db 0
align 8
seg027 ends

; Segment type:	Pure data
dseg segment para public 'DATA' use16
	assume cs:dseg
;byte_foobar	db 200h dup(0)
word_42670	dw 0
word_42672	dw 0
byte_42674	db 0
byte_42675	db 0
word_42676	dw 0
aMsRunTimeLibraryCopy db 'MS Run-Time Library - Copyright (c) 1988, Microsoft Corp'
		db  11h
byte_426B1	db 0
aComp		db 'comp',0
aRgb		db	'rgb',0
aEga		db	'ega',0
aTdy		db	'tdy',0
aThief_cfg	db 'thief.cfg',0
aTit0		db 'tit0',0
aTitle		db 'title',0
aMusic_all	db 'music.all',0
aStuckElipsis	db 'Stuck....',0
graphicsDrivers	dd aComp, aRgb,	aEga, aTdy; 0
aFacing		db 'facing ',0
byte_42716	db 0, 2, 20h, 22h
aEarlyMorning_	db 'early morning.',0
aMidMorning_	db	'mid morning.',0
aNoon_		db 'noon.',0
aAfternoon_	db 'afternoon.',0
aDusk_		db 'dusk.',0
aEvening_	db 'evening.',0
aMidnight_	db 'midnight.',0
aAfterMidnight_	db 'after midnight.',0
aRefugeeCampOfS	db ' refugee camp of Skara Brae.',0
aCityGates_	db ' city gates.',0
aEntranceToTheC	db ' entrance to the city.',0
aGreatIceKeep_	db ' great ice keep.',0
aEntranceOfTheF	db ' entrance of the forest.',0
aPausing	db 'pausing',0
		db    0
aWhoWillYouDrop? db 'Who will you drop?',0
		db    0
aYouCanTDropAPart db 'You can',27h,'t drop a party member.',0
		db    0
aYouReIn db 'You',27h,'re in ',0
		db    0
aAnd_2		db ' and ',0
aPaceS_1	db ' pace/\s',0
		db    0
aNorthSouth_0	db ' /north\south\',0
		db    0
aEastWest_0 db ' /east\west\',0
		db    0
aItSNow		db 0Ah,0Ah, 'It',27h,'s now ',0
timeOfDay	dd aEarlyMorning_, aMidMorning_, aNoon_, aAfternoon_,	aDusk_,	aEvening_, aMidnight_, aAfterMidnight_
aOfAtThe	db ' /of\at\ the',0
		db    0
locationString	dd aRefugeeCampOfS, aCityGates_,	aEntranceToTheC, aGreatIceKeep_, aEntranceOfTheF; 0
byte_428A6	db 0Ch, 0Ah,	7, 0Fh,	6, 6, 7, 9; 0
		db 0Ah,	0Fh		; 8
byte_428B0	db 0Fh, 0, 6, 8, 0Ah, 9, 0, 8; 0
		db 5, 1			; 8
byte_428BA	db 0, 1, 2, 1, 3, 2,	1, 2; 0
		db 4, 1			; 8
byte_428C4	db 7, 7, 7, 7, 0, 0,	0, 1; 0
		db 1, 1, 1, 2, 2, 2, 3,	3; 8
		db 4, 4, 4, 5, 5, 5, 6,	6; 16
aWhoWillUseAnItem db 'Who will use an item?',0
aUseOn		db 'Use on ',0
aPowerless_	db 'Powerless.',0
		db    0
aDoYouWishToResto db 'Do you wish to restore your last saved game?',0
		db    0
aDoYouWishToSaveY db 'Do you wish to save your game?',0
		db    0
aSavingTheGame_	db 'Saving the game.',0
		db    0
aYourGameHasBeenS	db 'Your game has been saved to disk.',0Ah, 0Ah
			db 'Do you wish to exit to DOS?',0
aHelpForThoseInNeed17	db 'HELP for those in need:',0Ah, 0Ah
			db '1-7 = Player info',0Ah
			db 'Arrows = Move, turn',0Ah
			db '? = Where are we',0Ah
			db 'N = New march order',0Ah
			db 'S = Save the game',0Ah
			db 'T = Time out',0Ah
			db 'V = Sound on/off',0Ah,0
aMoreHelpBPlayABardTu	db 'More HELP:',0Ah, 0Ah
			db 'B = Play a Bard tune',0Ah
			db 'C = Cast a spell',0Ah
			db 'F1-F7 = Cast a spell',0Ah
			db 'E = Ascend portal',0Ah
			db 'W = Descend portal',0Ah
			db 'P = Party combat',0Ah
			db 'D = Drop special party member',0Ah
			db 'U = Use an item',0Ah,0
aNewOrder	db 'New Order:',0Ah,0Ah,0
		db    0
gtChar		db '>'
byte_42AF5	db 78h				; XXX - Doesn't seem to be used
		db 20h
		db 0
aUseThisOrder?	db 0Ah,'Use this order?',0
aGame_sav	db 'game.sav',0
aCanTOpenGameSave	db 'Can',27h,'t open game save file',0
			db    0
word_42B36	dw 1
aQuitTheGame?	db 'Quit the game?',0
aYouWillLoseYou	db 'You will lose your game status.',0Ah
		db 0Ah, 0Ah, 0Ah
		db '  Do you wish to quit?',0
align 2
aWarrior	db 'Warrior',0
aWizard		db 'Wizard',0
aSorcerer	db 'Sorcerer',0
aConjurer	db 'Conjurer',0
aMagician	db 'Magician',0
aRogue		db 'Rogue',0
aBard		db 'Bard',0
aPaladin	db 'Paladin',0
aHunter		db 'Hunter',0
aMonk		db 'Monk',0
aArchmage	db 'Archmage',0
aChronomancer	db 'Chronomancer',0
aGeomancer	db 'Geomancer',0
aMonster	db 'Monster',0
aIllusion	db 'Illusion',0
aThouArtInTheCa	db 'Thou art in the Camp of Skara Brae.'
		db 0Ah
		db 0Ah
		db '@Add a member',0Ah
		db '@Remove a member',0Ah
		db '@Rename a member',0Ah
		db '@Create a member',0Ah
		db '@Transfer characters',0Ah
		db '@Delete a member',0Ah
		db '@Save the party',0Ah
		db '@Leave the game',0Ah
		db '@Enter wilderness',0
aPressReturnToS	db 'Press <RETURN> to save off all char'
		db 'acters and end game play. Or press '
		db 'ESC to go back.',0
aDoYouWishYourC	db 'Do you wish your character to be',0Ah
		db 'Male or',0Ah
		db 'Female?',0
align 2
aSelectARaceFor	db 'Select a race for your new character:',0Ah,0Ah
		db '1) Human',0Ah
		db '2) Elf',0Ah
		db '3) Dwarf',0Ah
		db '4) Hobbit',0Ah
		db '5) Half-Elf',0Ah
		db '6) Half-Orc',0Ah
		db '7) Gnome',0
align 2
aNameYourNewCha	db 'Name your new character --',0
align 2
aSelectWhichPar	db 'Select which party member to remove or...',0
aRemoveThemAll	db 'Remove them all!',0
align 2
aNameToSavePart	db 'Name to save party under?',0
aDeleteWho?	db 'Delete Who?',0
aIsCurrentlyInT	db ' is currently in the party. Remove from the party first.',0
align 2
aAreYouSureYouW	db 'Are you sure you want to delete ',0
align 2
aThereAreNoChar	db 'There are no characters on this disk.',0
aWhoShallJoin?	db 'Who shall join?',0
aIsAlreadyInThe	db ' is already in the party.',0
aThereIsAlready	db 'There is already a character with that name in the roster.',0
align 2
aTheRosterIsFul	db 'The roster is full.',0
aThereSNoOneHer	db 'There',27h,'s no one here named that!',0
aRenameWho?	db 'Rename Who?',0
aYouCanTRenameA	db 'You can',27h,'t rename a party list!',0
align 2
aWhatIs		db 'What is ',0
align 2
aSNewName?	db 27h,'s new name?',0
align 2
byte_42F8C	db 33, 48, 54, 79, 54, 79, 54, 79, 54, 79, 33; 0
		db 48, 33, 48, 33, 48, 33, 48, 33, 48, 54, 79; 11
baseAttributes	startingAttrBase <10, 6,	8, 8, 5, 10, 6, 8, 8,	5>
		startingAttrBase <8, 9,	9, 6, 6, 8, 9, 9, 6, 6>
		startingAttrBase <12, 6, 7, 10,	3, 12, 6, 7, 10, 3>
		startingAttrBase <4, 6,	12, 5, 10, 4, 6, 12, 5, 10>
		startingAttrBase <9, 8,	9, 7, 6, 9, 8, 9, 7, 6>
		startingAttrBase <11, 3, 8, 11,	4, 11, 3, 8, 11, 4>
		startingAttrBase <9, 10, 7, 3, 4, 9, 10, 7, 3, 4>
startingClasses	startingClass_t	<1, 0, 0, 1, 1,	1, 1, 1, 1, 1>	; 0
		startingClass_t	<1, 0, 0, 1, 1,	1, 1, 1, 0, 1>	; 1
		startingClass_t	<1, 0, 0, 0, 0,	1, 1, 1, 1, 1>	; 2
		startingClass_t	2 dup(<1, 0, 0,	1, 1, 1, 1, 0, 0, 1>); 3
		startingClass_t	<1, 0, 0, 1, 1,	1, 0, 0, 1, 0>	; 5
		startingClass_t	<1, 0, 0, 1, 1,	1, 0, 0, 1, 1>	; 6
byte_4302E	db 6, 42, 42, 42, 42, 32, 0,	6, 6, 22, 2Ah
		db    0
startingInventory	db 1,	14h, 0FFh, 4, 76h, 0Ah,	1, 3, 0FFh, 1, 0Eh; 0
			db 0FFh, 1, 0Ah, 0FFh, 1, 11h, 0FFh, 1,	12h, 0FFh, 0FEh; 11
			db 1, 4, 0FFh, 1, 0Ch, 0FFh, 0,	7Dh, 0Ah, 0FEh,	1; 22
			db 4, 0FFh, 1, 0Ch, 0FFh, 1, 0Ah, 0FFh,	0FEh, 1, 10h; 33
			db 0FFh, 1, 9, 0FFh, 1,	2, 1, 0FEh; 44
classString	dd aWarrior		    ; 0
		dd aWizard		; 1
		dd aSorcerer		; 2
		dd aConjurer		; 3
		dd aMagician		; 4
		dd aRogue		; 5
		dd aBard		; 6
		dd aPaladin		; 7
		dd aHunter		; 8
		dd aMonk		; 9
		dd aArchmage		; 10
		dd aChronomancer	; 11
		dd aGeomancer		; 12
		dd aMonster		; 13
		dd aIllusion		; 14
aTheRuin	db 'The Ruin',0
off_430BC	dd camp_addMember
		dd camp_removeMember
		dd camp_renameMember
		dd camp_createMember
		dd transferCharacter
		dd camp_deleteCharacter
		dd saveParty
		dd saveAndExitMaybe
		dd enterWilderness
aThieves_inf	db	'thieves.inf',0
aParties_inf	db	'parties.inf',0
aHailTravelersS	db 'Hail, travelers! Step to the bar and I',27h,'ll draw you a tankard.',0Ah
		db 'You can:',0Ah
		db 'Order a drink',0Ah
		db 'Talk to barkeep',0Ah
		db 'Exit the tavern',0
align 2
aWhoWillOrderAD	db 'Who will order a drink?',0
aSeatThyself	db	'Seat thyself,',0Ah,0
align 2
aWhatLlItBe?Ale	db 'What',27h,'ll it be?',0Ah
		db 'Ale',0Ah
		db 'Beer',0Ah
		db 'Mead',0Ah
		db 'Foul spirits',0Ah
		db 'Ginger Ale',0
align 2
aThouAreInNoCon	db 'Thou are in no condition to order anything.',0
aInFactThyParty	db 'In fact, thy party is a disgrace..',0Ah
		db 'Bouncers!!!',0
align 2
aWillYouHaveIt_	db 'Will you have it...',0Ah
		db 'Here or',0Ah
		db 'To go?',0
align 2
aBurpNotTooBad_	db '(Burp!) Not too bad.',0
align 2
aMyGoodnessThat	db 'My goodness, that',27h,'s good stuff.',0
aNowThatSARealT	db 'Now that',27h,'s a real thirst quencher!',0
align 2
aButYouFeelALit	db 'But you feel a little light-headed.'
		db 0
aYouStartHiccup	db 'You start hiccuping',0
aYouBeginToSing	db 'You begin to sing 99 bottles of beer on the wall.',0
aYouSeemToHaveA	db 'You seem to have a hard time staying on the bar stool.',0
align 2
aYouCollapseOnT	db 'You collapse on the floor.',0
align 2
aSorryBut	db 'Sorry but ',0
align 2
aCanTCarryAnyMo	db ' can',27h,'t carry any more items.',0
align 2
aTheBartenderFi	db 'The bartender fills a wineskin with your order and hands it to you.',0
aWhoWillTalkToT	db 'Who will talk to the barkeep?',0
aYouAreInNoCond	db 'You are in no condition to talk.',0
align 2
aTalkAinTCheap db '"Talk ain',27h,'t cheap,',0
align 2
aBeerBreath	db ' Beer Breath',0
align 2
aTheBarkeepSays	db '" the barkeep says.',0
aHowMuchWillYou	db 'How much will you tip him?',0
align 2
aMoneyTalksFrie	db '"Money talks, friend," he says.',0
aThereSABuildin	db '"There',27h,'s a building in Skara Brae where some of the survivors stashed their goods. It may be helpful," smiles the bartender',0
aBeOnTheLookout	db '"Be on the lookout for the magic gems, your spellcasters will need them."',0
aThereLiesAnoth	db '"There lies another bar in Celaria Bree, seek it. It exists only in the dimension called Lucencia."',0
aSeekOutTheOldM	db '"Seek out the old man in the Review Board. He keeps watch over everything."',0
aGoToTheBardSHa	db '"Go to the bard',27h,'s hall and listen to the songs they sing. They contain useful information."',0
aThereIsSaidToB	db '"There is said to be a key existing in the Violet Mountains, this will gain access to Cyanis',27h,'s Tower."', 0
align 2
aAckItSNotJustA	db '"Ack! It',27h,'s not just a word, but a state of mind."',0
aTheKeyToFindin	db '"The key to finding Sceadu is finding the lock."',0
align 2
aSceaduCanBeFou	db '"Sceadu can be found in the middle of Nowhere."',0
aSeekWerraInTar	db '"Seek Werra in Tarmitia."',0
aNotEnoughGold_	db 'Not enough gold.',0
align 2
barkeepSayings	dd aThereSABuildin      ; 0
		dd aBeOnTheLookout	; 1
		dd aThereLiesAnoth	; 2
		dd aSeekOutTheOldM	; 3
		dd aSeekOutTheOldM	; 4
		dd aAckItSNotJustA	; 5
		dd aBeOnTheLookout	; 6
		dd aThereLiesAnoth	; 7
		dd aGoToTheBardSHa	; 8
		dd aThereIsSaidToB	; 9
		dd aBeOnTheLookout	; 10
		dd aSeekOutTheOldM	; 11
		dd aSeekWerraInTar	; 12
		dd aTheKeyToFindin	; 13
		dd aSceaduCanBeFou	; 14
aAbmfg		db 'ABMFG',0
byte_437D8	db 3, 2, 4, 6, 1, 3	   ; 0
nullDrunkValue	dw 0
drunkString	dd nullDrunkValue	    ; 0
		dd nullDrunkValue	; 1
		dd nullDrunkValue	; 2
		dd nullDrunkValue	; 3
		dd aButYouFeelALit	; 4
		dd aButYouFeelALit	; 5
		dd aYouStartHiccup	; 6
		dd aYouStartHiccup	; 7
		dd aYouBeginToSing	; 8
		dd aYouSeemToHaveA	; 9
		dd aYouSeemToHaveA	; 10
		dd aYouCollapseOnT	; 11
		dd aYouCollapseOnT	; 12
tav_drinkStrength db 1,	2, 3, 4, 0, 0	  ; 0
aScrapwood	db 'Scrapwood',0
aStaggerInn	db 'Stagger Inn',0
aHicHaven	db 'Hic Haven',0
aCheers		db 'Cheers',0
aTavern		db 'Tavern',0
tavCoords	tavernLoc_t <12, 17, 0, 0, 0>; 0
		tavernLoc_t <7,	12, 3, 2, 5>; 1
		tavernLoc_t <2,	3, 3, 4, 5>; 2
		tavernLoc_t <13, 7, 6, 6, 5>; 3
		tavernLoc_t <99, 99, 99, 8, 10>; 4
		db    0
tavernNames	dd aScrapwood	    ; 0
		dd aStaggerInn		; 1
		dd aHicHaven		; 2
		dd aCheers		; 3
		dd aTavern		; 4
byte_43876	db 0, 50, 250, 244, 232 ; 0
		db    0
aWelcomeOhWearyOne	db 'Welcome, oh weary ones, to our humble temple.',0Ah
			db 'Dost thou wish to...',0Ah
			db 'Heal a character',0Ah
			db 'Pool thy gold',0Ah
			db 'Exit temple',0
aWhomShallGatherTh	db 'Whom shall gather thy gold?',0
aNowHathAllTheGold	db ' now hath all the gold.',0
aWhoNeedethHealing	db 'Who needeth healing?',0
			db    0
aIsInBadShapeIndeed_	db	' is in bad shape, indeed. ',0
			db    0
aInGold_WhoWillForfeit	db ' in gold. Who will forfeit the gold?',0
			db    0
aSorryButWithoutProper	db 'Sorry, but without proper sacrifice the prayer will fail.',0
aThePriestsLayHandsOn	db 'The priests lay hands on ',0
aElipsis		db '...',0
aElipsisAnd		db '...and ',0
aIsHealed		db ' is healed!',0
aHathBeenDrainedOfLife	db ' hath been drained of life force. ',0
			db    0
aThouMustSacrifice	db	'Thou must sacrifice ',0
			db    0
aDoesNotRequireAnyHeal	db ' does not require any healing.',0
			db    0
aHasWoundsWhichNeedTen	db ' has wounds which need tending. ',0
			db    0
aTheDonationWillBe	db 'The donation will be ',0
temple_healPrice	dw 0, 400, 300, 900, 1120, 220, 500, 600, 900			; 8
aHe		db 'he',0
aShe		db 'she',0
aIt		db 'it',0
aHim		db 'him',0
aHer		db 'her',0
aHis		db 'his',0
aIts		db 'its',0
pronounString	dd aHe, aShe, aIt, aHim, aHer, aIt, aHis, aHer, aIts		; 7
aShrine		db 'Shrine',0
aForestLawn	db 'Forest Lawn',0
aAlliria	db 'Alliria',0
aTwilightTmp	db 'Twilight Tmp',0
templeLoc	templeLoc_t <8, 1, 0,	0>; 0
		templeLoc_t <10, 4, 3, 2>; 1
		templeLoc_t <2,	7, 6, 4>; 2
		templeLoc_t <255, 255, 255, 6>;	3
templeTitles	dd aShrine, aForestLawn, aAlliria,	aTwilightTmp; 0
byte_43B50	db 2, 1, 10h, 40h, 20h, 8, 4, 0; 0
byte_43B58	db 2, 1, 5, 7, 6, 4,	3, 0; 0
statusHealMask	db 0FFh,	0FEh, 0FDh, 3, 3, 0EFh,	0DFh, 0BFh, 0FFh, 0		; 8
fgtrXPReq	dd 2000, 4000, 7000, 10000, 15000, 20000; 0
		dd 30000, 50000, 80000,	110000,	150000,	200000;	6
wizdXPReq	dd 20000, 50000, 80000, 120000, 160000, 200000; 0
		dd 250000, 300000, 400000, 600000, 900000; 6
		dd 1300000		; 11
sorcXPReq	dd 7000, 15000, 25000, 40000,	60000, 80000; 0
		dd 100000, 130000, 170000, 220000, 300000; 6
		dd 400000		; 11
magiXPReq	dd 1800, 4000, 6000, 10000, 14000, 19000; 0
		dd 29000, 50000, 90000,	120000,	170000,	230000;	6
archXPReq	dd 70000, 140000, 240000, 340000, 540000; 0
		dd 740000, 1000000, 1400000, 1800000, 2200000; 5
		dd 2600000, 3000000	; 10
geomXPReq	dd 100000, 225000, 400000, 650000, 950000; 0
		dd 1400000, 1800000, 2200000, 2600000, 3000000;	5
		dd 3400000, 3800000	; 10
classXPReqs	dd fgtrXPReq, wizdXPReq, sorcXPReq,	magiXPReq; 0
		dd magiXPReq, fgtrXPReq, fgtrXPReq, fgtrXPReq; 4
		dd fgtrXPReq, magiXPReq, archXPReq, archXPReq; 8
		dd geomXPReq		; 12
aYouAreInAnEmpt	db 'You are in an empty building.',0
aBuilding	db 'Building',0
align 2
aThePartyIsInsi	db 'The party is inside a storage building.',0Ah
		db 'Who wishes to inspect?',0Ah
		db 0Ah, 0Ah, 0Ah
		db 'ESC to exit building',0
align 2
aWould		db 'Would ',0
align 2
aLikeToPickup__	db ' like to pickup...',0
align 2
aTheBuildingIsE	db 'The building is empty.',0
align 2
aPickUp___	db 'Pick up...',0
align 2
aAllFull	db 'All full!',0
aYouPickUpTheIt	db 'You pick up the item.',0

aInventor_stf	db 'inventor.stf',0
align 2
aWildwal_grp	db	'wildwal.grp',0
aSkara_grp	db 'skara.grp',0
aGdung_grp	db 'gdung.grp',0
aDisk1		db 'Disk 1',0
aDisk2		db 'Disk 2',0
aDisk3		db 'Disk 3',0
aMaps_lo	db 'maps.lo',0
aMaps_hi	db 'maps.hi',0
aMonsterl	db 'monsterl',0
aMonsterh	db 'monsterh',0
aLow_pic	db 'low.pic',0
aHi_pic		db 'hi.pic',0
align 2
aPleaseInsertDi	db 'Please insert disk ',0
byte_43EBC	db 0FFh, 0, 4, 8, 4,	0, 0, 4; 0
		db 0, 0, 4, 8, 4, 0, 0,	4; 8
aOldPsndnutspossparade	db 'Old PsndNutsPossParaDeadSton',0
			db    0
byte_43EEA	db stat_old, stat_poisoned, stat_nuts, stat_possessed; 0
		db stat_paralyzed, stat_dead, stat_stoned, 0; 4
aWawisocomarobapahumoa	db 'WaWiSoCoMaRoBaPaHuMoArChGeMnIl',0
			db    0
word_43F12	dw 0
mouseBoxes	mouseBox_t < 0Fh,  0Ah,  6Ah,  7Ah>	; Bigpic Window
		mouseBox_t <   6, 0A8h,  66h, 132h>	; Text Window
		mouseBox_t < 90h,  0Ch, 0C7h, 132h>	; Roster Area
		db    0
		db    0
off_43F2E	dd aWildwal_grp, aSkara_grp; 0
		dd aSkara_grp, aGdung_grp; 2
		dd aGdung_grp, aGdung_grp; 4
byte_43F4A	db 8 dup(0)
disk1		dw offset aDisk1
dseg_0		dw seg dseg
disk2		dd aDisk2
disk3		dd aDisk3
mapFiles	dd aMaps_lo, aMaps_hi
monsterFiles	dd	aMonsterl, aMonsterh
stru_43F6E	someFileStru	<lev_monsterl, 0>; 0
		someFileStru <lev_monsterl, 1>;	1
		someFileStru <lev_monsterl, 2>;	2
		someFileStru <lev_monsterl, 3>;	3
		someFileStru <lev_monsterl, 4>;	4
		someFileStru <lev_monsterh, 0>;	5
		someFileStru <lev_monsterh, 1>;	6
		someFileStru <lev_monsterh, 2>;	7
		someFileStru <lev_monsterh, 3>;	8
		someFileStru <lev_monsterh, 4>;	9
		someFileStru <lev_monsterl, 5>;	10
		someFileStru <lev_monsterl, 6>;	11
		someFileStru <lev_monsterl, 7>;	12
		someFileStru <lev_monsterl, 8>;	13
		someFileStru <lev_monsterl, 9>;	14
		someFileStru <lev_monsterl, 10>; 15
		someFileStru <lev_monsterl, 11>; 16
		someFileStru <lev_monsterl, 12>; 17
		someFileStru <lev_monsterl, 13>; 18
		someFileStru <lev_monsterl, 14>; 19
		someFileStru <lev_monsterl, 15>; 20
		someFileStru <lev_monsterl, 16>; 21
		someFileStru <lev_monsterl, 17>; 22
		someFileStru <lev_monsterl, 18>; 23
		someFileStru <lev_monsterl, 19>; 24
		someFileStru <lev_monsterl, 20>; 25
		someFileStru <lev_monsterl, 21>; 26
		someFileStru <lev_monsterl, 22>; 27
		someFileStru <lev_monsterl, 23>; 28
		someFileStru <lev_monsterl, 24>; 29
		someFileStru <lev_monsterl, 25>; 30
		someFileStru <lev_monsterl, 26>; 31
		someFileStru <lev_monsterl, 27>; 32
		someFileStru <lev_monsterl, 28>; 33
		someFileStru <lev_monsterh, 5>;	34
		someFileStru <lev_monsterh, 6>;	35
		someFileStru <lev_monsterh, 7>;	36
		someFileStru <lev_monsterh, 8>;	37
		someFileStru <lev_monsterh, 9>;	38
		someFileStru <lev_monsterh, 10>; 39
		someFileStru <lev_monsterh, 11>; 40
		someFileStru <lev_monsterh, 12>; 41
		someFileStru <lev_monsterh, 13>; 42
		someFileStru <lev_monsterh, 14>; 43
		someFileStru <lev_monsterh, 15>; 44
		someFileStru <lev_monsterh, 16>; 45
		someFileStru <lev_monsterh, 17>; 46
		someFileStru <lev_monsterh, 18>; 47
		someFileStru <lev_monsterh, 19>; 48
		someFileStru <lev_monsterh, 20>; 49
		someFileStru <lev_monsterl, 29>; 50
		someFileStru <lev_monsterl, 30>; 51
		someFileStru <lev_monsterh, 21>; 52
		someFileStru <lev_monsterh, 22>; 53
		someFileStru <lev_monsterh, 23>; 54
		someFileStru <lev_monsterh, 24>; 55
		someFileStru <lev_monsterh, 25>; 56
		someFileStru <lev_monsterh, 26>; 57
		someFileStru <lev_monsterh, 27>; 58
		someFileStru <lev_monsterh, 28>; 59
		someFileStru <lev_monsterh, 29>; 60
		someFileStru <lev_monsterh, 30>; 61
		someFileStru <lev_monsterl, 31>; 62
		someFileStru <lev_monsterl, 32>; 63
		someFileStru <lev_monsterl, 33>; 64
		someFileStru <lev_monsterl, 34>; 65
		someFileStru <lev_monsterh, 31>; 66
		someFileStru <lev_monsterh, 32>; 67
		someFileStru <lev_monsterh, 33>; 68
		someFileStru <lev_monsterh, 34>; 69
		someFileStru <lev_monsterh, 35>; 70
lowPic		dd aLow_pic
		dd aHi_pic
bigpicIndex	db 0, 1, 2, 3	    ; 0
		db 4, 5, 6, 7		; 4
		db 8, 9, 10, 11		; 8
		db 12, 13, 14, 15	; 12
		db 16, 17, 18, 19	; 16
		db 20, 21, 255,	255	; 20
		db 22, 255, 23,	255	; 24
		db 255,	24, 25,	255	; 28
		db 26, 27, 255,	255	; 32
		db 255,	255, 28, 29	; 36
		db 255,	255, 255, 30	; 40
		db 255,	255, 31, 32	; 44
		db 33, 34, 35, 36	; 48
		db 37, 38, 39, 40	; 52
		db 41, 42, 43, 44	; 56
		db 255,	45, 255, 46	; 60
		db 255,	255, 255, 255	; 64
		db 255,	47, 48,	49	; 68
		db 255,	255, 50, 255	; 72
		db 255,	255, 51, 52	; 76
		db 255,	255, 255, 53	; 80
		db 255,	255, 255, 255	; 84
		db 255,	255, 255, 0	; 88
		db 255,	1, 255,	2	; 92
		db 255,	3, 4, 255	; 96
		db 255,	255, 5,	6	; 100
		db 255,	255, 255, 255	; 104
		db 255,	7, 8, 9		; 108
		db 255,	10, 255, 255	; 112
		db 11, 255, 255, 12	; 116
		db 13, 255, 14,	15	; 120
		db 16, 17, 18, 255	; 124
		db 19, 20, 21, 255	; 128
		db 22, 23, 255,	255	; 132
		db 24, 255, 255, 25	; 136
		db 26, 27, 28, 29	; 140
		db 255,	255, 255, 255	; 144
		db 30, 31, 32, 255	; 148
		db 33, 34, 35, 36	; 152
		db 37, 255, 255, 255	; 156
		db 38, 39, 255,	40	; 160
		db 41, 42, 43, 44	; 164
		db 45, 255, 46,	255	; 168
		db 47, 48, 255,	49	; 172
aYesNo		db 'Yes',0Ah,'No',0
		db    0
word_440BC	dw 0
_str_Loalphabet	db ' ', 'a', 'b', 'c', 'd', 'e', 'f', 'g'; 0
		db 'h', 'i', 'k', 'l', 'm', 'n', 'o', 'p'; 8
		db 'r', 's', 't', 'u', 'v', 'w', 'y', '.'; 16
		db '"', 27h, ',', '!', 0Ah, 0; 24
_str_Hialphabet	db 'j', 'q', 'x', 'z', '0', '1', '2', '3'; 0
		db '4', '5', '6', '7', '8', '9', '0', '1'; 8
		db '2', '3', '4', '5', '6', '7', '8', '9'; 16
		db 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'; 24
		db 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P'; 32
		db 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X'; 40
		db 'Y', 'Z', '(', ')', '/', '\', '#', '*'; 48
		db '?', '<', '>', ':', ';', '-', '%', 0; 56
aEsc		db 'ESC',0
aU		db '%U',0
aVict		db 'vict',0
aBardscr	db 'bardscr',0
aIcons_bin	db 'icons.bin',0
aPictureGetErro	db 'picture get error',0
word_4414C	dw 2
word_4414E	dw 0FFh
aNorth		db 'north',0
aEast		db 'east',0
aSouth		db 'south',0
aWest		db 'west',0
word_44166	dw 1
bitMask16bit	dw	1, 2, 4, 8	     ; 0
		dw 10h,	20h, 40h, 80h	; 4
		dw 100h, 200h, 400h, 800h; 8
		dw 1000h, 2000h, 4000h,	8000h; 12
byteMaskList	db 80h, 40h, 20h, 10h   ; 0
		db 8, 4, 2, 1		; 4
flagMaskList	db 7Fh, 0BFh, 0DFh, 0EFh; 0
		db 0F7h, 0FBh, 0FDh, 0FEh; 4
diceMaskList	db 1, 3		     ; 0
		db 7, 15		; 2
		db 31, 63		; 4
		db 127,	255		; 6
dirStringList	dd aNorth, aEast, aSouth,	aWest
dirDeltaN	dw 0FFFFh, 0,	1, 0	  ; 0
dirDeltaE	dw 0,	1, 0, 0FFFFh	  ; 0
northDelta	viewStruct <253, 3>	   ; 0
		viewStruct <254, 3>	; 1
		viewStruct <255, 3>	; 2
		viewStruct <0, 3>	; 3
		viewStruct <1, 3>	; 4
		viewStruct <2, 3>	; 5
		viewStruct <3, 3>	; 6
		viewStruct <253, 2>	; 7
		viewStruct <254, 2>	; 8
		viewStruct <255, 2>	; 9
		viewStruct <0, 2>	; 10
		viewStruct <1, 2>	; 11
		viewStruct <2, 2>	; 12
		viewStruct <3, 2>	; 13
		viewStruct <254, 1>	; 14
		viewStruct <255, 1>	; 15
		viewStruct <0, 1>	; 16
		viewStruct <1, 1>	; 17
		viewStruct <2, 1>	; 18
		viewStruct <255, 0>	; 19
		viewStruct <1, 0>	; 20
southDelta	viewStruct <3, 253>	   ; 0
		viewStruct <2, 253>	; 1
		viewStruct <1, 253>	; 2
		viewStruct <0, 253>	; 3
		viewStruct <255, 253>	; 4
		viewStruct <254, 253>	; 5
		viewStruct <253, 253>	; 6
		viewStruct <3, 254>	; 7
		viewStruct <2, 254>	; 8
		viewStruct <1, 254>	; 9
		viewStruct <0, 254>	; 10
		viewStruct <255, 254>	; 11
		viewStruct <254, 254>	; 12
		viewStruct <253, 254>	; 13
		viewStruct <2, 255>	; 14
		viewStruct <1, 255>	; 15
		viewStruct <0, 255>	; 16
		viewStruct <255, 255>	; 17
		viewStruct <254, 255>	; 18
		viewStruct <1, 0>	; 19
		viewStruct <255, 0>	; 20
eastDelta	viewStruct <3, 3>	  ; 0
		viewStruct <3, 2>	; 1
		viewStruct <3, 1>	; 2
		viewStruct <3, 0>	; 3
		viewStruct <3, 255>	; 4
		viewStruct <3, 254>	; 5
		viewStruct <3, 253>	; 6
		viewStruct <2, 3>	; 7
		viewStruct <2, 2>	; 8
		viewStruct <2, 1>	; 9
		viewStruct <2, 0>	; 10
		viewStruct <2, 255>	; 11
		viewStruct <2, 254>	; 12
		viewStruct <2, 253>	; 13
		viewStruct <1, 2>	; 14
		viewStruct <1, 1>	; 15
		viewStruct <1, 0>	; 16
		viewStruct <1, 255>	; 17
		viewStruct <1, 254>	; 18
		viewStruct <0, 1>	; 19
		viewStruct <0, 255>	; 20
westDelta	viewStruct <253, 253>	  ; 0
		viewStruct <253, 254>	; 1
		viewStruct <253, 255>	; 2
		viewStruct <253, 0>	; 3
		viewStruct <253, 1>	; 4
		viewStruct <253, 2>	; 5
		viewStruct <253, 3>	; 6
		viewStruct <254, 253>	; 7
		viewStruct <254, 254>	; 8
		viewStruct <254, 255>	; 9
		viewStruct <254, 0>	; 10
		viewStruct <254, 1>	; 11
		viewStruct <254, 2>	; 12
		viewStruct <254, 3>	; 13
		viewStruct <255, 254>	; 14
		viewStruct <255, 255>	; 15
		viewStruct <255, 0>	; 16
		viewStruct <255, 1>	; 17
		viewStruct <255, 2>	; 18
		viewStruct <0, 255>	; 19
		viewStruct <0, 1>	; 20
off_44268	dd northDelta, eastDelta, southDelta,	westDelta; 0
byte_44278	db 3, 3, 3, 3, 3, 3,	3, 1, 1, 1; 0
		db 1, 1, 1, 6, 6, 6, 6,	6, 6, 6; 10
		db 10, 10, 10, 10, 10, 10, 2, 2, 2, 2; 20
		db 10, 10, 10, 10, 10, 10, 10, 10, 10, 10; 30
		db 10, 3, 3, 3,	3, 18, 18, 18, 10, 10; 40
		db 10, 10, 10, 10, 6, 6, 32, 32, 32, 11; 50
		db 11, 0		; 60
byte_442B6	db 6, 6, 6, 6, 6, 6,	6, 6
		db 6, 6, 6, 6, 6, 12, 12, 12
		db 12, 12, 12, 12, 64, 64, 64, 64
		db 64, 64, 14, 14, 14, 14, 20, 20
		db 20, 20, 20, 64, 64, 64, 64, 64
		db 64, 20, 20, 20, 20, 36, 36, 36
		db 64, 64, 64, 64, 64, 64, 36, 36
		db 64, 64, 64, 64, 64, 0
byte_442F4	db 2, 2, 2, 2, 2, 2,	2, 0
		db 0, 0, 0, 0, 0, 2, 2,	2
		db 2, 2, 2, 2, 0, 0, 0,	2
		db 2, 2, 0, 0, 0, 0, 2,	2
		db 2, 2, 2, 0, 0, 0, 2,	2
		db 2, 0, 0, 0, 0, 2, 2,	2
		db 0, 0, 0, 2, 2, 2, 0,	0
		db 2, 2, 2, 0, 0, 0
byte_44332	db 1, 2, 3, 4
		db 5, 9, 11, 9
		db 10, 11, 15, 17
		db 15, 16, 17, 19
		db 20, 0
byte_44344	db 0, 255, 1, 1	   ; 0
		db 2, 255, 255,	1	; 4
		db 3, 255, 1, 1		; 8
		db 2, 255, 255,	1	; 12
byte_44354	db 0, 0FFh, 0FFh, 0FFh  ; 0
		db 0FFh, 0, 0FFh, 0FFh	; 4
		db 0FFh, 0FFh, 0FFh, 0FFh; 8
		db 0FFh, 0, 0FFh, 0FFh	; 12
dun_deltaNorth	viewStruct <253,	4>     ; 0
		viewStruct <254, 4>	; 1
		viewStruct <255, 4>	; 2
		viewStruct <0, 4>	; 3
		viewStruct <1, 4>	; 4
		viewStruct <2, 4>	; 5
		viewStruct <3, 4>	; 6
		viewStruct <253, 3>	; 7
		viewStruct <254, 3>	; 8
		viewStruct <255, 3>	; 9
		viewStruct <0, 3>	; 10
		viewStruct <1, 3>	; 11
		viewStruct <2, 3>	; 12
		viewStruct <3, 3>	; 13
		viewStruct <254, 2>	; 14
		viewStruct <255, 2>	; 15
		viewStruct <0, 2>	; 16
		viewStruct <1, 2>	; 17
		viewStruct <2, 2>	; 18
		viewStruct <255, 1>	; 19
		viewStruct <0, 1>	; 20
		viewStruct <1, 1>	; 21
		viewStruct <255, 0>	; 22
		viewStruct <0, 0>	; 23
		viewStruct <1, 0>	; 24
		viewStruct <255, 3>	; 25
		viewStruct <0, 3>	; 26
		viewStruct <1, 3>	; 27
		viewStruct <255, 2>	; 28
		viewStruct <0, 2>	; 29
		viewStruct <1, 2>	; 30
		viewStruct <255, 1>	; 31
		viewStruct <0, 1>	; 32
		viewStruct <1, 1>	; 33
dun_deltaSouth	viewStruct <3, 252>     ; 0
		viewStruct <2, 252>	; 1
		viewStruct <1, 252>	; 2
		viewStruct <0, 252>	; 3
		viewStruct <255, 252>	; 4
		viewStruct <254, 252>	; 5
		viewStruct <253, 252>	; 6
		viewStruct <3, 253>	; 7
		viewStruct <2, 253>	; 8
		viewStruct <1, 253>	; 9
		viewStruct <0, 253>	; 10
		viewStruct <255, 253>	; 11
		viewStruct <254, 253>	; 12
		viewStruct <253, 253>	; 13
		viewStruct <2, 254>	; 14
		viewStruct <1, 254>	; 15
		viewStruct <0, 254>	; 16
		viewStruct <255, 254>	; 17
		viewStruct <254, 254>	; 18
		viewStruct <1, 255>	; 19
		viewStruct <0, 255>	; 20
		viewStruct <255, 255>	; 21
		viewStruct <1, 0>	; 22
		viewStruct <0, 0>	; 23
		viewStruct <255, 0>	; 24
		viewStruct <1, 253>	; 25
		viewStruct <0, 253>	; 26
		viewStruct <255, 253>	; 27
		viewStruct <1, 254>	; 28
		viewStruct <0, 254>	; 29
		viewStruct <255, 254>	; 30
		viewStruct <1, 255>	; 31
		viewStruct <0, 255>	; 32
		viewStruct <255, 255>	; 33
dun_deltaEast	viewStruct <4, 3>	      ;	0
		viewStruct <4, 2>	; 1
		viewStruct <4, 1>	; 2
		viewStruct <4, 0>	; 3
		viewStruct <4, 255>	; 4
		viewStruct <4, 254>	; 5
		viewStruct <4, 253>	; 6
		viewStruct <3, 3>	; 7
		viewStruct <3, 2>	; 8
		viewStruct <3, 1>	; 9
		viewStruct <3, 0>	; 10
		viewStruct <3, 255>	; 11
		viewStruct <3, 254>	; 12
		viewStruct <3, 253>	; 13
		viewStruct <2, 2>	; 14
		viewStruct <2, 1>	; 15
		viewStruct <2, 0>	; 16
		viewStruct <2, 255>	; 17
		viewStruct <2, 254>	; 18
		viewStruct <1, 1>	; 19
		viewStruct <1, 0>	; 20
		viewStruct <1, 255>	; 21
		viewStruct <0, 1>	; 22
		viewStruct <0, 0>	; 23
		viewStruct <0, 255>	; 24
		viewStruct <3, 1>	; 25
		viewStruct <3, 0>	; 26
		viewStruct <3, 255>	; 27
		viewStruct <2, 1>	; 28
		viewStruct <2, 0>	; 29
		viewStruct <2, 255>	; 30
		viewStruct <1, 1>	; 31
		viewStruct <1, 0>	; 32
		viewStruct <1, 255>	; 33
dun_deltaWest	viewStruct <252, 253>   ;	0
		viewStruct <252, 254>	; 1
		viewStruct <252, 255>	; 2
		viewStruct <252, 0>	; 3
		viewStruct <252, 1>	; 4
		viewStruct <252, 2>	; 5
		viewStruct <252, 3>	; 6
		viewStruct <253, 253>	; 7
		viewStruct <253, 254>	; 8
		viewStruct <253, 255>	; 9
		viewStruct <253, 0>	; 10
		viewStruct <253, 1>	; 11
		viewStruct <253, 2>	; 12
		viewStruct <253, 3>	; 13
		viewStruct <254, 254>	; 14
		viewStruct <254, 255>	; 15
		viewStruct <254, 0>	; 16
		viewStruct <254, 1>	; 17
		viewStruct <254, 2>	; 18
		viewStruct <255, 255>	; 19
		viewStruct <255, 0>	; 20
		viewStruct <255, 1>	; 21
		viewStruct <0, 255>	; 22
		viewStruct <0, 0>	; 23
		viewStruct <0, 1>	; 24
		viewStruct <253, 255>	; 25
		viewStruct <253, 0>	; 26
		viewStruct <253, 1>	; 27
		viewStruct <254, 255>	; 28
		viewStruct <254, 0>	; 29
		viewStruct <254, 1>	; 30
		viewStruct <255, 255>	; 31
		viewStruct <255, 0>	; 32
		viewStruct <255, 1>	; 33
off_44474	dd dun_deltaNorth, dun_deltaEast, dun_deltaSouth, dun_deltaWest	; 3
byte_44484	db 0, 1, 2, 2, 2, 0,	3, 4; 0
		db 3, 3, 4, 4, 4, 0, 3,	4; 8
byte_44494	db 3Dh, 38h,	2Dh, 1Eh, 0Dh, 0, 2, 2,	2, 2; 0
		db 2, 2, 2, 16h, 16h, 4, 4, 16h, 16h, 6; 10
		db 6, 6, 6, 6, 6, 6, 2Ch, 2Ah, 2Ch, 38h; 20
		db 36h,	38h, 18h, 8, 8,	18h, 0Ah, 0Ah, 0Ah; 30
		db 0Ah,	0Ah, 30h, 2Eh, 30h, 3Ch, 3Ah, 3Ch; 39
		db 0Ch,	0Ch, 0Ch, 0Ch, 0Eh, 0Eh, 0Eh, 34h; 47
		db 32h,	34h, 40h, 3Eh, 40h, 10h, 10h, 12h; 55
		db 12h,	12h, 14h, 14h, 0; 63
byte_444D8	db 0, 0, 0, 0	   ; 0
		db 0, 0, 0, 0		; 4
		db 0, 0, -1, -1		; 8
		db -1, 0, 0, 0		; 12
		db 0, 0, 0, 0		; 16
		db 0, 0, -1, 0		; 20
		db 0, -1, 0, 0		; 24
		db -1, -1, 0, 0		; 28
		db 0, 0, 0, 0		; 32
		db 0, -1, 0, 0		; 36
		db -1, 0, 0, -1		; 40
		db -1, 0, 0, 0		; 44
		db 0, 0, -1, 0		; 48
		db 0, -1, 0, -1		; 52
		db 0, 0, 0, 0		; 56
		db -1, 0		; 60
byte_44516	db 0, 1, 2, 3, 4, 5,	6, 1, 2, 3, 3, 4, 5; 0
		db 7, 8, 9, 0Ah, 0Bh, 0Ch, 0Dh,	19h, 1Ah; 13
		db 1Bh,	19h, 1Ah, 1Bh, 9, 0Ah, 0Ah, 0Bh; 22
		db 0Eh,	0Fh, 10h, 11h, 12h, 1Ch, 1Dh, 1Eh; 30
		db 1Ch,	1Dh, 1Eh, 0Fh, 10h, 10h, 11h, 13h; 38
		db 14h,	15h, 1Fh, 20h, 21h, 1Fh, 20h, 21h; 46
		db 14h,	14h, 16h, 17h, 18h, 17h, 17h, 0; 54
byte_44554	db 4, 4, 4, 4, 4, 4,	4, 8, 8, 8, 0, 0, 0; 0
		db 4, 4, 4, 4, 4, 4, 4,	4, 4, 4, 0, 0, 0; 13
		db 8, 8, 0, 0, 4, 4, 4,	4, 4, 4, 4, 4, 0; 26
		db 0, 0, 8, 8, 0, 0, 4,	4, 4, 4, 4, 4, 0; 39
		db 0, 0, 8, 0, 4, 4, 4,	8, 0, 0; 52
stru_44592	unknown_t <12, 42>	   ; 0
		unknown_t <15, 42>	; 1
		unknown_t <18, 42>	; 2
		unknown_t <21, 42>	; 3
		unknown_t <24, 42>	; 4
		unknown_t <27, 42>	; 5
		unknown_t <30, 42>	; 6
		unknown_t <5, 38>	; 7
		unknown_t <12, 38>	; 8
		unknown_t <26, 38>	; 9
		unknown_t <29, 38>	; 10
		unknown_t <31, 38>	; 11
		unknown_t <39, 38>	; 12
		unknown_t <254,	38>	; 13
		unknown_t <5, 38>	; 14
		unknown_t <17, 44>	; 15
		unknown_t <24, 44>	; 16
		unknown_t <31, 44>	; 17
		unknown_t <33, 38>	; 18
		unknown_t <40, 38>	; 19
		unknown_t <13, 33>	; 20
		unknown_t <21, 33>	; 21
		unknown_t <31, 33>	; 22
		unknown_t <13, 55>	; 23
		unknown_t <21, 55>	; 24
		unknown_t <31, 55>	; 25
		unknown_t <255,	38>	; 26
		unknown_t <23, 38>	; 27
		unknown_t <31, 38>	; 28
		unknown_t <42, 38>	; 29
		unknown_t <2, 42>	; 30
		unknown_t <12, 42>	; 31
		unknown_t <23, 42>	; 32
		unknown_t <34, 42>	; 33
		unknown_t <45, 42>	; 34
		unknown_t <4, 21>	; 35
		unknown_t <20, 21>	; 36
		unknown_t <34, 21>	; 37
		unknown_t <4, 63>	; 38
		unknown_t <20, 63>	; 39
		unknown_t <34, 63>	; 40
		unknown_t <3, 35>	; 41
		unknown_t <19, 35>	; 42
		unknown_t <33, 35>	; 43
		unknown_t <48, 35>	; 44
		unknown_t <0, 35>	; 45
		unknown_t <18, 35>	; 46
		unknown_t <37, 35>	; 47
		unknown_t <0, 8>	; 48
		unknown_t <17, 4>	; 49
		unknown_t <44, 8>	; 50
		unknown_t <0, 77>	; 51
		unknown_t <17, 77>	; 52
		unknown_t <44, 77>	; 53
		unknown_t <12, 22>	; 54
		unknown_t <37, 22>	; 55
		unknown_t <235,	22>	; 56
		unknown_t <11, 22>	; 57
		unknown_t <43, 22>	; 58
		unknown_t <0, 0>	; 59
		unknown_t <44, 0>	; 60
byte_4460C	db 0, 0, 0, 0, 0, 0,	0, 0, 0, 0, 0, 0, 0; 0
		db 0, 0, 0FFh, 0FFh, 0FFh, 0, 0, 0, 0, 0; 13
		db 0, 0, 0, 0, 0FFh, 0FFh, 0, 0, 0FFh, 0FFh; 23
		db 0FFh, 0, 0, 0, 0, 0,	0, 0, 0, 0FFh, 0FFh; 33
		db 0, 0FFh, 0FFh, 0FFh,	0, 0, 0, 0, 0, 0; 44
		db 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh; 54
		db 0			; 61
byte_4464A	db 30, 31, 32, 33
		db 34, 42, 43, 45
		db 46, 47, 54, 55
		db 56, 57, 58, 59
		db 60, 0
strg_inventory	db 0C3h, 0, 1, 0C3h, 0, 1, 0C3h, 0, 1, 0C3h; 0
		db 0, 1, 0Fh, 0, 0FFh, 0Fh, 0, 0FFh, 7,	0; 10
		db 0FFh, 7, 0, 0FFh, 8,	0, 0FFh, 8, 0, 0FFh; 20
		db 16h,	0, 18h,	16h, 0,	18h, 76h, 0, 0Ah; 30
		db 2, 0, 1, 2, 0, 1, 1Eh, 0, 50h, 0CAh,	0; 39
		db 5, 0DFh, 0, 0Ah, 7Bh, 0, 0FFh, 7Ch, 0; 50
		db 18h,	73h, 0,	0FFh, 74h, 0, 0FFh, 87h; 59
		db 0, 0FFh, 88h, 0, 0FFh, 98h, 0, 0FFh,	99h; 67
		db 0, 0FFh, 9Ch, 0, 0FFh, 9Dh, 0, 0FFh;	76
bigpicLightOffset dw 0,	460h, 818h, 9A0h, 8C0h;	0
bigpicLightSize	dw 1340h, 0A80h, 620h, 348h, 1C0h; 0
iconXOffset	db 80, 92, 108, 124, 136, 0; 0
iconHeight	db 19, 26, 17, 20, 16, 0; 0
iconWidth	db 12, 16, 16, 12, 20, 0; 0
iconDataList	dd	iconLight, iconCompass,	iconAreaEnchant, iconShield, iconLevitation; 0
word_4470E	dw 0E4h, 1A0h, 110h,	0F0h, 140h; 0
byte_44718	db 0, 0, 0, 0, 0, 0	   ; 0
byte_4471E	db 2, 0, 4, 0, 3, 0	   ; 0
iconActiveFlagMaybe db 0, 0, 0,	0, 0, 0	    ; 0
byte_4472A	db 4, 4, 4, 1, 4, 0	   ; 0
byte_44730	db 0
byte_44731	db 0
		db    0
		db    0
		db    0
		db    0
aMafl		db 'MAFL',0
aMageFlame	db 'Mage Flame',0
aArfi		db 'ARFI',0
aArcFire	db 'Arc Fire',0
aTrzp		db 'TRZP',0
aTrapZap	db 'Trap Zap',0
aFrfo		db 'FRFO',0
aFreezeFoes	db 'Freeze Foes',0
aMaco		db 'MACO',0
aKielSCompass	db 'Kiel',27h,'s Compass',0
aWohl		db 'WOHL',0
aWordOfHealing	db 'Word of Healing',0
aLere		db 'LERE',0
aLesserRev_	db 'Lesser Rev.',0
aLevi		db 'LEVI',0
aLevitation	db 'Levitation',0
aWast		db 'WAST',0
aWarstrike	db 'Warstrike',0
aInwo		db 'INWO',0
aInstantWolf	db 'Instant Wolf',0
aFlre		db 'FLRE',0
aFleshRestore	db 'Flesh Restore',0
aGrre		db 'GRRE',0
aGreaterRev_	db 'Greater Rev.',0
aShsp		db 'SHSP',0
aShockSphere	db 'Shock-Sphere',0
aFlan		db 'FLAN',0
aFleshAnew	db 'Flesh Anew',0
aMale		db 'MALE',0
aMajorLev_	db 'Major Lev.',0
aRegn		db 'REGN',0
aRegeneration	db 'Regeneration',0
aApar		db 'APAR',0
aApportArcane	db 'Apport Arcane',0
aFafo		db 'FAFO',0
aFarFoe		db 'Far Foe',0
aInsl		db 'INSL',0
aInstantSlayer	db 'Instant Slayer',0
aVopl		db 'VOPL',0
aVorpalPlating	db 'Vorpal Plating',0
aQufi		db 'QUFI',0
aQuickFix	db 'Quick Fix',0
aScsi		db 'SCSI',0
aScrySight	db 'Scry Sight',0
aHowa		db 'HOWA',0
aHolyWater	db 'Holy Water',0
aMaga		db 'MAGA',0
aMageGauntlets	db 'Mage Gauntlets',0
aAren		db 'AREN',0
aAreaEnchant	db 'Area Enchant',0
aMysh		db 'MYSH',0
aMysticShield	db 'Mystic Shield',0
aOgst		db 'OGST',0
aOgreStrength	db 'Ogre Strength',0
aStfl		db 'STFL',0
aStarflare	db 'Starflare',0
aSpto		db 'SPTO',0
aSpectreTouch	db 'Spectre Touch',0
aDrbr		db 'DRBR',0
aDragonBreath	db 'Dragon Breath',0
aAnma		db 'ANMA',0
aAntiMagic	db 'Anti-Magic',0
aGist		db 'GIST',0
aGiantStrength	db 'Giant Strength',0
aPhdo		db 'PHDO',0
aPhaseDoor	db 'Phase Door',0
aYmca		db 'YMCA',0
aMysticalArmor	db 'Mystical Armor',0
aRest		db 'REST',0
aRestoration	db 'Restoration',0
aDest		db 'DEST',0
aDeathStrike	db 'Death Strike',0
aIces		db 'ICES',0
aIceStorm	db 'Ice Storm',0
aSton		db 'STON',0
aStoneToFlesh	db 'Stone to Flesh',0
aMija		db 'MIJA',0
aMindJab	db 'Mind Jab',0
aPhbl		db 'PHBL',0
aPhaseBlur	db 'Phase Blur',0
aLotr		db 'LOTR',0
aLocateTraps	db 'Locate Traps',0
aDisb		db 'DISB',0
aDisbelieve	db 'Disbelieve',0
aWiwa		db 'WIWA',0
aWindWarrior	db 'Wind Warrior',0
aFear		db 'FEAR',0
aWordOfFear	db 'Word of Fear',0
aWiog		db 'WIOG',0
aWindOgre	db 'Wind Ogre',0
aInvi		db 'INVI',0
aInvisibility	db 'Invisibility',0
aSesi		db 'SESI',0
aSecondSight	db 'Second Sight',0
aCaey		db 'CAEY',0
aCatEyes	db 'Cat Eyes',0
aWidr		db 'WIDR',0
aWindDragon	db 'Wind Dragon',0
aDiil		db 'DIIL',0
aDisruptIll_	db 'Disrupt Ill.',0
aMibl		db 'MIBL',0
aMindBlade	db 'Mind Blade',0
aWigi		db 'WIGI',0
aWindGiant	db 'Wind Giant',0
aSosi		db 'SOSI',0
aSorcerorSight	db 'Sorceror Sight',0
aRime		db 'RIME',0
aRimefang	db 'Rimefang',0
aWihe		db 'WIHE',0
aWindHero	db 'Wind Hero',0
aMagm		db 'MAGM',0
aMageMaelstrom	db 'Mage Maelstrom',0
aPrec		db 'PREC',0
aPreclusion	db 'Preclusion',0
aSuel		db 'SUEL',0
aSummonElementa	db 'Summon Elemental',0
aFofo		db 'FOFO',0
aForceFocus	db 'Force Focus',0
aPrsu		db 'PRSU',0
aPrimeSummoning	db 'Prime Summoning',0
aDeba		db 'DEBA',0
aDemonBane	db 'Demon Bane',0
aFlco		db 'FLCO',0
aFlameColumn	db 'Flame Column',0
aDisp		db 'DISP',0
aDispossess	db 'Dispossess',0
aHerb		db 'HERB',0
aSummonHerb	db 'Summon Herb',0
aAnde		db 'ANDE',0
aAnimateDead	db 'Animate Dead',0
aSpbi		db 'SPBI',0
aSpellBind	db 'Spell Bind',0
aSowh		db 'SOWH',0
aSoulWhip	db 'Soul Whip',0
aGrsu		db 'GRSU',0
aGreaterSummon	db 'Greater Summon',0
aBede		db 'BEDE',0
aBeyondDeath	db 'Beyond Death',0
aWizw		db 'WIZW',0
aWizardWar	db 'Wizard War',0
aDmst		db 'DMST',0
aDemonStrike	db 'Demon Strike',0
aHafo		db 'HAFO',0
aHaltfoe	db 'Haltfoe',0
aMeme		db 'MEME',0
aMeleeMen	db 'Melee Men',0
aBasp		db 'BASP',0
aBatchspell	db 'Batchspell',0
aCamr		db 'CAMR',0
aCamaraderie	db 'Camaraderie',0
aNila		db 'NILA',0
aNightLance	db 'Night Lance',0
aHeal		db 'HEAL',0
aHealAll	db 'Heal All',0
aBrkr		db 'BRKR',0
aKringleBros_	db 'Kringle Bros.',0
aMama		db 'MAMA',0
aMangarSMallet	db 'Mangar',27h,'s Mallet',0
aVitl		db 'VITL',0
aVitality	db 'Vitality',0
aArbo		db 'ARBO',0
aArbo_0		db 'Arbo',0
aEnik		db 'ENIK',0
aEnik_0		db 'Enik',0
aWifi		db 'WIFI',0
aWitherfist	db 'Witherfist',0
aCold		db 'COLD',0
aFrostForce	db 'Frost Force',0
aGeli		db 'GELI',0
aGeli_0		db 'Geli',0
aEcul		db 'ECUL',0
aEcul_0		db 'Ecul',0
aGofi		db 'GOFI',0
aGodFire	db 'God Fire',0
aStun		db 'STUN',0
aStunForce	db 'Stun Force',0
aLuce		db 'LUCE',0
aLuce_0		db 'Luce',0
aIleg		db 'ILEG',0
aIleg_0		db 'Ileg',0
aLuck		db 'LUCK',0
aLuckChant	db 'Luck Chant',0
aFade		db 'FADE',0
aFarDeath	db 'Far Death',0
aKine		db 'KINE',0
aKine_0		db 'Kine',0
aObra		db 'OBRA',0
aObra_0		db 'Obra',0
aWhat		db 'WHAT',0
aIdentify	db 'Identify',0
aOlay		db 'OLAY',0
aYouth		db 'Youth',0
aOluk		db 'OLUK',0
aOluk_0		db 'Oluk',0
aEcea		db 'ECEA',0
aEcea_0		db 'Ecea',0
aGrro		db 'GRRO',0
aGraveRobber	db 'Grave Robber',0
aFota		db 'FOTA',0
aForceOfTarjan	db 'Force of Tarjan',0
aAece		db 'AECE',0
aAece_0		db 'Aece',0
aKulo		db 'KULO',0
aKulo_0		db 'Kulo',0
aShsh		db 'SHSH',0
aShadowShield	db 'Shadow Shield',0
aFafi		db 'FAFI',0
aFatalFist	db 'Fatal Fist',0
aEvil		db 'EVIL',0
aEvil_0		db 'Evil',0
aLive		db 'LIVE',0
aLive_0		db 'Live',0
aEada		db 'EADA',0
aEarthDagger	db 'Earth Dagger',0
aEaso		db 'EASO',0
aEarthSong	db 'Earth Song',0
aEawa		db 'EAWA',0
aEarthWard	db 'Earth Ward',0
aTreb		db 'TREB',0
aTrebuchet	db 'Trebuchet',0
aEael		db 'EAEL',0
aEarthElemental	db 'Earth Elemental',0
aWawa		db 'WAWA',0
aWallWarp	db 'Wall Warp',0
aRock		db 'ROCK',0
aPetrify	db 'Petrify',0
aRoal		db 'ROAL',0
aRoscoeSAlert	db 'Roscoe',27h,'s Alert',0
aSuso		db 'SUSO',0
aSuccorSong	db 'Succor Song',0
aSast		db 'SAST',0
aSandstorm	db 'Sandstorm',0
aSant		db 'SANT',0
aSanctuary	db 'Sanctuary',0
aGlst		db 'GLST',0
aGlacierStrike	db 'Glacier Strike',0
aPath		db 'PATH',0
aPathfinder	db 'Pathfinder',0
aMaba		db 'MABA',0
aMagmaBlast	db 'Magma Blast',0
aJobo		db 'JOBO',0
aJoltBolt	db 'Jolt Bolt',0
aEama		db 'EAMA',0
aEarthMaw	db 'Earth Maw',0
aGill		db 'GILL',0
aGillesGills	db 'Gilles Gills',0
aDiva		db 'DIVA',0
aDivineInt_	db 'Divine Int.',0
aNuke		db 'NUKE',0
aGotterdamurung	db 'Gotterdamurung',0
aItem		db 'Item',0
aWeapon		db 'Weapon',0
aShield		db 'Shield',0
aArmor		db 'Armor',0
aHelm		db 'Helm',0
aGloves		db 'Gloves',0
aInstrument	db 'Instrument',0
aFigurine	db 'Figurine',0
aRing		db 'Ring',0
aWand		db 'Wand',0
aBow		db 'Bow',0
aQuiver		db 'Quiver',0
aContainer	db 'Container',0
aNothing	db 'Nothing',0
aTorch		db 'Torch',0
aLamp		db 'Lamp',0
aBroadsword	db 'Broadsword',0
aShortSword	db 'Short Sword',0
aDagger		db 'Dagger',0
aWarAxe		db 'War Axe',0
aHalbard	db 'Halbard',0
aLongBow	db 'Long Bow',0
aStaff		db 'Staff',0
aBuckler	db 'Buckler',0
aTowerShield	db 'Tower Shield',0
aLeatherArmor	db 'Leather Armor',0
aChainMail	db 'Chain Mail',0
aScaleArmor	db 'Scale Armor',0
aPlateArmor	db 'Plate Armor',0
aRobes		db 'Robes',0
aLeatherGloves	db 'Leather Gloves',0
aGauntlets	db 'Gauntlets',0
aMandolin	db 'Mandolin',0
aSpear		db 'Spear',0
aArrows		db 'Arrows',0
aMthrSword	db 'Mthr Sword',0
aMthrShield	db 'Mthr Shield',0
aMthrChain	db 'Mthr Chain',0
aMthrScale	db 'Mthr Scale',0
aGiantFgn	db 'Giant Fgn',0
aMthrBracers	db 'Mthr Bracers',0
aBardsword	db 'Bardsword',0
aFireHorn	db 'Fire Horn',0
aLitewand	db 'Litewand',0
aMthrDagger	db 'Mthr Dagger',0
aMthrHelm	db 'Mthr Helm',0
aMthrGloves	db 'Mthr Gloves',0
aMthrAxe	db 'Mthr Axe',0
aShuriken	db 'Shuriken',0
aMthrPlate	db 'Mthr Plate',0
aMoltenFgn	db 'Molten Fgn',0
aSpellSpear	db 'Spell Spear',0
aShieldRing	db 'Shield Ring',0
aFinSFlute	db 'Fin',27h,'s Flute',0
aKaelSAxe	db 'Kael',27h,'s Axe',0
aMthrArrows	db 'Mthr Arrows',0
aDayblade	db 'Dayblade',0
aShieldStaff	db 'Shield Staff',0
aElfCloak	db 'Elf Cloak',0
aHawkblade	db 'Hawkblade',0
aAdmtSword	db 'Admt Sword',0
aAdmtShield	db 'Admt Shield',0
aAdmtHelm	db 'Admt Helm',0
aAdmtGloves	db 'Admt Gloves',0
aPureblade	db 'Pureblade',0
aBoomerang	db 'Boomerang',0
aAliSCarpet	db 'Ali',27h,'s Carpet',0
aLuckshield	db 'Luckshield',0
aDozerFgn	db 'Dozer Fgn',0
aAdmtChain	db 'Admt Chain',0
aDeathStars	db 'Death Stars',0
aAdmtPlate	db 'Admt Plate',0
aAdmtBracers	db 'Admt Bracers',0
aSlayerFgn	db 'Slayer Fgn',0
aPureShield	db 'Pure Shield',0
aMageStaff	db 'Mage Staff',0
aWarStaff	db 'War Staff',0
aThiefDagger	db 'Thief Dagger',0
aSoulMace	db 'Soul Mace',0
aOgrewand	db 'Ogrewand',0
aKatoSBracer	db 'Kato',27h,'s bracer',0
aSorcerstaff	db 'Sorcerstaff',0
aGaltSFlute	db 'Galt',27h,'s Flute',0
aFrostHorn	db 'Frost Horn',0
aAgSArrows	db 'Ag',27h,'s Arrows',0
aDmndShield	db 'Dmnd Shield',0
aBardBow	db 'Bard Bow',0
aDmndHelm	db 'Dmnd Helm',0
aElfBoots	db 'Elf Boots',0
aVanquisherFgn	db 'Vanquisher Fgn',0
aConjurstaff	db 'Conjurstaff',0
aStaffOfLor	db 'Staff of Lor',0
aFlameSword	db 'Flame Sword',0
aPowerstaff	db 'Powerstaff',0
aBreathRing 	db 'Breath Ring',0
aDragonshield	db 'Dragonshield',0
aDmndPlate	db 'Dmnd Plate',0
aWargloves	db 'Wargloves',0
aWizhelm	db 'Wizhelm',0
aDragonwand	db 'Dragonwand',0
aDeathring	db 'Deathring',0
aCrystalSword	db 'Crystal Sword',0
aSpeedboots	db 'Speedboots',0
aFlameHorn	db 'Flame Horn',0
aZenArrows	db 'Zen Arrows',0
aDeathdrum	db 'Deathdrum',0
aPipesOfPan	db 'Pipes of Pan',0
aPowerRing	db 'Power Ring',0
aSongAxe	db 'Song Axe',0
aTrickBrick	db 'Trick Brick',0
aDragonFgn	db 'Dragon Fgn',0
aMageFgn	db 'Mage Fgn',0
aTrollRing	db 'Troll Ring',0
aAramSKnife	db 'Aram',27h,'s Knife',0
aAngraSEye	db 'Angra',27h,'s Eye',0
aHerbFgn	db 'Herb Fgn',0
aMasterWand	db 'Master Wand',0
aBrothersFgn	db 'Brothers Fgn',0
aDynamite	db 'Dynamite',0
aThorSHammer	db 'Thor',27h,'s Hammer',0
aStoneblade	db 'Stoneblade',0
aHolyHandgrenad	db 'Holy Handgrenade',0
aMasterkey	db 'Masterkey',0
aNospinRing	db 'Nospin Ring',0
aCrystalLens	db 'Crystal Lens',0
aSmokeyLens	db 'Smokey Lens',0
aBlackLens	db 'Black Lens',0
aSphereOfLanati	db 'Sphere of Lanatir',0
aWandOfPower	db 'Wand of Power',0
aAcorn		db 'Acorn',0
aWineskin	db 'Wineskin',0
aNightspear	db 'Nightspear',0
aTslothaSHead	db 'Tslotha',27h,'s Head',0
aTslothaSHeart	db 'Tslotha',27h,'s Heart',0
aArefolia	db 'Arefolia',0
aValarianSBow	db 'Valarian',27h,'s Bow',0
aArwsOfLife	db 'Arws of Life',0
aCanteen	db 'Canteen',0
aTitanPlate	db 'Titan Plate',0
aTitanShield	db 'Titan Shield',0
aTitanHelm	db 'Titan Helm',0
aFireSpear	db 'Fire Spear',0
aWillowFlute	db 'Willow Flute',0
aFirebrand	db 'Firebrand',0
aHolySword	db 'Holy Sword',0
aWandOfFury	db 'Wand of Fury',0
aLightstar	db 'Lightstar',0
aCrownOfTruth	db 'Crown of Truth',0
aBeltOfAlliria	db 'Belt of Alliria',0
aCrystalKey	db 'Crystal Key',0
aTaoRing	db 'Tao Ring',0
aStealthArrows	db 'Stealth Arrows',0
aYellowStaff	db 'Yellow Staff',0
aSteadyEye	db 'Steady Eye',0
aDivineHalbard	db 'Divine Halbard',0
aIncense	db 'Incense',0
aIChing		db 'I-ching',0
aWhiteRose	db 'White Rose',0
aBlueRose	db 'Blue Rose',0
aRedRose	db 'Red Rose',0
aYellowRose	db 'Yellow Rose',0
aRainbowRose	db 'Rainbow Rose',0
aMagicTriangle	db 'Magic Triangle',0
aXChar		db 'x', 0
aHammerOfWrath	db 'Hammer of Wrath',0
aFerofistSHelm	db 'Ferofist',27h,'s Helm',0
aHelmOfJustice	db 'Helm of Justice',0
aSceaduSCloak	db 'Sceadu',27h,'s Cloak',0
aShadelance	db 'Shadelance',0
aBlackArrows	db 'Black Arrows',0
aWerraSShield	db 'Werra',27h,'s Shield',0
aStrifespear	db 'Strifespear',0
aSheetmusic	db 'Sheetmusic',0
aRightKey	db 'Right Key',0
aLeftKey	db 'Left Key',0
aLever		db 'Lever',0
aNut		db 'Nut',0
aBolt		db 'Bolt',0
aSpanner	db 'Spanner',0
aShadowLock	db 'Shadow Lock',0
aShadowDoor	db 'Shadow Door',0
aMisericorde	db 'Misericorde',0
aHolyAvenger	db 'Holy Avenger',0
aShadowshiv	db 'Shadowshiv',0
aKaliSGarrote	db 'Kali',27h,'s Garrote',0
aFlameKnife	db 'Flame Knife',0
aRedSStiletto	db 'Red',27h,'s Stiletto',0
aHeartseeker	db 'Heartseeker',0
aDmndScale	db 'Dmnd Scale',0
aHolyTnt	db 'Holy TNT',0
aEternalTorch	db 'Eternal Torch',0
aOsconSStaff	db 'Oscon',27h,'s Staff',0
aAngelSRing	db 'Angel',27h,'s Ring',0
aDeathhorn	db 'Deathhorn',0
aStaffOfMangar	db 'Staff of Mangar',0
aTeslaRing	db 'Tesla Ring',0
aDmndBracers	db 'Dmnd Bracers',0
aDeathFgn	db 'Death Fgn',0
aThunderSword	db 'Thunder Sword',0
aPoisonDagger	db 'Poison Dagger',0
aSparkBlade	db 'Spark Blade',0
aGalvanicOboe	db 'Galvanic Oboe',0
aHarmonicGem	db 'Harmonic Gem',0
aTungShield	db 'Tung Shield',0
aTungPlate	db 'Tung Plate',0
aMinstrelsGlove	db 'Minstrels Glove',0
aHuntersCloak	db 'Hunters Cloak',0
aDeathHammer	db 'Death Hammer',0
aBloodMeshRobe	db 'Blood Mesh Robe',0
aSoothingBalm	db 'Soothing Balm',0
aMagesCloak	db 'Mages Cloak',0
aFamiliarFgn	db 'Familiar Fgn',0
aHourglass	db 'Hourglass',0
aThievesHood	db 'Thieves Hood',0
aSurehandAmulet	db 'Surehand Amulet',0
aThievesDart	db 'Thieves Dart',0
aShrillFlute	db 'Shrill Flute',0
aAngelSHarp	db 'Angel',27h,'s Harp',0
aTheBook	db 'The Book',0
aTrothLance	db 'Troth Lance',0
aDmndSuit	db 'Dmnd Suit',0
aDmndFlail	db 'Dmnd Flail',0
aPurpleHeart	db 'Purple Heart',0
aTitanBracers	db 'Titan Bracers',0
aEelskinTunic	db 'Eelskin Tunic',0
aSorcererSHood	db 'Sorcerer',27h,'s Hood',0
aDmndStaff	db 'Dmnd Staff',0
aCrystalGem	db 'Crystal Gem',0
aWandOfForce	db 'Wand of Force',0
aCliLyre	db 'Cli Lyre',0
aYouthPotion	db 'Youth Potion',0
aMthrSuit	db 'Mthr Suit',0
aTitanSuit	db 'Titan Suit',0
aMagesGlove	db 'Mages Glove',0
aFlareCrystal	db 'Flare Crystal',0
aHolyMissile	db 'Holy Missile',0
aGodsBlade	db 'Gods',27h,' Blade',0
aHunterBlade	db 'Hunter Blade',0
aStaffOfGods	db 'Staff of Gods',0
aHornOfGods	db 'Horn of Gods',0
aWater		db 'Water',0
aSpirits	db 'Spirits',0
aWaterOfLife	db 'Water of Life',0
aDragonBlood	db 'Dragon Blood',0
aMoltenTar	db 'Molten Tar',0
aHuman		db 'Human',0
aElf		db 'Elf',0
aDwarf		db 'Dwarf',0
aHobbit		db 'Hobbit',0
aHalfElf	db 'Half-Elf',0
aHalfOrc	db 'Half-Orc',0
aGnome		db 'Gnome',0
aMale_0		db 'Male',0
aFemale		db 'Female',0
nullStr		db 0
		db    0
spellString 	spellString_t <aMafl, aMageFlame>; 0
		spellString_t <aArfi, aArcFire>; 1
		spellString_t <aTrzp, aTrapZap>; 2
		spellString_t <aFrfo, aFreezeFoes>; 3
		spellString_t <aMaco, aKielSCompass>; 4
		spellString_t <aWohl, aWordOfHealing>; 5
		spellString_t <aLere, aLesserRev_>; 6
		spellString_t <aLevi, aLevitation>; 7
		spellString_t <aWast, aWarstrike>; 8
		spellString_t <aInwo, aInstantWolf>; 9
		spellString_t <aFlre, aFleshRestore>; 10
		spellString_t <aGrre, aGreaterRev_>; 11
		spellString_t <aShsp, aShockSphere>; 12
		spellString_t <aFlan, aFleshAnew>; 13
		spellString_t <aMale, aMajorLev_>; 14
		spellString_t <aRegn, aRegeneration>; 15
		spellString_t <aApar, aApportArcane>; 16
		spellString_t <aFafo, aFarFoe>;	17
		spellString_t <aInsl, aInstantSlayer>; 18
		spellString_t <aVopl, aVorpalPlating>; 19
		spellString_t <aQufi, aQuickFix>; 20
		spellString_t <aScsi, aScrySight>; 21
		spellString_t <aHowa, aHolyWater>; 22
		spellString_t <aMaga, aMageGauntlets>; 23
		spellString_t <aAren, aAreaEnchant>; 24
		spellString_t <aMysh, aMysticShield>; 25
		spellString_t <aOgst, aOgreStrength>; 26
		spellString_t <aStfl, aStarflare>; 27
		spellString_t <aSpto, aSpectreTouch>; 28
		spellString_t <aDrbr, aDragonBreath>; 29
		spellString_t <aAnma, aAntiMagic>; 30
		spellString_t <aGist, aGiantStrength>; 31
		spellString_t <aPhdo, aPhaseDoor>; 32
		spellString_t <aYmca, aMysticalArmor>; 33
		spellString_t <aRest, aRestoration>; 34
		spellString_t <aDest, aDeathStrike>; 35
		spellString_t <aIces, aIceStorm>; 36
		spellString_t <aSton, aStoneToFlesh>; 37
		spellString_t <aMija, aMindJab>; 38
		spellString_t <aPhbl, aPhaseBlur>; 39
		spellString_t <aLotr, aLocateTraps>; 40
		spellString_t <aDisb, aDisbelieve>; 41
		spellString_t <aWiwa, aWindWarrior>; 42
		spellString_t <aFear, aWordOfFear>; 43
		spellString_t <aWiog, aWindOgre>; 44
		spellString_t <aInvi, aInvisibility>; 45
		spellString_t <aSesi, aSecondSight>; 46
		spellString_t <aCaey, aCatEyes>; 47
		spellString_t <aWidr, aWindDragon>; 48
		spellString_t <aDiil, aDisruptIll_>; 49
		spellString_t <aMibl, aMindBlade>; 50
		spellString_t <aWigi, aWindGiant>; 51
		spellString_t <aSosi, aSorcerorSight>; 52
		spellString_t <aRime, aRimefang>; 53
		spellString_t <aWihe, aWindHero>; 54
		spellString_t <aMagm, aMageMaelstrom>; 55
		spellString_t <aPrec, aPreclusion>; 56
		spellString_t <aSuel, aSummonElementa>;	57
		spellString_t <aFofo, aForceFocus>; 58
		spellString_t <aPrsu, aPrimeSummoning>;	59
		spellString_t <aDeba, aDemonBane>; 60
		spellString_t <aFlco, aFlameColumn>; 61
		spellString_t <aDisp, aDispossess>; 62
		spellString_t <aHerb, aSummonHerb>; 63
		spellString_t <aAnde, aAnimateDead>; 64
		spellString_t <aSpbi, aSpellBind>; 65
		spellString_t <aSowh, aSoulWhip>; 66
		spellString_t <aGrsu, aGreaterSummon>; 67
		spellString_t <aBede, aBeyondDeath>; 68
		spellString_t <aWizw, aWizardWar>; 69
		spellString_t <aDmst, aDemonStrike>; 70
		spellString_t <aHafo, aHaltfoe>; 71
		spellString_t <aMeme, aMeleeMen>; 72
		spellString_t <aBasp, aBatchspell>; 73
		spellString_t <aCamr, aCamaraderie>; 74
		spellString_t <aNila, aNightLance>; 75
		spellString_t <aHeal, aHealAll>; 76
		spellString_t <aBrkr, aKringleBros_>; 77
		spellString_t <aMama, aMangarSMallet>; 78
		spellString_t <aVitl, aVitality>; 79
		spellString_t <aArbo, aArbo_0>; 80
		spellString_t <aEnik, aEnik_0>; 81
		spellString_t <aWifi, aWitherfist>; 82
		spellString_t <aCold, aFrostForce>; 83
		spellString_t <aGeli, aGeli_0>; 84
		spellString_t <aEcul, aEcul_0>; 85
		spellString_t <aGofi, aGodFire>; 86
		spellString_t <aStun, aStunForce>; 87
		spellString_t <aLuce, aLuce_0>; 88
		spellString_t <aIleg, aIleg_0>; 89
		spellString_t <aLuck, aLuckChant>; 90
		spellString_t <aFade, aFarDeath>; 91
		spellString_t <aKine, aKine_0>; 92
		spellString_t <aObra, aObra_0>; 93
		spellString_t <aWhat, aIdentify>; 94
		spellString_t <aOlay, aYouth>; 95
		spellString_t <aOluk, aOluk_0>; 96
		spellString_t <aEcea, aEcea_0>; 97
		spellString_t <aGrro, aGraveRobber>; 98
		spellString_t <aFota, aForceOfTarjan>; 99
		spellString_t <aAece, aAece_0>; 100
		spellString_t <aKulo, aKulo_0>; 101
		spellString_t <aShsh, aShadowShield>; 102
		spellString_t <aFafi, aFatalFist>; 103
		spellString_t <aEvil, aEvil_0>; 104
		spellString_t <aLive, aLive_0>; 105
		spellString_t <aEada, aEarthDagger>; 106
		spellString_t <aEaso, aEarthSong>; 107
		spellString_t <aEawa, aEarthWard>; 108
		spellString_t <aTreb, aTrebuchet>; 109
		spellString_t <aEael, aEarthElemental>;	110
		spellString_t <aWawa, aWallWarp>; 111
		spellString_t <aRock, aPetrify>; 112
		spellString_t <aRoal, aRoscoeSAlert>; 113
		spellString_t <aSuso, aSuccorSong>; 114
		spellString_t <aSast, aSandstorm>; 115
		spellString_t <aSant, aSanctuary>; 116
		spellString_t <aGlst, aGlacierStrike>; 117
		spellString_t <aPath, aPathfinder>; 118
		spellString_t <aMaba, aMagmaBlast>; 119
		spellString_t <aJobo, aJoltBolt>; 120
		spellString_t <aEama, aEarthMaw>; 121
		spellString_t <aGill, aGillesGills>; 122
		spellString_t <aDiva, aDivineInt_>; 123
		spellString_t <aNuke, aGotterdamurung>;	124
aSpellPoints	db 'Spell Points:',0
aExpr		db 'Expr:',0
aGold		db 'Gold:',0
aPoolGoldTradeG	db 0Ah,0Ah
		db '     Pool  gold',0Ah
		db '     Trade gold',0
aTradeGoldToWho	db 'Trade gold to whom?',0
aHowMuchGoldWil	db 'How much gold will you trade?',0
align 2
aDone		db 'Done!',0
aInventory	db 'Inventory',0
aDoYouWishTo@tr	db ' Do you wish to:',0Ah
		db 0Ah,0Ah,0Ah
		db '@Trade the item',0Ah
		db '@Discard the item',0Ah
		db '@Equip the item',0Ah
		db '@Unequip the item',0Ah
		db '@Identify the item',0
align 2
aItSFilledWith	db 'It',27h,'s filled with ',0
aTriesToIdentif	db ' tries to identify the item...',0Ah
		db 'and /succeed\fail\s!!',0
align 2
aWhoDoes	db 'Who does ',0
aWantToGiveItTo	db ' want to give it to?',0
align 2
aYouDonTKnowAny	db 'You don',27h,'t know any spells.',0
align 2
aKnownSpells	db 'Known spells',0
align 2
aRogueAbilities	db 'Rogue abilities',0
aDisarmTraps	db 'Disarm traps ',0
aIdentifyChest	db 'Identify chest ',0
aIdentifyItem	db 'Identify item ',0
align 2
aHideInShadows	db 'Hide in shadows ',0
align 2
aCriticalHit	db 'Critical hit ',0
aBardAbilities	db 'Bard abilities',0
align 2
aNumberOfTunesL	db 'Number of tunes left: ',0
align 2
aHunterAbilitie	db 'Hunter abilities',0
align 2
aYourPocketsAreEm db 'Your pockets are empty.',0
aStiqdxcnlkhp	db 'StIQDxCnLkHP',0
align 2
genericItemStr	dd aItem, aWeapon, aShield, aArmor, aHelm, aGloves, aInstrument, aFigurine; 0
		dd aRing, aWand, aItem, aBow,	aQuiver, aContainer, aArmor; 8
itemStr		dd aNothing, aTorch, aLamp, aBroadsword; 0
		dd aShortSword,	aDagger, aWarAxe, aHalbard; 4
		dd aLongBow, aStaff, aBuckler, aTowerShield; 8
		dd aLeatherArmor, aChainMail, aScaleArmor, aPlateArmor;	12
		dd aRobes, aHelm, aLeatherGloves, aGauntlets;	16
		dd aMandolin, aSpear, aArrows, aMthrSword; 20
		dd aMthrShield,	aMthrChain, aMthrScale,	aGiantFgn; 24
		dd aMthrBracers, aBardsword, aFireHorn,	aLitewand; 28
		dd aMthrDagger,	aMthrHelm, aMthrGloves,	aMthrAxe; 32
		dd aShuriken, aMthrPlate, aMoltenFgn, aSpellSpear; 36
		dd aShieldRing,	aFinSFlute, aKaelSAxe, aMthrArrows; 40
		dd aDayblade, aShieldStaff, aElfCloak, aHawkblade; 44
		dd aAdmtSword, aAdmtShield, aAdmtHelm, aAdmtGloves; 48
		dd aPureblade, aBoomerang, aAliSCarpet,	aLuckshield; 52
		dd aDozerFgn, aAdmtChain, aDeathStars, aAdmtPlate; 56
		dd aAdmtBracers, aSlayerFgn, aPureShield, aMageStaff; 60
		dd aWarStaff, aThiefDagger, aSoulMace, aOgrewand; 64
		dd aKatoSBracer, aSorcerstaff, aGaltSFlute, aFrostHorn;	68
		dd aAgSArrows, aDmndShield, aBardBow, aDmndHelm; 72
		dd aElfBoots, aVanquisherFgn, aConjurstaff, aStaffOfLor; 76
		dd aFlameSword,	aPowerstaff, aBreathRing, aDragonshield; 80
		dd aDmndPlate, aWargloves, aWizhelm, aDragonwand; 84
		dd aDeathring, aCrystalSword, aSpeedboots, aFlameHorn; 88
		dd aZenArrows, aDeathdrum, aPipesOfPan,	aPowerRing; 92
		dd aSongAxe, aTrickBrick, aDragonFgn, aMageFgn;	96
		dd aTrollRing, aAramSKnife, aAngraSEye,	aHerbFgn; 100
		dd aMasterWand,	aBrothersFgn, aDynamite, aThorSHammer; 104
		dd aStoneblade,	aHolyHandgrenad, aMasterkey, aNospinRing; 108
		dd aCrystalLens, aSmokeyLens, aBlackLens, aSphereOfLanati; 112
		dd aWandOfPower, aAcorn, aWineskin, aNightspear; 116
		dd aTslothaSHead, aTslothaSHeart, aArefolia, aValarianSBow; 120
		dd aArwsOfLife,	aCanteen, aTitanPlate, aTitanShield; 124
		dd aTitanHelm, aFireSpear, aWillowFlute, aFirebrand; 128
		dd aHolySword, aWandOfFury, aLightstar,	aCrownOfTruth; 132
		dd aBeltOfAlliria, aCrystalKey,	aTaoRing, aStealthArrows; 136
		dd aYellowStaff, aSteadyEye, aDivineHalbard, aIncense; 140
		dd aIChing, aWhiteRose,	aBlueRose, aRedRose; 144
		dd aYellowRose,	aRainbowRose, aMagicTriangle, aXChar; 148
		dd aHammerOfWrath, aFerofistSHelm, aXChar, aXChar; 152
		dd aHelmOfJustice, aSceaduSCloak, aShadelance, aBlackArrows; 156
		dd aWerraSShield, aStrifespear,	aSheetmusic, aRightKey;	160
		dd aLeftKey, aLever, aNut, aBolt; 164
		dd aSpanner, aShadowLock, aShadowDoor, aMisericorde; 168
		dd aHolyAvenger, aShadowshiv, aKaliSGarrote, aFlameKnife; 172
		dd aRedSStiletto, aHeartseeker,	aXChar, aXChar; 176
		dd aXChar, aDmndScale, aHolyTnt, aEternalTorch; 180
		dd aOsconSStaff, aAngelSRing, aDeathhorn, aStaffOfMangar; 184
		dd aTeslaRing, aDmndBracers, aDeathFgn,	aThunderSword; 188
		dd aPoisonDagger, aSparkBlade, aGalvanicOboe, aHarmonicGem; 192
		dd aTungShield,	aTungPlate, aMinstrelsGlove, aHuntersCloak; 196
		dd aDeathHammer, aBloodMeshRobe, aSoothingBalm,	aMagesCloak; 200
		dd aFamiliarFgn, aHourglass, aThievesHood, aSurehandAmulet; 204
		dd aThievesDart, aShrillFlute, aAngelSHarp, aTheBook; 208
		dd aTrothLance,	aDmndSuit, aDmndFlail, aPurpleHeart; 212
		dd aTitanBracers, aEelskinTunic, aSorcererSHood, aDmndStaff; 216
		dd aCrystalGem,	aWandOfForce, aCliLyre,	aYouthPotion; 220
		dd aXChar, aXChar, aXChar, aXChar; 224
		dd aXChar, aXChar, aXChar, aXChar; 228
		dd aXChar, aXChar, aXChar, aXChar; 232
		dd aXChar, aXChar, aXChar, aXChar; 236
		dd aMthrSuit, aTitanSuit, aMagesGlove, aFlareCrystal; 240
		dd aHolyMissile, aGodsBlade, aHunterBlade, aStaffOfGods; 244
		dd aHornOfGods,	aXChar, aXChar, aXChar; 248
		dd aXChar, aXChar, aXChar, aXChar; 252
wineskinString	dd aWater	       ; 0
		dd aSpirits		; 1
		dd aWaterOfLife		; 2
		dd aDragonBlood		; 3
		dd aMoltenTar		; 4
byte_464B8	db 0FFh, 1, 1, 0FFh, 0FFh, 0FFh, 1, 0FFh, 0FFh, 0FFh; 0
		db 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh; 10
		db 0FFh, 1, 18h, 0FFh, 0FFh, 0FFh, 0FFh, 1, 0FFh, 0FFh;	20
		db 32h,	50h, 0FFh, 0FFh, 0FFh, 1, 1, 0FFh, 1, 1; 30
		db 0FFh, 0FFh, 1, 0Ah, 50h, 0FFh, 0FFh,	0FFh, 0FFh, 0FFh; 40
		db 0FFh, 0FFh, 0FFh, 0FFh, 32h,	0FFh, 1, 0FFh, 4, 0FFh;	50
		db 0FFh, 1, 0FFh, 0FFh,	0FFh, 0FFh, 0FFh, 58h, 0FFh, 50h; 60
		db 58h,	41h, 0Ah, 0FFh,	0FFh, 0FFh, 0FFh, 1, 0FFh, 23h;	70
		db 0FFh, 33h, 0FFh, 14h, 0FFh, 0FFh, 19h, 23h, 40h, 0FFh; 80
		db 0FFh, 3Ch, 0Ah, 0Ah,	0FFh, 11h, 0FFh, 1Eh, 1, 1; 90
		db 0FFh, 1Eh, 7, 1, 0Bh, 1, 1, 0FFh, 0FFh, 1; 100
		db 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 1,	0Ah, 0FFh; 110
		db 0FFh, 0FFh, 1, 0FFh,	18h, 0Ah, 0FFh,	0FFh, 0FFh, 1; 120
		db 5, 0FFh, 0FFh, 0Ah, 1, 0FFh,	0FFh, 0FFh, 0FFh, 18h; 130
		db 0FFh, 0FFh, 0FFh, 3,	19h, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh; 140
		db 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 18h; 150
		db 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh; 160
		db 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 14h, 0FFh, 0FFh, 0FFh,	0FFh; 170
		db 0FFh, 0FFh, 2, 0FFh,	0Ah, 0FFh, 1Eh,	0FFh, 19h, 0FFh; 180
		db 1, 0FFh, 0FFh, 0FFh,	5, 1, 0FFh, 0FFh, 0FFh,	0FFh; 190
		db 0FFh, 0FFh, 5, 0Ah, 0FFh, 2,	0FFh, 0FFh, 1, 5; 200
		db 5, 4, 0FFh, 0FFh, 0FFh, 0Ah,	0FFh, 0FFh, 0FFh, 0FFh;	210
		db 3, 0Ah, 0Fh,	0Ah, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh; 220
		db 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh; 230
		db 0FFh, 0FFh, 0FFh, 5,	1, 0FFh, 0FFh, 0Ah, 19h, 0FFh; 240
		db 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh; 250
itemDamageDice	db 0, 0, 0, 33	       ; 0
		db 64, 0, 33, 96	; 4
		db 0, 64, 0, 0		; 8
		db 0, 0, 0, 0		; 12
		db 0, 0, 0, 0		; 16
		db 0, 64, 0, 33		; 20
		db 0, 0, 0, 0		; 24
		db 0, 65, 0, 0		; 28
		db 0, 0, 0, 33		; 32
		db 0, 0, 0, 96		; 36
		db 0, 0, 36, 0		; 40
		db 66, 96, 0, 66	; 44
		db 33, 0, 0, 0		; 48
		db 98, 0, 0, 0		; 52
		db 0, 0, 0, 0		; 56
		db 0, 0, 0, 66		; 60
		db 67, 52, 65, 0	; 64
		db 0, 34, 0, 0		; 68
		db 33, 0, 0, 0		; 72
		db 0, 0, 34, 36		; 76
		db 98, 66, 97, 0	; 80
		db 0, 0, 0, 0		; 84
		db 0, 98, 0, 0		; 88
		db 0, 0, 0, 0		; 92
		db 0, 0, 0, 0		; 96
		db 0, 33, 0, 0		; 100
		db 0, 0, 0, 99		; 104
		db 0, 0, 0, 0		; 108
		db 0, 0, 0, 0		; 112
		db 0, 0, 0, 100		; 116
		db 0, 0, 0, 0		; 120
		db 0, 0, 0, 0		; 124
		db 0, 99, 0, 72		; 128
		db 99, 0, 0, 0		; 132
		db 0, 0, 0, 0		; 136
		db 38, 0, 72, 0		; 140
		db 0, 0, 0, 0		; 144
		db 0, 0, 0, 0		; 148
		db 99, 0, 0, 0		; 152
		db 0, 0, 0, 0		; 156
		db 0, 0, 0, 0		; 160
		db 0, 0, 0, 0		; 164
		db 0, 0, 0, 165		; 168
		db 135,	98, 137, 105	; 172
		db 167,	32, 0, 0	; 176
		db 0, 0, 0, 0		; 180
		db 67, 0, 0, 99		; 184
		db 0, 0, 0, 99		; 188
		db 98, 99, 0, 0		; 192
		db 0, 0, 0, 0		; 196
		db 99, 0, 0, 0		; 200
		db 0, 0, 0, 0		; 204
		db 0, 0, 0, 0		; 208
		db 135,	0, 129,	0	; 212
		db 0, 0, 0, 39		; 216
		db 0, 99, 0, 0		; 220
		db 0, 0, 0, 0		; 224
		db 0, 0, 0, 0		; 228
		db 0, 0, 0, 0		; 232
		db 0, 0, 0, 0		; 236
		db 0, 0, 0, 0		; 240
		db 0, 137, 169,	41	; 244
		db 0, 0, 0, 0		; 248
		db 0, 0, 0, 0		; 252
item_acBonWeapDam db 0,	0, 0, 0		  ; 0
		db 0, 0, 0, 0		; 4
		db 0, 0, 1, 2		; 8
		db 2, 3, 4, 5		; 12
		db 1, 1, 1, 1		; 16
		db 0, 0, 0, 32		; 20
		db 3, 4, 5, 0		; 24
		db 4, 64, 0, 0		; 28
		db 32, 2, 2, 32		; 32
		db 0, 6, 0, 32		; 36
		db 2, 2, 32, 0		; 40
		db 16, 18, 3, 16	; 44
		db 64, 4, 3, 3		; 48
		db 0, 0, 2, 3		; 52
		db 0, 5, 0, 7		; 56
		db 6, 0, 5, 2		; 60
		db 0, 16, 48, 0		; 64
		db 0, 50, 0, 0		; 68
		db 96, 5, 2, 4		; 72
		db 0, 0, 34, 16		; 76
		db 17, 16, 16, 4	; 80
		db 8, 4, 3, 0		; 84
		db 1, 16, 0, 0		; 88
		db 0, 2, 2, 0		; 92
		db 3, 0, 0, 0		; 96
		db 0, 64, 0, 0		; 100
		db 0, 0, 0, 32		; 104
		db 48, 0, 0, 0		; 108
		db 0, 0, 0, 37		; 112
		db 51, 0, 0, 48		; 116
		db 0, 0, 0, 4		; 120
		db 32, 0, 10, 22	; 124
		db 5, 48, 2, 65		; 128
		db 66, 17, 0, 10	; 132
		db 0, 0, 37, 2		; 136
		db 36, 4, 49, 0		; 140
		db 0, 0, 0, 0		; 144
		db 0, 0, 0, 0		; 148
		db 0, 39, 0, 0		; 152
		db 9, 28, 0, 0		; 156
		db 8, 80, 0, 0		; 160
		db 0, 0, 0, 0		; 164
		db 0, 0, 0, 115		; 168
		db 84, 16, 49, 33	; 172
		db 66, 82, 0, 0		; 176
		db 0, 7, 0, 0		; 180
		db 51, 2, 0, 36		; 184
		db 2, 8, 0, 66		; 188
		db 49, 50, 0, 0		; 192
		db 23, 12, 7, 40	; 196
		db 81, 4, 0, 4		; 200
		db 0, 0, 4, 0		; 204
		db 0, 2, 2, 0		; 208
		db 81, 15, 80, 0	; 212
		db 10, 20, 3, 33	; 216
		db 0, 32, 5, 0		; 220
		db 0, 0, 0, 0		; 224
		db 0, 0, 0, 0		; 228
		db 0, 0, 0, 0		; 232
		db 0, 0, 0, 0		; 236
		db 10, 15, 4, 0		; 240
		db 0, 85, 83, 50	; 244
		db 0, 0, 0, 0		; 248
		db 0, 0, 0, 0		; 252
itemTypeList	db itType_item, itType_item, itType_item; 0
		db itType_weapon, itType_weapon, itType_weapon;	3
		db itType_weapon, itType_weapon, itType_bow; 6
		db itType_weapon, itType_shield, itType_shield;	9
		db itType_armor, itType_armor, itType_armor; 12
		db itType_armor, itType_armor, itType_helm; 15
		db itType_gloves, itType_gloves, itType_instrument; 18
		db itType_weapon, itType_quiver, itType_weapon;	21
		db itType_shield, itType_armor,	itType_armor; 24
		db itType_figurine, itType_armor, itType_weapon; 27
		db itType_instrument, itType_item0, itType_weapon; 30
		db itType_helm,	itType_gloves, itType_weapon; 33
		db itType_item0, itType_armor, itType_figurine;	36
		db itType_weapon, itType_ring, itType_instrument; 39
		db 11h,	itType_quiver, itType_weapon; 42
		db itType_weapon, itType_armor0, itType_weapon;	45
		db itType_weapon, itType_shield, itType_helm; 48
		db itType_gloves, itType_weapon, itType_item0; 51
		db itType_item0, itType_shield,	itType_figurine; 54
		db itType_armor, itType_weapon,	itType_armor; 57
		db itType_armor, itType_figurine, itType_shield; 60
		db itType_weapon, itType_weapon, itType_weapon;	63
		db 51h,	itType_wand, itType_item0; 66
		db itType_weapon, itType_instrument, itType_instrument;	69
		db itType_quiver, itType_shield, itType_bow; 72
		db itType_helm,	itType_item0, itType_figurine; 75
		db itType_weapon, itType_weapon, itType_weapon;	78
		db itType_weapon, itType_ring, itType_shield; 81
		db itType_armor, itType_gloves,	itType_helm; 84
		db itType_wand,	itType_ring, itType_weapon; 87
		db itType_item0, itType_instrument, itType_quiver; 90
		db itType_instrument, itType_instrument, itType_ring; 93
		db itType_weapon, itType_item0,	itType_figurine; 96
		db itType_figurine, itType_ring, itType_weapon;	99
		db itType_item0, itType_figurine, itType_wand; 102
		db itType_figurine, itType_item0, itType_weapon; 105
		db 61h,	itType_item0, itType_item0; 108
		db itType_ring,	itType_item, itType_item; 111
		db itType_item,	itType_item0, itType_wand; 114
		db itType_item0, itType_container, itType_weapon; 117
		db itType_item0, itType_item0, itType_item0; 120
		db itType_bow, itType_quiver, itType_container;	123
		db itType_armor, itType_shield,	itType_helm; 126
		db itType_weapon, itType_instrument, 51h; 129
		db itType_weapon, itType_wand, itType_item0; 132
		db itType_helm,	itType_item0, itType_item0; 135
		db itType_ring,	itType_quiver, itType_weapon; 138
		db itType_item0, itType_weapon,	itType_item0; 141
		db itType_item0, itType_item0, itType_item0; 144
		db itType_item0, itType_item0, itType_item0; 147
		db itType_item0, itType_item0, itType_weapon; 150
		db itType_helm,	itType_item0, itType_item0; 153
		db itType_helm,	itType_armor, itType_weapon; 156
		db itType_item0, itType_shield,	71h; 159
		db itType_item0, itType_item0, itType_item0; 162
		db itType_item0, itType_item0, itType_item0; 165
		db itType_item0, itType_item0, itType_item0; 168
		db itType_weapon, itType_weapon, itType_weapon;	171
		db itType_weapon, itType_weapon, itType_weapon;	174
		db 71h,	itType_item0, itType_item0; 177
		db itType_item0, itType_armor, itType_item0; 180
		db itType_item0, 11h, itType_ring; 183
		db itType_instrument, 51h, itType_ring;	186
		db itType_armor, itType_figurine, itType_weapon; 189
		db 11h,	itType_weapon, itType_instrument; 192
		db itType_item0, itType_shield,	itType_armor; 195
		db itType_gloves, itType_armor,	itType_weapon; 198
		db itType_armor, itType_item0, itType_armor; 201
		db itType_figurine, itType_item0, itType_helm; 204
		db itType_item0, itType_item0, itType_instrument; 207
		db itType_instrument, itType_item0, itType_weapon; 210
		db itType_armor0, itType_weapon, itType_item0; 213
		db itType_armor, itType_instrument, itType_helm; 216
		db itType_weapon, itType_item0,	itType_wand; 219
		db itType_instrument, itType_item0, itType_item0; 222
		db itType_item0, itType_item0, itType_item0; 225
		db itType_item0, itType_item0, itType_item0; 228
		db itType_item0, itType_item0, itType_item0; 231
		db itType_item0, itType_item0, itType_item0; 234
		db itType_item0, itType_item0, itType_item0; 237
		db itType_armor, itType_armor, itType_gloves; 240
		db itType_item0, itType_weapon,	itType_weapon; 243
		db itType_weapon, itType_weapon, itType_instrument; 246
		db itType_item0, itType_item0, itType_item0; 249
		db itType_item0, itType_item0, itType_item0; 252
		db itType_item0		; 255
classEquipMask	db 80h, 40h, 40h, 40h, 40h, 10h, 8, 4; 0
		db 2, 1, 20h, 60h, 0E0h, 0, 0, 0; 8
itemEquipMask	db 0, 0FFh, 0FFh, 8Fh, 9Fh, 0FFh, 8Fh, 87h; 0
		db 9Fh,	0FFh, 9Fh, 8Eh,	9Fh, 8Fh, 8Eh, 86h; 8
		db 0FFh, 9Fh, 0FFh, 86h, 8, 9Fh, 9Fh, 9Eh; 16
		db 9Eh,	8Fh, 9Eh, 0FFh,	70h, 8,	8, 60h;	24
		db 0FFh, 9Fh, 8Ch, 8Fh,	9Bh, 86h, 0FFh,	9Fh; 32
		db 0FFh, 8, 8Eh, 9Fh, 8Eh, 0FFh, 71h, 8Eh; 40
		db 9Eh,	9Eh, 9Eh, 84h, 4, 99h, 0FFh, 9Eh; 48
		db 0FFh, 8Eh, 2, 86h, 70h, 0FFh, 4, 60h; 56
		db 0FFh, 10h, 8Eh, 60h,	70h, 60h, 8, 8;	64
		db 86h,	8Eh, 8,	86h, 0FFh, 8, 60h, 61h;	72
		db 86h,	0FCh, 0FFh, 9Eh, 8Ch, 84h, 60h,	60h; 80
		db 86h,	8Eh, 9Fh, 8, 9Fh, 8, 8,	62h; 88
		db 8, 60h, 0FFh, 0FFh, 0FFh, 86h, 6Ch, 0FFh; 96
		db 60h,	0FFh, 0FFh, 84h, 86h, 0FFh, 0FFh, 0FFh;	104
		db 0FFh, 0FFh, 0FFh, 60h, 60h, 0FFh, 0FFh, 9Fh;	112
		db 0FFh, 0FFh, 0FFh, 9Fh, 9Fh, 0FFh, 84h, 8Ch; 120
		db 86h,	9Fh, 8,	9Eh, 4,	60h, 2,	86h; 128
		db 0FFh, 0FFh, 1, 2, 60h, 2, 87h, 1; 136
		db 1, 0FFh, 0FFh, 0FFh,	0FFh, 0FFh, 0FFh, 0FFh;	144
		db 84h,	86h, 0FFh, 0FFh, 10h, 10h, 86h,	9Fh; 152
		db 8Eh,	8Eh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh; 160
		db 0FFh, 0FFh, 0FFh, 10h, 4, 10h, 10h, 10h; 168
		db 10h,	10h, 0FFh, 0FFh, 0FFh, 8Eh, 0FFh, 0FFh;	176
		db 60h,	0FFh, 8, 20h, 60h, 70h,	0FFh, 8; 184
		db 10h,	80h, 8,	60h, 8Ch, 84h, 8, 2; 192
		db 80h,	60h, 0FFh, 20h,	20h, 60h, 10h, 10h; 200
		db 10h,	8, 8, 4, 86h, 84h, 84h,	0FFh; 208
		db 70h,	2, 60h,	20h, 60h, 60h, 8, 0FFh;	216
		db 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh; 224
		db 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh; 232
		db 86h,	80h, 60h, 60h, 9Fh, 84h, 2, 60h; 240
		db 8, 0FFh, 0FFh, 0FFh,	0FFh, 0FFh, 0FFh, 0FFh;	248
itemEffectList	db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 0
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 4
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 8
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 12
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 16
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 20
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 24
		db itemEff_none, itemEff_freeSinging, itemEff_none, itemEff_none; 28
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 32
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 36
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 40
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 44
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 48
		db itemEff_none, itemEff_none, itemEff_none, itemEff_alwaysHide; 52
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 56
		db itemEff_none, itemEff_none, itemEff_none, itemEff_anotherSpptRegen; 60
		db itemEff_none, 8, itemEff_none, itemEff_none;	64
		db itemEff_calmMonster,	itemEff_none, itemEff_none, itemEff_none; 68
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 72
		db itemEff_none, itemEff_none, itemEff_halfSpptUsage, itemEff_none; 76
		db itemEff_none, itemEff_none, itemEff_breathDefense, itemEff_none; 80
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 84
		db itemEff_none, itemEff_none, itemEff_alwaysRunAway, itemEff_none; 88
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 92
		db itemEff_freeSinging,	itemEff_none, itemEff_none, itemEff_none; 96
		db itemEff_regenHP, itemEff_none, itemEff_none,	itemEff_none; 100
		db itemEff_none, itemEff_none, itemEff_none, itemEff_regenHP; 104
		db itemEff_none, itemEff_none, 0Bh, itemEff_noSpin; 108
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 112
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 116
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 120
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 124
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 128
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 132
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 136
		db itemEff_anotherSpptRegen, itemEff_none, itemEff_none, itemEff_none; 140
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 144
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 148
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 152
		db 8, itemEff_none, itemEff_none, itemEff_none;	156
		db itemEff_breathDefense, itemEff_none,	itemEff_none, itemEff_none; 160
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 164
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 168
		db itemEff_none, itemEff_alwaysHide, 8,	itemEff_none; 172
		db itemEff_none, itemEff_breathDefense,	itemEff_none, itemEff_none; 176
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 180
		db itemEff_regenSppt, itemEff_resurrect, itemEff_alwaysHide, itemEff_halfSpptUsage; 184
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 188
		db itemEff_none, itemEff_none, itemEff_freeSinging, itemEff_none; 192
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 196
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 200
		db itemEff_regenSppt, itemEff_none, 8, itemEff_alwaysHide; 204
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 208
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 212
		db itemEff_none, itemEff_none, itemEff_resurrect, itemEff_regenSppt; 216
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 220
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 224
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 228
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 232
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 236
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 240
		db itemEff_none, itemEff_none, itemEff_none, itemEff_quaterSpptUse; 244
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 248
		db itemEff_none, itemEff_none, itemEff_none, itemEff_none; 252
itemSpellNo	db 255, 126, 127, 255   ; 0	; This array holds the spell number to call when
		db 255,	255, 131, 255	; 4 ; using the	particular item
		db 255,	255, 255, 255	; 8
		db 255,	255, 255, 255	; 12
		db 255,	255, 255, 255	; 16
		db 255,	131, 131, 255	; 20
		db 255,	255, 255, 132	; 24
		db 255,	255, 133, 6	; 28
		db 255,	255, 255, 131	; 32
		db 131,	255, 132, 131	; 36
		db 255,	255, 131, 131	; 40
		db 6, 255, 255,	255	; 44
		db 255,	255, 255, 255	; 48
		db 255,	131, 14, 255	; 52
		db 132,	255, 131, 255	; 56
		db 255,	132, 255, 255	; 60
		db 255,	255, 255, 51	; 64
		db 255,	49, 54,	133	; 68
		db 131,	255, 255, 255	; 72
		db 255,	132, 255, 34	; 76
		db 255,	66, 255, 133	; 80
		db 255,	255, 69, 133	; 84
		db 64, 255, 255, 133	; 88
		db 131,	35, 11,	55	; 92
		db 131,	36, 132, 132	; 96
		db 255,	131, 73, 63	; 100
		db 75, 77, 78, 131	; 104
		db 255,	78, 255, 255	; 108
		db 130,	130, 130, 130	; 112
		db 67, 128, 129, 131	; 116
		db 255,	130, 122, 130	; 120
		db 131,	129, 255, 255	; 124
		db 255,	131, 69, 255	; 128
		db 11, 133, 131, 255	; 132
		db 130,	130, 7,	131	; 136
		db 255,	255, 255, 15	; 140
		db 21, 130, 130, 130	; 144
		db 130,	130, 130, 255	; 148
		db 130,	130, 255, 255	; 152
		db 255,	130, 75, 131	; 156
		db 130,	91, 130, 130	; 160
		db 130,	130, 130, 130	; 164
		db 130,	130, 130, 11	; 168
		db 11, 255, 255, 61	; 172
		db 71, 255, 255, 255	; 176
		db 255,	255, 78, 126	; 180
		db 37, 255, 133, 255	; 184
		db 69, 255, 132, 11	; 188
		db 255,	12, 69,	134	; 192
		db 255,	255, 255, 255	; 196
		db 255,	255, 15, 73	; 200
		db 132,	87, 45,	255	; 204
		db 133,	17, 15,	62	; 208
		db 255,	255, 255, 34	; 212
		db 255,	255, 55, 255	; 216
		db 134,	99, 133, 95	; 220
		db 255,	255, 255, 255	; 224
		db 255,	255, 255, 255	; 228
		db 255,	255, 255, 255	; 232
		db 255,	255, 255, 255	; 236
		db 255,	255, 255, 134	; 240
		db 131,	255, 255, 120	; 244
		db 133,	255, 255, 255	; 248
		db 255,	255, 255, 255	; 252
raceString	dd aHuman		   ; 0
		dd aElf			; 1
		dd aDwarf		; 2
		dd aHobbit		; 3
		dd aHalfElf		; 4
		dd aHalfOrc		; 5
		dd aGnome		; 6
genderString	dd aMale_0		     ; 0
		dd aFemale		; 1
		dd nullStr
		aIsAN db ' is a/n \ ',0
align 2
aLevel		db 'Level',0
acDexterityBonus db 1, 1, 2, 2		 ; 0
		db 3, 3, 3, 4		; 4
		db 4, 4, 4, 4		; 8
		db 5, 5, 5, 5		; 12
		db 5, 0			; 16
itemCharFlags	db ' ', '|', '^', '?', 0, 0; 0 ; This is a list of characters used in the inventory
			; string for flags.
			
			
			
off_46C1A	dd item_trade, item_discard, item_equip, item_unequip, item_identify;	0
aEscToContinue	db 'ESC to continue',0
aThereAreStairs	db 'There are stairs here, going /up\down\. ',0Ah
		db 'Do you wish to take them?',0
align 2
aWhoWantsToGetT	db 'Who wants to get the ',0
align 2
aCanTCarryAny_0	db ' can',27h,'t carry any more items.',0
align 2
aGotThe		db ' got the ',0
aYouDonTHaveEno	db 'You don',27h,'t have enough gold',0
aZounds		db 'Zounds',0
aD		db '%d',0
aBadOpcode	db 'bad opcode',0
off_46CFC	dd mfunc_downStairs ;	0
		dd mfunc_upStairs	; 1
		dd sub_1942B		; 2
		dd mfunc_teleport	; 3
		dd mfunc_battle		; 4
		dd mfunc_clearPrintString ; 5
		dd mfunc_ffcode		; 6
		dd mfunc_drawBigpic	; 7
		dd mfunc_setTitle	; 8
		dd mfunc_getChMaybe	; 9
		dd mfunc_clearTextWindow ; a
		dd mfunc_ifFlag		; b
		dd mfunc_ifNotFlag	; c
		dd sub_19855		; d
		dd mfunc_setFlag	; e
		dd mfunc_clearFlag	; f
		dd mfunc_ifCurSpellEQ	; 10
		dd mfunc_setMapRval	; 11
		dd mfunc_printString	; 12
		dd mfunc_doNothing	; 13
		dd mfunc_ifChHasItemF	; 14
		dd mfunc_getItem	; 15
		dd mfunc_ifHasItem	; 16
		dd mfunc_ifNotHasItem	; 17
		dd mfunc_ifW4ee66	; 18
		dd mfunc_ifYesNo	; 19
		dd mfunc_goto		; 1a
		dd mfunc_battleNoCry	; 1b
		dd mfunc_zero4ee66	; 1c
		dd mfunc_turnAround	; 1d
		dd mfunc_removeItem	; 1e
		dd mfunc_incRegister	; 1f
		dd mfunc_decRegister	; 20
		dd mfunc_ifRegNotZero	; 21
		dd mfunc_ifRegister	; 22
		dd mfunc_drainHP	; 23
		dd mfunc_ifInBox	; 24
		dd mfunc_invANDc3	; 25
		dd mfunc_addToInv	; 26
		dd mfunc_subFromInv	; 27
		dd mfunc_addToRegister	; 28
		dd mfunc_subFromRegister ; 29
		dd mfunc_setDirFacing	; 2a
		dd mfunc_getStrFromUser	; 2b
		dd mfunc_ifStrEq	; 2c
		dd mfunc_setRegFromBuf	; 2d
		dd mfunc_getCharacter	; 2e
		dd mfunc_ifGiveGold	; 2f
		dd sub_1A5C0		; 30
		dd mfunc_ifRegLT	; 31
		dd mfunc_ifRegEQ	; 32
		dd mfunc_ifRegGE	; 33
		dd mfunc_learnSpell	; 34
		dd mfunc_setRegister	; 35
		dd mfunc_chHasItemNo	; 36
		dd mfunc_packInvMaybe	; 37
		dd mfunc_addMonToParty	; 38
		dd mfunc_ifMonInParty	; 39
		dd mfunc_clrPrtStrOffset ; 3a
		dd mfunc_ifIsNight	; 3b
		dd mfunc_rmMonFromParty	; 3c
		dd sub_1A9C8		; 3d
		dd sub_1AAD5		; 3e
		dd mfunc_setChronQuestFlag ; 3f
		dd sub_1AC20		; 40
		dd sub_1AC9E		; 41
		dd mfunc_isWildSqFlagSet ; 42
		dd mfunc_wildSetSqFlag	; 43
		dd mfunc_ifIsClass	; 44
		dd mfunc_printStrAtOffset ; 45
		dd mfunc_clrAndTeleport	; 46
aThisFunctionIs	db 'this function is not implemented',0
align 2
aKilling	db ', killing ',0
aPoisoning	db ', poisoning ',0
aDraining	db ', draining ',0
aCrazing	db ', crazing ',0
aWithering	db ', withering ',0
aPossessing 	db ', possessing ',0
aStoning	db ', stoning ',0
aCriticallyHitt	db ', critically hitting ',0
aStealing	db ', stealing ',0
aPhazing	db ', phazing ',0
aSwingsAt	db 'swings at',0
aSlashesAt	db 'slashes at',0
aKicksAt	db 'kicks at',0
aPunchesAt	db 'punches at',0
aClawsAt	db 'claws at',0
aTearsAt	db 'tears at',0
aBitesAt	db 'bites at',0
aGnawsOn	db 'gnaws on',0
aStabsAt	db 'stabs at',0
aSlicesAt	db 'slices at',0
aSlams		db 'slams',0
aStrikesAt	db 'strikes at',0
aGropesAt	db 'gropes at',0
aReachesToward	db 'reaches toward',0
aPeersAt	db 'peers at',0
aStaresAt	db 'stares at',0
aDissentionInYo	db 'Dissention in your ranks...',0Ah
db 0Ah,0
aWillThereEverB	db '"Will there ever be an end to them?" you shout. You see ',0
aEnjoyYourNextL	db '"Enjoy your next life!" you snarl. You see ',0
aYourBattlecryI	db 'Your battlecry is heard by all as you face ',0
aYourOnslaughtI	db 'Your onslaught is greeted with laughter, you face ',0
aNotAgainYouMoa	db '"Not again!" you moan as you face ',0
aGimmeABreakWhe	db '"Gimme a break! Where do they come from?" You see ',0
align 2
specialAttString dd aKilling, aPoisoning, aDraining, aCrazing, aWithering; 0
		dd aPossessing,	aStoning, aCriticallyHitt, aStealing, aPhazing;	5
breathAttack	breathAtt_t <0, 0, 0, 0, 0, 41h, 1>; 0
		db    0
aYouStillFace	db 'You still face ',0
aDoYouWishToCon	db 'Do you wish to continue?',0Ah,0
aButMisses	db ', but misses!',0Ah,0Ah,0
aPeriodBlankLine	db '.', 0Ah, 0Ah,0
aExclBlankLine		db '!',0Ah, 0Ah,0
aJumpsIntoTheShadows	db ' jumps into the shadows, ',0
aAndSucceeds	db 'and succeeds!',0Ah,0Ah,0
aButIsDiscovered db 'but is discovered!',0Ah,0Ah,0
		db    0
aSummonsHelpAnd	db ' summons help and ',0
		db    0
aNoneAppears___	db 'none appears...',0Ah,0Ah,0
aAnotherJoinsTheFray db	'another joins the fray!',0Ah,0Ah,0
aThe		db	'The ',0
		db    0
aAdvanceS	db ' advance/s\!',0Ah,0Ah,0
		db    0
aButMisses_0	db ', but misses',0
		db    0
aWillYourGallantBand db	'Will your gallant band choose to:',0Ah
		db '@Fight bravely',0Ah
		db '@Advance ahead',0Ah
		db '@Run away',0Ah,0
		db    0
aThePartyAdvances db 0Ah,0Ah,'The party advances!',0Ah,0Ah,0
aHasTheseOptionsThisBa db ' has these options this battle round:',0Ah,0Ah
		db '@Attack foes ',0
		db    0
byte_4724A	db 31h
		db  30h	; 0
		db  27h	
		db    0
a@defend@partyAttack@c db 0Ah
		db '@Defend',0Ah
		db '@Party attack',0Ah
		db '@Cast a spell',0Ah
		db '@Use an item',0Ah
		db '@Hide in shadows',0Ah
		db '@Bard Song',0Ah,0
		db    0
aSelectAnOption_ db 0Ah,0Ah,'Select an option.',0
aUseOn_0	db 0Ah,'Use on ',0
		db    0
aYouCanTUseThatItem_ db	'You can',27h,'t use that item.',0
		db    0
aAttack		db 0Ah,'Attack ',0
		db    0
aUseTheseCommands? db 'Use these commands?',0Ah,0Ah,0
aAndHits	db ', and hits ',0
aTimesFor	db ' times for ',0
aAndHitsFor	db ', and hits for ',0
aFirBreathEs	db ' /fir\breath\es ',0
		db    0
aLost		db ' lost ',0
		db    0
aVoice		db ' voice!',0Ah,0Ah,0
aPlays___	db ' plays...',0Ah,0Ah,0
aHostilePartyMembers db	'hostile party members!',0Ah,0Ah,0
		db    0
asc_473AE	db ',',0
aAnd_1		db 'and ',0
		db 0
a__1		db '.',0Ah,0Ah,0
aParty		db 'Party',0
aSorryBud	db 'Sorry, Bud',0
		db    0
aAlasYourPartyHasExp db	'Alas, your party has expired, but gone to adventurer heaven.',0
		db    0
byte_47412	db ' ', '!', '"', '#', '$', '%', '&', 27h; 0
		db 'h', 'i', 'j', 'k', 'l', 'm', 'n', ''; 8
monMeleeAttString dd aSwingsAt		  ; 0
		dd aSlashesAt		; 1
		dd aKicksAt		; 2
		dd aPunchesAt		; 3
		dd aClawsAt		; 4
		dd aTearsAt		; 5
		dd aBitesAt		; 6
		dd aGnawsOn		; 7
		dd aStabsAt		; 8
		dd aSlicesAt		; 9
		dd aSlams		; 10
		dd aStrikesAt		; 11
		dd aGropesAt		; 12
		dd aReachesToward	; 13
		dd aPeersAt		; 14
		dd aStaresAt		; 15
itemLevMask	db 0, 81h, 81h, 81h, 81h, 81h, 81h,	81h; 0
		db 81h,	81h, 81h, 81h, 81h, 81h, 81h, 81h; 8
		db 81h,	81h, 81h, 81h, 81h, 81h, 0C1h, 41h; 16
		db 41h,	41h, 41h, 41h, 41h, 41h, 41h, 41h; 24
		db 41h,	41h, 41h, 41h, 41h, 41h, 41h, 41h; 32
		db 41h,	41h, 41h, 41h, 41h, 41h, 41h, 31h; 40
		db 31h,	31h, 31h, 31h, 31h, 31h, 31h, 31h; 48
		db 31h,	31h, 31h, 31h, 31h, 31h, 31h, 31h; 56
		db 31h,	31h, 31h, 31h, 31h, 31h, 31h, 31h; 64
		db 31h,	19h, 19h, 19h, 19h, 19h, 19h, 19h; 72
		db 19h,	19h, 19h, 19h, 19h, 19h, 19h, 19h; 80
		db 19h,	19h, 19h, 19h, 19h, 19h, 19h, 19h; 88
		db 19h,	19h, 19h, 19h, 19h, 19h, 19h, 19h; 96
		db 19h,	19h, 19h, 19h, 19h, 19h, 19h, 19h; 104
		db 0, 0, 0, 0, 0, 0, 0FFh, 0; 112
		db 0, 0, 0, 0, 0, 0FFh,	9, 9; 120
		db 9, 9, 9, 9, 9, 9, 9,	0; 128
		db 0, 0, 9, 9, 9, 9, 9,	9; 136
		db 9, 0, 0, 0, 0, 0, 0,	0; 144
		db 0, 0, 0, 0, 0, 0, 5,	5; 152
		db 0, 0, 0, 0, 0, 9, 9,	9; 160
		db 9, 0, 0, 3, 3, 41h, 9, 11h; 168
		db 5, 1, 0, 0, 0, 9, 9,	9; 176
		db 9, 9, 9, 9, 9, 9, 9,	9; 184
		db 9, 9, 9, 7Fh, 5, 5, 5, 5; 192
		db 5, 5, 5, 5, 5, 5, 5,	5; 200
		db 5, 5, 5, 5, 5, 3, 3,	3; 208
		db 3, 3, 3, 3, 3, 3, 3,	1Dh; 216
		db 0, 0, 0, 0, 0, 0, 0,	0; 224
		db 0, 0, 0, 0, 0, 0, 0,	0; 232
		db 1, 1, 1, 1, 1, 1, 1,	1; 240
		db 1, 0, 0, 0, 0, 0, 0,	0; 248
battleCryString	dd aDissentionInYo	; 0
		dd aWillThereEverB	; 1
		dd aEnjoyYourNextL	; 2
		dd aYourBattlecryI	; 3
		dd aYourOnslaughtI	; 4
		dd aNotAgainYouMoa	; 5
		dd aGimmeABreakWhe	; 6
aMember17	db 'member #(1-7)',0
aMember1	db 'member #(1)',0
aOr		db ' or ',0
		db    0
vowelList	db 'A', 'E', 'I', 'O', 'U', 0               ; 4
byte_475AE	db 5, 7, 7, 3	   ; 0
		db 3, 0, 0, 5		; 4
		db 5, 0Ah, 0Fh,	0Fh	; 8
		db 16h			; 12
aBadDiceMaskRange db 'Bad dice mask range',0
		db    0
off_475D0	dd party_fight
		dd party_advance
		dd party_run
off_475DC	dd bat_attackOpt, bat_defendOpt; 0
		dd bat_partyAttackOpt, bat_castOpt; 2
		dd bat_useItemOpt, bat_hideOpt;	4
		dd bat_songOpt		; 6
byte_475F8	db 3, 1, 1, 1	   ; 0
		db 1, 0, 0, 3		; 4
		db 3, 4, 1, 1		; 8
		db 4, 0			; 12
byte_47606	db 3, 2, 0, 0FEh	   ; 0
byte_4760A	db 0FFh, 0FFh, 0FFh,	0  ; 0
		db 0, 0, 0, 0		; 4
		db 1, 1			; 8
aPoisonNeedle	db 'Poison Needle',0
aPoisonBlades	db 'Poison Blades',0
aBlades		db 'Blades',0
aShockWave	db 'Shock Wave',0
aCrazycloud	db 'Crazycloud',0
aVortex		db 'Vortex',0
aShocks		db 'Shocks',0
aPoisonDarts	db 'Poison Darts',0
aAcidBurst	db 'Acid Burst',0
aGasCloud	db 'Gas Cloud',0
aPoisonSpikes	db 'Poison Spikes',0
aMindBlast	db 'Mind Blast',0
aBasiliskSnare	db 'Basilisk Snare',0
aDeathBlades	db 'Death Blades',0
aCodgerBomb	db 'Codger Bomb',0
aSwindler	db 'Swindler',0
aHammer		db 'Hammer',0
		db    0
aExperiencePointsForV db ' experience points for valor and battle knowledge, and ',0
aTheyDisbelieve	db 'They disbelieve!',0Ah,0Ah,0
		db    0
aInGold_	db ' in gold.',0Ah,0Ah,0
aFoundA		db ' found a ',0
aEachCharacterReceive db 'Each character receives ',0
		db    0
aThePartyDisbelieves_ db 'The party disbelieves...',0Ah,0Ah,0
		db    0
aThereIsAChestHere_Wil db 'There is a chest here. Will you:',0Ah,0Ah
		db '@Examine chest',0Ah
		db '@Open chest',0Ah
		db '@Disarm chest',0Ah
		db '@Trap Zap',0Ah
		db '@Leave chest',0
aWhoWillCastATrzp?	db 'Who will cast a TRZP?',0
aYouDonTKnowThatSpell_	db 'You don',27h,'t know that spell.',0
		db    0
aYouNeedAtLeast2SpellP	db 'You need at least 2 spell points.',0
aWhoWillExamineIt?	db 'Who will examine it?',0
		db    0
aItLooksLikeA	db 'It looks like a ',0
		db    0
aThatCharacterHasAlr	db 'That character has already checked.'
		db 0
aYouFoundNothing_	db 'You found nothing.',0
		db    0
aWhoWillDisarmIt?	db 'Who will disarm it?',0
aEnterTrapName	db 'Enter trap name:',0
		db    0
aDisarmFailed	db 'Disarm failed!',0
		db    0
aYouDisarmedIt	db 'You disarmed it!',0
		db    0
aWhoWillOpenIt?	db 'Who will open it?',0
aYouSetOffA	db 'You set off a ',0
		db    0
trapFlags	db 1,	1, 0, 80h, 1, 1, 80h, 3; 0
		db 1, 1, 80h, 9, 81h, 80h, 81h,	81h; 8
		db 1, 3, 0, 6, 81h, 84h, 8, 80h; 16
		db 81h,	81h, 81h, 81h, 81h, 81h, 81h, 81h; 24
trapDice	db 41h, 41h, 44h, 41h,	43h, 43h, 46h, 42h; 0
		db 45h,	45h, 47h, 46h, 47h, 48h, 47h, 47h; 8
		db 49h,	47h, 49h, 21h, 49h, 47h, 45h, 49h; 16
		db 49h,	49h, 49h, 49h, 49h, 49h, 49h, 49h; 24
stru_47938	saveStru 4 dup(<0Fh,	0Fh>); 0
		saveStru 4 dup(<13h, 13h>); 4
		saveStru 4 dup(<15h, 15h>); 8
		saveStru 4 dup(<18h, 18h>); 12
		saveStru 4 dup(<26h, 26h>); 16
		saveStru <27h, 27h>	; 20
		saveStru <28h, 28h>	; 21
		saveStru <27h, 27h>	; 22
		saveStru 9 dup(<28h, 28h>); 23
aChest		db 'Chest!',0
		db    0
byte_47988	db 0, 1, 2, 3, 0, 1,	3, 4; 0
		db 0, 1, 6, 5, 7, 8, 9,	9; 8
		db 0Ah,	0Bh, 0Ch, 0Dh, 0Eh, 0Fh, 10h, 11h; 16
		db 0Eh,	0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh; 24
trapName	dd aPoisonNeedle	 ; 0
		dd aPoisonBlades	; 1
		dd aBlades		; 2
		dd aShockWave		; 3
		dd aCrazycloud		; 4
		dd aVortex		; 5
		dd aShocks		; 6
		dd aPoisonDarts		; 7
		dd aAcidBurst		; 8
		dd aGasCloud		; 9
		dd aPoisonSpikes	; 10
		dd aMindBlast		; 11
		dd aMindJab		; 12
		dd aBasiliskSnare	; 13
		dd aDeathBlades		; 14
		dd aCodgerBomb		; 15
		dd aSwindler		; 16
		dd aHammer		; 17
byte_479F0	db 1, 2, 4, 8, 0Ah, 10h, 14h; 0
aTreasure	db 'Treasure',0
off_47A00	dd chest_examine, chest_open,	chest_disarm, chest_trapZap, chest_returnOne
aFried		db 'fried',0
aFrozen		db 'frozen',0
aShocked	db 'shocked',0
aDrained	db 'drained',0
aBurnt		db 'burnt',0
aChoked		db 'choked',0
aSteamed	db 'steamed',0
aBlasted	db 'blasted',0
aHit		db 'hit',0
aNuked		db 'nuked',0
aLessThirsty_	db 'less thirsty.',0Ah,0Ah,0
aHicHappier_	db '(hic) happier.',0Ah,0Ah,0
aRefreshed	db 'refreshed!',0Ah,0Ah,0
aTerrible_	db 'terrible.',0Ah,0Ah,0
aTheEntryStairs	db 'the entry stairs.',0
aTheEntryPortal	db 'the entry portal.',0
aTheEntryway_	db 'the entryway.',0
aTheBaseOfTheMo	db 'the base of the mountain.',0
aAVantagePoint_	db 'a vantage point.',0
aTheWayIn_	db 'the way in.',0
aTheExit_	db 'the exit.',0
align 2
aYouCanOnlyCast	db 'You can only cast that in combat',0Ah,0Ah,0
align 2
aAtTheParty___	db 'at the party...',0Ah,0Ah,0
aButThePartyWas	db 'But the party was too far away!',0Ah,0Ah,0
aAt		db 'at ',0
aSome		db 'some ',0
aElipsisNLNL	db '...',0Ah,0Ah,0
aOne		db 'One ',0
align 2
aRepelledTheAtt	db 'repelled the attack!',0Ah,0Ah,0
align 2
aWasTooFarAway db 'was too far away!',0Ah,0Ah,0
aIs		db 'is ',0
aFor		db	' for ',0
aPointSOfDamage	db ' point/\s\ of damage',0
align 2
aAnd		db	'And ',0
align 2
aAndThePartyFre	db 'and the party freezes',0
aButItHadNoEffe	db 'but it had no effect!',0Ah,0Ah,0
aCloser		db 'closer',0
align 2
aFartherAway	db 'farther away',0
align 2
aAndTheFoesAre	db 'and the foes are ',0
align 2
aTheParty	db 'the party!',0
align 2
aAndTheEarthSwa	db 'and the earth swallows up ',0
align 2
aWhichItem?	db 'Which item?',0
aSpellAborted_	db 'Spell aborted.',0
align 2
aItemHasBeenIde	db 'Item has been identified!',0
aDopplganger	db 'Dopplganger',0
aAteIt_		db 'ate it.',0Ah,0Ah,0
aDrinksAndFeels	db 'drinks and feels ',0
off_47D32	dd aLessThirsty_, aHicHappier_, aRefreshed, aTerrible_, aTerrible_;	0
aCanTSeemToFind	db 'can',27h,'t seem to find a use for the item.',0Ah,0Ah,0
align 2
aInvokesAFiguri	db 'invokes a figurine ',0
aIsReEnergized	db 'is re-energized!',0Ah,0Ah,0
align 2
aCastsAWeapon	db 'casts a weapon ',0
aBreathes	db 'breathes ',0
aTeleportUseArr	db 'Teleport',0Ah
		db '<Use arrow keys and SPC to select>',0Ah,0Ah
		db 'North:',0Ah
		db 'East :',0Ah,0
aDownUp		db '/Down\Up  \ :',0Ah,0
align 2
aTeleport?	db 0Ah,'Teleport?',0Ah,0Ah,0
align 2
aTeleportCancel	db 'Teleport cancelled!',0
aTeleportFailed	db 'Teleport failed!',0
align 2
aTeleportSucces	db 'Teleport successful!',0
align 2
aYouFace	db 'You face ',0
aLevelS		db ' level/\s',0
aAboveBelow	db ' /above\below\',0
align 2
aPaceS		db ' pace/\s',0
align 2
aNorthSouth	db ' /north\south\',0
align 2
aEastWest	db ' /east\west\',0
align 2
aAndAreAt	db ' and are at ',0
align 2
aOf		db ' of ',0
align 2
aAndAre		db ' and /\are \',0
align 2
scryBaseStringList dd aTheEntryStairs, aTheEntryPortal,	aTheEntryway_
		dd aTheBaseOfTheMo, aAVantagePoint_, aTheWayIn_
		dd aTheExit_
byte_47EDC	db 0, 0, 4, 2	   ; 0
		db 2, 2, 2, 9		; 4
		db 0, 0, 0, 0		; 8
		db 0, 0, 0, 0		; 12
		db 4, 4, 4, 4		; 16
		db 8, 8, 0, 0		; 20
		db 0, 0, 0, 0		; 24
		db 0, 6, 6, 0		; 28
		db 0, 0, 0, 0		; 32
		db 0, 0, 0, 0		; 36
		db 0, 0, 0, 0		; 40
		db 0, 0Eh, 0, 0Ah	; 44
		db 0, 0, 0, 3		; 48
		db 0, 0, 0, 0		; 52
		db 10h,	15h, 1,	1	; 56
		db 1, 0			; 60
byte_47F1A	db 0, 0, 0Eh, 0	   ; 0
		db 0, 0, 0, 0		; 4
		db 0, 0, 0, 0		; 8
		db 4, 4, 4, 4		; 12
		db 0, 0, 0, 0		; 16
		db 2, 2, 1, 1		; 20
		db 9, 9, 0, 0		; 24
		db 0, 0, 0, 0		; 28
		db 0, 0, 0, 0		; 32
		db 0, 0, 0, 0		; 36
		db 0, 0, 0Ah, 0Ah	; 40
		db 0Ah,	0Bh, 0,	0	; 44
		db 6, 6, 6, 0Ch		; 48
		db 0Eh,	0Eh, 0Eh, 0Eh	; 52
		db 0Ah,	3, 1, 1		; 56
		db 0, 0			; 60
byte_47F58	db 0, 0, 2, 0	   ; 0
		db 0, 0, 0, 2		; 4
		db 0, 0, 0, 0		; 8
		db 0, 0, 0, 0		; 12
		db 0, 0, 0, 0		; 16
		db 0, 0, 0, 0		; 20
		db 3, 3, 0, 0		; 24
		db 0, 0, 0, 4		; 28
		db 4, 4, 4, 4		; 32
		db 4, 4, 4, 4		; 36
		db 0, 0, 5, 5		; 40
		db 5, 6, 6, 6		; 44
		db 6, 6, 6, 1		; 48
		db 0, 0, 0, 0		; 52
		db 2, 2, 1, 2		; 56
byte_47F94	db 1Ch, 0Bh,	14h, 0Ah, 1Ch, 38h, 1Ch, 1Ch; 0
		db 0Ah,	1Ch, 38h, 1Ch, 0Ah, 3Ch, 1Ch, 38h; 8
		db 14h,	0Ah, 1Ch, 28h, 38h, 14h, 0Bh, 28h; 16
		db 1Ch,	1Ch, 28h, 0Ah, 0Bh, 0Ah, 0Ch, 2Ch; 24
		db 14h,	1Ch, 3Ch, 0Bh, 0Ah, 38h, 0Bh, 0Ch; 32
		db 1Ch,	0Ch, 1Ch, 0Ah, 1Ch, 0Ch, 1Ch, 1Ch; 40
		db 1Ch,	0Ch, 0Ch, 1Ch, 1Ch, 0Ch, 1Ch, 0Ah; 48
		db 0FCh, 1Ch, 0Ah, 1Ch,	0Bh, 0Ah, 38h, 1Ch; 56
		db 8, 0Ah, 0Bh,	1Ch, 38h, 0Ah, 0Ah, 0Ch; 64
		db 0Ah,	1Ch, 0Ch, 0Ah, 1Ch, 1Ch, 0Ch, 38h; 72
		db 1Ch,	1Ch, 0Ah, 0Ah, 1Ch, 1Ch, 0Ah, 0Ch; 80
		db 1Ch,	1Ch, 0Ch, 0Bh, 1Ch, 1Ch, 14h, 38h; 88
		db 1Ch,	1Ch, 38h, 0Ah, 1Ch, 1Ch, 1Ch, 0Ch; 96
		db 1Ch,	1Ch, 0Ah, 14h, 14h, 0Ch, 1Ch, 14h; 104
		db 0Bh,	14h, 14h, 0Ah, 14h, 0Bh, 14h, 0Ah; 112
		db 0Ch,	0Ah, 14h, 0FCh,	0Ch, 1Ch, 1Ch, 1Ch; 120
		db 1Ch,	1Ch, 1Ch, 0Bh, 1Ch, 0Ah, 1Ch, 0Ch; 128
spellEffectFlags db 0, 0B6h, 0,	2	 ; 0
		db 20h,	4, 1, 4		; 4
		db 2Ah,	0, 0Ah,	2	; 8
		db 31h,	0Ah, 0FFh, 0FDh	; 12
		db 0, 4, 1, 2		; 16
		db 0FEh, 0, 69h, 4	; 20
		db 4, 4, 7, 38h		; 24
		db 0A8h, 3Fh, 2, 0Ah	; 28
		db 0, 0FFh, 0FDh, 0AFh	; 32
		db 70h,	0, 0BDh, 1	; 36
		db 4, 1, 82h, 1		; 40
		db 83h,	4, 6, 3		; 44
		db 84h,	80h, 0,	85h	; 48
		db 0FFh, 15h, 86h, 77h	; 52
		db 40h,	7, 46h,	8	; 56
		db 0C4h, 4Dh, 0, 9	; 60
		db 0E0h, 0, 0CBh, 0Ah	; 64
		db 0, 54h, 7Eh,	0	; 68
		db 0, 0, 0, 5Bh		; 72
		db 0FDh, 0Bh, 7, 0FFh	; 76
		db 0, 0, 62h, 85h	; 80
		db 0, 0, 8Ch, 0EEh	; 84
		db 0, 0, 8, 0D2h	; 88
		db 0, 0, 0, 0		; 92
		db 0, 0, 6, 9		; 96
		db 0, 0, 0FFh, 1Ch	; 100
		db 0, 0, 93h, 6		; 104
		db 0, 0A1h, 0Ch, 80h	; 108
		db 0D9h, 8, 4, 6	; 112
		db 2, 0E7h, 0Ah, 9Ah	; 116
		db 0Eh,	0, 0, 5		; 120
		db 23h,	0, 4, 5		; 124
		db 0, 0, 0, 0		; 128
		db 0, 0, 0, 0		; 132
byte_480A4	db 0, 1, 0, 0Ah, 0, 0, 0, 0;	0
		db 2, 0, 1, 0, 83h, 81h, 0, 1; 8
		db 0, 0, 0, 0, 0, 0, 1,	0; 16
		db 1, 2, 0, 84h, 7, 83h, 0, 1; 24
		db 0, 2, 81h, 1, 5, 2, 84h, 0; 32
		db 0, 0, 0, 0, 0, 0, 2,	0; 40
		db 0, 0, 83h, 0, 2, 4, 0, 0Ah; 48
		db 0Ah,	0, 1, 0, 3, 3, 3, 0; 56
		db 0, 0, 7, 0, 4, 5, 85h, 0; 64
		db 0, 0, 0, 6, 86h, 0, 0Ah, 0; 72
		db 0, 0, 2, 8, 0, 0, 8,	5; 80
		db 0, 0, 0, 3, 0, 0, 0,	5; 88
		db 0, 0, 0, 0, 0, 0, 4,	0Ah; 96
		db 0, 0, 84h, 0, 0, 0Ah, 0, 0; 104
		db 6, 0, 0, 0, 0, 0Ah, 85h, 5; 112
		db 0Ah,	5, 0, 0Ah, 0Ah,	0, 1, 1; 120
		db 0, 0, 0, 0, 0, 0, 0,	0; 128
spptRequired	db 2, 3, 2, 3, 3, 4, 5, 4;	0
		db 5, 6, 6, 7, 7, 9, 8,	12; 8
		db 15, 18, 12, 3, 3, 2,	4, 5; 16
		db 5, 6, 6, 6, 8, 7, 8,	10; 24
		db 10, 10, 25, 16, 11, 20, 3, 2; 32
		db 2, 4, 5, 4, 6, 6, 6,	7; 40
		db 12, 8, 10, 11, 11, 20, 16, 40; 48
		db 50, 10, 11, 14, 11, 14, 12, 13; 56
		db 14, 16, 13, 22, 18, 16, 25, 15; 64
		db 20, 28, 26, 30, 50, 60, 80, 12; 72
		db 10, 10, 20, 20, 15, 15, 25, 30; 80
		db 20, 20, 45, 50, 25, 25, 60, 60; 88
		db 30, 30, 65, 70, 35, 35, 60, 100; 96
		db 50, 50, 5, 5, 8, 10,	15, 15;	104
		db 18, 20, 20, 25, 30, 40, 40, 50; 112
		db 60, 80, 10, 250, 150, 1; 120
breathEffectStr	dd aFried, aFrozen, aShocked, aDrained, aBurnt; 0
		dd aChoked, aSteamed, aBlasted, aHit, aNuked;	5
damageSpellData	breathAtt_t <0,	0Ch, 4,	0, 38h,	0C0h, 1>; 0
		breathAtt_t <0,	4, 0, 0, 38h, 0C0h, 8>;	1
		breathAtt_t <0,	0Ch, 4,	0, 38h,	0C0h, 10h>	; 2
		breathAtt_t <0,	14h, 2,	0, 58h,	0C0h, 1>; 3
		breathAtt_t <0,	4, 10h,	0, 3Dh,	0C0h, 0Dh>	; 4
		breathAtt_t <0,	4, 12h,	0, 5Fh,	0C0h, 10h>	; 5
		breathAtt_t <0,	0Ch, 4,	0, 24h,	40h, 1>; 6
		breathAtt_t <0,	0Ch, 4,	0, 2Eh,	40h, 1>; 7
		breathAtt_t <0,	0Ch, 4,	0, 29h,	40h, 1>; 8
		breathAtt_t <0,	84h, 8,	0, 47h,	40h, 1>; 9
		breathAtt_t <0,	4, 10h,	0, 38h,	40h, 1>; 10
		breathAtt_t <0,	84h, 8,	0, 35h,	40h, 1>; 11
		breathAtt_t <0,	0Ch, 4,	0, 38h,	40h, 2>; 12
		breathAtt_t <0,	14h, 2,	0, 38h,	40h, 4>; 13
		breathAtt_t <4,	4, 6, 0, 1Dh, 40h, 0Ah>; 14
		breathAtt_t <0,	24h, 6,	80h, 25h, 0, 1>; 15
		breathAtt_t <0,	14h, 2,	0, 33h,	40h, 1>; 16
		breathAtt_t <0,	4, 0Ah,	20h, 3Dh, 40h, 2>		; 17
		breathAtt_t <0,	4, 10h,	40h, 13h, 40h, 0Ah>	; 18
		breathAtt_t <0,	14h, 2,	0, 58h,	40h, 2>; 19
		breathAtt_t <0,	24h, 0Eh, 0, 2Bh, 40h, 5>		; 20
		breathAtt_t <0,	24h, 0,	0, 38h,	40h, 8>; 21
		breathAtt_t <0,	84h, 8,	0, 3Dh,	40h, 0Ah>	; 22
		breathAtt_t <0,	4, 0, 0, 2Eh, 0C0h, 0Ah>; 23
		breathAtt_t <4,	4, 6, 0, 2Eh, 0, 1>; 24
		breathAtt_t <7,	4, 10h,	0, 0, 0, 1>; 25
		breathAtt_t <0,	84h, 8,	0, 20h,	0, 0>; 26
		breathAtt_t <0,	0Ch, 4,	0, 21h,	0, 0>; 27
		breathAtt_t <0,	84h, 8,	40h, 38h, 0, 4>; 28
		breathAtt_t <0,	24h, 6,	0, 38h,	0, 2>; 29
		breathAtt_t <7,	4, 10h,	0, 0, 0, 1>; 30
		breathAtt_t <6,	4, 10h,	0, 0, 0, 1>; 31
		breathAtt_t <5,	4, 10h,	0, 0, 0, 1>; 32
		breathAtt_t <0,	14h, 2,	0, 38h,	0, 10h>; 33
		breathAtt_t <0,	0Ch, 4,	0, 38h,	0C0h, 2>; 34
		db    0
weaponDamageList	anotherBreathAtt_t <0, 1, 25h, 2, 1,	2>; 0
		anotherBreathAtt_t <0, 1, 24h, 2, 1, 2>; 1
		anotherBreathAtt_t <0, 1, 22h, 2, 1, 3>; 2
		anotherBreathAtt_t <0, 1, 26h, 2, 1, 3>; 3
		anotherBreathAtt_t <0, 1, 23h, 2, 1, 3>; 4
		anotherBreathAtt_t <0, 1, 27h, 2, 1, 4>; 5
		anotherBreathAtt_t <0, 1, 28h, 2, 1, 4>; 6
		anotherBreathAtt_t <0, 1, 28h, 2, 1, 5>; 7
		anotherBreathAtt_t <0, 1, 2Bh, 2, 1, 4>; 8
		anotherBreathAtt_t <0, 1, 2Fh, 2, 1, 6>; 9
		anotherBreathAtt_t <0, 1, 37h, 2, 1, 9>; 10
		anotherBreathAtt_t <0, 1, 33h, 2, 2, 7>; 11
		anotherBreathAtt_t <0, 1, 2Fh, 2, 4, 8>; 12
		anotherBreathAtt_t <0, 1, 2Fh, 2, 8, 9>; 13
		anotherBreathAtt_t <0, 1, 2Fh, 2, 2, 7>; 14
		anotherBreathAtt_t <0, 1, 33h, 2, 2, 7>; 15
		anotherBreathAtt_t <0, 1, 38h, 2, 8, 5>; 16
		anotherBreathAtt_t 2 dup(<0, 80h, 38h, 2, 4,	6>); 17
		anotherBreathAtt_t <0, 1, 38h, 2, 8, 6>; 19
		anotherBreathAtt_t <0, 1, 38h, 42h, 8, 9>	; 20
		anotherBreathAtt_t <7, 1, 20h, 2, 1, 3>; 21
		anotherBreathAtt_t <0, 20h, 2Fh, 2, 10h, 8>	; 22
		anotherBreathAtt_t <0, 80h, 29h, 42h, 1, 3>	; 23
		anotherBreathAtt_t <0, 10h, 37h, 42h, 1, 4>	; 24
		anotherBreathAtt_t <0, 80h, 2Fh, 42h, 2, 6>	; 25
		anotherBreathAtt_t <0, 80h, 2Fh, 42h, 6, 6>	; 26
		anotherBreathAtt_t <0, 80h, 2Fh, 42h, 8, 5>	; 27
		anotherBreathAtt_t <7, 8, 2Fh, 42h, 10h, 6>	; 28
		anotherBreathAtt_t <0, 0, 31h, 42h, 0Ah, 7>	; 29
		anotherBreathAtt_t <0, 20h, 2Fh, 42h, 20h, 7>; 30
		anotherBreathAtt_t <0, 1, 25h, 2, 1, 2>; 0

byte_48382	db 6, 15h, 16h, 23h, 24h, 27h, 2Ah, 2Bh; 0
		db 35h,	3Ah, 48h, 5Ch, 60h, 65h, 6Bh, 77h; 8
		db 7Ch,	81h, 86h, 8Bh, 9Fh, 0D0h, 0F4h,	1Eh; 16
		db 47h,	53h, 57h, 5Bh, 0BAh, 0DEh; 24
		db 0F8h, 85h
		db    0
figurineItemNo	db 27, 38	       ; 0
		db 56, 61		; 2
		db 77, 98		; 4
		db 99, 190		; 6
		db 204,	0		; 8
byte_483AC	db 0Dh, 0Eh		   ; 0
		db 0Fh,	1		; 2
		db 10h,	11h		; 4
		db 12h,	13h		; 6
		db 14h,	0		; 8
aCastAt		db 'Cast at ',0
		db    0
aWhoWillCastASp	db 'Who will cast a spell?',0
		db    0
aYouDonTKnowThatSpell db 'You don',27h,'t know that spell!',0
		db    0
aNoSpellByThatName	db 'No spell by that name.', 0
aNotEnoughSpellPoint	db 'Not enough spell points!',0
		db    0
aSpellToCast db	'Spell to cast:',0
		db    0
aWhichMagicArtShallYou db 'Which magic art shall you invoke?',0
		db ') ',0
		db    0
aCastsASpell	db 'casts a spell',0
aButItFizzled	db 'but it fizzled!',0
aButItFizzledNL	db 'but it fizzled!',0Ah,0Ah,0
aMakesALight	db 'makes a light',0
mageSpellIndex	db 255, 42, 28, 0       ; 0 ; This array	is an index into another array for
		db 14, 255, 255, 255	; 4 ; determining the spells that a magic user has.
		db 255,	255, 56, 70	; 8
		db 84, 255, 255, 0	; 12
aThouArtNotAS_0	db 'Thou art not a spellcaster',0
		db    0
lightDistList	db 3, 4, 5, 5, 2, 2 ;0
byte_484B2	db 0, 0FFh, 0FFh, 0, 0, 0; 0
lightDurList	db 4, 0Ch, 10h, 0FFh, 4, 8; 0
byte_484BE	db 0, 0Ah, 0Ah, 5	   ; 0
		db 5, 0, 0, 5		; 4
		db 0, 0, 11h, 11h	; 8
		db 16h,	0		; 12
word_484CC	dw 1Eh
		db  1Eh
		db    0
		db    7
		db    0
byte_484D2	db 0Bh
		db  21h	; !
		db  34h	; 4
		db  0Eh
		db    4
		db    0
		db  44h	; D
		db  0Fh
		db    0
		db 0D2h	; 
unk_484DC	db  73h ; s
		db    0
geoSpMasks	geomanSp_t <3, 20h>	   ; 0
		geomanSp_t <4, 40h>	; 1
		geomanSp_t <3, 4>	; 2
		geomanSp_t <3, 2>	; 3
geoSpList	dd dun_removeTrap	  ; 0 ;	0: Earth Ward. Remove all traps	from level
		dd dun_revealSpSquare	; 1 ; 1: Sanctuary. Reveal all mage regeneration squares
		dd dun_revealSpSquare	; 2 ; 2: Succor	Song. Reveal party heal	squares
		dd dun_revealSpSquare	; 3 ; 3: Roscoe's Alert. Reveal all anti-magic squares
		dd dun_revealSpSquare	; 4 ; 4: Earth song. Reveal all	drain HP squares
		dd sub_22300		; 5 ; 5:
spellFuncList	dd sp_lightSpell	      ;	0
		dd sp_damageSpell	; 1
		dd sp_trapZap		; 2
		dd sp_freezeFoes	; 3
		dd sp_compassSpell	; 4
		dd sp_healSpell		; 5
		dd sp_lightSpell	; 6
		dd sp_levitation	; 7
		dd sp_damageSpell	; 8
		dd sp_summonSpell	; 9
		dd sp_healSpell		; 10
		dd sp_lightSpell	; 11
		dd sp_damageSpell	; 12
		dd sp_healSpell		; 13
		dd sp_levitation	; 14
		dd sp_healSpell		; 15
		dd sp_teleport		; 16
		dd sp_farFoes		; 17
		dd sp_summonSpell	; 18
		dd sp_vorpalPlating	; 19
		dd sp_healSpell		; 20
		dd sp_scrySight		; 21
		dd sp_damageSpell	; 22
		dd sp_vorpalPlating	; 23
		dd sp_areaEnchant	; 24
		dd sp_shieldSpell	; 25
		dd sp_strengthBonus	; 26
		dd sp_damageSpell	; 27
		dd sp_damageSpell	; 28
		dd sp_damageSpell	; 29
		dd sp_antiMagic		; 30
		dd sp_strengthBonus	; 31
		dd sp_phaseDoor		; 32
		dd sp_shieldSpell	; 33
		dd sp_healSpell		; 34
		dd sp_damageSpell	; 35
		dd sp_damageSpell	; 36
		dd sp_healSpell		; 37
		dd sp_damageSpell	; 38
		dd sp_acBonus		; 39
		dd sp_areaEnchant	; 40
		dd sp_disbelieve	; 41
		dd sp_summonSpell	; 42
		dd sp_wordOfFear	; 43
		dd sp_summonSpell	; 44
		dd sp_acBonus		; 45
		dd sp_areaEnchant	; 46
		dd sp_lightSpell	; 47
		dd sp_summonSpell	; 48
		dd sp_disbelieve	; 49
		dd sp_damageSpell	; 50
		dd sp_summonSpell	; 51
		dd sp_areaEnchant	; 52
		dd sp_damageSpell	; 53
		dd sp_summonSpell	; 54
		dd sp_damageSpell	; 55
		dd sp_disbelieve	; 56
		dd sp_summonSpell	; 57
		dd sp_damageSpell	; 58
		dd sp_summonSpell	; 59
		dd sp_damageSpell	; 60
		dd sp_damageSpell	; 61
		dd sp_healSpell		; 62
		dd sp_summonSpell	; 63
		dd sp_possessChar	; 64
		dd sp_spellbind		; 65
		dd sp_damageSpell	; 66
		dd sp_summonSpell	; 67
		dd sp_healSpell		; 68
		dd sp_damageSpell	; 69
		dd sp_damageSpell	; 70
		dd sp_haltFoe		; 71
		dd sp_meleeMen		; 72
		dd sp_batchspell	; 73
		dd sp_camaraderie	; 74
		dd sp_damageSpell	; 75
		dd sp_healSpell		; 76
		dd sp_summonSpell	; 77
		dd sp_damageSpell	; 78
		dd sp_healSpell		; 79
		dd printSpellFizzled	; 80
		dd printSpellFizzled	; 81
		dd sp_damageSpell	; 82
		dd sp_damageSpell	; 83
		dd printSpellFizzled	; 84
		dd printSpellFizzled	; 85
		dd sp_damageSpell	; 86
		dd sp_damageSpell	; 87
		dd printSpellFizzled	; 88
		dd printSpellFizzled	; 89
		dd sp_luckSpell		; 90
		dd sp_damageSpell	; 91
		dd printSpellFizzled	; 92
		dd printSpellFizzled	; 93
		dd sp_identifySpell	; 94
		dd sp_healSpell		; 95
		dd printSpellFizzled	; 96
		dd printSpellFizzled	; 97
		dd sp_batchspell	; 98
		dd sp_batchspell	; 99
		dd printSpellFizzled	; 100
		dd printSpellFizzled	; 101
		dd sp_shieldSpell	; 102
		dd sp_damageSpell	; 103
		dd printSpellFizzled	; 104
		dd printSpellFizzled	; 105
		dd sp_damageSpell	; 106
		dd sp_geomancerSpell	; 107
		dd sp_geomancerSpell	; 108
		dd sp_damageSpell	; 109
		dd sp_summonSpell	; 110
		dd sp_phaseDoor		; 111
		dd sp_damageSpell	; 112
		dd sp_geomancerSpell	; 113
		dd sp_geomancerSpell	; 114
		dd sp_farFoes		; 115
		dd sp_geomancerSpell	; 116
		dd sp_damageSpell	; 117
		dd sp_geomancerSpell	; 118
		dd sp_damageSpell	; 119
		dd sp_damageSpell	; 120
		dd sp_earthMaw		; 121
		dd printNoEffect	; 122
		dd sp_divineIntervention; 123
		dd sp_damageSpell	; 124
		dd printNoEffect	; 125
		dd _sp_useLightObj	; 126
		dd _sp_useLightObj	; 127
		dd _sp_useAcorn		; 128
		dd _sp_useWineskin	; 129
		dd printCantFindUse	; 130
		dd _sp_useWeapon	; 131
		dd _sp_useFigurine	; 132
		dd _sp_useWeapon	; 133
		dd _sp_reenergizeMage	; 134
aSirRobinSTune	db 'Sir Robin',27h,'s Tune',0
aSafetySong	db 'Safety Song',0
aSanctuaryScore	db 'Sanctuary Score',0
aBringaroundBal	db 'Bringaround Ballad',0
aRhymeOfDuotime	db 'Rhyme of Duotime',0
aWatchwoodMelod	db 'Watchwood Melody',0
aKielSOverture	db 'Kiel',27h,'s Overture',0
aMinstrelShield	db 'Minstrel Shield',0
aWhoWillPlay?	db 'Who will play?',0
align 2
aNotABard	db 'Not a bard!',0
aYouArenTUsingA	db 'You aren',27h,'t using an instrument!',0
aYourThroatIsDr	db 'Your throat is dry!',0
songNames	dd aSirRobinSTune, aSafetySong, aSanctuaryScore, aBringaroundBal; 0
		dd aRhymeOfDuotime, aWatchwoodMelod, aKielSOverture, aMinstrelShield; 4
aStopPlayingASo	db 'Stop playing a song',0
byte_48820	db 14h dup(0), 1, 14h dup(0), 2, 0Ch dup(0), 2, 16h dup(0), 1
		db 34h dup(0), 2, 4Eh dup(0), 2, 3, 6 dup(0), 1, 4 dup(0)
		db 3, 21h dup(0)
aGillesGillsFor	db 'Gilles Gills for ',0
aDivineInterven	db 'Divine Intervention for ',0
aGotterdamuru_0	db 'Gotterdamurung for ',0
aStrength_	db 'strength.',0
aIntelligence_	db 'intelligence.',0
aDexterity_	db 'dexterity.',0
aConstitution_	db 'constitution.',0
aLuck_		db 'luck.',0
aWizard_0	db 'Wizard',0Ah,0
aSorcerer_0	db 'Sorcerer',0Ah,0
aConjurer_0	db 'Conjurer',0Ah,0
aMagician_0	db 'Magician',0Ah,0
aArchmage_0	db 'Archmage',0Ah,0
aChronomancer_0	db 'Chronomancer',0Ah,0
spellLevelCost	dw 100, 1000, 2000, 4000, 7000, 10000, 20000; 0
stru_489E2	spellAdvance <0, 3>	   ; 0
		spellAdvance <3, 3>	; 1
		spellAdvance <6, 3>	; 2
		spellAdvance <9, 2>	; 3
		spellAdvance <11, 2>	; 4
		spellAdvance <13, 2>	; 5
		spellAdvance <15, 4>	; 6
		spellAdvance <19, 3>	; 7
		spellAdvance <22, 3>	; 8
		spellAdvance <25, 3>	; 9
		spellAdvance <28, 2>	; 10
		spellAdvance <30, 2>	; 11
		spellAdvance <32, 2>	; 12
		spellAdvance <34, 4>	; 13
		spellAdvance <38, 3>	; 14
		spellAdvance <41, 3>	; 15
		spellAdvance <44, 3>	; 16
		spellAdvance <47, 2>	; 17
		spellAdvance <49, 2>	; 18
		spellAdvance <51, 2>	; 19
		spellAdvance <53, 4>	; 20
		spellAdvance <57, 2>	; 21
		spellAdvance <59, 2>	; 22
		spellAdvance <61, 2>	; 23
		spellAdvance <63, 2>	; 24
		spellAdvance <65, 2>	; 25
		spellAdvance <67, 2>	; 26
		spellAdvance <69, 2>	; 27
		spellAdvance <71, 2>	; 28
		spellAdvance <73, 1>	; 29
		spellAdvance <74, 1>	; 30
		spellAdvance <75, 1>	; 31
		spellAdvance <76, 1>	; 32
		spellAdvance <77, 1>	; 33
		spellAdvance <78, 1>	; 34
		spellAdvance <79, 3>	; 35
		spellAdvance <82, 2>	; 36
		spellAdvance <86, 2>	; 37
		spellAdvance <90, 2>	; 38
		spellAdvance <94, 2>	; 39
		spellAdvance <98, 2>	; 40
		spellAdvance <102, 2>	; 41
		spellAdvance <106, 3>	; 42
		spellAdvance <109, 3>	; 43
		spellAdvance <112, 2>	; 44
		spellAdvance <114, 2>	; 45
		spellAdvance <116, 2>	; 46
		spellAdvance <118, 2>	; 47
		spellAdvance <120, 2>	; 48
specialSpellCost	dd 10000, 50000, 50000	 ; 0
aThouArtInTheHallOfW	db	'Thou art in the hall of wizards. Would thou like...',0Ah,0Ah
		db 'Advancement',0Ah
		db 'Spell Acquiring',0Ah
		db 'Buy a new spell',0Ah
		db 'Exit the hall',0
		db    0
aTheGuildEldersPrepare	db 'The Guild elders prepare to weigh thy merits.',0Ah,0Ah
		db 'Who shall be reviewed?',0
aTheGuildEldersDeemTha	db 'The Guild elders deem that ',0
aCannotBeRaisedLevels_	db ' cannot be raised levels.',0
aTheEldersTeachYouTh	db 'The Elders teach you the lore.',0
		db    0
aWhoSeeksTheSpecialK	db 'Who seeks the special knowledge of the mystic arts?',0
aThouMayLearn	db 'Thou may learn ',0
nonClassSpellList	dd aGillesGillsFor, aDivineInterven; 0
			dd aGotterdamuru_0	; 2
aInGold_WhoWill	db ' in gold. Who will pay?',0
aTheLastOfTheGu	db 'The last of the guild elders is here. Would you like...',0Ah,0Ah
		db 'Advancement',0Ah
		db 'Spell Acquiring',0Ah
		db 'Class Change',0Ah
		db 'Talk to the elder',0Ah
		db 'Exit the guild',0
align 2
aTheGuildElderP	db 'The Guild elder prepares to weigh your merits.',0Ah,0Ah
		db 'Who shall be reviewed?',0
align 2
aHmmm___ShouldI	db '"Hmmm... Should I make you into a zombie perhaps?!?"',0
align 2
aTheGuildElderD	db 'The Guild elder deems that ',0
aCannotBeRaised	db ' cannot be raised levels.',0
aStillNeedeth	db ' still needeth ',0
aExperiencePoin	db ' experience points prior to advancement.',0
align 2
aHathEarnedALev	db ' hath earned a level of advancement...',0
align 2
a1To		db	'+1 to ',0
align 2
fullAttributeString	dd aStrength_, aIntelligence_, aDexterity_;	0
			dd aConstitution_, aLuck_; 3
aWhoSeeksKnowle	db 'Who seeks knowledge of the mystic arts?',0
aThouHathLearne	db 'Thou hath learned all the spells in thy art.',0
align 2
aThouCannotAcqu	db 'Thou cannot acquire new spells yet.'
		db 0
aSpellLevel	db ' spell level ',0
aWillCost	db ' will cost ',0
aNotEnoughGoldNL	db 'Not enough gold.',0Ah,0
aTheElderTeache	db 'The Elder teaches you the lore.',0
aWhichMageSeeks	db 'Which mage seeks to change classes?'
		db 0
aThouCannotChan	db 'Thou cannot change class.',0
aYouMustKnowAtL	db 'You must know at least 3 spell levels in your present art first.',0
align 2
aTheeDoesnTQual	db 'Thee doesn',27h,'t qualify for any new class.',0
aWhichClassShal	db 0Ah,'Which class shall thee become?',0
aTheeUnderstand	db 'Thee understands the sacrifice, dost thou not? Thee will be stripped of all thy spells and knowledge thereof. Thee will be more powerful than ever before, but more vulnerable as well.',0
aDostThouAccept	db 'Dost thou accept this sacrifice?',0Ah,0Ah,0
align 2
aKnowThisTheSpe	db '"Know this, the spell to enter Arboria is invoked by uttering ARBO and the spell to return is ENIK. Be wary, for the spells only work in one place in the land."',0
align 2
aThereIsALargeG	db '"There is a large grove of trees just south of Skara Brae. The spell will work there."',0
align 2
aNowThouBeginsT	db 'Now thou begins thy new profession.'
		db 0
aTheOldReviewBo	db 'The old review board is deserted.',0
magicUserString	dd aWizard_0, aSorcerer_0, aConjurer_0,	aMagician_0; 0
		dd aArchmage_0,	aChronomancer_0; 4
aThouArtNotASpe	db 'Thou art not a spell caster!',0
align 2
aWhoWishsToSpea	db 'Who wishs to speak with the elder?',0
align 2
aGelidiaTheLand	db '"Gelidia, the land of cold, is entered by uttering GELI and the spell to return is ECUL."',0
aToTheNorthIsCo	db 'To the north is Cold Peak, your passage to Gelidia is there.',0
align 2
aLucenciaIsEnte	db '"Lucencia is entered by uttering LUCE and the spell to return is ILEG."',0
aToTheEastIsACr	db 'To the east is a crystal spring, your passage to Lucencia is there.',0
aKinestiaTheDim	db '"Kinestia, the dimension of machines, is reached by casting KINE. OBRA will bring you back."',0
align 2
aToTheSouthWest	db '"To the south-west is an old mine, you may reach Kinestia from there."'
db 0
align 2
aTenebrosiaCanB	db '"Tenebrosia can be reached by uttering OLUK and the spell to return is ECEA."',0
aToTheSoutheast	db '"To the southeast is Shadow Rock, your passage to Tenebrosia is there."',0
aTarmitiaIsEnte	db '"Tarmitia is entered by uttering AECE and the spell to return is KULO."',0
aToTheSouthIsAV	db '"To the south is a vale, your passage to Tarmitia is there."',0
align 2
aHurryTimeIsRun	db '"Hurry! Time is running out!"',0
aILlTeachOnlyAC	db '"I',27h,'ll teach only a Chronomancer the special magic that you need to journey on your quest."',0
align 2
aSeekOutBrilhas	db '"Seek out Brilhasti ap Tarj!"',0
align 2
aTheOldManAward	db 'The old man awards each member 600000 experience points.',0
align 2
aWithAWaveOfHis	db 'With a wave of his hand, the old man re-energizes all magic users.',0
align 2
aTheOldManInThe	db 'The old man in the Review Board scratches his head. "Yes, you are the prophesied ones, but you have come too early. No matter."',0
aBeneathSkaraBr	db '"Beneath Skara Brae you will find one of Tarjan',27h,'s devotees. Brilhasti ap Tarj is a foul Necromancer, and his life impedes my efforts to stave off disaster."',0
align 2
aYouMayEnterThe	db '"You may enter the Catacombs under the Mad God',27h,'s Temple by uttering his master',27h,'s name... ',27h,'Tarjan"',0
align 2
aDestroyBrilhas	db '"Destroy Brilhasti ap Tarj, then return to me for your true quest."',0
aWelcomeYeChild	db '"Welcome ye children of the prophecy. Upon your shoulders falls a great weight, for you must embark on what will be your greatest adventure ever."',0
align 2
aThatWhichHasLa	db '"That which has laid waste to Skara Brae is an ancient evil recently released. It threatens to destroy all reality and time as it has wrought havoc on Skara Brae."',0
aIfYouCannotSto	db '"If you cannot stop it, it will consume the universe. If you do stop it, you will be rewarded beyond all your dreams."',0
align 2
aPrepareThyselv	db '"Prepare thyselves, and hasten to the place of trees, for it is most like the first dimension you must sojourn in to blunt the evil."',0
aAboriaTheHomeO	db '"Aboria, the home of Valarian the bold, is reached through using powerful magic that only a Chronomancer can control."',0
align 2
aBringToMeValar	db '"Bring to me Valarian',27h,'s Bow and The Arrows of Life if Valarian will not return here with you."',0
align 2
aYesAndBeOnTheL	db '"Yes, and be on the lookout for an ally, for you are not the first I have sent on this quest. Though your paths are different, they may cross, and you will do well together."',0
align 2
aTheOldManTakes	db 'The old man takes the news of Valarian',27h,'s death hard, but he summons a smile to his lips and breathes deeply.',0
align 2
aYouHaveDoneWel	db '"You have done well, children, and I take well the news that Hawkslayer has survived this long. Now you are bound for a place far distant."',0
aItIsTheDimensi	db '"It is the dimension of magic. It is known as Gelidia and if your Chronomancer is able, I will share the spells to get you there and back again."',0
aBringLanatirWi	db '"Bring Lanatir with you, or, if you cannot convince him to come, coax from him the Wand of Power and the Sphere of Lanatir."',0
align 2
aTheOldManAppea	db 'The old man appears visibly shaken by the news of Lanatir',27h,'s death. After a long silence he stares off into space and mumbles, "Is it to be that way then?"',0
align 2
aHisEyesFocusUp	db 'His eyes focus upon you again, and a grim look washes over his features. "Now you are bound for Lucencia."',0
align 2
aIDareNotHopeAl	db '"I dare not hope Alliria lives, so I want you to recover the Crown of Truth and the Belt of Alliria. Beware, for she had a jealous consort, and he will protect her as best he can."',0
algn_49F1F:
align 2
aTheOldManSLook	db 'The old man',27h,'s look of grim determination withstands news of Alliria',27h,'s death, but the information saps some of his strength.',0
aQuicklyThenMyC	db '"Quickly then, my children, to distant Kinestia!"',0
aYouMustReturnH	db '"You must return here with The Hammer of Wrath and Ferofist',27h,'s Helm. I know Ferofist yet lives, but I cannot be sure of how long he will survive."',0
aHurryThePaceQu	db '"Hurry, the pace quickens, and the outlook is horrible if you fail!"',0
align 2
aTheOldManSEyes	db 'The old man',27h,'s eyes narrow as you tell of Ferofist',27h,'s end. "An alliance with the dark one, did he say? It is well he realized his folly in the end."',0
align 2
aHePausesASecon	db 'He pauses a second, and you see utter weariness send a tremor through him. "Now to Tenebrosia for all of you."',0
align 2
aRememberInTheL	db '"Remember, in the land where night is day and day is night, nothing is as you know it to be. Paradox lives there - trust no one but yourselves."',0
align 2
aFromThereIRequ	db '"From there I require the Helm of Justice and Sceadu',27h,'s Cloak."',0
align 2
aNoTheOldManCri	db '"No!" the old man cries out, "not Sceadu as well. The dark one is utterly mad. Still," the old man smiles, "he burns the chaff while I sow the seed."',0
aOffWithYouToTa	db '"Off with you to Tarmitia, the land of unceasing warfare. A myriad of ages meld together there, and your success depends upon your ability to adapt."',0
aBringMeWerraSS	db '"Bring me Werra',27h,'s Shield and the Strifespear."',0
align 2
aHisEyesLoseThe	db 'His eyes lose their focus. "It is almost done, the circle is almost joined."',0
align 2
aIKnowTheOldMan	db '"I know," the old man gurgles, "Werra lies dead." Blood bubbles up on his lips and joins the dark stains on the rest of his clothing. "I, too, have been slain by the Mad One."',0
aGatherUpThePri	db '"Gather up the prizes you have won, the special ones, those I requested. Hawkslayer has already ventured into Malefia, the land of EVIL."',0
aIHavePlacedThe	db '"I have placed the prizes in the storage building near the entrance of Skara Brae."',0
aGetYourselvesH	db '"Get yourselves hence and help him. Destroy the Mad God Tarjan before he destroys all reality!!"',0
align 2
aWithThoseFinal	db 'With those final words, the old man slumps over, and his body dissolves into a mist that a slight breeze stirs and blows away.',0
align 2
hpLevelBonusMask db 0Fh, 7, 7, 3, 3, 7,	0Fh, 0Fh, 0Fh, 7; 0 ; This array holds the mask	for bonus hit points for
		db 7, 7, 7, 0		; 10 ; each class at level-up time.
off_4A6A4	dd mage_wizardReqCheck, mage_sorcererReqCheck; 0
		dd mage_conjurorReqCheck, mage_magicianReqCheck; 2
		dd mage_archmageReqCheck, mage_chronoReqCheck; 4
byte_4A6BC	db 1, 2, 3, 4, 0Ah, 0Bh ; 0
aReviewBoard	db 'Review Board',0
		db    0
questFuncs	dd chron_questBrilhasti, chron_questValarian; 0
		dd chron_questLanatir, chron_questAlliria; 2
		dd chron_questFerofist,	chron_questSceadu; 4
		dd chron_questWerra, chron_questTarjan;	6
byte_4A6FA	db 0, 1, 40h, 10h, 4, 1, 40h, 10h; 0
byte_4A702	db 1, 1, 0, 0, 0, 0,	1, 1; 0
aGuild		db 'Guild',0
aWelcomeBraveHe	db '"Welcome, brave heroes. You have succeeded in destroying the threat to all reality. As you know, to do this, you slipped the bonds of time, and traveled forbidden routes'
		db 'through that which has forever been. You pressed your struggle forward despite danger and death, and you accomplished that which the gods themselves were unable to do."'
		db 0Ah,0Ah
		db 'His praise washes over you like a warm ocean wave, and you feel strength infuse your body.',0
aInDoingWhatYou	db '"In doing what you have done, you have proved youself worthy of nothing less than the ultimate reward." He closes his eyes and raises his hands. '
		db '"The death of the gods tore reality asunder, but you bound it up again. The gods of old are dead, therefore I accept you as my new children. You shall be gods yourselves!"'
		db 0Ah,0Ah,0
aHisEyesOpenAga	db 'His eyes open again and you look up on infinity. At once you see Skara Brae restored to its former beauty. You see beyond it and the Six cities of the Plains. '
		db 'You see the whole world and each of its cultures, and you realize all of it is now your domain.',0Ah,0Ah,0
aAndSoItCameToP	db '"And so it came to pass that eight new stars burned in the night sky. The least of these, the Companion star, was named Hawkslayer after a hero of legend. '
		db 'The other seven, together known as the Company of Heroes, are each named for one of the New Gods. Each night they can be seen is betokened a good night, and '
		db 'adventurers know these gods smile especially upon them..."',0Ah,'-- excerpt from The Gospel of the New Gods (Chap I, Verses 5-9)',0Ah,0Ah,0Ah,0
aYourPartyWillN	db 'Your party will now alter time back to the refugee camp.',0Ah
		db 'Who knows what new challenges await you in the future!',0
aATrapIsNear	db 'A trap is near!',0
aThereAreStai_0	db 'There are stairs near...',0
aSomethingSpeci	db 'Something special is near...',0
aASpinnerIsNear	db 'A spinner is near...',0
aYourSpellsWave	db 'Your spells waver...',0
aSomethingAhead	db 'Something ahead...',0
aOdd___		db 'Odd...',0
aAwfullyQuietAh	db 'Awfully quiet ahead...',0
aStoneBlock	db 'stone block!',0
aTripwire	db 'tripwire!',0
aPit		db 'pit!',0
aSpikedPit	db 'spiked pit!',0
aPoisonGasCloud	db 'poison gas cloud!',0
aPunjiStakes	db 'punji stakes!',0
aCrossbowBolts	db 'crossbow bolts!',0
aShockWave_0	db 'shock wave!',0
aAcidBath	db 'acid bath!',0
aMindZap	db 'mind zap!',0
aPoisonSpray	db 'poison spray!',0
aPoisonSpikedPi	db 'poison spiked pit!',0
aMageZap	db 'mage zap!',0
aDecapitator	db 'decapitator!',0
aTimedWarstrike	db 'timed warstrike!',0
aShockSphere_0	db 'shock sphere!',0
aCrushingWalls	db 'crushing walls!',0
aRollingBall	db 'rolling ball!',0
aBasiliskSnar_0	db 'basilisk snare!',0
aWitherStrike	db 'wither strike!',0
aSledgehammer	db 'sledgehammer!',0
aEarthquake	db 'earthquake!',0
aDeathstrikeEXCL	db 'deathstrike!',0
aBonkers	db 'bonkers!',0
aAWanderingCreatureOff	db 'A wandering creature offers to join your party. You can:'
		db 0Ah,0Ah
		db '@Allow it to join',0Ah
		db '@Fight it',0Ah
		db '@Leave in peace',0
aComeHearTheTaleOfSkar db 'Come hear the tale of Skara Brae - A god returned to have his way. Creatures of darkness, spawn of night, The Mad One',27h,'s kin destroyed the'
		db ' site. Defenders fell, their bane come true, Garth, Roscoe, Kylearan too! As doom approached, the helpless fled. It did no good, the streets'
		db ' ran red. Survivors few, they sit and mope, with but one final ray of hope: ',27h,'Cross time and space, the legends say, Heroes, at last! To steal the day! ',0
		db    0
someMessageList	dd aWelcomeBraveHe	; 0
		dd aInDoingWhatYou	; 1
		dd aHisEyesOpenAga	; 2
		dd aAndSoItCameToP	; 3
		dd aYourPartyWillN	; 4
align 2
aAnExplosion	db 0Ah,'An explosion!',0
align 2
aDarkness	db 0Ah,'Darkness!',0
align 2
aThereIsAPortAbove	db 0Ah,'There is a portal above you.',0
aThereIsAPortBelow	db 0Ah,'There is a portal below.',0
aTheSoundOfSile	db 0Ah,'The sound of silence...',0
align 2
detectMessages	dd aATrapIsNear	       ; 0
		dd aThereAreStai_0	; 1
		dd aSomethingSpeci	; 2
		dd aASpinnerIsNear	; 3
		dd aYourSpellsWave	; 4
		dd aSomethingAhead	; 5
		dd aOdd___		; 6
		dd aAwfullyQuietAh	; 7
aTrapYouVeHitA	db 'TRAP! You',27h,'ve hit a ',0
trapTypeString	dd aStoneBlock, aTripwire, aPit, aSpikedPit; 0
		dd aPoisonGasCloud, aPunjiStakes, aCrossbowBolts; 4
		dd aShockWave_0, aAcidBath, aMindZap, aPoisonSpray; 7
		dd aPoisonSpikedPi, aMageZap, aDecapitator; 11
		dd aTimedWarstrike, aShockSphere_0, aCrushingWalls; 14
		dd aRollingBall, aBasiliskSnar_0, aWitherStrike; 17
		dd aSledgehammer, aEarthquake, aDeathstrikeEXCL; 20
		dd aBonkers		; 23
byte_4B238	db 0, 0, 0, 0	   ; 0
		db 0, 1, 0, 0		; 4
		db 0, 0, 0, 0		; 8
		db 3, 1, 1, 0		; 12
		db 0, 0, 0, 0		; 16
		db 0, 0, 0, 0		; 20
		db 6, 4, 0, 0		; 24
		db 0, 7, 4, 0		; 28
byte_4B258	db 20h dup(0)
byte_4B278	db 0, 1, 2, 0	   ; 0
		db 3, 4, 5, 0		; 4
		db 6, 7, 8, 0		; 8
		db 9, 10, 11, 0		; 12
		db 12, 13, 14, 0	; 16
		db 15, 16, 17, 0	; 20
		db 18, 19, 20, 0	; 24
		db 21, 22, 23, 0	; 28
trapSaveList	trapSave_t < 0Fh, 0Fh	>
		trapSave_t < 0Eh, 0	>
		trapSave_t < 13h, 13h	>
		trapSave_t < 13h, 0	>
		trapSave_t < 15h, 14h	>
		trapSave_t < 14h, 0	>
		trapSave_t < 18h, 18h	>
		trapSave_t < 17h, 0	>
		trapSave_t < 26h, 26h	>
		trapSave_t < 28h, 0	>
		trapSave_t < 27h, 28h	>
		trapSave_t < 28h, 0	>
		trapSave_t < 2Ah, 29h	>
		trapSave_t < 2Ah, 0	>
		trapSave_t < 2Bh, 2Eh	>
		trapSave_t < 2Bh, 0	>
byte_4B2B8	db 0, 2, 4, 0	   ; 0
detectByte	db 0, 0FFh, 0, 0FFh	   ; 0 ; This array holds the flag byte	to detect certain
		db 0, 0, 0, 1		; 4 ; types of squares
		db 1, 1, 1, 1		; 8
		db 1, 0FFh		; 12
detectMask	db 10h, 0, 1, 0	   ; 0 ; This array holds the bitmasks to detect certain
		db 10h,	1, 4, 1		; 4 ; types of squares
		db 2, 4, 8, 10h		; 8
		db 20h,	0		; 12
detectMsgIndex	db 0, 0, 1, 0	       ; 0
		db 0, 1, 2, 3		; 4
		db 4, 5, 6, 7		; 8
		db 5, 0			; 12
off_4B2E6	dd dunsq_battleCheck,	dunsq_doTrap, dunsq_doDarkness;	0
		dd dunsq_doSpinner, dunsq_antiMagic, dunsq_drainHP; 3
		dd dunsq_somethingOdd, dunsq_doSilence,	dunsq_regenSppt; 6
		dd dunsq_drainSppt, dunsq_monHostile, dunsq_doStuck; 9
		dd dunsq_unknown3, dunsq_doExplosion, dunsq_portalAbove; 12
		dd dunsq_portalBelow
byte_4B326	db 0, 0, 0		   ; 0
		db 1, 1, 1		; 3
		db 1, 1, 1		; 6
		db 1, 1, 2		; 9
		db 2, 2, 0		; 12
		db 0			; 15
byte_4B336	db 80h, 10h, 8	   ; 0
		db 1, 2, 4		; 3
		db 8, 10h, 20h		; 6
		db 40h,	80h, 80h	; 9
		db 40h,	10h, 40h	; 12
		db 20h			; 15
off_4B346	dd dun_randomMonJoin
		dd dun_randomMonFight
		dd dun_randomMonLeave
aDragonDragonWh	db 'Dragon, dragon,',0Ah
		db 'Why do you lair?',0Ah
		db 'Unfurl your wings, Take to the air!',0Ah
		db 'Soar high above, Far away fly,',0Ah
		db 'Or is that where, You wish to die?',0
aHawkslayerHawk	db 'Hawkslayer, Hawkslayer,',0Ah
		db 'Why do you ask? Killing me is a difficult task. My claws are sharp, my fangs sharper yet, And my breath flames, let us not forget.',0
aDragonDragonTh	db 'Dragon, dragon,',0Ah
		db 'Thou art quite strong. Your scales are bright and talons are long, But a duty I have and it is clear: Whatever it takes, I will drive you from here.',0
aHawkslayerHa_0	db 'Hawkslayer, Hawkslayer,',0Ah
		db 'Such a brief life. Have you no wish to again see your wife? Imagine her tears and grief and despair, Walk away from this fight, you have not a prayer.',0
aDragonDragonHo	db 'Dragon, dragon,',0Ah
		db 'How wise thou art.',0Ah
		db 'A massive beast with such a kind heart.',0Ah
		db 'I do wish to kiss my wife and my heir,',0Ah
		db '"Pray, fly to the mountains and await me there.',0
aHawkslayerHa_1	db 'Hawkslayer, Hawkslayer,',0Ah
		db 'I thought you were brave. Here I await you, deep in this cave. Come, little man, and I',27h,'ll eat your brain, Then ravage Lucencia again and again.',0
aDragonDragonGr	db 'Dragon, dragon,',0Ah
		db 'Great is your heart. Massive your body, but you are not smart. The rumble you hear and the dust in the air? I',27h,'ve closed the cave off and trapped you in there.',0
aHawkslayerHa_2	db 'Hawkslayer, Hawkslayer,',0Ah
		db 'Others will come.',0Ah
		db 'I will wait but I will not succumb.',0Ah
		db 'Hero you are, and incredibly sly,',0Ah
		db 'But the future I know and a hero you',27h,'ll die...',0
aHeWasBornWithT	db 'He was born with the red, red rose, Sign of his blood, was the link to the past.',0
aInBattleHeWonT	db 'In battle, he won the blue, blue rose, Blossom of his valor, his weapons were cast.',0
aSheWasForHimTh	db 'She was for him the yellow, yellow rose, Her spirit divine, his love would always last.',0
aHisPledgeHeMad	db 'His pledge he made o',27h,'er the white, white rose, And she accepted it as sooth, and remained his steadfast.',0
aSoHeMadeForHer	db 'So he made for her the rainbow rose, Like Alliria',27h,'s beauty, a blossom unsurpassed.',0
aMadGodBadGodTh	db 'Mad god, bad god,',0Ah
		db 'Thrust from the sky,',0Ah
		db 'Foolish god, ghoulish god.',0Ah
		db 'We can',27h,'t hear you cry.',0
aRudeGodCrudeGo	db 'Rude god, crude god,',0Ah
		db 'Why must you terrify?',0Ah
		db 'Error god, terror god,',0Ah
		db 'Do not your future scry.',0
aCleverGodNever	db 'Clever god, never god,',0Ah
		db 'Your time is nigh.',0Ah
		db 'Dire god, liar god,',0Ah
		db 'Why won',27h,'t you just die?',0
aInTheLandOfNoT	db 'In the land of no time,',0Ah
		db 'The Clock within burns like a flame,',0
aLockingEachInH	db 'Locking each in his own crime:',0Ah
		db 'One can only leave when he came.',0
aWelcomeAndBeHa	db 'Welcome and be happy o',27h,' weary travelers! Step to the stage and listen to my tales.',0Ah,0Ah
		db 'You can:',0Ah,0Ah
		db 'Listen to the bard',0Ah
		db 'Exit the hall',0
align 2
aTheseAreTheSon	db 'These are the songs I know...',0Ah,0Ah
		db '@Dragon Song',0Ah
		db '@Flower Ballad',0Ah
		db '@Kiel',27h,'s Overture',0Ah
		db '@Gale of Gods',0Ah
		db '@Evil',27h,'s Bane',0Ah
		db '@Minstrel Shield',0
off_4BC98	dd aDragonDragonWh
		dd aHawkslayerHawk
		dd aDragonDragonTh
		dd aHawkslayerHa_0
		dd aDragonDragonHo
		dd aHawkslayerHa_1
		dd aDragonDragonGr
		dd aHawkslayerHa_2
off_4BCB8	dd aHeWasBornWithT
		dd aInBattleHeWonT
		dd aSheWasForHimTh
		dd aHisPledgeHeMad
		dd aSoHeMadeForHer
off_4BCCC	dd aMadGodBadGodTh
		dd aRudeGodCrudeGo
		dd aCleverGodNever
off_4BCD8	dd aInTheLandOfNoT
		dd aLockingEachInH
aTheBardSmilesA	db 'The bard smiles and says, "That one will cost thee for your bards will learn the magic of my song."',0
aItWillCostYou	db '"It will cost you ',0
align 2
aTheBardPlaysTh	db 'The bard plays the song and you memorize the lines.',0
aBardSHall	db 'Bard',27h,'s Hall',0
word_4BDC4	dw 8, 5, 0, 3, 2, 0    ; 0
bardSongLyrics	dd off_4BC98	       ; 0
		dd off_4BCB8		; 1
		dd offset word_42670	; 2
		dd off_4BCCC		; 3
		dd off_4BCD8		; 4
align 8
bardSongPrice	dd 30000, 60000       ;	0
byte_4BDF0	db 1, 2     ; 0
aButNoRoomForASummoni db 'but no room for a summoning!',0Ah,0Ah,0
		db    0
aAndA		db 'and a ',0
		db    0
aAppears	db ' appears!',0Ah,0Ah,0
summonData      db 'Wol/f\ves',0,0,0,0,0,0,0; _name
summonHpDice    db 0A1h                 ; [0].hpDice
                dw 0Ah                  ; [0].hpBase
                db 11h                  ; [0].distance
                db 8Ch                  ; [0].packedGenAc
                db 0                    ; [0].groupSize
                db 0F0h                 ; [0].attackType._type
                db 23h                  ; [0].attackType.damage
                db 0F0h                 ; [0].attackType._type
                db 23h                  ; [0].attackType.damage
                db 0F0h                 ; [0].attackType._type
                db 23h                  ; [0].attackType.damage
                db 0F0h                 ; [0].attackType._type
                db 23h                  ; [0].attackType.damage
                db 0                    ; [0].breathFlag
                db 0                    ; [0].breathRange
                db 4                    ; [0].picIndex
                db 64h                  ; [0].rewardLo
                db 0                    ; [0].rewardMid
                db 0                    ; [0].rewardHi
                db 43h                  ; [0].flags
                db 12h                  ; [0].breathSaveLo
                db 19h                  ; [0].breathSaveHi
                db 37h                  ; [0].oppPriorityLo
                db 41h                  ; [0].oppPriorityHi
                db 0                    ; [0].strongElement
                db 0                    ; [0].weakElement
                db 8                    ; [0].repelFlags
                db 0Fh                  ; [0].toHitLo
                db 19h                  ; [0].toHitHi
                db 17h                  ; [0].spellSaveLo
                db 1Ch                  ; [0].spellSaveHi
                db 'Slayer/\s',0,0,0,0,0,0,0; _name
                db 81h                  ; [1].hpDice
                dw 40h                  ; [1].hpBase
                db 11h                  ; [1].distance
                db 17h                  ; [1].packedGenAc
                db 0                    ; [1].groupSize
                db 0F7h                 ; [1].attackType._type
                db 81h                  ; [1].attackType.damage
                db 0F7h                 ; [1].attackType._type
                db 81h                  ; [1].attackType.damage
                db 0F7h                 ; [1].attackType._type
                db 81h                  ; [1].attackType.damage
                db 0F7h                 ; [1].attackType._type
                db 81h                  ; [1].attackType.damage
                db 0                    ; [1].breathFlag
                db 0                    ; [1].breathRange
                db 21h                  ; [1].picIndex
                db 64h                  ; [1].rewardLo
                db 0                    ; [1].rewardMid
                db 0                    ; [1].rewardHi
                db 80h                  ; [1].flags
                db 12h                  ; [1].breathSaveLo
                db 19h                  ; [1].breathSaveHi
                db 37h                  ; [1].oppPriorityLo
                db 3Dh                  ; [1].oppPriorityHi
                db 8                    ; [1].strongElement
                db 0                    ; [1].weakElement
                db 4                    ; [1].repelFlags
                db 0Fh                  ; [1].toHitLo
                db 19h                  ; [1].toHitHi
                db 19h                  ; [1].spellSaveLo
                db 23h                  ; [1].spellSaveHi
                db 'Wind Warrior/\s',0  ; _name
                db 81h                  ; [2].hpDice
                dw 14h                  ; [2].hpBase
                db 11h                  ; [2].distance
                db 17h                  ; [2].packedGenAc
                db 0                    ; [2].groupSize
                db 0F0h                 ; [2].attackType._type
                db 62h                  ; [2].attackType.damage
                db 0F0h                 ; [2].attackType._type
                db 62h                  ; [2].attackType.damage
                db 0F0h                 ; [2].attackType._type
                db 62h                  ; [2].attackType.damage
                db 0F0h                 ; [2].attackType._type
                db 62h                  ; [2].attackType.damage
                db 0                    ; [2].breathFlag
                db 0                    ; [2].breathRange
                db 14h                  ; [2].picIndex
                db 64h                  ; [2].rewardLo
                db 0                    ; [2].rewardMid
                db 0                    ; [2].rewardHi
                db 94h                  ; [2].flags
                db 12h                  ; [2].breathSaveLo
                db 19h                  ; [2].breathSaveHi
                db 37h                  ; [2].oppPriorityLo
                db 3Dh                  ; [2].oppPriorityHi
                db 0                    ; [2].strongElement
                db 0                    ; [2].weakElement
                db 0                    ; [2].repelFlags
                db 0Fh                  ; [2].toHitLo
                db 19h                  ; [2].toHitHi
                db 19h                  ; [2].spellSaveLo
                db 23h                  ; [2].spellSaveHi
                db 'Wind Ogre/\s',0,0,0,0; _name
                db 0A1h                 ; [3].hpDice
                dw 0Ah                  ; [3].hpBase
                db 11h                  ; [3].distance
                db 97h                  ; [3].packedGenAc
                db 0                    ; [3].groupSize
                db 0F0h                 ; [3].attackType._type
                db 64h                  ; [3].attackType.damage
                db 0F0h                 ; [3].attackType._type
                db 64h                  ; [3].attackType.damage
                db 0FFh                 ; [3].attackType._type
                db 0                    ; [3].attackType.damage
                db 0FFh                 ; [3].attackType._type
                db 0                    ; [3].attackType.damage
                db 0                    ; [3].breathFlag
                db 0                    ; [3].breathRange
                db 33h                  ; [3].picIndex
                db 64h                  ; [3].rewardLo
                db 0                    ; [3].rewardMid
                db 0                    ; [3].rewardHi
                db 95h                  ; [3].flags
                db 12h                  ; [3].breathSaveLo
                db 19h                  ; [3].breathSaveHi
                db 37h                  ; [3].oppPriorityLo
                db 3Dh                  ; [3].oppPriorityHi
                db 0                    ; [3].strongElement
                db 0                    ; [3].weakElement
                db 0                    ; [3].repelFlags
                db 0Fh                  ; [3].toHitLo
                db 19h                  ; [3].toHitHi
                db 19h                  ; [3].spellSaveLo
                db 23h                  ; [3].spellSaveHi
                db 'Wind Dragon/\s',0,0 ; _name
                db 0A2h                 ; [4].hpDice
                dw 28h                  ; [4].hpBase
                db 11h                  ; [4].distance
                db 99h                  ; [4].packedGenAc
                db 0                    ; [4].groupSize
                db 80h                  ; [4].attackType._type
                db 69h                  ; [4].attackType.damage
                db 80h                  ; [4].attackType._type
                db 69h                  ; [4].attackType.damage
                db 0F0h                 ; [4].attackType._type
                db 69h                  ; [4].attackType.damage
                db 80h                  ; [4].attackType._type
                db 44h                  ; [4].attackType.damage
                db 0                    ; [4].breathFlag
                db 3                    ; [4].breathRange
                db 3Dh                  ; [4].picIndex
                db 64h                  ; [4].rewardLo
                db 0                    ; [4].rewardMid
                db 0                    ; [4].rewardHi
                db 0D2h                 ; [4].flags
                db 13h                  ; [4].breathSaveLo
                db 1Eh                  ; [4].breathSaveHi
                db 28h                  ; [4].oppPriorityLo
                db 46h                  ; [4].oppPriorityHi
                db 80h                  ; [4].strongElement
                db 10h                  ; [4].weakElement
                db 1                    ; [4].repelFlags
                db 14h                  ; [4].toHitLo
                db 1Eh                  ; [4].toHitHi
                db 0Ah                  ; [4].spellSaveLo
                db 64h                  ; [4].spellSaveHi
                db 'Wind Giant/\s',0,0,0; _name
                db 0A3h                 ; [5].hpDice
                dw 0Fh                  ; [5].hpBase
                db 11h                  ; [5].distance
                db 19h                  ; [5].packedGenAc
                db 0                    ; [5].groupSize
                db 80h                  ; [5].attackType._type
                db 6Bh                  ; [5].attackType.damage
                db 0F0h                 ; [5].attackType._type
                db 6Bh                  ; [5].attackType.damage
                db 0F0h                 ; [5].attackType._type
                db 6Bh                  ; [5].attackType.damage
                db 23h                  ; [5].attackType._type
                db 32h                  ; [5].attackType.damage
                db 2                    ; [5].breathFlag
                db 4                    ; [5].breathRange
                db 33h                  ; [5].picIndex
                db 64h                  ; [5].rewardLo
                db 0                    ; [5].rewardMid
                db 0                    ; [5].rewardHi
                db 0D5h                 ; [5].flags
                db 15h                  ; [5].breathSaveLo
                db 20h                  ; [5].breathSaveHi
                db 1Eh                  ; [5].oppPriorityLo
                db 3Ch                  ; [5].oppPriorityHi
                db 0                    ; [5].strongElement
                db 0                    ; [5].weakElement
                db 0                    ; [5].repelFlags
                db 19h                  ; [5].toHitLo
                db 23h                  ; [5].toHitHi
                db 0Ah                  ; [5].spellSaveLo
                db 1Eh                  ; [5].spellSaveHi
                db 'Wind Her/o\oes',0,0 ; _name
                db 0A4h                 ; [6].hpDice
                dw 14h                  ; [6].hpBase
                db 11h                  ; [6].distance
                db 1Bh                  ; [6].packedGenAc
                db 20h                  ; [6].groupSize
                db 0F0h                 ; [6].attackType._type
                db 6Ch                  ; [6].attackType.damage
                db 0F0h                 ; [6].attackType._type
                db 6Ch                  ; [6].attackType.damage
                db 0F0h                 ; [6].attackType._type
                db 8Ch                  ; [6].attackType.damage
                db 0F0h                 ; [6].attackType._type
                db 6Ch                  ; [6].attackType.damage
                db 0                    ; [6].breathFlag
                db 0                    ; [6].breathRange
                db 0Ah                  ; [6].picIndex
                db 64h                  ; [6].rewardLo
                db 0                    ; [6].rewardMid
                db 0                    ; [6].rewardHi
                db 94h                  ; [6].flags
                db 16h                  ; [6].breathSaveLo
                db 21h                  ; [6].breathSaveHi
                db 2Ah                  ; [6].oppPriorityLo
                db 48h                  ; [6].oppPriorityHi
                db 0                    ; [6].strongElement
                db 0                    ; [6].weakElement
                db 0                    ; [6].repelFlags
                db 19h                  ; [6].toHitLo
                db 23h                  ; [6].toHitHi
                db 0Ah                  ; [6].spellSaveLo
                db 64h                  ; [6].spellSaveHi
                db 'Fire Elemental/',0  ; _name
                db 81h                  ; [7].hpDice
                dw 0Ah                  ; [7].hpBase
                db 11h                  ; [7].distance
                db 97h                  ; [7].packedGenAc
                db 0                    ; [7].groupSize
                db 0F0h                 ; [7].attackType._type
                db 64h                  ; [7].attackType.damage
                db 0F0h                 ; [7].attackType._type
                db 64h                  ; [7].attackType.damage
                db 0F0h                 ; [7].attackType._type
                db 64h                  ; [7].attackType.damage
                db 0F0h                 ; [7].attackType._type
                db 64h                  ; [7].attackType.damage
                db 0                    ; [7].breathFlag
                db 0                    ; [7].breathRange
                db 5                    ; [7].picIndex
                db 64h                  ; [7].rewardLo
                db 0                    ; [7].rewardMid
                db 0                    ; [7].rewardHi
                db 85h                  ; [7].flags
                db 12h                  ; [7].breathSaveLo
                db 19h                  ; [7].breathSaveHi
                db 37h                  ; [7].oppPriorityLo
                db 3Dh                  ; [7].oppPriorityHi
                db 80h                  ; [7].strongElement
                db 10h                  ; [7].weakElement
                db 0                    ; [7].repelFlags
                db 0Fh                  ; [7].toHitLo
                db 19h                  ; [7].toHitHi
                db 19h                  ; [7].spellSaveLo
                db 23h                  ; [7].spellSaveHi
                db 'Demon/\s',0,0,0,0,0,0,0,0; _name
                db 0A2h                 ; [8].hpDice
                dw 0Ch                  ; [8].hpBase
                db 11h                  ; [8].distance
                db 94h                  ; [8].packedGenAc
                db 0                    ; [8].groupSize
                db 80h                  ; [8].attackType._type
                db 44h                  ; [8].attackType.damage
                db 80h                  ; [8].attackType._type
                db 44h                  ; [8].attackType.damage
                db 0F0h                 ; [8].attackType._type
                db 64h                  ; [8].attackType.damage
                db 0F0h                 ; [8].attackType._type
                db 64h                  ; [8].attackType.damage
                db 0                    ; [8].breathFlag
                db 4                    ; [8].breathRange
                db 17h                  ; [8].picIndex
                db 64h                  ; [8].rewardLo
                db 0                    ; [8].rewardMid
                db 0                    ; [8].rewardHi
                db 80h                  ; [8].flags
                db 12h                  ; [8].breathSaveLo
                db 19h                  ; [8].breathSaveHi
                db 37h                  ; [8].oppPriorityLo
                db 3Dh                  ; [8].oppPriorityHi
                db 0                    ; [8].strongElement
                db 20h                  ; [8].weakElement
                db 40h                  ; [8].repelFlags
                db 0Fh                  ; [8].toHitLo
                db 19h                  ; [8].toHitHi
                db 19h                  ; [8].spellSaveLo
                db 23h                  ; [8].spellSaveHi
                db 'Herb/\s',0,0,0,0,0,0,0,0,0; _name
                db 0E0h                 ; [9].hpDice
                dw 28h                  ; [9].hpBase
                db 11h                  ; [9].distance
                db 16h                  ; [9].packedGenAc
                db 0                    ; [9].groupSize
                db 0F0h                 ; [9].attackType._type
                db 69h                  ; [9].attackType.damage
                db 0F0h                 ; [9].attackType._type
                db 69h                  ; [9].attackType.damage
                db 0F0h                 ; [9].attackType._type
                db 69h                  ; [9].attackType.damage
                db 42h                  ; [9].attackType._type
                db 20h                  ; [9].attackType.damage
                db 0                    ; [9].breathFlag
                db 0                    ; [9].breathRange
                db 5                    ; [9].picIndex
                db 64h                  ; [9].rewardLo
                db 0                    ; [9].rewardMid
                db 0                    ; [9].rewardHi
                db 82h                  ; [9].flags
                db 13h                  ; [9].breathSaveLo
                db 1Eh                  ; [9].breathSaveHi
                db 28h                  ; [9].oppPriorityLo
                db 46h                  ; [9].oppPriorityHi
                db 0                    ; [9].strongElement
                db 0                    ; [9].weakElement
                db 0                    ; [9].repelFlags
                db 14h                  ; [9].toHitLo
                db 1Eh                  ; [9].toHitHi
                db 0Ah                  ; [9].spellSaveLo
                db 64h                  ; [9].spellSaveHi
                db 'Greater Demon',0,0,0; _name
                db 0E1h                 ; [10].hpDice
                dw 0Ah                  ; [10].hpBase
                db 11h                  ; [10].distance
                db 9Ch                  ; [10].packedGenAc
                db 0                    ; [10].groupSize
                db 0F0h                 ; [10].attackType._type
                db 6Ch                  ; [10].attackType.damage
                db 0F0h                 ; [10].attackType._type
                db 6Ch                  ; [10].attackType.damage
                db 80h                  ; [10].attackType._type
                db 69h                  ; [10].attackType.damage
                db 80h                  ; [10].attackType._type
                db 69h                  ; [10].attackType.damage
                db 2                    ; [10].breathFlag
                db 5                    ; [10].breathRange
                db 5                    ; [10].picIndex
                db 64h                  ; [10].rewardLo
                db 0                    ; [10].rewardMid
                db 0                    ; [10].rewardHi
                db 0C5h                 ; [10].flags
                db 16h                  ; [10].breathSaveLo
                db 23h                  ; [10].breathSaveHi
                db 20h                  ; [10].oppPriorityLo
                db 48h                  ; [10].oppPriorityHi
                db 0                    ; [10].strongElement
                db 20h                  ; [10].weakElement
                db 40h                  ; [10].repelFlags
                db 19h                  ; [10].toHitLo
                db 25h                  ; [10].toHitHi
                db 0Fh                  ; [10].spellSaveLo
                db 64h                  ; [10].spellSaveHi
                db 'Kringle Bro',27h,0,0,0,0; _name
                db 0E1h                 ; [11].hpDice
                dw 0C8h                 ; [11].hpBase
                db 11h                  ; [11].distance
                db 1Eh                  ; [11].packedGenAc
                db 0                    ; [11].groupSize
                db 0F0h                 ; [11].attackType._type
                db 73h                  ; [11].attackType.damage
                db 0F0h                 ; [11].attackType._type
                db 73h                  ; [11].attackType.damage
                db 0F0h                 ; [11].attackType._type
                db 73h                  ; [11].attackType.damage
                db 4Bh                  ; [11].attackType._type
                db 19h                  ; [11].attackType.damage
                db 0                    ; [11].breathFlag
                db 0                    ; [11].breathRange
                db 0Ah                  ; [11].picIndex
                db 64h                  ; [11].rewardLo
                db 0                    ; [11].rewardMid
                db 0                    ; [11].rewardHi
                db 85h                  ; [11].flags
                db 16h                  ; [11].breathSaveLo
                db 23h                  ; [11].breathSaveHi
                db 32h                  ; [11].oppPriorityLo
                db 50h                  ; [11].oppPriorityHi
                db 0                    ; [11].strongElement
                db 0                    ; [11].weakElement
                db 0                    ; [11].repelFlags
                db 23h                  ; [11].toHitLo
                db 2Dh                  ; [11].toHitHi
                db 0Ah                  ; [11].spellSaveLo
                db 64h                  ; [11].spellSaveHi
                db 'Earth Elemental',0  ; _name
                db 0E2h                 ; [12].hpDice
                dw 12Ch                 ; [12].hpBase
                db 11h                  ; [12].distance
                db 9Fh                  ; [12].packedGenAc
                db 0                    ; [12].groupSize
                db 0F0h                 ; [12].attackType._type
                db 8Eh                  ; [12].attackType.damage
                db 0F0h                 ; [12].attackType._type
                db 8Eh                  ; [12].attackType.damage
                db 0F0h                 ; [12].attackType._type
                db 8Eh                  ; [12].attackType.damage
                db 6Eh                  ; [12].attackType._type
                db 32h                  ; [12].attackType.damage
                db 0                    ; [12].breathFlag
                db 0                    ; [12].breathRange
                db 5                    ; [12].picIndex
                db 64h                  ; [12].rewardLo
                db 0                    ; [12].rewardMid
                db 0                    ; [12].rewardHi
                db 0C5h                 ; [12].flags
                db 16h                  ; [12].breathSaveLo
                db 23h                  ; [12].breathSaveHi
                db 32h                  ; [12].oppPriorityLo
                db 50h                  ; [12].oppPriorityHi
                db 0                    ; [12].strongElement
                db 0                    ; [12].weakElement
                db 0                    ; [12].repelFlags
                db 23h                  ; [12].toHitLo
                db 2Dh                  ; [12].toHitHi
                db 0Ah                  ; [12].spellSaveLo
                db 64h                  ; [12].spellSaveHi
                db 'Frost Giant/\s',0,0 ; _name
                db 0A1h                 ; [13].hpDice
                dw 14h                  ; [13].hpBase
                db 11h                  ; [13].distance
                db 17h                  ; [13].packedGenAc
                db 0                    ; [13].groupSize
                db 0F0h                 ; [13].attackType._type
                db 64h                  ; [13].attackType.damage
                db 0F0h                 ; [13].attackType._type
                db 64h                  ; [13].attackType.damage
                db 0F0h                 ; [13].attackType._type
                db 64h                  ; [13].attackType.damage
                db 0FFh                 ; [13].attackType._type
                db 0                    ; [13].attackType.damage
                db 0                    ; [13].breathFlag
                db 0                    ; [13].breathRange
                db 33h                  ; [13].picIndex
                db 64h                  ; [13].rewardLo
                db 0                    ; [13].rewardMid
                db 0                    ; [13].rewardHi
                db 0C5h                 ; [13].flags
                db 12h                  ; [13].breathSaveLo
                db 19h                  ; [13].breathSaveHi
                db 37h                  ; [13].oppPriorityLo
                db 3Dh                  ; [13].oppPriorityHi
                db 10h                  ; [13].strongElement
                db 80h                  ; [13].weakElement
                db 0                    ; [13].repelFlags
                db 0Fh                  ; [13].toHitLo
                db 19h                  ; [13].toHitHi
                db 19h                  ; [13].spellSaveLo
                db 23h                  ; [13].spellSaveHi
                db 'Molten M/an\en',0,0 ; _name
                db 0C0h                 ; [14].hpDice
                dw 32h                  ; [14].hpBase
                db 11h                  ; [14].distance
                db 94h                  ; [14].packedGenAc
                db 0                    ; [14].groupSize
                db 80h                  ; [14].attackType._type
                db 62h                  ; [14].attackType.damage
                db 80h                  ; [14].attackType._type
                db 62h                  ; [14].attackType.damage
                db 0F0h                 ; [14].attackType._type
                db 64h                  ; [14].attackType.damage
                db 0F0h                 ; [14].attackType._type
                db 64h                  ; [14].attackType.damage
                db 4                    ; [14].breathFlag
                db 4                    ; [14].breathRange
                db 5                    ; [14].picIndex
                db 64h                  ; [14].rewardLo
                db 0                    ; [14].rewardMid
                db 0                    ; [14].rewardHi
                db 80h                  ; [14].flags
                db 13h                  ; [14].breathSaveLo
                db 1Ah                  ; [14].breathSaveHi
                db 38h                  ; [14].oppPriorityLo
                db 3Eh                  ; [14].oppPriorityHi
                db 80h                  ; [14].strongElement
                db 10h                  ; [14].weakElement
                db 0                    ; [14].repelFlags
                db 10h                  ; [14].toHitLo
                db 1Ah                  ; [14].toHitHi
                db 19h                  ; [14].spellSaveLo
                db 24h                  ; [14].spellSaveHi
                db 'Bulldozer/\s',0,0,0,0; _name
                db 0E0h                 ; [15].hpDice
                dw 30h                  ; [15].hpBase
                db 1                    ; [15].distance
                db 98h                  ; [15].packedGenAc
                db 0                    ; [15].groupSize
                db 0F0h                 ; [15].attackType._type
                db 69h                  ; [15].attackType.damage
                db 0F0h                 ; [15].attackType._type
                db 69h                  ; [15].attackType.damage
                db 0F0h                 ; [15].attackType._type
                db 6Bh                  ; [15].attackType.damage
                db 0F0h                 ; [15].attackType._type
                db 6Bh                  ; [15].attackType.damage
                db 0                    ; [15].breathFlag
                db 0                    ; [15].breathRange
                db 0Bh                  ; [15].picIndex
                db 64h                  ; [15].rewardLo
                db 0                    ; [15].rewardMid
                db 0                    ; [15].rewardHi
                db 0C0h                 ; [15].flags
                db 13h                  ; [15].breathSaveLo
                db 1Eh                  ; [15].breathSaveHi
                db 28h                  ; [15].oppPriorityLo
                db 46h                  ; [15].oppPriorityHi
                db 0                    ; [15].strongElement
                db 0                    ; [15].weakElement
                db 0                    ; [15].repelFlags
                db 14h                  ; [15].toHitLo
                db 1Eh                  ; [15].toHitHi
                db 0Ah                  ; [15].spellSaveLo
                db 64h                  ; [15].spellSaveHi
                db 'Vanquisher/\s',0,0,0; _name
                db 0E1h                 ; [16].hpDice
                dw 40h                  ; [16].hpBase
                db 11h                  ; [16].distance
                db 9Dh                  ; [16].packedGenAc
                db 0                    ; [16].groupSize
                db 32h                  ; [16].attackType._type
                db 1Eh                  ; [16].attackType.damage
                db 3Dh                  ; [16].attackType._type
                db 1Eh                  ; [16].attackType.damage
                db 32h                  ; [16].attackType._type
                db 1Eh                  ; [16].attackType.damage
                db 42h                  ; [16].attackType._type
                db 1Eh                  ; [16].attackType.damage
                db 0                    ; [16].breathFlag
                db 0                    ; [16].breathRange
                db 36h                  ; [16].picIndex
                db 64h                  ; [16].rewardLo
                db 0                    ; [16].rewardMid
                db 0                    ; [16].rewardHi
                db 82h                  ; [16].flags
                db 16h                  ; [16].breathSaveLo
                db 23h                  ; [16].breathSaveHi
                db 32h                  ; [16].oppPriorityLo
                db 50h                  ; [16].oppPriorityHi
                db 0                    ; [16].strongElement
                db 0                    ; [16].weakElement
                db 0                    ; [16].repelFlags
                db 23h                  ; [16].toHitLo
                db 2Dh                  ; [16].toHitHi
                db 0Ah                  ; [16].spellSaveLo
                db 64h                  ; [16].spellSaveHi
                db 'Blast Dragon/\s',0  ; _name
                db 0E3h                 ; [17].hpDice
                dw 20h                  ; [17].hpBase
                db 11h                  ; [17].distance
                db 9Dh                  ; [17].packedGenAc
                db 0                    ; [17].groupSize
                db 0F0h                 ; [17].attackType._type
                db 6Eh                  ; [17].attackType.damage
                db 80h                  ; [17].attackType._type
                db 6Eh                  ; [17].attackType.damage
                db 80h                  ; [17].attackType._type
                db 6Eh                  ; [17].attackType.damage
                db 0F0h                 ; [17].attackType._type
                db 6Eh                  ; [17].attackType.damage
                db 2                    ; [17].breathFlag
                db 5                    ; [17].breathRange
                db 3Dh                  ; [17].picIndex
                db 64h                  ; [17].rewardLo
                db 0                    ; [17].rewardMid
                db 0                    ; [17].rewardHi
                db 0C2h                 ; [17].flags
                db 17h                  ; [17].breathSaveLo
                db 24h                  ; [17].breathSaveHi
                db 34h                  ; [17].oppPriorityLo
                db 52h                  ; [17].oppPriorityHi
                db 80h                  ; [17].strongElement
                db 0                    ; [17].weakElement
                db 1                    ; [17].repelFlags
                db 24h                  ; [17].toHitLo
                db 2Eh                  ; [17].toHitHi
                db 0Ah                  ; [17].spellSaveLo
                db 64h                  ; [17].spellSaveHi
                db 'One-eyed Angra',0,0 ; _name
                db 0E2h                 ; [18].hpDice
                dw 82h                  ; [18].hpBase
                db 11h                  ; [18].distance
                db 0DAh                 ; [18].packedGenAc
                db 0                    ; [18].groupSize
                db 48h                  ; [18].attackType._type
                db 20h                  ; [18].attackType.damage
                db 4Bh                  ; [18].attackType._type
                db 23h                  ; [18].attackType.damage
                db 4Bh                  ; [18].attackType._type
                db 23h                  ; [18].attackType.damage
                db 2Dh                  ; [18].attackType._type
                db 23h                  ; [18].attackType.damage
                db 0                    ; [18].breathFlag
                db 0                    ; [18].breathRange
                db 36h                  ; [18].picIndex
                db 64h                  ; [18].rewardLo
                db 0                    ; [18].rewardMid
                db 0                    ; [18].rewardHi
                db 80h                  ; [18].flags
                db 19h                  ; [18].breathSaveLo
                db 28h                  ; [18].breathSaveHi
                db 28h                  ; [18].oppPriorityLo
                db 46h                  ; [18].oppPriorityHi
                db 0                    ; [18].strongElement
                db 0                    ; [18].weakElement
                db 0                    ; [18].repelFlags
                db 22h                  ; [18].toHitLo
                db 2Eh                  ; [18].toHitHi
                db 0Ah                  ; [18].spellSaveLo
                db 5Ah                  ; [18].spellSaveHi
                db 'Black Death',0,0,0,0,0; _name
                db 0E9h                 ; [19].hpDice
                dw 64h                  ; [19].hpBase
                db 11h                  ; [19].distance
                db 0A0h                 ; [19].packedGenAc
                db 20h                  ; [19].groupSize
                db 0F7h                 ; [19].attackType._type
                db 0C9h                 ; [19].attackType.damage
                db 0F7h                 ; [19].attackType._type
                db 0E9h                 ; [19].attackType.damage
                db 5Bh                  ; [19].attackType._type
                db 28h                  ; [19].attackType.damage
                db 63h                  ; [19].attackType._type
                db 0                    ; [19].attackType.damage
                db 0                    ; [19].breathFlag
                db 0                    ; [19].breathRange
                db 24h                  ; [19].picIndex
                db 64h                  ; [19].rewardLo
                db 0                    ; [19].rewardMid
                db 0                    ; [19].rewardHi
                db 80h                  ; [19].flags
                db 1Eh                  ; [19].breathSaveLo
                db 28h                  ; [19].breathSaveHi
                db 3Ch                  ; [19].oppPriorityLo
                db 5Ah                  ; [19].oppPriorityHi
                db 0                    ; [19].strongElement
                db 20h                  ; [19].weakElement
                db 0                    ; [19].repelFlags
                db 28h                  ; [19].toHitLo
                db 2Fh                  ; [19].toHitHi
                db 14h                  ; [19].spellSaveLo
                db 64h                  ; [19].spellSaveHi
                db 'Familiar/\s',0,0,0,0,0; _name
                db 49h                  ; [20].hpDice
                dw 32h                  ; [20].hpBase
                db 11h                  ; [20].distance
                db 99h                  ; [20].packedGenAc
                db 0                    ; [20].groupSize
                db 4Ch                  ; [20].attackType._type
                db 32h                  ; [20].attackType.damage
                db 22h                  ; [20].attackType._type
                db 32h                  ; [20].attackType.damage
                db 2Dh                  ; [20].attackType._type
                db 32h                  ; [20].attackType.damage
                db 5Ah                  ; [20].attackType._type
                db 32h                  ; [20].attackType.damage
                db 0                    ; [20].breathFlag
                db 0                    ; [20].breathRange
                db 12h                  ; [20].picIndex
                db 64h                  ; [20].rewardLo
                db 0                    ; [20].rewardMid
                db 0                    ; [20].rewardHi
                db 3                    ; [20].flags
                db 1Eh                  ; [20].breathSaveLo
                db 28h                  ; [20].breathSaveHi
                db 0Ah                  ; [20].oppPriorityLo
                db 14h                  ; [20].oppPriorityHi
                db 4                    ; [20].strongElement
                db 0                    ; [20].weakElement
                db 0                    ; [20].repelFlags
                db 0Ah                  ; [20].toHitLo
                db 0Ah                  ; [20].toHitHi
                db 0Ah                  ; [20].spellSaveLo
                db 0Ah                  ; [20].spellSaveHi
                db 'Black Slayer/\s',0  ; _name
                db 0                    ; [21].hpDice
                dw 0FA0h                ; [21].hpBase
                db 12h                  ; [21].distance
                db 0A7h                 ; [21].packedGenAc
                db 23h                  ; [21].groupSize
                db 0F7h                 ; [21].attackType._type
                db 64h                  ; [21].attackType.damage
                db 0F7h                 ; [21].attackType._type
                db 84h                  ; [21].attackType.damage
                db 0F7h                 ; [21].attackType._type
                db 85h                  ; [21].attackType.damage
                db 0F7h                 ; [21].attackType._type
                db 65h                  ; [21].attackType.damage
                db 0                    ; [21].breathFlag
                db 0                    ; [21].breathRange
                db 41h                  ; [21].picIndex
                db 50h                  ; [21].rewardLo
                db 0C3h                 ; [21].rewardMid
                db 0                    ; [21].rewardHi
                db 80h                  ; [21].flags
                db 28h                  ; [21].breathSaveLo
                db 32h                  ; [21].breathSaveHi
                db 5Ah                  ; [21].oppPriorityLo
                db 78h                  ; [21].oppPriorityHi
                db 0                    ; [21].strongElement
                db 20h                  ; [21].weakElement
                db 10h                  ; [21].repelFlags
                db 28h                  ; [21].toHitLo
                db 3Ch                  ; [21].toHitHi
                db 28h                  ; [21].spellSaveLo
                db 46h                  ; [21].spellSaveHi
unk_4C246	db  0Ah
		db    0
aWhatTypeOfDisp	db 'What type of display do you wish to use?',0
a1CompositeOrTv	db 0Ah,0Ah
		db '1) Composite or TV monitor.',0
a2RgbMonitor_	db 0Ah,'2) RGB monitor.',0
a3EgaMonitor_	db 0Ah,'3) EGA monitor.',0
a4TandyComputer	db 0Ah,'4) Tandy computer with RGB monitor.',0
aPleaseEnterThe	db 0Ah,0Ah
		db 'Please enter the appropriate number for your system type:',0
asc_4C312	db  0Ah, 0
aWhatTypeOfSoundOutput db 'What type of sound output device do you wish to use?',0
a1Mt32_		db 0Ah,0Ah,'1) MT32.',0
a2AdLib_	db 0Ah,'2) Ad Lib.',0
a3InternalIbmSpeaker_ db 0Ah,'3) Internal IBM speaker.',0
a4Tandy_	db 0Ah,'4) Tandy.',0
a5Ps1		db 0Ah,'5) PS/1',0
aPleaseEnterTheAppropr db 0Ah,0Ah,'Please enter the appropriate number for your system type:',0
aDiskToTransfer	db 'Disk to transfer characters from?',0
aWhoShallTransfer?	db 'Who shall transfer?',0
aThisCharacterAlready	db 'This character already exists',0
aNoCharactersFoundOn	db 'No characters found on',0
		db    0
aNoPartiesFoundOn	db 'No parties found on',0
aTransferCharac	db 'Transfer characters from:',0Ah
		db '1) Bards I',0Ah
		db '2) Bards II',0Ah
		db '3) Bards III',0Ah
		db 'E) Exit',0
bi_inventoryMap	db 0, 1, 2, 3, 4, 5, 6,	7, 6, 9; 0
		db 0Ah,	0Bh, 0Ch, 0Dh, 0Eh, 0Fh, 10h, 11h, 12h,	13h; 10
		db 14h,	14h, 14h, 17h, 18h, 19h, 1Ah, 0, 1Ch, 1Dh; 20
		db 1Eh,	1Fh, 20h, 21h, 22h, 23h, 0, 25h, 0, 0; 30
		db 28h,	0, 29h,	2Ah, 0,	2Ch, 2Dh, 2Eh, 2Fh, 30h; 40
		db 31h,	0, 32h,	33h, 0,	0, 34h,	0, 36h,	0; 50
		db 37h,	1Bh, 39h, 0, 3Bh, 3Ch, 0, 3Eh, 3Fh, 40h; 60
		db 41h,	42h, 0,	45h, 0,	0, 46h,	47h, 59h, 49h; 70
		db 0, 4Bh, 0, 0, 4Eh, 0, 4Fh, 51h, 0, 53h; 80
		db 54h,	55h, 0,	57h, 0,	5Ah, 5Bh, 0, 0,	5Eh; 90
		db 5Fh,	58h, 0,	0, 0, 0, 43h, 0, 62h, 0; 100
		db 64h,	64h, 0,	59h, 6Ch, 0, 0,	0, 0, 0; 110
		db 0, 0, 0, 0, 0, 0, 0,	0; 120
bii_inventoryMap db 0, 1, 2, 3,	4, 5, 6, 7, 8, 9; 0
		db 10, 11, 12, 13, 14, 15, 16, 17, 18, 19; 10
		db 20, 21, 22, 23, 24, 25, 26, 27, 28, 29; 20
		db 30, 31, 32, 33, 34, 35, 36, 37, 38, 39; 30
		db 40, 41, 42, 43, 44, 45, 46, 47, 48, 49; 40
		db 50, 51, 52, 53, 54, 55, 56, 57, 58, 59; 50
		db 60, 61, 62, 63, 64, 65, 66, 67, 68, 69; 60
		db 70, 71, 72, 73, 74, 75, 76, 77, 78, 79; 70
		db 80, 81, 82, 83, 84, 85, 86, 87, 88, 89; 80
		db 90, 91, 92, 93, 94, 95, 96, 97, 98, 99; 90
		db 100,	101, 102, 103, 104, 105, 106, 107, 108,	109; 100
		db 110,	111, 0,	0, 0, 0, 0, 0, 0, 0; 110
		db 0, 0, 0, 0, 0, 0, 0,	0; 120
bii_classMap	db 0, 7, 5, 6, 8, 9, 3, 4,	2, 1, 0Ah; 0
		db 0Dh,	0Eh		; 11
a_tpw		db '*.tpw',0
a_tw		db '*.tw',0
oldCharFilters	dd a_tpw, a_tw	       ; 0
aAcorns		db 'Acorns',0
aArrowsOfLife	db 'Arrows of Life',0
aMalefia	db 'Malefia',0
aValarian	db 'Valarian',0
aLanatir	db 'Lanatir',0
aFerofist	db 'Ferofist',0
aSceadu		db 'Sceadu',0
aWerra		db 'Werra',0
aTarjan		db 'Tarjan',0
aSkaraBrae	db 'Skara Brae',0
aUnterbrae	db 'UnterBrae',0
aArboria	db 'Arboria',0
aGelidia	db 'Gelidia',0
aLucencia	db 'Lucencia',0
aKinestia	db 'Kinestia',0
aTenebrosia	db 'Tenebrosia',0
aTarmitia	db 'Tarmitia',0
aCieraBrannia	db 'Ciera Brannia',0
aCelariaBree	db 'Celaria Bree',0
aBlackScar	db 'Black Scar',0
aDarkCopse	db 'Dark Copse',0
aNowhere	db 'Nowhere',0
aFesteringPit	db 'Festering Pit',0
aSacredGrove	db 'Sacred Grove',0
aIceKeep	db 'Ice Keep',0
aShadowCanyon	db 'Shadow Canyon',0
aTarQuarry	db 'Tar Quarry',0
aColdPeak	db 'Cold Peak',0
aCrystalSpring	db 'Crystal Spring',0
aOldDwarfMine	db 'Old Dwarf Mine',0
aShadowRock	db 'Shadow Rock',0
aSulphurSprings	db 'Sulphur Springs',0
aWarriorsVale	db 'Warriors Vale',0
aBrilhasti	db 'Brilhasti',0
aUrmech		db 'Urmech',0
aTslotha	db 'Tslotha',0
aCyanis		db 'Cyanis',0
aTheOldMan	db 'The Old Man',0
aHawkslayer	db 'Hawkslayer',0
aVioletMountain	db 'Violet Mountains',0
aCrystalPalace	db 'Crystal Palace',0
aCatacombs	db 'Catacombs',0
aTunnels	db 'Tunnels',0
aWorkshop	db 'Workshop',0
aWizardSGuild	db 'Wizard',27h,'s Guild',0
align 2
aToTraverseTime	db 'To traverse time and space, you must first recite the alignment value of ',0
aAnd_0		db ', and ',0
align 2
asc_4C8DA	db ', ',0
align 2
a__0		db '.',0
aYouHaveFailedT	db 'You have failed to recite the proper alignment pattern!',0
off_4C918	dd aArefolia, aAcorns ; 0
		dd aArrowsOfLife, aCrystalKey; 2
		dd aCrownOfTruth, aStrifespear; 4
		dd aRainbowRose, aCrystalLens; 6
		dd aSmokeyLens, aBlackLens;	8
		dd aShadowDoor, aShadowLock; 10
		dd aWineskin,	aNightspear; 12
		dd aHammerOfWrath, aWandOfPower; 14
off_4C958	dd aMalefia, aValarian  ; 0
		dd aLanatir, aAlliria	; 2
		dd aFerofist, aSceadu	; 4
		dd aWerra, aTarjan	; 6
		dd aSkaraBrae, aUnterbrae; 8
		dd aArboria, aGelidia	; 10
		dd aLucencia, aKinestia	; 12
		dd aTenebrosia,	aTarmitia; 14
off_4C998	dd aCieraBrannia, aCelariaBree; 0
		dd aBlackScar, aDarkCopse; 2
		dd aNowhere, aFesteringPit; 4
		dd aSacredGrove, aIceKeep; 6
		dd aShadowCanyon, aTarQuarry; 8
		dd aColdPeak, aCrystalSpring; 10
		dd aOldDwarfMine, aShadowRock; 12
		dd aSulphurSprings, aWarriorsVale; 14
off_4C9D8	dd aBrilhasti, aUrmech  ; 0
		dd aTslotha, aCyanis	; 2
		dd aTheOldMan, aHawkslayer; 4
		dd aScrapwood, aBardSHall; 6
		dd aStaggerInn, aHicHaven; 8
		dd aVioletMountain, aCrystalPalace; 10
		dd aCatacombs, aTunnels	; 12
		dd aWorkshop, aWizardSGuild; 14
byte_4CA18	db 0, 4		   ; 0
		db 12h,	17h		; 2
		db 25h,	31h		; 4
		db 33h,	46h		; 6
		db 54h,	62h		; 8
		db 66h,	70h		; 10
		db 83h,	85h		; 12
		db 91h,	97h		; 14
byte_4CA28	db 0Dh
byte_4CA29	db 7
		db    0
		db    2
		db    6
		db    9
		db  0Fh
		db    3
		db    5
		db  0Ch
		db  0Ah
		db    1
		db  0Eh
		db    8
		db    4
		db  0Bh
byte_4CA38	db 1
		db  0Fh
		db  7Fh	; 
		db 0FFh
		db    0
		db    0
		db    0
byte_4CA3F	db 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3
		db 3, 3, 3, 3, 3, 3, 3,	3, 3, 3, 3, 3, 3, 3, 3,	3
		db 4, 4, 4, 4, 4, 4, 4,	4, 4, 4, 4, 4, 4, 4, 4,	4
		db 4, 4, 4, 4, 4, 4, 4,	4, 4, 4, 4, 4, 4, 4, 4,	4
		db 4, 4, 4, 4, 4, 4, 4,	4, 4, 4, 4, 4, 4, 4, 4,	4
		db 5, 5, 5, 5, 5, 5, 5,	5, 5, 5, 5, 5, 5, 5, 5,	5
		db 5, 5, 5, 5, 5, 5, 5,	5, 5, 5, 5, 5, 5, 5, 5,	5
		db 5, 5, 5, 5, 5, 5, 5,	5, 5, 5, 5, 5, 5, 5, 5,	5
		db 5, 5, 5, 5, 5, 5, 5,	5, 5, 5, 5, 5, 5, 5, 5,	5
		db 6, 6, 6, 6, 6, 6, 6,	6, 6, 6, 6, 6, 6, 6, 6,	6
		db 6, 6, 6, 6, 6, 6, 6,	6, 6, 6, 6, 6, 6, 6, 6,	6
		db 6, 6, 6, 6, 6, 6, 6,	6, 6, 6, 6, 6, 6, 6, 6,	6
		db 7, 7, 7, 7, 7, 7, 7,	7, 7, 7, 7, 7, 7, 7, 7,	7
		db 7, 7, 7, 7, 7, 7, 7,	7, 7, 7, 7, 7, 7, 7, 7,	7
		db 7, 7, 7, 7, 7, 7, 7,	7, 7, 7, 7, 7, 7, 7, 7,	7
		db 8, 8, 8, 8, 8, 8, 8,	8, 8, 8, 8, 8, 8, 8, 8,	8
byte_4CB3F	db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0; 0
		db 0, 0, 0, 0, 0, 0, 0,	0, 0, 0, 0, 0, 0, 0, 0,	0; 16
		db 1, 1, 1, 1, 1, 1, 1,	1, 1, 1, 1, 1, 1, 1, 1,	1; 32
		db 2, 2, 2, 2, 2, 2, 2,	2, 2, 2, 2, 2, 2, 2, 2,	2; 48
		db 3, 3, 3, 3, 3, 3, 3,	3, 3, 3, 3, 3, 3, 3, 3,	3; 64
		db 4, 4, 4, 4, 4, 4, 4,	4, 5, 5, 5, 5, 5, 5, 5,	5; 80
		db 6, 6, 6, 6, 6, 6, 6,	6, 7, 7, 7, 7, 7, 7, 7,	7; 96
		db 8, 8, 8, 8, 8, 8, 8,	8, 9, 9, 9, 9, 9, 9, 9,	9; 112
		db 0Ah,	0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Bh,	0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh; 128
		db 0Ch,	0Ch, 0Ch, 0Ch, 0Dh, 0Dh, 0Dh, 0Dh, 0Eh,	0Eh, 0Eh, 0Eh, 0Fh, 0Fh, 0Fh, 0Fh; 144
		db 10h,	10h, 10h, 10h, 11h, 11h, 11h, 11h, 12h,	12h, 12h, 12h, 13h, 13h, 13h, 13h; 160
		db 14h,	14h, 14h, 14h, 15h, 15h, 15h, 15h, 16h,	16h, 16h, 16h, 17h, 17h, 17h, 17h; 176
		db 18h,	18h, 19h, 19h, 1Ah, 1Ah, 1Bh, 1Bh, 1Ch,	1Ch, 1Dh, 1Dh, 1Eh, 1Eh, 1Fh, 1Fh; 192
		db 20h,	20h, 21h, 21h, 22h, 22h, 23h, 23h, 24h,	24h, 25h, 25h, 26h, 26h, 27h, 27h; 208
		db 28h,	28h, 29h, 29h, 2Ah, 2Ah, 2Bh, 2Bh, 2Ch,	2Ch, 2Dh, 2Dh, 2Eh, 2Eh, 2Fh, 2Fh; 224
		db 30h,	31h, 32h, 33h, 34h, 35h, 36h, 37h, 38h,	39h, 3Ah, 3Bh, 3Ch, 3Dh, 3Eh, 3Fh; 240
_d3cmp_baseAddr	dw 0
word_4CC41	dw 0
_d3cmp_offset	dw 0
countMaybe	dd 0
		db 0
		db 0
word_4CC4B	dw 2196 dup(0)
dataHeader	dd 0
		db    0
		db    0
		db    0
		db    0
byte_4DD7B	db 103Bh dup(20h)	   ; 0
workBuf		dw 40h dup(0)		; 0
		db    0
		db    0
workBufIndex	dw	0
curFromOffset	dw 0
curFromSegment	dw 0
		db    0
		db    0
		db    0
		db    0
curToSegment	dw	0
curToOffset	dw 0
word_4EE46	dw 0
word_4EE48	dw 0
word_4EE4A	dw 0
word_4EE4C	dw 0
word_4EE4E	dw 0
word_4EE50	dw 0
randomSeed	dw 0
currentLocationMaybe dw	0
dunLevelIndex	dw 0
dunLevelNum	dw 0
sq_north	dw 0
sq_east		dw 0
dirFacing	dw 0
inDungeonMaybe	dw 0
buildingRvalMaybe dw 0
word_4EE66	dw 0
curSpellNo	dw 0
mfuncFlags	db 7 dup(0)     ; 0
byte_4EE71	db 0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
_mfunc_regs	dw 20h dup(0)	    ; 0
byte_4EEBA	db 0
lightDistance	db 0
byte_4EEBC	db 0
lightDuration		db 0
compassDuration		db 0
detectDuration		db 0
shieldDuration		db 0
levitationDuration	db 0
detectType		db 0
byte_4EEC3	db 0
byte_4EEC4	db 0
levelNoMaybe	db 0
levFlags	db 0
dunWidth	db 0
dunHeight	db 0
byte_4EEC9	db 0
partyAttackFlag	db 0
byte_4EECB	db 0
byte_4EECC	db 0
byte_4EECD	db 0FFh, 7 dup(0), 8 dup(1), 7 dup(0)
		db 0FFh, 8 dup(80h), 6Bh, 8; 23
		db 6 dup(0), 2 dup(1), 0, 2 dup(6); 34
		db 0, 2 dup(1), 6 dup(0), 8; 45
		db 6Bh, 2 dup(80h), 0, 2 dup(30h); 55
		db 0, 2 dup(80h), 55h, 7 dup(0); 61
		db 2 dup(1), 0, 2 dup(1), 0; 72
		db 2 dup(1), 7 dup(0), 55h, 2 dup(80h); 78
		db 0, 2 dup(80h), 0, 2 dup(80h); 90
		db 2 dup(0), 8, 2 dup(1Ch), 8; 96
		db 3 dup(0), 66h, 3Ch, 2 dup(18h); 102
		db 3Ch, 66h, 0, 8 dup(0FFh); 109
		db 2 dup(0)           
aFaster		db 0Ah,'<Faster...>',0Ah,0
aSlower		db 0Ah,'<Slower...>',0Ah,0
txtDelayTable	db 1, 4, 7, 0Bh, 0Eh, 11h, 14h, 17h, 1Ah, 1Dh
txtDelayIndex	db 7
_clockTicks	dw 0
word_4EF49	dw 0
byte_4EF4B	db 0
byte_4EF4C	db 0
byte_4EF4D	db 0
align 4
byte_4EF50	db 0
byte_4EF51	db 0
byte_4EF52	db 0
byte_4EF53	db 0
spell_mouseClicked	db 0
mouse_moved	db 0
mouse_x		dw 0DCh
mouse_y		dw 0
word_4EF59	dw 0
word_4EF5B	dw 0
byte_4EF5D	db 0
byte_4EF5E	db 0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db    0
		db  0Ah
		db    0
		db    0
		db    0
		db    0
		db    0
word_4EF6F	dw 3F8h
		db    4
		db    0
		db    0
		db 0B8h	; 
		db    1
		db    0
		db    0
		db    0
byte_4EF79	db 1
byte_4EF7A	db 0
align 2
word_4EF7C	dw 0
word_4EF7E	dw 0
off_4EF80	dw offset sub_2843B
word_4EF82	dw 0
		dw seg dseg
		db 4Ch dup(0)
off_4EFD2	dw offset word_4EF82
aC_file_info	db ';C_FILE_INFO',0
dword_4EFE1	dd 0
		db 8 dup(0)
word_4EFED	dw 0
		db 4 dup(0)
word_4EFF3	dw 0
word_4EFF5	dw 0
		db 0
byte_4EFF8	db 0
align 2
word_4EFFA	dw 14h
byte_4EFFC	db 3 dup(81h), 2 dup(1), 0Fh dup(0)
word_4F010	dw 0
word_4F012	dw 0
word_4F014	dw 0
word_4F016	dw 0
word_4F018	dw 0
off_4F01A	dd unk_4F01E
unk_4F01E	db  43h	; C
		db    0
		db    0
		db    0
byte_4F022	db 0
byte_4F023	db 0
dword_4F024	dd 0
unk_4F028	db	0
		db    0
word_4F02A	dw 0
dword_4F02C	dd 0FFFFFFFFh
word_4F030	dw (offset dseg_end+102h)
dword_4F032	dd 0
byte_4F036	db 0, 16h, 2 dup(2), 18h
		db 0Dh, 9, 3 dup(0Ch), 7; 5
		db 8, 2 dup(16h), 0FFh, 12h; 11
		db 0Dh, 12h, 2, 0FFh    ; 16
word_4F04A	dw 0
byte_4F04C	db 200h dup(0)
byte_4F24C	db 200h dup(0)
byte_4F44C	db 200h dup(0)
off_4F64C	dw offset byte_4F04C
		dw seg dseg
		db    0
		db    0
		dd byte_4F04C
		db    1
		db    0
byte_4F658	db 0Ah dup(0), 2, 1
byte_4F664	db 0Ah dup(0), 2 dup(2), 0Ah dup(0), 84h, 3, 0Ah dup(0), 2, 4
		db 0A8h dup(0)
byte_4F730	db 0Ch dup(0)
byte_4F73C	db 1, 2 dup(0), 2, 74h dup(0)
word_4F7B4	dw offset byte_4F730
seg_4F7B6	dw seg dseg
word_4F7B8	dw 0
aNull		db '(null)',0
aNull_0		db '(null)',0
asc_4F7C8	db '+- #',0
align 2
word_4F7CE	dw 0
word_4F7D0	dw 0
align 4
word_4F7D4	dw 0
align 4
word_4F7D8	dw 0
word_4F7DA	dw 0
word_4F7DC	dw 0
word_4F7DE	dw 2000h
word_4F7E0	dw 0
byte_4F7E2	db 0
align 2
off_4F7E4	dd sub_284E6
off_4F7E8	dd sub_284E6
off_4F7EC	dd sub_284E6
off_4F7F0	dd sub_284E6
off_4F7F4	dd sub_284E6
		db    0
		db    0
		db    0
		db    0
		db    1
		db    1
		db    0
sscanf_charFlags	db 32, 32, 32, 32, 32, 32, 32, 32
		db 32, 40, 40, 40, 40, 40, 32, 32
		db 32, 32, 32, 32, 32, 32, 32, 32
		db 32, 32, 32, 32, 32, 32, 32, 32
		db 72, 16, 16, 16, 16, 16, 16, 16
		db 16, 16, 16, 16, 16, 16, 16, 16
		db 132,	132, 132, 132, 132, 132, 132, 132
		db 132,	132, 16, 16, 16, 16, 16, 16
		db 16, 129, 129, 129, 129, 129,	129, 1
		db 1, 1, 1, 1, 1, 1, 1,	1
		db 1, 1, 1, 1, 1, 1, 1,	1
		db 1, 1, 1, 16,	16, 16,	16, 16
		db 16, 130, 130, 130, 130, 130,	130, 2
		db 2, 2, 2, 2, 2, 2, 2,	2
		db 2, 2, 2, 2, 2, 2, 2,	2
		db 2, 2, 2, 16,	16, 16,	16, 32
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0, 0, 0, 0, 0, 0, 0,	0
		db 0
word_4F900	dw 0FFFFh
align 4
unk_4F904	db	0
db    0
word_4F906	dw 0
dword_4F908	dd 0
dword_4F90C	dd 0
off_4F910	dd sub_28846
seg027_41	dw seg seg027
dseg_x		dw seg dseg
seg027_x	dw seg	seg027
seg022_x	dw seg	seg022
seg023_x	dw seg seg023
aNmsg		db '<<NMSG>>',0
align 2
aR6000StackOver	db 'R6000',0Dh,0Ah
		db '- stack overflow',0Dh,0Ah,0
		db    3
		db    0
		db  52h	; R
		db  36h	; 6
		db  30h	; 0
		db  30h	; 0
		db  33h	; 3
		db  0Dh
		db  0Ah
		db  2Dh	; -
		db  20h
		db  69h	; i
		db  6Eh	; n
		db  74h	; t
		db  65h	; e
		db  67h	; g
		db  65h	; e
		db  72h	; r
		db  20h
		db  64h	; d
		db  69h	; i
		db  76h	; v
		db  69h	; i
		db  64h	; d
		db  65h	; e
		db  20h
		db  62h	; b
		db  79h	; y
		db  20h
		db  30h	; 0
		db  0Dh
		db  0Ah
		db    0
		db    9
		db    0
		db  52h	; R
		db  36h	; 6
		db  30h	; 0
		db  30h	; 0
		db  39h	; 9
		db  0Dh
		db  0Ah
		db  2Dh	; -
		db  20h
		db  6Eh	; n
		db  6Fh	; o
		db  74h	; t
		db  20h
		db  65h	; e
		db  6Eh	; n
		db  6Fh	; o
		db  75h	; u
		db  67h	; g
		db  68h	; h
		db  20h
		db  73h	; s
		db  70h	; p
		db  61h	; a
		db  63h	; c
		db  65h	; e
		db  20h
		db  66h	; f
		db  6Fh	; o
		db  72h	; r
		db  20h
		db  65h	; e
		db  6Eh	; n
		db  76h	; v
		db  69h	; i
		db  72h	; r
		db  6Fh	; o
		db  6Eh	; n
		db  6Dh	; m
		db  65h	; e
		db  6Eh	; n
		db  74h	; t
		db  0Dh
		db  0Ah
		db    0
		db 0FCh	; 
		db    0
		db  0Dh
		db  0Ah
		db    0
		db 0FFh
		db    0
		db  72h	; r
		db  75h	; u
		db  6Eh	; n
		db  2Dh	; -
		db  74h	; t
		db  69h	; i
		db  6Dh	; m
		db  65h	; e
		db  20h
		db  65h	; e
		db  72h	; r
		db  72h	; r
		db  6Fh	; o
		db  72h	; r
		db  20h
		db    0
		db    2
		db    0
		db  52h	; R
		db  36h	; 6
		db  30h	; 0
		db  30h	; 0
		db  32h	; 2
		db  0Dh
		db  0Ah
		db  2Dh	; -
		db  20h
		db  66h	; f
		db  6Ch	; l
		db  6Fh	; o
		db  61h	; a
		db  74h	; t
		db  69h	; i
		db  6Eh	; n
		db  67h	; g
		db  20h
		db  70h	; p
		db  6Fh	; o
		db  69h	; i
		db  6Eh	; n
		db  74h	; t
		db  20h
		db  6Eh	; n
		db  6Fh	; o
		db  74h	; t
		db  20h
		db  6Ch	; l
		db  6Fh	; o
		db  61h	; a
		db  64h	; d
		db  65h	; e
		db  64h	; d
		db  0Dh
		db  0Ah
		db    0
		db    1
		db    0
		db  52h	; R
		db  36h	; 6
		db  30h	; 0
		db  30h	; 0
		db  31h	; 1
		db  0Dh
		db  0Ah
		db  2Dh	; -
		db  20h
		db  6Eh	; n
		db  75h	; u
		db  6Ch	; l
		db  6Ch	; l
		db  20h
		db  70h	; p
		db  6Fh	; o
		db  69h	; i
		db  6Eh	; n
		db  74h	; t
		db  65h	; e
		db  72h	; r
		db  20h
		db  61h	; a
		db  73h	; s
		db  73h	; s
		db  69h	; i
		db  67h	; g
		db  6Eh	; n
		db  6Dh	; m
		db  65h	; e
		db  6Eh	; n
		db  74h	; t
		db  0Dh
		db  0Ah
		db    0
		db 0FFh
		db 0FFh
		db 0FFh
		db    0
word_4FD56	dw 0
tav_drunkLevel	db 8 dup(0)	       ; 0
curStrByte	db ?
align 2
dataBufOff	dw ?
dataBufSeg	dw ?
bitsLeft	dw ?
_str_capFlag	dw	?
align 4
word_4FD6C	dw ?
sscanf_structP	dd ?
word_4FD72	dw ?
word_4FD74	dw ?
sscanf_argSizeFlag	dw ?
sscanf_charListFlag	dw ?
word_4FD7A	dw ?
dword_4FD7C	dd ?
sscanf_bufp	dd ?
word_4FD84	dw ?
sscanf_buf	db 100h dup(?)
sscanf_minWidth dw ?
sscanf_noAssign dw ?
word_4FE8A	dw ?
word_4FE8C	dw ?
_sscanf_floatBuf	db 42h dup(?)
word_4FED0	dw ?
word_4FED2	dw ?
word_4FED4	dw ?
dword_4FED6	dd ?
word_4FEDA	dw ?
word_4FEDC	dw ?
word_4FEDE	dw ?
word_4FEE0	dw ?
byte_4FEE2	db 0Ch dup(?)
word_4FEEE	dw ?
dword_4FEF0	dd ?
word_4FEF4	dw ?
word_4FEF6	dw ?
word_4FEF8	dw ?
word_4FEFA	dw ?
word_4FEFC	dw ?
word_4FEFE	dw ?
word_4FF00	dw ?
word_4FF02	dw ?
word_4FF04	dw ?
word_4FF06	dw ?
byte_4FF08	db 15Eh dup(?)
word_50066	dw ?
word_50068	dw ?
byte_5006A	db 4 dup(?)
dseg_end	db ?
		db ?
align 8
dseg ends

; Segment type:	Uninitialized
seg029 segment word stack 'STACK' use16
	assume cs:seg029
	assume es:nothing, ss:nothing, ds:dseg,	fs:nothing, gs:nothing
byte_50070 db 0FA0h dup(?)
seg029 ends

end start
